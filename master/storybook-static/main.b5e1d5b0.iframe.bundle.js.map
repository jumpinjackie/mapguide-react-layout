{"version":3,"file":"main.b5e1d5b0.iframe.bundle.js","mappings":"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","sources":["webpack://mapguide-react-layout/./.storybook/generated-stories-entry.js","webpack://mapguide-react-layout/./.storybook/preview.js","webpack://mapguide-react-layout/./.storybook/preview.js-generated-config-entry.js","webpack://mapguide-react-layout/./src/actions/defs.ts","webpack://mapguide-react-layout/./src/actions/flyout.ts","webpack://mapguide-react-layout/./src/actions/init-command.ts","webpack://mapguide-react-layout/./src/actions/init-mapguide.ts","webpack://mapguide-react-layout/./src/actions/init.ts","webpack://mapguide-react-layout/./src/actions/legend.ts","webpack://mapguide-react-layout/./src/actions/map.ts","webpack://mapguide-react-layout/./src/actions/modal.ts","webpack://mapguide-react-layout/./src/actions/taskpane.ts","webpack://mapguide-react-layout/./src/actions/template.ts","webpack://mapguide-react-layout/./src/api/base-layer-set.ts","webpack://mapguide-react-layout/./src/api/bootstrap.ts","webpack://mapguide-react-layout/./src/api/builders/deArrayify.ts","webpack://mapguide-react-layout/./src/api/builders/factory.ts","webpack://mapguide-react-layout/./src/api/builders/mapagent.ts","webpack://mapguide-react-layout/./src/api/client.ts","webpack://mapguide-react-layout/./src/api/common.ts","webpack://mapguide-react-layout/./src/api/composite-selection.ts","webpack://mapguide-react-layout/./src/api/contracts/weblayout.ts","webpack://mapguide-react-layout/./src/api/error.ts","webpack://mapguide-react-layout/./src/api/expr-eval-context.ts","webpack://mapguide-react-layout/./src/api/generic-layer-set.ts","webpack://mapguide-react-layout/./src/api/i18n.ts","webpack://mapguide-react-layout/./src/api/layer-manager.ts","webpack://mapguide-react-layout/./src/api/layer-manager/csv-driver.ts","webpack://mapguide-react-layout/./src/api/layer-manager/driver-registry.ts","webpack://mapguide-react-layout/./src/api/layer-manager/format-driver.ts","webpack://mapguide-react-layout/./src/api/layer-manager/parsed-features.ts","webpack://mapguide-react-layout/./src/api/layer-set-group-base.ts","webpack://mapguide-react-layout/./src/api/layer-set.ts","webpack://mapguide-react-layout/./src/api/lazy.ts","webpack://mapguide-react-layout/./src/api/mg-layer-set-group.ts","webpack://mapguide-react-layout/./src/api/ol-factory.ts","webpack://mapguide-react-layout/./src/api/ol-mapguide-source-factory.ts","webpack://mapguide-react-layout/./src/api/ol-style-builders.ts","webpack://mapguide-react-layout/./src/api/ol-style-contracts.ts","webpack://mapguide-react-layout/./src/api/ol-style-helpers.ts","webpack://mapguide-react-layout/./src/api/ol-style-map-set.ts","webpack://mapguide-react-layout/./src/api/registry/command-spec.ts","webpack://mapguide-react-layout/./src/api/registry/command.ts","webpack://mapguide-react-layout/./src/api/registry/component.tsx","webpack://mapguide-react-layout/./src/api/registry/external-layer.ts","webpack://mapguide-react-layout/./src/api/registry/layout.ts","webpack://mapguide-react-layout/./src/api/registry/projections.ts","webpack://mapguide-react-layout/./src/api/request-builder.ts","webpack://mapguide-react-layout/./src/api/runtime.ts","webpack://mapguide-react-layout/./src/api/selection-count.ts","webpack://mapguide-react-layout/./src/api/session-store.ts","webpack://mapguide-react-layout/./src/components/accordion.tsx","webpack://mapguide-react-layout/./src/components/base-layer-switcher.tsx","webpack://mapguide-react-layout/./src/components/color-picker.tsx","webpack://mapguide-react-layout/./src/components/context.ts","webpack://mapguide-react-layout/./src/components/error.tsx","webpack://mapguide-react-layout/./src/components/external-layer-factory.ts","webpack://mapguide-react-layout/./src/components/icon.tsx","webpack://mapguide-react-layout/./src/components/layer-manager/add-layer.tsx","webpack://mapguide-react-layout/./src/components/layer-manager/add-wfs-layer.tsx","webpack://mapguide-react-layout/./src/components/layer-manager/add-wms-layer.tsx","webpack://mapguide-react-layout/./src/components/layer-manager/color-brewer.tsx","webpack://mapguide-react-layout/./src/components/layer-manager/common.tsx","webpack://mapguide-react-layout/./src/components/layer-manager/legend.ts","webpack://mapguide-react-layout/./src/components/layer-manager/manage-layers.tsx","webpack://mapguide-react-layout/./src/components/layer-manager/wfs-capabilities-panel.tsx","webpack://mapguide-react-layout/./src/components/layer-manager/wfs-capabilities-parser.ts","webpack://mapguide-react-layout/./src/components/layer-manager/wms-capabilities-panel.tsx","webpack://mapguide-react-layout/./src/components/legend.tsx","webpack://mapguide-react-layout/./src/components/map-load-indicator.tsx","webpack://mapguide-react-layout/./src/components/map-menu.tsx","webpack://mapguide-react-layout/./src/components/map-providers/base.ts","webpack://mapguide-react-layout/./src/components/map-providers/context.tsx","webpack://mapguide-react-layout/./src/components/map-providers/mapguide.ts","webpack://mapguide-react-layout/./src/components/mapguide-debug-context.ts","webpack://mapguide-react-layout/./src/components/mouse-coordinates.tsx","webpack://mapguide-react-layout/./src/components/navigator.tsx","webpack://mapguide-react-layout/./src/components/scale-display.tsx","webpack://mapguide-react-layout/./src/components/selected-feature-count.tsx","webpack://mapguide-react-layout/./src/components/selection-panel.tsx","webpack://mapguide-react-layout/./src/components/session-keep-alive.tsx","webpack://mapguide-react-layout/./src/components/task-pane.tsx","webpack://mapguide-react-layout/./src/components/toolbar.tsx","webpack://mapguide-react-layout/./src/components/tooltips/feature.ts","webpack://mapguide-react-layout/./src/components/tooltips/mouse.ts","webpack://mapguide-react-layout/./src/components/tooltips/selected-features.ts","webpack://mapguide-react-layout/./src/components/tooltips/utfgrid.ts","webpack://mapguide-react-layout/./src/components/vector-style-editor.tsx","webpack://mapguide-react-layout/./src/components/view-size.tsx","webpack://mapguide-react-layout/./src/constants.ts","webpack://mapguide-react-layout/./src/constants/actions.ts","webpack://mapguide-react-layout/./src/constants/assets.ts","webpack://mapguide-react-layout/./src/containers/add-manage-layers.tsx","webpack://mapguide-react-layout/./src/containers/app.tsx","webpack://mapguide-react-layout/./src/containers/base-layer-switcher.tsx","webpack://mapguide-react-layout/./src/containers/coordinate-tracker.tsx","webpack://mapguide-react-layout/./src/containers/hooks-generic.ts","webpack://mapguide-react-layout/./src/containers/hooks-mapguide.ts","webpack://mapguide-react-layout/./src/containers/hooks.ts","webpack://mapguide-react-layout/./src/containers/legend.tsx","webpack://mapguide-react-layout/./src/containers/map-menu.tsx","webpack://mapguide-react-layout/./src/containers/mouse-coordinates.tsx","webpack://mapguide-react-layout/./src/containers/navigator.tsx","webpack://mapguide-react-layout/./src/containers/neo-map-viewer.tsx","webpack://mapguide-react-layout/./src/containers/scale-display.tsx","webpack://mapguide-react-layout/./src/containers/selected-feature-count.tsx","webpack://mapguide-react-layout/./src/containers/selection-panel.tsx","webpack://mapguide-react-layout/./src/containers/subscriber.tsx","webpack://mapguide-react-layout/./src/containers/task-pane.tsx","webpack://mapguide-react-layout/./src/containers/url-state.ts","webpack://mapguide-react-layout/./src/containers/view-size.tsx","webpack://mapguide-react-layout/./src/containers/viewer-options.tsx","webpack://mapguide-react-layout/./src/reducers/config.ts","webpack://mapguide-react-layout/./src/reducers/init-error.ts","webpack://mapguide-react-layout/./src/reducers/last-action.ts","webpack://mapguide-react-layout/./src/reducers/map-state.ts","webpack://mapguide-react-layout/./src/reducers/modal.ts","webpack://mapguide-react-layout/./src/reducers/mouse.ts","webpack://mapguide-react-layout/./src/reducers/root.ts","webpack://mapguide-react-layout/./src/reducers/taskpane.ts","webpack://mapguide-react-layout/./src/reducers/template.ts","webpack://mapguide-react-layout/./src/reducers/toolbar.ts","webpack://mapguide-react-layout/./src/reducers/viewer.ts","webpack://mapguide-react-layout/./src/store/configure-store.ts","webpack://mapguide-react-layout/./src/store/logger.ts","webpack://mapguide-react-layout/./src/store/promise-middleware.ts","webpack://mapguide-react-layout/./src/stories/1.map.stories.tsx","webpack://mapguide-react-layout/./src/stories/2.common.stories.tsx","webpack://mapguide-react-layout/./src/stories/3.accordion.stories.tsx","webpack://mapguide-react-layout/./src/stories/fake-app.tsx","webpack://mapguide-react-layout/./src/stories/story-bootstrap.tsx","webpack://mapguide-react-layout/./src/strings/en.ts","webpack://mapguide-react-layout/./src/utils/array.ts","webpack://mapguide-react-layout/./src/utils/assert.ts","webpack://mapguide-react-layout/./src/utils/asset.ts","webpack://mapguide-react-layout/./src/utils/logger.ts","webpack://mapguide-react-layout/./src/utils/never.ts","webpack://mapguide-react-layout/./src/utils/number.ts","webpack://mapguide-react-layout/./src/utils/site-version.ts","webpack://mapguide-react-layout/./src/utils/string.ts","webpack://mapguide-react-layout/./src/utils/type-guards.ts","webpack://mapguide-react-layout/./src/utils/units.tsx","webpack://mapguide-react-layout/./src/utils/url.ts","webpack://mapguide-react-layout/./src/utils/viewer-state.ts","webpack://mapguide-react-layout/./src/stories/styles/accordion-slate.css","webpack://mapguide-react-layout/./src/styles/index.css","webpack://mapguide-react-layout/./stdassets/sprites/icons.css","webpack://mapguide-react-layout/./src/stories/styles/accordion-slate.css?d556","webpack://mapguide-react-layout/./src/styles/index.css?2763","webpack://mapguide-react-layout/\\.)("],"sourcesContent":["\"use strict\";\n\nvar _frameworkImportPath = require(\"@storybook/react\");\n\n/* eslint-disable import/no-unresolved */\n(0, _frameworkImportPath.configure)([require.context('../src/stories', false, /^\\.\\/(?:(?!\\.)(?=.)[^\\\\/]*?\\.stories\\.tsx)$/)], module, false);","//import '@storybook/addon-console';\nimport { configure, addParameters } from '@storybook/react';\nimport { INITIAL_VIEWPORTS, DEFAULT_VIEWPORT } from \"@storybook/addon-viewport\";\nimport \"../src/stories/story-bootstrap\";\n/*\naddParameters({\n  viewport: {\n    viewports: INITIAL_VIEWPORTS,\n    defaultViewport: DEFAULT_VIEWPORT,\n  },\n});\n\nconst req = require.context(\"../src/stories\", true, /.stories.tsx$/);\nfunction loadStories() {\n    req.keys().forEach(req);\n}\nconfigure(loadStories, module);\n*/\nexport const parameters = {\n  actions: { argTypesRegex: \"^on[A-Z].*\" },\n  controls: {\n    matchers: {\n      color: /(background|color)$/i,\n      date: /Date$/,\n    },\n  },\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/* eslint-disable import/no-unresolved */\nimport { addDecorator, addParameters, addLoader, addArgsEnhancer, addArgTypesEnhancer, setGlobalRender } from 'C:/projects/mapguide-react-layout/node_modules/@storybook/client-api';\nimport { logger } from 'C:/projects/mapguide-react-layout/node_modules/@storybook/client-logger';\nimport * as config from 'C:/projects/mapguide-react-layout/.storybook/preview.js';\nObject.keys(config).forEach(function (key) {\n  var value = config[key];\n\n  switch (key) {\n    case 'args':\n    case 'argTypes':\n      {\n        return logger.warn('Invalid args/argTypes in config, ignoring.', JSON.stringify(value));\n      }\n\n    case 'decorators':\n      {\n        return value.forEach(function (decorator) {\n          return addDecorator(decorator, false);\n        });\n      }\n\n    case 'loaders':\n      {\n        return value.forEach(function (loader) {\n          return addLoader(loader, false);\n        });\n      }\n\n    case 'parameters':\n      {\n        return addParameters(_objectSpread({}, value), false);\n      }\n\n    case 'argTypesEnhancers':\n      {\n        return value.forEach(function (enhancer) {\n          return addArgTypesEnhancer(enhancer);\n        });\n      }\n\n    case 'argsEnhancers':\n      {\n        return value.forEach(function (enhancer) {\n          return addArgsEnhancer(enhancer);\n        });\n      }\n\n    case 'render':\n      {\n        return setGlobalRender(value);\n      }\n\n    case 'globals':\n    case 'globalTypes':\n      {\n        var v = {};\n        v[key] = value;\n        return addParameters(v, false);\n      }\n\n    default:\n      {\n        // eslint-disable-next-line prefer-template\n        return console.log(key + ' was not supported :( !');\n      }\n  }\n});","/**\n * defs.ts\n * \n * Redux action definitions\n */\n\nimport { IDOMElementMetrics, IMapView, Dictionary, IExternalBaseLayer, IModalComponentDisplayOptions, IModalDisplayOptions, UnitOfMeasure, ActiveMapTool, ILayerInfo, Bounds, INameValuePair } from '../api/common';\nimport { ActionType } from '../constants/actions';\nimport { PreparedSubMenuSet } from '../api/registry/command-spec';\nimport { RuntimeMap } from '../api/contracts/runtime-map';\nimport { QueryMapFeaturesResponse } from '../api/contracts/query';\nimport { IVectorLayerStyle, IClusterSettings, VectorStyleSource } from '../api/ol-style-contracts';\nimport { Action } from 'redux';\nimport { ClientSelectionFeature } from '../api/contracts/common';\n\n/**\n * Opens the context menu\n * \n * @since 0.13\n */\nexport interface IOpenContextMenuAction {\n    type: ActionType.CONTEXT_MENU_OPEN;\n    payload: {\n        x: number;\n        y: number;\n    }\n}\n\nexport interface ICloseContextMenuAction {\n    type: ActionType.CONTEXT_MENU_CLOSE;\n}\n\n/**\n * Opens a flyout menu\n * \n * @since 0.12\n */\nexport interface IOpenFlyoutAction {\n    type: ActionType.FLYOUT_OPEN;\n    payload: {\n        flyoutId: string;\n        metrics: IDOMElementMetrics;\n    }\n}\n\n/**\n * Closes a flyout menu\n * \n * @since 0.12\n */\nexport interface ICloseFlyoutAction {\n    type: ActionType.FLYOUT_CLOSE;\n    payload: {\n        flyoutId: string;\n    }\n}\n\n/**\n * Opens a registered component in the given flyout\n * \n * @since 0.12\n */\nexport interface IOpenComponentInFlyoutAction {\n    type: ActionType.COMPONENT_OPEN;\n    payload: {\n        flyoutId: string;\n        metrics: IDOMElementMetrics;\n        name: string;\n        props: any;\n    }\n}\n\n/**\n * Closes a registered component in the given flyout\n *\n * @since 0.12\n */\nexport interface ICloseComponentInFlyoutAction {\n    type: ActionType.COMPONENT_CLOSE;\n    payload: {\n        flyoutId: string;\n    }\n}\n\n/**\n * Metadata about the generic subject layer\n * \n * @export\n * @interface IGenericSubjectMapLayerMetadata\n * @since 0.14\n */\nexport interface IGenericSubjectMapLayerMetadata {\n    /**\n     * The bounds of this layer\n     *\n     * @type {Bounds}\n     * @memberof IGenericSubjectMapLayerMetadata\n     */\n    extents: Bounds;\n    /**\n     * The projection of this layer\n     *\n     * @type {string}\n     * @memberof IGenericSubjectMapLayerMetadata\n     */\n    projection: string;\n    /**\n     * An other arbitrary metadata properties\n     */\n    properties?: any;\n    /**\n     * If true, the GeoJSON layer will be loaded as a vector tile layer. Has no effect if this layer is not a GeoJSON layer\n     */\n    geojson_as_vt?: boolean;\n}\n\n/**\n * Valid generic subject layer types\n * \n * @export\n * @enum {string}\n * @since 0.14\n */\nexport enum GenericSubjectLayerType {\n    /**\n     * A tiled WMS layer\n     */\n    TileWMS = \"TileWMS\",\n    /**\n     * A vector layer based on an external CSV file\n     */\n    CSV = \"CSV\",\n    /**\n     * A vector layer based on an external KML file\n     */\n    KML = \"KML\",\n    /**\n     * A vector layer based on an external GeoJSON file\n     */\n    GeoJSON = \"GeoJSON\",\n    /**\n     * A vector layer based on an inline GeoJSON fragment\n     */\n    GeoJSON_Inline = \"GeoJSON_Inline\",\n    /**\n     * A vector layer based on a custom-defined format whose driver was registered with {@link ExternalLayerFactoryRegistry.registerExternalVectorLayerCreator}\n     */\n    CustomVector = \"CustomVector\",\n    /**\n     * A vector layer based on a Mapbox Vector Tile set\n     */\n    MVT = \"MVT\"\n}\n\n/**\n * Defines an expression for a popup link\n */\nexport interface IPopupLinkExpression {\n    expression: string;\n    placeholderBegin?: string;\n    placeholderEnd?: string;\n}\n\n/**\n * Popup link control options\n *\n * @export\n * @interface ISelectedFeaturePopupLinkProperty\n * @since 0.14\n */\nexport interface ISelectedFeaturePopupLinkProperty {\n    /**\n     * The feature property that contains the link\n     *\n     * @type {string}\n     * @memberof ISelectedFeaturePopupLinkProperty\n     */\n    name: string | IPopupLinkExpression;\n    /**\n     * The anchor label to render\n     *\n     * @type {string}\n     * @memberof ISelectedFeaturePopupLinkProperty\n     */\n    label: string;\n    /**\n     * The hyperlink target\n     *\n     * @type {string}\n     * @memberof ISelectedFeaturePopupLinkProperty\n     */\n    linkTarget: string;\n}\n\n/**\n * Selected feature popup configuration for an external layer\n *\n * @export\n * @interface ISelectedFeaturePopupTemplateConfiguration\n * @since 0.14\n */\nexport interface ISelectedFeaturePopupTemplateConfiguration {\n    /**\n     * Custom popup title. If not set, the default title \"Feature Properties\" \n     * (string value dependent on your locale's string bundle) will be used\n     *\n     * @type {string}\n     * @memberof ISelectedFeaturePopupTemplateConfiguration\n     */\n    title?: string;\n    /**\n     * The popup title for a selected cluster. If not set, the default title \"Cluster Properties\"\n     * (string value dependent on your locale's string bundle) will be used\n     * @since 0.14\n     */\n    clusteredTitle?: (size: number) => string;\n    /**\n     * If specified, restricts the display of feature properties only to what is\n     * specified here. The value part determines the display label.\n     *\n     * @type {INameValuePair[]}\n     * @memberof ISelectedFeaturePopupTemplateConfiguration\n     */\n    propertyMappings?: INameValuePair[];\n    /**\n     * If specified, controls link display for the popup\n     *\n     * @type {INameValuePair}\n     * @memberof ISelectedFeaturePopupTemplateConfiguration\n     */\n    linkProperty?: ISelectedFeaturePopupLinkProperty;\n}\n\n/**\n * \n * @export\n * @interface IGenericSubjectMapLayer\n * @since 0.14\n */\nexport interface IGenericSubjectMapLayer {\n    type: GenericSubjectLayerType;\n    meta: IGenericSubjectMapLayerMetadata | undefined;\n    layerOptions: any;\n    sourceParams: any;\n    name: string;\n    description?: string;\n    displayName?: string;\n    initiallyVisible: boolean;\n    selectable: boolean;\n    vectorStyle?: IVectorLayerStyle;\n    cluster?: IClusterSettings;\n    attributions?: string[];\n    popupTemplate?: ISelectedFeaturePopupTemplateConfiguration;\n    /**\n     * The driver name for custom external layers\n     */\n    driverName?: string;\n}\n\nexport type IInitialExternalLayer = IGenericSubjectMapLayer;\n\nexport function isGenericSubjectMapLayer(map: RuntimeMap | IGenericSubjectMapLayer): map is IGenericSubjectMapLayer {\n    return typeof((map as any)?.type) == 'string';\n}\n\n/**\n * @since 0.12\n */\nexport type MapInfo = {\n    mapGroupId: string;\n    map: RuntimeMap | IGenericSubjectMapLayer | undefined;\n    initialView: IMapView | undefined;\n    externalBaseLayers: IExternalBaseLayer[];\n    /**\n     * The initial set of external layers\n     *\n     * @type {IInitialExternalLayer[]}\n     * @since 0.14\n     */\n    initialExternalLayers: IInitialExternalLayer[];\n}\n\n/**\n * @since 0.12\n */\nexport interface IRestoredSelectionSets {\n    [mapName: string]: QueryMapFeaturesResponse;\n}\n\n/**\n * @since 0.12\n */\nexport interface IInitAppActionPayload {\n    activeMapName: string;\n    initialView?: IMapView;\n    initialUrl: string;\n    initialTaskPaneWidth?: number;\n    initialInfoPaneWidth?: number;\n    locale: string;\n    maps: Dictionary<MapInfo>;\n    config: any;\n    capabilities: {\n        hasTaskPane: boolean,\n        hasTaskBar: boolean,\n        hasStatusBar: boolean,\n        hasNavigator: boolean,\n        hasSelectionPanel: boolean,\n        hasLegend: boolean,\n        hasToolbar: boolean,\n        hasViewSize: boolean\n    },\n    /**\n     * @since 0.13\n     */\n    featureTooltipsEnabled?: boolean;\n    initialShowLayers?: string[];\n    initialShowGroups?: string[];\n    initialHideLayers?: string[];\n    initialHideGroups?: string[];\n    toolbars: PreparedSubMenuSet;\n    warnings: string[];\n    /**\n     * @since 0.12\n     */\n    initialSelections?: IRestoredSelectionSets;\n    /**\n     * @since 0.12.5\n     */\n    initialActiveTool?: ActiveMapTool;\n}\n\n/**\n * Initializes the viewer application\n *\n * @since 0.12\n */\nexport interface IInitAppAction {\n    type: ActionType.INIT_APP;\n    payload: IInitAppActionPayload;\n}\n\n/**\n * @since 0.12.7\n */\nexport interface ISetLocaleAction {\n    type: ActionType.SET_LOCALE;\n    payload: string;\n}\n\nexport interface IInitErrorAction {\n    type: ActionType.INIT_ERROR,\n    payload: {\n        error: {\n            message: string;\n            stack: string[];\n        },\n        includeStack?: boolean;\n        options: any;\n    }\n}\n\nexport interface IAcknowledgeStartupWarningsAction {\n    type: ActionType.INIT_ACKNOWLEDGE_WARNINGS;\n}\n\nexport interface IElementState {\n    legendVisible: boolean;\n    taskPaneVisible: boolean;\n    selectionPanelVisible: boolean;\n}\n\n/**\n * @since 0.12\n */\nexport interface ITemplateSetElementStateAction {\n    type: ActionType.FUSION_SET_ELEMENT_STATE;\n    payload: IElementState;\n}\n\n/**\n * @since 0.12\n */\nexport interface ITemplateSetTaskPaneVisibilityAction {\n    type: ActionType.FUSION_SET_TASK_PANE_VISIBILITY;\n    payload: boolean;\n}\n\n/**\n * @since 0.12\n */\nexport interface ITemplateSetSelectionPanelVisibility {\n    type: ActionType.FUSION_SET_SELECTION_PANEL_VISIBILITY;\n    payload: boolean;\n}\n\n/**\n * @since 0.12\n */\nexport interface ITemplateSetLegendVisibility {\n    type: ActionType.FUSION_SET_LEGEND_VISIBILITY;\n    payload: boolean;\n}\n\n/**\n * @since 0.12\n */\nexport interface ITaskPaneBackAction {\n    type: ActionType.TASK_PANE_BACK;\n}\n\n/**\n * @since 0.12\n */\nexport interface ITaskPaneForwardAction {\n    type: ActionType.TASK_PANE_FORWARD;\n}\n\n/**\n * Pushes the given URL to the task pane navigation history stack\n * \n * @since 0.12\n */\nexport interface ITaskPanePushUrlAction {\n    type: ActionType.TASK_PANE_PUSH_URL;\n    payload: {\n        url: string;\n        silent?: boolean;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface ITaskPaneInvokeUrlAction {\n    type: ActionType.TASK_INVOKE_URL,\n    payload: {\n        url: string;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface ITaskPaneHomeAction {\n    type: ActionType.TASK_PANE_HOME;\n}\n\n/**\n * @since 0.12\n */\nexport interface IShowComponentInModalAction {\n    type: ActionType.MODAL_SHOW_COMPONENT;\n    payload: IModalComponentDisplayOptions;\n}\n\n/**\n * @since 0.12\n */\nexport interface IShowModalUrlAction {\n    type: ActionType.MODAL_SHOW_URL;\n    payload: IModalDisplayOptions;\n}\n\n/**\n * @since 0.12\n */\nexport interface ICloseModalAction {\n    type: ActionType.MODAL_CLOSE;\n    payload: string;\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetBusyCountAction {\n    type: ActionType.MAP_SET_BUSY_COUNT;\n    payload: number;\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetBaseLayerAction {\n    type: ActionType.MAP_SET_BASE_LAYER;\n    payload: {\n        mapName: string;\n        layerName: string;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetScaleAction {\n    type: ActionType.MAP_SET_SCALE;\n    payload: {\n        mapName: string;\n        scale: number;\n        resolution?: number;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetMouseCoordinatesAction {\n    type: ActionType.UPDATE_MOUSE_COORDINATES;\n    payload: {\n        mapName: string;\n        coord: any;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetLayerTransparencyAction {\n    type: ActionType.MAP_SET_LAYER_TRANSPARENCY;\n    payload: {\n        mapName: string;\n        layerName: string;\n        opacity: number;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetViewSizeUnitsAction {\n    type: ActionType.MAP_SET_VIEW_SIZE_UNITS;\n    payload: UnitOfMeasure;\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapPreviousViewAction {\n    type: ActionType.MAP_PREVIOUS_VIEW;\n    payload: {\n        mapName: string;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapNextViewAction {\n    type: ActionType.MAP_NEXT_VIEW;\n    payload: {\n        mapName: string;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetSelectionAction {\n    type: ActionType.MAP_SET_SELECTION;\n    payload: {\n        mapName: string;\n        selection: QueryMapFeaturesResponse | undefined;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapResizedAction {\n    type: ActionType.MAP_RESIZED;\n    payload: {\n        width: number;\n        height: number;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetViewAction {\n    type: ActionType.MAP_SET_VIEW;\n    payload: {\n        mapName: string;\n        view: IMapView;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface ISetActiveMapToolAction {\n    type: ActionType.MAP_SET_ACTIVE_TOOL;\n    payload: ActiveMapTool;\n}\n\n/**\n * @since 0.12\n */\nexport interface ISetActiveMapAction {\n    type: ActionType.MAP_SET_ACTIVE_MAP;\n    payload: string;\n}\n\n/**\n * @since 0.12\n */\nexport interface ISetFeatureTooltipsEnabledAction {\n    type: ActionType.MAP_SET_MAPTIP;\n    payload: boolean;\n}\n\n/**\n * @since 0.12\n */\nexport interface ISetManualFeatureTooltipsEnabledAction {\n    type: ActionType.MAP_SET_MANUAL_MAPTIP;\n    payload: boolean;\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetViewRotationAction {\n    type: ActionType.MAP_SET_VIEW_ROTATION;\n    payload: number;\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapSetViewRotationEnabledAction {\n    type: ActionType.MAP_SET_VIEW_ROTATION_ENABLED;\n    payload: boolean;\n}\n\n/**\n * @since 0.12\n */\nexport interface IShowSelectedFeatureAction {\n    type: ActionType.MAP_SHOW_SELECTED_FEATURE;\n    payload: {\n        mapName: string;\n        layerId: string;\n        selectionKey: string;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface ILegendSetGroupVisibilityAction {\n    type: ActionType.LEGEND_SET_GROUP_VISIBILITY;\n    payload: {\n        id: string;\n        value: boolean;\n        mapName: string;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface ILegendSetLayerVisibilityAction {\n    type: ActionType.LEGEND_SET_LAYER_VISIBILITY;\n    payload: {\n        id: string;\n        value: boolean;\n        mapName: string;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface ILegendSetGroupExpandedAction {\n    type: ActionType.LEGEND_SET_GROUP_EXPANDABLE;\n    payload: {\n        id: string;\n        value: boolean;\n        mapName: string;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface ILegendSetGroupSelectableAction {\n    type: ActionType.LEGEND_SET_LAYER_SELECTABLE;\n    payload: {\n        id: string;\n        value: boolean;\n        mapName: string;\n    }\n}\n\n/**\n * @since 0.12\n */\nexport interface IMapRefreshAction {\n    type: ActionType.MAP_REFRESH;\n    payload: {\n        mapName: string,\n        map: RuntimeMap\n    }\n}\n\n/**\n * An action to signal that a new external layer has been added for a given map\n * \n * @since 0.13\n * @since 0.14 payload.defaultStyle changed to IVectorLayerStyle\n */\nexport interface IAddedLayerAction {\n    type: ActionType.LAYER_ADDED,\n    payload: {\n        mapName: string,\n        layer: ILayerInfo,\n        defaultStyle?: IVectorLayerStyle\n    }\n}\n\n/**\n * @since 0.14\n */\nexport interface IExternalLayersReadyAction {\n    type: ActionType.EXTERNAL_LAYERS_READY,\n    payload: {\n        mapName: string\n    }\n}\n\n/**\n * Removes a given external layer for the given map\n * \n * @since 0.13\n */\nexport interface IRemoveLayerAction {\n    type: ActionType.REMOVE_LAYER,\n    payload: {\n        mapName: string,\n        layerName: string\n    }\n}\n\n/**\n * Sets the display order index for the given external layer for the given map\n * \n * @since 0.13\n */\nexport interface ISetLayerIndexAction {\n    type: ActionType.SET_LAYER_INDEX,\n    payload: {\n        mapName: string,\n        layerName: string,\n        index: number\n    }\n}\n\n/**\n * Sets the opacity for the given external layer for the given map\n * \n * @since 0.13\n */\nexport interface ISetLayerOpacityAction {\n    type: ActionType.SET_LAYER_OPACITY,\n    payload: {\n        mapName: string,\n        layerName: string,\n        opacity: number\n    }\n}\n\n/**\n * Sets the heatmap blur for the given external heatmap layer for the given map\n * \n * @since 0.14\n */\nexport interface ISetHeatmapLayerBlurAction {\n    type: ActionType.SET_HEATMAP_LAYER_BLUR,\n    payload: {\n        mapName: string,\n        layerName: string,\n        blur: number\n    }\n}\n\n/**\n * Sets the heatmap radius for the given external heatmap layer for the given map\n * \n * @since 0.14\n */\nexport interface ISetHeatmapLayerRadiusAction {\n    type: ActionType.SET_HEATMAP_LAYER_RADIUS,\n    payload: {\n        mapName: string,\n        layerName: string,\n        radius: number\n    }\n}\n\n/**\n * Sets the visibility for the given external layer for the given map\n * \n * @since 0.13\n */\nexport interface ISetLayerVisibilityAction {\n    type: ActionType.SET_LAYER_VISIBILITY,\n    payload: {\n        mapName: string,\n        layerName: string,\n        visible: boolean\n    }\n}\n\n/**\n * Sets the vector style for the given external layer for the given map\n * \n * @since 0.13\n * @since 0.14 payload.style changed to IVectorLayerStyle and which property added\n */\nexport interface ISetMapLayerVectorStyle {\n    type: ActionType.SET_LAYER_VECTOR_STYLE,\n    payload: {\n        mapName: string,\n        layerName: string,\n        style: IVectorLayerStyle,\n        which: VectorStyleSource\n    }\n}\n\n/**\n * Adds a busy worker for the given external layer for the given map\n * \n * @since 0.13\n */\nexport interface IAddMapLayerBusyWorkerAction {\n    type: ActionType.ADD_LAYER_BUSY_WORKER,\n    payload: {\n        mapName: string,\n        layerName: string\n    }\n}\n\n/**\n * Removes a busy worker for the given external layer for the given map\n * \n * @since 0.13\n */\nexport interface IRemoveMapLayerBusyWorkerAction {\n    type: ActionType.REMOVE_LAYER_BUSY_WORKER,\n    payload: {\n        mapName: string,\n        layerName: string\n    }\n}\n\n/**\n * Adds a feature to the client selection set for the given map\n * \n * @since 0.14\n */\nexport interface IAddClientSelectedFeatureAction {\n    type: ActionType.MAP_ADD_CLIENT_SELECTED_FEATURE,\n    payload: {\n        mapName: string;\n        layerName: string;\n        feature: ClientSelectionFeature;\n    }\n}\n\n/**\n * Clears the client selection set for the given map\n */\nexport interface IClearClientSelectionAction {\n    type: ActionType.MAP_CLEAR_CLIENT_SELECTION,\n    payload: {\n        mapName: string\n    }\n}\n\n/**\n * @since 0.12\n */\nexport type ViewerAction = IOpenFlyoutAction \n    | ICloseFlyoutAction\n    | IOpenContextMenuAction //@since 0.13\n    | ICloseContextMenuAction //@since 0.13\n    | IOpenComponentInFlyoutAction\n    | ICloseComponentInFlyoutAction\n    | IInitAppAction\n    | IInitErrorAction\n    | IAcknowledgeStartupWarningsAction\n    | ITemplateSetElementStateAction\n    | ITemplateSetTaskPaneVisibilityAction\n    | ITemplateSetSelectionPanelVisibility\n    | ITemplateSetLegendVisibility\n    | ITaskPaneBackAction\n    | ITaskPaneForwardAction\n    | ITaskPanePushUrlAction\n    | ITaskPaneInvokeUrlAction\n    | ITaskPaneHomeAction\n    | IShowComponentInModalAction\n    | IShowModalUrlAction\n    | ICloseModalAction\n    | IMapSetBusyCountAction\n    | IMapSetBaseLayerAction\n    | IMapSetScaleAction\n    | IMapSetMouseCoordinatesAction\n    | IMapSetLayerTransparencyAction\n    | IMapSetViewSizeUnitsAction\n    | IMapPreviousViewAction\n    | IMapNextViewAction\n    | IMapSetSelectionAction\n    | IMapResizedAction\n    | IMapSetViewAction\n    | ISetActiveMapToolAction\n    | ISetActiveMapAction\n    | ISetFeatureTooltipsEnabledAction\n    | ISetManualFeatureTooltipsEnabledAction\n    | IMapSetViewRotationAction\n    | IMapSetViewRotationEnabledAction\n    | IShowSelectedFeatureAction\n    | ILegendSetGroupVisibilityAction\n    | ILegendSetLayerVisibilityAction\n    | ILegendSetGroupExpandedAction\n    | ILegendSetGroupSelectableAction\n    | IMapRefreshAction\n    | ISetLocaleAction //@since 0.12.7\n    | IAddedLayerAction //@since 0.13\n    | IRemoveLayerAction //@since 0.13\n    | ISetLayerIndexAction //@since 0.13\n    | ISetLayerOpacityAction //@since 0.13\n    | ISetLayerVisibilityAction //@since 0.13\n    | ISetMapLayerVectorStyle //@since 0.13\n    | IAddMapLayerBusyWorkerAction //@since 0.13\n    | IRemoveMapLayerBusyWorkerAction //@since 0.13\n    | IExternalLayersReadyAction //@since 0.14\n    | IAddClientSelectedFeatureAction //@since 0.14\n    | IClearClientSelectionAction //@since 0.14\n    | ISetHeatmapLayerBlurAction //@since 0.14\n    | ISetHeatmapLayerRadiusAction //@since 0.14","import { IDOMElementMetrics } from \"../api/common\";\nimport {\n    IOpenFlyoutAction, \n    ICloseFlyoutAction,\n    IOpenComponentInFlyoutAction,\n    ICloseComponentInFlyoutAction,\n    IOpenContextMenuAction,\n    ICloseContextMenuAction\n} from \"./defs\";\nimport { ActionType } from '../constants/actions';\n\n/**\n * Opens the context menu at the specific position\n * \n * @param position The client x/y position\n * @since 0.13\n */\nexport function openContextMenu(position: { x: number, y: number }): IOpenContextMenuAction {\n    return {\n        type: ActionType.CONTEXT_MENU_OPEN,\n        payload: {\n            ...position\n        }\n    };\n}\n\n/**\n * Closes the context menu\n * \n * @since 0.13\n */\nexport function closeContextMenu(): ICloseContextMenuAction {\n    return {\n        type: ActionType.CONTEXT_MENU_CLOSE\n    };\n}\n\n/**\n * Opens the specified flyout menu\n *\n * @export\n * @param {string} id\n * @param {IDOMElementMetrics} metrics\n * @returns {IOpenFlyoutAction}\n */\nexport function openFlyout(id: string, metrics: IDOMElementMetrics): IOpenFlyoutAction {\n    return {\n        type: ActionType.FLYOUT_OPEN,\n        payload: {\n            flyoutId: id,\n            metrics: metrics\n        }\n    };\n}\n\n/**\n * Closes the specified flyout menu\n *\n * @export\n * @param {string} id\n * @returns {ICloseFlyoutAction}\n */\nexport function closeFlyout(id: string): ICloseFlyoutAction {\n    return {\n        type: ActionType.FLYOUT_CLOSE,\n        payload: {\n            flyoutId: id\n        }\n    };\n}\n\n/**\n * Load the specified component in the given flyout with the given component props\n *\n * @export\n * @param {string} id\n * @param {IDOMElementMetrics} metrics\n * @param {string} name\n * @param {*} props\n * @returns {IOpenComponentInFlyoutAction}\n */\nexport function openComponent(id: string, metrics: IDOMElementMetrics, name: string, props: any): IOpenComponentInFlyoutAction {\n    return {\n        type: ActionType.COMPONENT_OPEN,\n        payload: {\n            flyoutId: id,\n            metrics: metrics,\n            name: name,\n            props: props\n        }\n    };\n}\n\n/**\n * Closes the component in the given flyout\n *\n * @export\n * @param {string} id\n * @returns {ICloseComponentInFlyoutAction}\n */\nexport function closeComponent(id: string): ICloseComponentInFlyoutAction {\n    return {\n        type: ActionType.COMPONENT_CLOSE,\n        payload: {\n            flyoutId: id\n        }\n    };\n}","import { IInitAsyncOptions, normalizeInitPayload } from './init';\nimport { ReduxDispatch, Dictionary, ActiveMapTool } from '../api/common';\nimport { IGenericSubjectMapLayer, IInitAppActionPayload, MapInfo } from './defs';\nimport { ToolbarConf, convertFlexLayoutUIItems, parseWidgetsInAppDef, prepareSubMenus } from '../api/registry/command-spec';\nimport { makeUnique } from '../utils/array';\nimport { ApplicationDefinition, MapConfiguration } from '../api/contracts/fusion';\nimport { warn, info } from '../utils/logger';\nimport { registerCommand } from '../api/registry/command';\nimport { tr, registerStringBundle, DEFAULT_LOCALE } from '../api/i18n';\nimport { WEBLAYOUT_CONTEXTMENU } from \"../constants\";\nimport { Client } from '../api/client';\nimport { ActionType } from '../constants/actions';\nimport { ensureParameters } from '../utils/url';\nimport { MgError } from '../api/error';\nimport { strStartsWith } from '../utils/string';\nimport { IClusterSettings } from '../api/ol-style-contracts';\n\nconst TYPE_SUBJECT = \"SubjectLayer\";\nconst TYPE_EXTERNAL = \"External\";\n\nexport type SessionInit = {\n    session: string;\n    sessionWasReused: boolean;\n}\n\nfunction getMapGuideConfiguration(appDef: ApplicationDefinition): [string, MapConfiguration][] {\n    const configs = [] as [string, MapConfiguration][];\n    if (appDef.MapSet) {\n        for (const mg of appDef.MapSet.MapGroup) {\n            for (const map of mg.Map) {\n                if (map.Type == \"MapGuide\") {\n                    configs.push([mg[\"@id\"], map]);\n                }\n            }\n        }\n    }\n    return configs;\n}\n\nfunction tryExtractMapMetadata(extension: any) {\n    const ext: any = {};\n    for (const k in extension) {\n        if (strStartsWith(k, \"Meta_\")) {\n            const sk = k.substring(\"Meta_\".length);\n            ext[sk] = extension[k];\n        }\n    }\n    return ext;\n}\n\nexport function buildSubjectLayerDefn(name: string, map: MapConfiguration): IGenericSubjectMapLayer {\n    const st = map.Extension.source_type;\n    const initiallyVisible = map.Extension.initially_visible ?? true;\n    const sp: any = {};\n    const lo: any = {};\n    const meta: any = {};\n    const keys = Object.keys(map.Extension);\n    let popupTemplate = map.Extension.popup_template;\n    let selectable: boolean | undefined = map.Extension.is_selectable ?? true;\n    for (const k of keys) {\n        const spidx = k.indexOf(\"source_param_\");\n        const loidx = k.indexOf(\"layer_opt_\");\n        const midx = k.indexOf(\"meta_\");\n        if (spidx == 0) {\n            const kn = k.substring(\"source_param_\".length);\n            sp[kn] = map.Extension[k];\n        } else if (loidx == 0) {\n            const kn = k.substring(\"layer_opt_\".length);\n            lo[kn] = map.Extension[k];\n        } else if (midx == 0) {\n            const kn = k.substring(\"meta_\".length);\n            meta[kn] = map.Extension[k];\n        }\n    }\n    const sl = {\n        name: name,\n        description: map.Extension.layer_description,\n        displayName: map.Extension.display_name,\n        driverName: map.Extension.driver_name,\n        type: st,\n        layerOptions: lo,\n        sourceParams: sp,\n        meta: (Object.keys(meta).length > 0 ? meta : undefined),\n        initiallyVisible,\n        selectable,\n        popupTemplate,\n        vectorStyle: map.Extension.vector_layer_style\n    } as IGenericSubjectMapLayer;\n\n    if (map.Extension.cluster) {\n        sl.cluster = {\n            ...map.Extension.cluster\n        } as IClusterSettings;\n    }\n    return sl;\n}\n\nexport function getMapDefinitionsFromFlexLayout(appDef: ApplicationDefinition): (MapToLoad | IGenericSubjectMapLayer)[] {\n    const maps = [] as (MapToLoad | IGenericSubjectMapLayer)[];\n    const configs = getMapGuideConfiguration(appDef);\n    if (configs.length > 0) {\n        for (const c of configs) {\n            maps.push({ \n                name: c[0],\n                mapDef: c[1].Extension.ResourceId,\n                metadata: tryExtractMapMetadata(c[1].Extension)\n            });\n        }\n    }\n    if (appDef.MapSet?.MapGroup) {\n        for (const mGroup of appDef.MapSet.MapGroup) {\n            for (const map of mGroup.Map) {\n                if (map.Type == TYPE_SUBJECT) {\n                    const name = mGroup[\"@id\"];\n                    maps.push(buildSubjectLayerDefn(name, map));\n                }\n            }\n        }\n    }\n    if (maps.length == 0)\n        throw new MgError(\"No Map Definition or subject layer found in Application Definition\");\n\n    return maps;\n}\n\nexport type MapToLoad = { name: string, mapDef: string, metadata: any };\n\nexport function isStateless(appDef: ApplicationDefinition) {\n    // This appdef is stateless if:\n    //\n    //  1. It has a Stateless extension property set to \"true\" (ie. The author has opted-in to this feature)\n    //  2. No MapGuide Map Definitions were found in the appdef\n    if (appDef.Extension?.Stateless == \"true\")\n        return true;\n\n    try {\n        return getMapDefinitionsFromFlexLayout(appDef).length == 0;\n    } catch (e) {\n        return true;\n    }\n}\n\nexport interface IViewerInitCommand {\n    attachClient(client: Client): void;\n    runAsync(options: IInitAsyncOptions): Promise<IInitAppActionPayload>;\n}\n\nexport abstract class ViewerInitCommand<TSubject> implements IViewerInitCommand {\n    constructor(protected readonly dispatch: ReduxDispatch) { }\n    public abstract attachClient(client: Client): void;\n    public abstract runAsync(options: IInitAsyncOptions): Promise<IInitAppActionPayload>;\n    protected abstract establishInitialMapNameAndSession(mapsByName: Dictionary<TSubject>): [string, string];\n    protected abstract setupMaps(appDef: ApplicationDefinition, mapsByName: Dictionary<TSubject>, config: any, warnings: string[]): Dictionary<MapInfo>;\n    protected async initLocaleAsync(options: IInitAsyncOptions): Promise<void> {\n        //English strings are baked into this bundle. For non-en locales, we assume a strings/{locale}.json\n        //exists for us to fetch\n        const { locale } = options;\n        if (locale != DEFAULT_LOCALE) {\n            const r = await fetch(`strings/${locale}.json`);\n            if (r.ok) {\n                const res = await r.json();\n                registerStringBundle(locale, res);\n                // Dispatch the SET_LOCALE as it is safe to change UI strings at this point\n                this.dispatch({\n                    type: ActionType.SET_LOCALE,\n                    payload: locale\n                });\n                info(`Registered string bundle for locale: ${locale}`);\n            } else {\n                //TODO: Push warning to init error/warning reducer when we implement it\n                warn(`Failed to register string bundle for locale: ${locale}`);\n            }\n        }\n    }\n    protected getExtraProjectionsFromFlexLayout(appDef: ApplicationDefinition): string[] {\n        //The only widget we care about is the coordinate tracker\n        const epsgs: string[] = [];\n        for (const ws of appDef.WidgetSet) {\n            for (const w of ws.Widget) {\n                if (w.Type == \"CoordinateTracker\") {\n                    const ps = w.Extension.Projection || [];\n                    for (const p of ps) {\n                        epsgs.push(p.split(':')[1]);\n                    }\n                } else if (w.Type == \"CursorPosition\") {\n                    const dp = w.Extension.DisplayProjection;\n                    if (dp) {\n                        epsgs.push(dp.split(':')[1]);\n                    }\n                }\n            }\n        }\n        return makeUnique(epsgs);\n    }\n    \n    protected async initFromAppDefCoreAsync(appDef: ApplicationDefinition, options: IInitAsyncOptions, mapsByName: Dictionary<TSubject | IGenericSubjectMapLayer>, warnings: string[]): Promise<IInitAppActionPayload> {\n        const {\n            taskPane,\n            hasTaskBar,\n            hasStatus,\n            hasNavigator,\n            hasSelectionPanel,\n            hasLegend,\n            viewSize,\n            widgetsByKey,\n            isStateless,\n            initialTask\n        } = parseWidgetsInAppDef(appDef, registerCommand);\n        const { locale, featureTooltipsEnabled } = options;\n        const config: any = {};\n        config.isStateless = isStateless;\n        const tbConf: Dictionary<ToolbarConf> = {};\n        \n        //Now build toolbar layouts\n        for (const widgetSet of appDef.WidgetSet) {\n            for (const cont of widgetSet.Container) {\n                let tbName = cont.Name;\n                tbConf[tbName] = { items: convertFlexLayoutUIItems(isStateless, cont.Item, widgetsByKey, locale) };\n            }\n            for (const w of widgetSet.Widget) {\n                if (w.Type == \"CursorPosition\") {\n                    config.coordinateProjection = w.Extension.DisplayProjection;\n                    config.coordinateDecimals = w.Extension.Precision;\n                    config.coordinateDisplayFormat = w.Extension.Template;\n                }\n            }\n        }\n\n        const mapsDict: any  = mapsByName; //HACK: TS generics doesn't want to play nice with us\n        const maps = this.setupMaps(appDef, mapsDict, config, warnings);\n        if (appDef.Title) {\n            document.title = appDef.Title || document.title;\n        }\n        const [firstMapName, firstSessionId] = this.establishInitialMapNameAndSession(mapsDict);\n        const [tb, bFoundContextMenu] = prepareSubMenus(tbConf);\n        if (!bFoundContextMenu) {\n            warnings.push(tr(\"INIT_WARNING_NO_CONTEXT_MENU\", locale, { containerName: WEBLAYOUT_CONTEXTMENU }));\n        }\n        return normalizeInitPayload({\n            activeMapName: firstMapName,\n            initialUrl: ensureParameters(initialTask, firstMapName, firstSessionId, locale),\n            featureTooltipsEnabled: featureTooltipsEnabled,\n            locale: locale,\n            maps: maps,\n            config: config,\n            capabilities: {\n                hasTaskPane: (taskPane != null),\n                hasTaskBar: hasTaskBar,\n                hasStatusBar: hasStatus,\n                hasNavigator: hasNavigator,\n                hasSelectionPanel: hasSelectionPanel,\n                hasLegend: hasLegend,\n                hasToolbar: (Object.keys(tbConf).length > 0),\n                hasViewSize: (viewSize != null)\n            },\n            toolbars: tb,\n            warnings: warnings,\n            initialActiveTool: ActiveMapTool.Pan\n        }, options.layout);\n    }\n}\n","import { ApplicationDefinition } from '../api/contracts/fusion';\nimport { MapGroup, MapLayer, RuntimeMap } from '../api/contracts/runtime-map';\nimport { Dictionary, IExternalBaseLayer, ReduxDispatch, ActiveMapTool, IMapView } from '../api/common';\nimport { MapInfo, IInitAppActionPayload, IRestoredSelectionSets, IGenericSubjectMapLayer } from './defs';\nimport { tr, DEFAULT_LOCALE } from '../api/i18n';\nimport { isResourceId, strEndsWith, strIsNullOrEmpty } from '../utils/string';\nimport { Client } from '../api/client';\nimport { applyInitialBaseLayerVisibility, IInitAsyncOptions, processLayerInMapGroup } from './init';\nimport { RuntimeMapFeatureFlags } from '../api/request-builder';\nimport { info, debug } from '../utils/logger';\nimport { MgError } from '../api/error';\nimport { resolveProjectionFromEpsgIoAsync } from '../api/registry/projections';\nimport { register } from 'ol/proj/proj4';\nimport proj4 from \"proj4\";\nimport { buildSubjectLayerDefn, getMapDefinitionsFromFlexLayout, isStateless, MapToLoad, ViewerInitCommand } from './init-command';\nimport { WebLayout } from '../api/contracts/weblayout';\nimport { convertWebLayoutUIItems, parseCommandsInWebLayout, prepareSubMenus, ToolbarConf } from '../api/registry/command-spec';\nimport { clearSessionStore, retrieveSelectionSetFromLocalStorage } from '../api/session-store';\nimport * as shortid from 'shortid';\nimport { WEBLAYOUT_CONTEXTMENU, WEBLAYOUT_TASKMENU, WEBLAYOUT_TOOLBAR } from \"../constants\";\nimport { registerCommand } from '../api/registry/command';\nimport { ensureParameters } from '../utils/url';\nimport { assertIsDefined } from '../utils/assert';\nimport { MapDefinition } from '../api/contracts/map-definition';\nimport { TileSetDefinition } from '../api/contracts/tile-set-definition';\nimport { AsyncLazy } from '../api/lazy';\nimport { SiteVersionResponse } from '../api/contracts/common';\nimport { isRuntimeMap } from '../utils/type-guards';\n\nconst TYPE_SUBJECT = \"SubjectLayer\";\nconst TYPE_EXTERNAL = \"External\";\n\n/**\n * @since 0.14\n */\nexport type SubjectLayerType = RuntimeMap | IGenericSubjectMapLayer;\n\n/**\n * Default viewer init commmand\n * \n * @since 0.14\n */\nexport class DefaultViewerInitCommand extends ViewerInitCommand<SubjectLayerType> {\n    private client: Client | undefined;\n    private options: IInitAsyncOptions;\n    constructor(dispatch: ReduxDispatch) {\n        super(dispatch);\n    }\n    public attachClient(client: Client): void {\n        this.client = client;\n    }\n    /**\n     * @override\n     * @protected\n     * @param {Dictionary<RuntimeMap>} mapsByName\n     * @memberof MgViewerInitCommand\n     */\n    protected establishInitialMapNameAndSession(mapsByName: Dictionary<SubjectLayerType>): [string, string] {\n        let firstMapName = \"\";\n        let firstSessionId = \"\";\n        for (const mapName in mapsByName) {\n            if (!firstMapName && !firstSessionId) {\n                const map = mapsByName[mapName];\n                if (isRuntimeMap(map)) {\n                    firstMapName = map.Name;\n                    firstSessionId = map.SessionId;\n                    break;\n                }\n            }\n        }\n        return [firstMapName, firstSessionId];\n    }\n    private getDesiredTargetMapName(mapDef: string) {\n        const lastSlash = mapDef.lastIndexOf(\"/\");\n        const lastDot = mapDef.lastIndexOf(\".\");\n        if (lastSlash >= 0 && lastDot >= 0 && lastDot > lastSlash) {\n            return `${mapDef.substring(lastSlash + 1, lastDot)}`;\n        } else {\n            return `Map_${shortid.generate()}`;\n        }\n    }\n    private async initFromWebLayoutAsync(webLayout: WebLayout, session: AsyncLazy<string>, sessionWasReused: boolean): Promise<IInitAppActionPayload> {\n        const [mapsByName, warnings] = await this.createRuntimeMapsAsync(session, webLayout, false, wl => [{ name: this.getDesiredTargetMapName(wl.Map.ResourceId), mapDef: wl.Map.ResourceId, metadata: {} }], () => [], sessionWasReused);\n        const { locale, featureTooltipsEnabled, externalBaseLayers } = this.options;\n        const cmdsByKey = parseCommandsInWebLayout(webLayout, registerCommand);\n        const mainToolbar = (webLayout.ToolBar.Visible\n            ? convertWebLayoutUIItems(webLayout.ToolBar.Button, cmdsByKey, locale)\n            : []);\n        const taskBar = (webLayout.TaskPane.TaskBar.Visible\n            ? convertWebLayoutUIItems(webLayout.TaskPane.TaskBar.MenuButton, cmdsByKey, locale, false)\n            : []);\n        const contextMenu = (webLayout.ContextMenu.Visible\n            ? convertWebLayoutUIItems(webLayout.ContextMenu.MenuItem, cmdsByKey, locale, false)\n            : []);\n        const config: any = {};\n        if (webLayout.SelectionColor != null) {\n            config.selectionColor = webLayout.SelectionColor;\n        }\n        if (webLayout.MapImageFormat != null) {\n            config.imageFormat = webLayout.MapImageFormat;\n        }\n        if (webLayout.SelectionImageFormat != null) {\n            config.selectionImageFormat = webLayout.SelectionImageFormat;\n        }\n        if (webLayout.PointSelectionBuffer != null) {\n            config.pointSelectionBuffer = webLayout.PointSelectionBuffer;\n        }\n        let initialView: IMapView | null = null;\n        if (webLayout.Map.InitialView != null) {\n            initialView = {\n                x: webLayout.Map.InitialView.CenterX,\n                y: webLayout.Map.InitialView.CenterY,\n                scale: webLayout.Map.InitialView.Scale\n            };\n        }\n\n        if (webLayout.Title != \"\") {\n            document.title = webLayout.Title || document.title;\n        }\n\n        const maps: any = {};\n        const [firstMapName, firstSessionId] = this.establishInitialMapNameAndSession(mapsByName);\n\n        const menus: Dictionary<ToolbarConf> = {};\n        menus[WEBLAYOUT_TOOLBAR] = {\n            items: mainToolbar\n        };\n        menus[WEBLAYOUT_TASKMENU] = {\n            items: taskBar\n        };\n        menus[WEBLAYOUT_CONTEXTMENU] = {\n            items: contextMenu\n        };\n\n        const tb = prepareSubMenus(menus)[0];\n        return {\n            activeMapName: firstMapName,\n            featureTooltipsEnabled: featureTooltipsEnabled,\n            initialUrl: ensureParameters(webLayout.TaskPane.InitialTask || \"server/TaskPane.html\", firstMapName, firstSessionId, locale),\n            initialTaskPaneWidth: webLayout.TaskPane.Width,\n            initialInfoPaneWidth: webLayout.InformationPane.Width,\n            maps: maps,\n            locale: locale,\n            config: config,\n            capabilities: {\n                hasTaskPane: webLayout.TaskPane.Visible,\n                hasTaskBar: webLayout.TaskPane.TaskBar.Visible,\n                hasStatusBar: webLayout.StatusBar.Visible,\n                hasNavigator: webLayout.ZoomControl.Visible,\n                hasSelectionPanel: webLayout.InformationPane.Visible && webLayout.InformationPane.PropertiesVisible,\n                hasLegend: webLayout.InformationPane.Visible && webLayout.InformationPane.LegendVisible,\n                hasToolbar: webLayout.ToolBar.Visible,\n                hasViewSize: webLayout.StatusBar.Visible\n            },\n            toolbars: tb,\n            warnings: warnings,\n            initialActiveTool: ActiveMapTool.Pan\n        };\n    }\n    private async tryDescribeRuntimeMapAsync(mapName: string, session: AsyncLazy<string>, mapDef: string) {\n        assertIsDefined(this.client);\n        try {\n            const map = await this.client.describeRuntimeMap({\n                mapname: mapName,\n                requestedFeatures: RuntimeMapFeatureFlags.LayerFeatureSources | RuntimeMapFeatureFlags.LayerIcons | RuntimeMapFeatureFlags.LayersAndGroups,\n                session: await session.getValueAsync()\n            });\n            return map;\n        } catch (e) {\n            if (e.message === \"MgResourceNotFoundException\") {\n                const map = await this.client.createRuntimeMap({\n                    mapDefinition: mapDef,\n                    requestedFeatures: RuntimeMapFeatureFlags.LayerFeatureSources | RuntimeMapFeatureFlags.LayerIcons | RuntimeMapFeatureFlags.LayersAndGroups,\n                    session: await session.getValueAsync(),\n                    targetMapName: mapName\n                });\n                return map;\n            }\n            throw e;\n        }\n    }\n    private isMapDefinition(arg: MapToLoad | IGenericSubjectMapLayer): arg is MapToLoad {\n        return (arg as any).mapDef != null;\n    }\n    private async createRuntimeMapsAsync<TLayout>(session: AsyncLazy<string>, res: TLayout, isStateless: boolean, mapDefSelector: (res: TLayout) => (MapToLoad | IGenericSubjectMapLayer)[], projectionSelector: (res: TLayout) => string[], sessionWasReused: boolean): Promise<[Dictionary<SubjectLayerType>, string[]]> {\n        const mapDefs = mapDefSelector(res);\n        const mapPromises: Promise<RuntimeMap>[] = [];\n        const warnings = [] as string[];\n        const { locale } = this.options;\n        const subjectLayers: Dictionary<IGenericSubjectMapLayer> = {};\n        if (isStateless) {\n            // We use an AsyncLazy because we only want to fetch the site version *iff* we encounter a MG map defn\n            const siteVersion = new AsyncLazy<SiteVersionResponse>(async () => {\n                assertIsDefined(this.client);\n                const sv = await this.client.getSiteVersion();\n                return sv;\n            });\n            for (const m of mapDefs) {\n                if (this.isMapDefinition(m)) {\n                    const siteVer = await siteVersion.getValueAsync();\n                    assertIsDefined(this.client);\n                    mapPromises.push(this.describeRuntimeMapStateless(this.client, siteVer.Version, m));\n                }\n            }\n        } else {\n            for (const m of mapDefs) {\n                if (this.isMapDefinition(m)) {\n                    //sessionWasReused is a hint whether to create a new runtime map, or recover the last runtime map state from the given map name\n                    if (sessionWasReused) {\n                        //FIXME: If the map state we're recovering has a selection, we need to re-init the selection client-side\n                        info(`Session ID re-used. Attempting recovery of map state of: ${m.name}`);\n                        mapPromises.push(this.tryDescribeRuntimeMapAsync(m.name, session, m.mapDef));\n                    } else {\n                        info(`Creating runtime map state (${m.name}) for: ${m.mapDef}`);\n                        assertIsDefined(this.client);\n                        mapPromises.push(this.client.createRuntimeMap({\n                            mapDefinition: m.mapDef,\n                            requestedFeatures: RuntimeMapFeatureFlags.LayerFeatureSources | RuntimeMapFeatureFlags.LayerIcons | RuntimeMapFeatureFlags.LayersAndGroups,\n                            session: await session.getValueAsync(),\n                            targetMapName: m.name\n                        }));\n                    }\n                }\n            }\n        }\n        const maps = await Promise.all(mapPromises);\n        const fetchEpsgs: { epsg: string, mapDef: string }[] = [];\n        //All must be non-zero\n        for (const m of maps) {\n            const epsg = m.CoordinateSystem.EpsgCode;\n            const mapDef = m.MapDefinition;\n            if (epsg == \"0\") {\n                throw new MgError(tr(\"INIT_ERROR_UNSUPPORTED_COORD_SYS\", locale || DEFAULT_LOCALE, { mapDefinition: mapDef }));\n            }\n            //Must be registered to proj4js if not 4326 or 3857\n            if (!proj4.defs[`EPSG:${epsg}`]) {\n                fetchEpsgs.push({ epsg: epsg, mapDef: mapDef });\n            }\n        }\n        const extraEpsgs = projectionSelector(res);\n        for (const e of extraEpsgs) {\n            fetchEpsgs.push({ epsg: e, mapDef: \"\" });\n        }\n        const epsgs = await Promise.all(fetchEpsgs.map(f => resolveProjectionFromEpsgIoAsync(f.epsg, locale, f.mapDef)));\n\n        //Previously, we register proj4 with OpenLayers on the bootstrap phase way before this init\n        //process is started. This no longer works for OL6 where it doesn't seem to pick up the extra\n        //projections we've registered with proj4 after linking proj4 to OpenLayers. So that registration\n        //step has been relocated here, after all the custom projections have been fetched and registered\n        //with proj4\n        debug(`Register proj4 with OpenLayers`);\n        register(proj4);\n\n        //Build the Dictionary<MgSubjectLayerType> from loaded maps\n        const mapsByName: Dictionary<SubjectLayerType> = {};\n        for (const map of maps) {\n            mapsByName[map.Name] = map;\n        }\n        for (const gs of mapDefs) {\n            if (!this.isMapDefinition(gs)) {\n                mapsByName[gs.name] = gs;\n            }\n        }\n        return [mapsByName, warnings];\n    }\n    private async describeRuntimeMapStateless(client: Client, siteVersion: string, m: MapToLoad): Promise<RuntimeMap> {\n        const { name, mapDef, metadata } = m;\n        const mdf = await this.client?.getResource<MapDefinition>(mapDef, { username: \"Anonymous\" });\n        if (!mdf)\n            throw new Error(\"Failed to fetch map def\");\n\n        const rt: RuntimeMap = {\n            SessionId: \"\",\n            Extents: {\n                LowerLeftCoordinate: {\n                    X: mdf.Extents.MinX,\n                    Y: mdf.Extents.MinY\n                },\n                UpperRightCoordinate: {\n                    X: mdf.Extents.MaxX,\n                    Y: mdf.Extents.MaxY\n                }\n            },\n            SiteVersion: siteVersion,\n            Name: name,\n            DisplayDpi: 96,\n            BackgroundColor: mdf.BackgroundColor,\n            MapDefinition: mapDef,\n            CoordinateSystem: {\n                // We are assuming the app def specifies this data in each <Map> entry as extension properties\n                // beginning with \"Meta_\" (eg. Meta_MentorCode, Meta_EpsgCode, etc)\n                MentorCode: metadata.MentorCode,\n                EpsgCode: metadata.EpsgCode,\n                MetersPerUnit: metadata.MetersPerUnit,\n                Wkt: mdf.CoordinateSystem\n            },\n            IconMimeType: \"image/png\",\n        };\n\n        const groups = [] as MapGroup[];\n        const layers = [] as MapLayer[];\n\n        if (mdf.TileSetSource) {\n            rt.TileSetDefinition = mdf.TileSetSource.ResourceId;\n            const tsd = await client.getResource<TileSetDefinition>(mdf.TileSetSource.ResourceId);\n            if (tsd.TileStoreParameters.TileProvider == \"Default\") {\n                const sTileWidth = tsd.TileStoreParameters.Parameter.find(p => p.Name == \"TileWidth\")?.Value;\n                const sTileHeight = tsd.TileStoreParameters.Parameter.find(p => p.Name == \"TileHeight\")?.Value;\n                if (!strIsNullOrEmpty(sTileWidth) && !strIsNullOrEmpty(sTileHeight)) {\n                    rt.TileWidth = parseInt(sTileWidth, 10);\n                    rt.TileHeight = parseInt(sTileHeight, 10);\n                }\n            } else if (tsd.TileStoreParameters.TileProvider == \"XYZ\") {\n                rt.TileHeight = 256;\n                rt.TileHeight = 256;\n            }\n\n            for (const bg of tsd.BaseMapLayerGroup) {\n                groups.push({\n                    Name: bg.Name,\n                    DisplayInLegend: bg.ShowInLegend,\n                    LegendLabel: bg.LegendLabel,\n                    ObjectId: bg.Name,\n                    ExpandInLegend: bg.ExpandInLegend,\n                    Visible: bg.Visible,\n                    ActuallyVisible: bg.Visible,\n                    Type: 3 /* BaseMapFromTileSet */\n                });\n\n                for (const lyr of bg.BaseMapLayer) {\n                    layers.push({\n                        Name: lyr.Name,\n                        DisplayInLegend: lyr.ShowInLegend,\n                        // We don't have stateless QUERYMAPFEATURES (yet), so there is no point actually respecting this flag\n                        Selectable: false, //lyr.Selectable,\n                        LegendLabel: lyr.LegendLabel,\n                        ExpandInLegend: lyr.ExpandInLegend,\n                        Visible: true,\n                        ParentId: bg.Name,\n                        ActuallyVisible: true,\n                        LayerDefinition: lyr.ResourceId,\n                        ObjectId: lyr.Name,\n                        Type: 2 /* BaseMap */\n                    });\n                }\n            }\n        }\n\n        for (const grp of mdf.MapLayerGroup) {\n            groups.push({\n                Name: grp.Name,\n                DisplayInLegend: grp.ShowInLegend,\n                LegendLabel: grp.LegendLabel,\n                ObjectId: grp.Name,\n                ExpandInLegend: grp.ExpandInLegend,\n                Visible: grp.Visible,\n                ActuallyVisible: grp.Visible,\n                Type: 1 /* Normal */\n            });\n        }\n\n        for (const lyr of mdf.MapLayer) {\n            layers.push({\n                Name: lyr.Name,\n                DisplayInLegend: lyr.ShowInLegend,\n                // We don't have stateless QUERYMAPFEATURES (yet), so there is no point actually respecting this flag\n                Selectable: false, // lyr.Selectable,\n                LegendLabel: lyr.LegendLabel,\n                ExpandInLegend: lyr.ExpandInLegend,\n                Visible: true,\n                ParentId: lyr.Group,\n                ActuallyVisible: true,\n                LayerDefinition: lyr.ResourceId,\n                ObjectId: lyr.Name,\n                Type: 1 /* Dynamic */\n            })\n        }\n\n        rt.Group = groups;\n        rt.Layer = layers;\n\n        return rt;\n    }\n    /**\n     * @override\n     * @protected\n     * @param {ApplicationDefinition} appDef\n     * @param {Dictionary<SubjectLayerType>} mapsByName\n     * @param {*} config\n     * @param {string[]} warnings\n     * @returns {Dictionary<MapInfo>}\n     * @memberof MgViewerInitCommand\n     */\n    protected setupMaps(appDef: ApplicationDefinition, mapsByName: Dictionary<SubjectLayerType>, config: any, warnings: string[]): Dictionary<MapInfo> {\n        const dict: Dictionary<MapInfo> = {};\n        if (appDef.MapSet) {\n            for (const mGroup of appDef.MapSet.MapGroup) {\n                let mapName: string | undefined;\n                //Setup external layers\n                const initExternalLayers = [] as IGenericSubjectMapLayer[];\n                const externalBaseLayers = [] as IExternalBaseLayer[];\n                for (const map of mGroup.Map) {\n                    if (map.Type === \"MapGuide\") {\n                        //TODO: Based on the schema, different MG map groups could have different\n                        //settings here and our redux tree should reflect that. Currently the first one \"wins\"\n                        if (!config.selectionColor && map.Extension.SelectionColor != null) {\n                            config.selectionColor = map.Extension.SelectionColor;\n                        }\n                        if (!config.imageFormat && map.Extension.ImageFormat != null) {\n                            config.imageFormat = map.Extension.ImageFormat;\n                        }\n                        if (!config.selectionImageFormat && map.Extension.SelectionFormat != null) {\n                            config.selectionImageFormat = map.Extension.SelectionFormat;\n                        }\n\n                        //NOTE: Although non-sensical, if the same map definition exists across multiple\n                        //MapGroups, we might be matching the wrong one. We just assume such non-sensical\n                        //AppDefs won't exist\n                        for (const name in mapsByName) {\n                            const mapDef = mapsByName[name];\n                            if (isRuntimeMap(mapDef) && mapDef.MapDefinition == map.Extension.ResourceId) {\n                                mapName = name;\n                                break;\n                            }\n                        }\n                    } else if (map.Type == TYPE_SUBJECT) {\n                        mapName = mGroup[\"@id\"];\n                    } else {\n                        if (map.Type == TYPE_EXTERNAL) {\n                            initExternalLayers.push(buildSubjectLayerDefn(map.Extension.layer_name, map));\n                        } else {\n                            processLayerInMapGroup(map, warnings, config, appDef, externalBaseLayers);\n                        }\n                    }\n                }\n\n                applyInitialBaseLayerVisibility(externalBaseLayers);\n\n                //Setup initial view\n                let initialView: IMapView | undefined;\n                if (mGroup.InitialView) {\n                    initialView = {\n                        x: mGroup.InitialView.CenterX,\n                        y: mGroup.InitialView.CenterY,\n                        scale: mGroup.InitialView.Scale\n                    };\n                }\n\n                if (mapName) {\n                    dict[mapName] = {\n                        mapGroupId: mGroup[\"@id\"],\n                        map: mapsByName[mapName],\n                        initialView: initialView,\n                        externalBaseLayers: externalBaseLayers,\n                        initialExternalLayers: initExternalLayers\n                    };\n                }\n            }\n        }\n        return dict;\n    }\n    private async initFromAppDefAsync(appDef: ApplicationDefinition, session: AsyncLazy<string>, sessionWasReused: boolean): Promise<IInitAppActionPayload> {\n        const [mapsByName, warnings] = await this.createRuntimeMapsAsync(session, appDef, isStateless(appDef), fl => getMapDefinitionsFromFlexLayout(fl), fl => this.getExtraProjectionsFromFlexLayout(fl), sessionWasReused);\n        return await this.initFromAppDefCoreAsync(appDef, this.options, mapsByName, warnings);\n    }\n    private async sessionAcquiredAsync(session: AsyncLazy<string>, sessionWasReused: boolean): Promise<IInitAppActionPayload> {\n        const { resourceId, locale } = this.options;\n        if (!resourceId) {\n            //Try assumed default location of appdef.json that we are assuming sits in the same place as the viewer html files\n            const cl = new Client(\"\", \"mapagent\");\n            try {\n                const fl = await cl.get<ApplicationDefinition>(\"appdef.json\");\n                return await this.initFromAppDefAsync(fl, session, sessionWasReused);\n            } catch (e) { //The appdef.json doesn't exist at the assumed default location?\n                throw new MgError(tr(\"INIT_ERROR_MISSING_RESOURCE_PARAM\", locale));\n            }\n        } else {\n            if (typeof (resourceId) == 'string') {\n                if (strEndsWith(resourceId, \"WebLayout\")) {\n                    assertIsDefined(this.client);\n                    const wl = await this.client.getResource<WebLayout>(resourceId, { SESSION: await session.getValueAsync() });\n                    return await this.initFromWebLayoutAsync(wl, session, sessionWasReused);\n                } else if (strEndsWith(resourceId, \"ApplicationDefinition\")) {\n                    assertIsDefined(this.client);\n                    const fl = await this.client.getResource<ApplicationDefinition>(resourceId, { SESSION: await session.getValueAsync() });\n                    return await this.initFromAppDefAsync(fl, session, sessionWasReused);\n                } else {\n                    if (isResourceId(resourceId)) {\n                        throw new MgError(tr(\"INIT_ERROR_UNKNOWN_RESOURCE_TYPE\", locale, { resourceId: resourceId }));\n                    } else {\n                        //Assume URL to a appdef json document\n                        let fl: ApplicationDefinition;\n                        if (!this.client) {\n                            // This wasn't set up with a mapagent URI (probably a non-MG viewer template), so make a new client on-the-fly\n                            const cl = new Client(\"\", \"mapagent\");\n                            fl = await cl.get<ApplicationDefinition>(resourceId);\n                        } else {\n                            fl = await this.client.get<ApplicationDefinition>(resourceId);\n                        }\n                        return await this.initFromAppDefAsync(fl, session, sessionWasReused);\n                    }\n                }\n            } else {\n                const fl = await resourceId();\n                return await this.initFromAppDefAsync(fl, session, sessionWasReused);\n            }\n        }\n    }\n    public async runAsync(options: IInitAsyncOptions): Promise<IInitAppActionPayload> {\n        this.options = options;\n        await this.initLocaleAsync(this.options);\n        let sessionWasReused = false;\n        let session: AsyncLazy<string>;\n        if (!this.options.session) {\n            session = new AsyncLazy<string>(async () => {\n                assertIsDefined(this.client);\n                const sid = await this.client.createSession(\"Anonymous\", \"\");\n                return sid;\n            });\n        } else {\n            info(`Re-using session: ${this.options.session}`);\n            sessionWasReused = true;\n            session = new AsyncLazy<string>(() => Promise.resolve(this.options.session!));\n        }\n        const payload = await this.sessionAcquiredAsync(session, sessionWasReused);\n        if (sessionWasReused) {\n            let initSelections: IRestoredSelectionSets = {};\n            for (const mapName in payload.maps) {\n                const sset = await retrieveSelectionSetFromLocalStorage(session, mapName);\n                if (sset) {\n                    initSelections[mapName] = sset;\n                }\n            }\n            payload.initialSelections = initSelections;\n            try {\n                //In the interest of being a responsible citizen, clean up all selection-related stuff from\n                //session store\n                await clearSessionStore();\n            } catch (e) {\n\n            }\n        }\n\n        return payload;\n    }\n}","import { Client } from \"../api/client\";\nimport { ReduxDispatch, IMapView } from \"../api/common\";\nimport {\n    ApplicationDefinition,\n    MapConfiguration\n} from \"../api/contracts/fusion\";\nimport {\n    IExternalBaseLayer,\n    ReduxThunkedAction,\n    IMapViewer\n} from \"../api/common\";\nimport { strIsNullOrEmpty, strReplaceAll } from \"../utils/string\";\nimport { IAcknowledgeStartupWarningsAction, IInitAppActionPayload } from './defs';\nimport { ActionType } from '../constants/actions';\nimport { getViewer } from '../api/runtime';\nimport { tr } from '../api/i18n';\nimport { IViewerInitCommand } from './init-command';\nimport { getLayoutCapabilities } from \"../api/registry/layout\";\nimport { debug } from \"../utils/logger\";\n\nexport function applyInitialBaseLayerVisibility(externalBaseLayers: IExternalBaseLayer[]) {\n    if (externalBaseLayers.length > 0) {\n        // First visual base layer, first served\n        const firstBase = externalBaseLayers.find(bl => bl.kind != \"UTFGrid\");\n        if (firstBase) {\n            firstBase.visible = true;\n        }\n        // Make all non-visual base layers (ie. UTFGrid) visible\n        const nonVisuals = externalBaseLayers.filter(bl => bl.kind == \"UTFGrid\");\n        for (const nv of nonVisuals) {\n            nv.visible = true;\n        }\n    }\n}\n\nfunction processAndDispatchInitError(error: Error, includeStack: boolean, dispatch: ReduxDispatch, opts: IInitAsyncOptions): void {\n    if (error.stack) {\n        dispatch({\n            type: ActionType.INIT_ERROR,\n            payload: {\n                error: {\n                    message: error.message,\n                    stack: (error.stack || \"\").split(\"\\n\")\n                },\n                includeStack: includeStack,\n                options: opts\n            }\n        });\n    } else {\n        dispatch({\n            type: ActionType.INIT_ERROR,\n            payload: {\n                error: {\n                    message: error.message,\n                    stack: []\n                },\n                includeStack: includeStack,\n                options: opts\n            }\n        });\n    }\n}\n\nexport interface IInitAppLayout {\n    locale: string;\n    resourceId: string | (() => Promise<ApplicationDefinition>);\n    externalBaseLayers?: IExternalBaseLayer[];\n    session?: string;\n    initialView?: IMapView;\n    /**\n     * \n     * @since 0.11\n     * @type {string}\n     * @memberof IInitAppLayout\n     */\n    initialActiveMap?: string;\n    /**\n     * \n     * @since 0.11\n     * @type {string[]}\n     * @memberof IInitAppLayout\n     */\n    initialShowLayers?: string[];\n    /**\n     * \n     * @since 0.11\n     * @type {string[]}\n     * @memberof IInitAppLayout\n     */\n    initialShowGroups?: string[];\n    /**\n     * \n     * @since 0.11\n     * @type {string[]}\n     * @memberof IInitAppLayout\n     */\n    initialHideLayers?: string[];\n    /**\n     * \n     * @since 0.11\n     * @type {string[]}\n     * @memberof IInitAppLayout\n     */\n    initialHideGroups?: string[];\n    onInit?: (viewer: IMapViewer) => void;\n    /**\n     * Sets whether feature tooltips should be initially enabled\n     * \n     * @since 0.13\n     */\n    featureTooltipsEnabled?: boolean;\n    /**\n     * @since 0.14\n     */\n    layout?: string;\n}\n\n/**\n * @hidden\n */\nexport function normalizeInitPayload(payload: IInitAppActionPayload, layout: string | undefined): IInitAppActionPayload {\n    if (!strIsNullOrEmpty(layout)) {\n        const caps = getLayoutCapabilities(layout);\n        if (caps) {\n            if (!caps.hasTaskPane) {\n                debug(\"Overriding hasTaskPane capability to false\");\n                payload.capabilities.hasTaskPane = false;\n            }\n        }\n    }\n    return payload;\n}\n\nexport interface IInitAsyncOptions extends IInitAppLayout {\n    locale: string;\n}\n\nlet _counter = 0;\n\nexport function processLayerInMapGroup(map: MapConfiguration, warnings: string[], config: any, appDef: ApplicationDefinition, externalBaseLayers: IExternalBaseLayer[]) {\n    switch (map.Type) {\n        case \"Google\":\n            warnings.push(tr(\"INIT_WARNING_UNSUPPORTED_GOOGLE_MAPS\", config.locale));\n            break;\n        case \"VirtualEarth\":\n            {\n                //HACK: De-arrayification of arbitrary extension elements\n                //is shallow (hence name/type is string[]). Do we bother to fix this?\n                const { name, type } = map.Extension.Options;\n                const sName = Array.isArray(name) ? name[0] : name;\n                const sType = Array.isArray(type) ? type[0] : type;\n                const options: any = {};\n                let bAdd = true;\n                switch (sType) {\n                    case \"Aerial\":\n                    case \"a\":\n                        options.imagerySet = \"Aerial\";\n                        break;\n                    case \"AerialWithLabels\":\n                        options.imagerySet = \"AerialWithLabels\";\n                        break;\n                    case \"Road\":\n                        options.imagerySet = \"Road\";\n                        break;\n                    default:\n                        bAdd = false;\n                        warnings.push(tr(\"INIT_WARNING_BING_UNKNOWN_LAYER\", config.locale, { type: type }));\n                        break;\n                }\n                if (appDef.Extension.BingMapKey) {\n                    options.key = appDef.Extension.BingMapKey;\n                }\n                else {\n                    bAdd = false;\n                    warnings.push(tr(\"INIT_WARNING_BING_API_KEY_REQD\", config.locale));\n                }\n                if (bAdd) {\n                    externalBaseLayers.push({\n                        name: sName,\n                        kind: \"BingMaps\",\n                        options: options\n                    });\n                }\n            }\n            break;\n        case \"OpenStreetMap\":\n            {\n                //HACK: De-arrayification of arbitrary extension elements\n                //is shallow (hence name/type is string[]). Do we bother to fix this?\n                const { name, type } = map.Extension.Options;\n                const sName = Array.isArray(name) ? name[0] : name;\n                const sType = Array.isArray(type) ? type[0] : type;\n                const options: any = {};\n                switch (sType) {\n                    case \"CycleMap\":\n                        options.url = \"http://{a-c}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png\";\n                        break;\n                    case \"TransportMap\":\n                        options.url = \"http://tile2.opencyclemap.org/transport/{z}/{x}/{y}.png\";\n                        break;\n                }\n                externalBaseLayers.push({\n                    name: sName,\n                    kind: \"OSM\",\n                    options: options\n                });\n            }\n            break;\n        case \"Stamen\":\n            {\n                //HACK: De-arrayification of arbitrary extension elements\n                //is shallow (hence name/type is string[]). Do we bother to fix this?\n                const { name, type } = map.Extension.Options;\n                const sName = Array.isArray(name) ? name[0] : name;\n                const sType = Array.isArray(type) ? type[0] : type;\n                externalBaseLayers.push({\n                    name: sName,\n                    kind: \"Stamen\",\n                    options: {\n                        layer: sType\n                    }\n                });\n            }\n            break;\n        case \"UTFGrid\":\n            {\n                externalBaseLayers.push({\n                    name: `UTFGridSource${_counter++}`,\n                    kind: \"UTFGrid\",\n                    options: {\n                        tileJSON: {\n                            scheme: \"xyz\",\n                            grids: Array.isArray(map.Extension.UrlTemplate) ? [...map.Extension.UrlTemplate] : [map.Extension.UrlTemplate]\n                        }\n                    }\n                })\n            }\n            break;\n        case \"XYZ\":\n            {\n                //HACK: De-arrayification of arbitrary extension elements\n                //is shallow (hence name/type is string[]). Do we bother to fix this?\n                const { name, type, attributions } = map.Extension.Options;\n                const sName = Array.isArray(name) ? name[0] : name;\n                const sType = Array.isArray(type) ? type[0] : type;\n                let tilePixelRatio = 1;\n                if (map.Extension.Options.tilePixelRatio) {\n                    tilePixelRatio = parseInt(map.Extension.Options.tilePixelRatio[0], 10);\n                }\n                //NOTE: From a fusion appdef, we're expecting placeholder tokens to be in ${this_format} instead of\n                //{this_format} as the primary consumer is the Fusion viewer that is based on OpenLayers 2\n                //As we're not using OL2, but OL4+ the expected format is {this_format}, so we need to convert these\n                //placeholder tokens\n                const urls = (map.Extension.Options.urls || []).map((s: string) => strReplaceAll(s, \"${\", \"{\"));\n                externalBaseLayers.push({\n                    name: sName,\n                    kind: \"XYZ\",\n                    options: {\n                        layer: sType,\n                        urls,\n                        attributions,\n                        tilePixelRatio\n                    }\n                });\n            }\n            break;\n    }\n}\n\n/**\n * Initializes the viewer\n *\n * @export\n * @param {IViewerInitCommand} cmd\n * @param {IInitAppLayout} options\n * @returns {ReduxThunkedAction}\n */\nexport function initLayout(cmd: IViewerInitCommand, options: IInitAppLayout): ReduxThunkedAction {\n    const opts: IInitAsyncOptions = { ...options };\n    return (dispatch, getState) => {\n        const args = getState().config;\n        //TODO: Fetch and init the string bundle earlier if \"locale\" is present\n        //so the English init messages are seen only for a blink if requesting a\n        //non-english string bundle\n        if (args.agentUri && args.agentKind) {\n            const client = new Client(args.agentUri, args.agentKind);\n            cmd.attachClient(client);\n        }\n        cmd.runAsync(options).then(payload => {\n            let initPayload = payload;\n            if (opts.initialView) {\n                initPayload.initialView = {\n                    ...opts.initialView\n                };\n            }\n            if (opts.initialActiveMap) {\n                initPayload.activeMapName = opts.initialActiveMap;\n            }\n            initPayload.initialHideGroups = opts.initialHideGroups;\n            initPayload.initialHideLayers = opts.initialHideLayers;\n            initPayload.initialShowGroups = opts.initialShowGroups;\n            initPayload.initialShowLayers = opts.initialShowLayers;\n            initPayload.featureTooltipsEnabled = opts.featureTooltipsEnabled;\n            dispatch({\n                type: ActionType.INIT_APP,\n                payload\n            });\n            if (options.onInit) {\n                const viewer = getViewer();\n                if (viewer) {\n                    options.onInit(viewer);\n                }\n            }\n        }).catch(err => {\n            processAndDispatchInitError(err, false, dispatch, opts);\n        })\n    };\n}\n\nexport function acknowledgeInitWarnings(): IAcknowledgeStartupWarningsAction {\n    return {\n        type: ActionType.INIT_ACKNOWLEDGE_WARNINGS\n    }\n}","import { Client } from \"../api/client\";\nimport { RuntimeMapFeatureFlags } from \"../api/request-builder\";\nimport {\n    ReduxThunkedAction,\n    getRuntimeMap\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ILegendSetGroupVisibilityAction, ILegendSetGroupExpandedAction, ILegendSetLayerVisibilityAction, ILegendSetGroupSelectableAction } from './defs';\n\n/**\n * Sets the visibility for the given map group\n *\n * @export\n * @param {string} mapName\n * @param {{ id: string, value: boolean }} options\n * @returns\n */\nexport function setGroupVisibility(mapName: string, options: { id: string, value: boolean }): ILegendSetGroupVisibilityAction {\n    return {\n        type: ActionType.LEGEND_SET_GROUP_VISIBILITY,\n        payload: { ...options, ...{ mapName: mapName } }\n    };\n}\n\n/**\n * Sets the visibility for the given map layer\n *\n * @export\n * @param {string} mapName\n * @param {{ id: string, value: boolean }} options\n * @returns\n */\nexport function setLayerVisibility(mapName: string, options: { id: string, value: boolean }): ILegendSetLayerVisibilityAction {\n    return {\n        type: ActionType.LEGEND_SET_LAYER_VISIBILITY,\n        payload: { ...options, ...{ mapName: mapName } }\n    };\n}\n\n/**\n * Sets the expanded/collapsed state of the given group\n *\n * @export\n * @param {string} mapName\n * @param {{ id: string, value: boolean }} options\n * @returns\n */\nexport function setGroupExpanded(mapName: string, options: { id: string, value: boolean }): ILegendSetGroupExpandedAction {\n    return {\n        type: ActionType.LEGEND_SET_GROUP_EXPANDABLE,\n        payload: { ...options, ...{ mapName: mapName } }\n    };\n}\n\n/**\n * Sets the selectability state for the given map layer\n *\n * @export\n * @param {string} mapName\n * @param {{ id: string, value: boolean }} options\n * @returns\n */\nexport function setLayerSelectable(mapName: string, options: { id: string, value: boolean }): ILegendSetGroupSelectableAction {\n    return {\n        type: ActionType.LEGEND_SET_LAYER_SELECTABLE,\n        payload: { ...options, ...{ mapName: mapName } }\n    };\n}\n\n/**\n * Perform a full refresh with a requery of the layer/group structure\n *\n * @export\n * @returns {ReduxThunkedAction}\n */\nexport function refresh(): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        const state = getState();\n        const args = state.config;\n        const map = getRuntimeMap(state);\n        if (map && args.agentUri && args.agentKind) {\n            const client = new Client(args.agentUri, args.agentKind);\n            client.describeRuntimeMap({\n                mapname: map.Name,\n                session: map.SessionId,\n                requestedFeatures: RuntimeMapFeatureFlags.LayerFeatureSources | RuntimeMapFeatureFlags.LayerIcons | RuntimeMapFeatureFlags.LayersAndGroups\n            }).then(res => {\n                if (args.activeMapName) {\n                    dispatch({\n                        type: ActionType.MAP_REFRESH,\n                        payload: {\n                            mapName: args.activeMapName,\n                            map: res\n                        }\n                    });\n                }\n            });\n        }\n    };\n}","import {\n    ActiveMapTool,\n    ICommand,\n    IMapView,\n    ReduxThunkedAction,\n    getCurrentView,\n    getRuntimeMap,\n    getSelectionSet,\n    UnitOfMeasure,\n    ILayerInfo,\n    Bounds\n} from \"../api/common\";\nimport { getViewer } from \"../api/runtime\";\nimport { getFiniteScaleIndexForScale } from '../utils/number';\nimport { Client } from \"../api/client\";\nimport { QueryMapFeaturesResponse, FeatureSet, SelectedFeature, SelectedFeatureSet } from '../api/contracts/query';\nimport { IQueryMapFeaturesOptions } from '../api/request-builder';\nimport { buildSelectionXml } from '../api/builders/deArrayify';\nimport { makeUnique } from \"../utils/array\";\nimport { ActionType } from '../constants/actions';\nimport {\n    IMapSetBusyCountAction,\n    IMapSetBaseLayerAction,\n    IMapSetScaleAction,\n    IMapSetMouseCoordinatesAction,\n    IMapSetLayerTransparencyAction,\n    IMapSetViewSizeUnitsAction,\n    IMapPreviousViewAction,\n    IMapNextViewAction,\n    ISetActiveMapToolAction,\n    ISetActiveMapAction,\n    ISetManualFeatureTooltipsEnabledAction,\n    ISetFeatureTooltipsEnabledAction,\n    IMapSetViewRotationAction,\n    IMapSetViewRotationEnabledAction,\n    IShowSelectedFeatureAction,\n    IMapSetSelectionAction,\n    IMapResizedAction,\n    IAddedLayerAction,\n    IRemoveLayerAction,\n    ISetLayerIndexAction,\n    ISetLayerOpacityAction,\n    ISetLayerVisibilityAction,\n    ISetMapLayerVectorStyle,\n    IAddMapLayerBusyWorkerAction,\n    IRemoveMapLayerBusyWorkerAction,\n    IAddClientSelectedFeatureAction,\n    IClearClientSelectionAction,\n    ISetHeatmapLayerBlurAction,\n    ISetHeatmapLayerRadiusAction\n} from './defs';\nimport { persistSelectionSetToLocalStorage } from '../api/session-store';\nimport { getSiteVersion, canUseQueryMapFeaturesV4 } from '../utils/site-version';\nimport { areViewsCloseToEqual } from '../utils/viewer-state';\nimport { IVectorLayerStyle, VectorStyleSource } from '../api/ol-style-contracts';\nimport { ClientSelectionFeature } from \"../api/contracts/common\";\n\nfunction combineSelectedFeatures(oldRes: SelectedFeature[], newRes: SelectedFeature[]): SelectedFeature[] {\n    const merged: SelectedFeature[] = [];\n    for (const feat of oldRes) {\n        merged.push(feat);\n    }\n    for (const feat of newRes) {\n        //NOTE: Due to lack of identity property information, we have to\n        //check all property values\n        const matches = merged.filter(f => {\n            for (const p of f.Property) {\n                for (const np of feat.Property) {\n                    if (p.Name == np.Name) {\n                        if (p.Value != np.Value) {\n                            return false;\n                        }\n                    }\n                }\n            }\n            return true;\n        });\n        if (matches.length == 0) {\n            merged.push(feat);\n        }\n    }\n    return merged;\n}\n\nfunction combineSelectedFeatureSets(oldRes: SelectedFeatureSet | undefined, newRes: SelectedFeatureSet | undefined): SelectedFeatureSet | undefined {\n    if (oldRes == null) {\n        return newRes;\n    }\n    const merged: SelectedFeatureSet = {\n        SelectedLayer: []\n    };\n    for (const layer of oldRes.SelectedLayer) {\n        merged.SelectedLayer.push(layer);\n    }\n    if (newRes) {\n        for (const layer of newRes.SelectedLayer) {\n            const layerId = layer[\"@id\"];\n            const layerName = layer[\"@name\"];\n            const existing = merged.SelectedLayer.filter(l => l[\"@id\"] == layerId && l[\"@name\"] == layerName);\n            if (existing.length == 0) {\n                merged.SelectedLayer.push(layer);\n            } else {\n                existing[0].Feature = combineSelectedFeatures(existing[0].Feature, layer.Feature);\n            }\n        }\n    }\n    return merged;\n}\n\nfunction combineFeatureSets(oldRes: FeatureSet | undefined, newRes: FeatureSet | undefined): FeatureSet | undefined {\n    if (oldRes == null) {\n        return newRes;\n    }\n    const merged: FeatureSet = {\n        Layer: []\n    };\n    for (const layer of oldRes.Layer) {\n        merged.Layer.push(layer);\n    }\n    if (newRes) {\n        for (const layer of newRes.Layer) {\n            const layerId = layer[\"@id\"];\n            const existing = merged.Layer.filter(l => l[\"@id\"] == layerId);\n            if (existing.length == 0) {\n                merged.Layer.push(layer);\n            } else {\n                existing[0].Class.ID = makeUnique(existing[0].Class.ID.concat(layer.Class.ID));\n            }\n        }\n    }\n    return merged;\n}\n\nfunction combineSelections(oldRes: QueryMapFeaturesResponse | undefined, newRes: QueryMapFeaturesResponse): QueryMapFeaturesResponse {\n    if (oldRes) {\n        const merged: QueryMapFeaturesResponse = {\n            SelectedFeatures: combineSelectedFeatureSets(oldRes.SelectedFeatures, newRes.SelectedFeatures),\n            FeatureSet: combineFeatureSets(oldRes.FeatureSet, newRes.FeatureSet),\n            Hyperlink: undefined,\n            InlineSelectionImage: undefined\n        };\n        return merged;\n    } else {\n        return newRes;\n    }\n}\n\n/**\n * Options for map querying\n *\n * @export\n * @interface QueryMapFeatureActionOptions\n */\nexport interface QueryMapFeatureActionOptions {\n    /**\n     * The main set of map querying options\n     *\n     * @type {IQueryMapFeaturesOptions}\n     * @memberof QueryMapFeatureActionOptions\n     */\n    options: IQueryMapFeaturesOptions;\n    /**\n     * If true, the selection changes will be appended to the current selection set. False otherwise\n     *\n     * @type {boolean}\n     * @memberof QueryMapFeatureActionOptions\n     */\n    append?: boolean;\n    /**\n     * An optional callback to invoke on successful operation\n     *\n     * @memberof QueryMapFeatureActionOptions\n     */\n    callback?: (res: QueryMapFeaturesResponse) => void;\n    /**\n     * An optional callback to invoke on failure\n     *\n     * @memberof QueryMapFeatureActionOptions\n     */\n    errBack?: (err: any) => void;\n}\n\n/**\n * Queries map features\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {QueryMapFeatureActionOptions} opts query options\n * @returns {ReduxThunkedAction}\n */\nexport function queryMapFeatures(mapName: string, opts: QueryMapFeatureActionOptions): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        const state = getState();\n        const args = state.config;\n        const map = getRuntimeMap(state);\n        const selectionSet = getSelectionSet(state);\n        if (map && args.agentKind && args.agentUri) {\n            const client = new Client(args.agentUri, args.agentKind);\n            const success = (res: QueryMapFeaturesResponse) => {\n                if (opts.callback != null) {\n                    opts.callback(res);\n                }\n            };\n            const failure = (err: Error) => {\n                if (opts.errBack != null) {\n                    opts.errBack(err);\n                }\n            };\n            //We want v4.0.0 QUERYMAPFEATURES if available\n            const sv = getSiteVersion(map);\n            const queryOp = canUseQueryMapFeaturesV4(sv)\n                ? (opts: IQueryMapFeaturesOptions) => client.queryMapFeatures_v4(opts)\n                : (opts: IQueryMapFeaturesOptions) => client.queryMapFeatures(opts);\n            queryOp(opts.options).then(res => {\n                if (opts.options.persist === 1) {\n                    if (opts.append === true) {\n                        const combined = combineSelections(selectionSet, res);\n                        const mergedXml = buildSelectionXml(combined.FeatureSet);\n                        //Need to update the server-side selection with the merged result\n                        queryOp({\n                            session: map.SessionId,\n                            mapname: map.Name,\n                            persist: 1,\n                            featurefilter: mergedXml\n                        }).then(() => {\n                            persistSelectionSetToLocalStorage(map.SessionId, mapName, combined); // set and forget\n                            dispatch(setSelection(mapName, combined));\n                            success(combined);\n                        });\n                    } else {\n                        persistSelectionSetToLocalStorage(map.SessionId, mapName, res); // set and forget\n                        dispatch(setSelection(mapName, res));\n                        success(res);\n                    }\n                } else {\n                    success(res);\n                }\n            }).catch(failure);\n        }\n    };\n}\n\n/**\n * Sets the current map view.\n *\n * NOTE: Subscribing components are not guaranteed to receive every new view change sent by\n * calling this method. For purposes of optimization, views passed in that are \"close enough\"\n * to the current view are not dispatched to subscribing components.\n * \n * @export\n * @param {IMapView} view The map view to set\n * @returns {ReduxThunkedAction}\n */\nexport function setCurrentView(view: IMapView): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        // HACK-y:\n        //\n        // We don't want to dispatch SET_VIEW actions with redundant view\n        // states if the one we're about to dispatch is the same as the\n        // previous one\n        const state = getState();\n        const currentView = getCurrentView(state);\n        const newView = { ...view };\n        const mapName = state.config.activeMapName;\n        let dispatchThis = true;\n        if (currentView && mapName) {\n            //If the current map is tiled (has finite scales), \"snap\" the view's scale\n            //to the closest applicable finite scale then do the test \n            const mapState = state.mapState[mapName];\n            const fs = mapState?.mapguide?.runtimeMap?.FiniteDisplayScale;\n            if (fs && fs.length > 0) {\n\n                const fi = getFiniteScaleIndexForScale(fs, newView.scale);\n                newView.scale = fs[fi];\n            }\n            if (areViewsCloseToEqual(currentView, newView)) {\n                dispatchThis = false;\n            }\n        }\n        if (dispatchThis && mapName) {\n            dispatch({\n                type: ActionType.MAP_SET_VIEW,\n                payload: {\n                    mapName,\n                    view: newView\n                }\n            });\n        }\n    };\n}\n\n/**\n * Sends a map resized notification\n * \n * @export\n * @param {number} width \n * @param {number} height \n * @returns {IMapResizedAction} \n */\nexport function mapResized(width: number, height: number): IMapResizedAction {\n    return {\n        type: ActionType.MAP_RESIZED,\n        payload: {\n            width,\n            height\n        }\n    }\n}\n\n/**\n * Sets the selection set for the given map\n * \n * @param mapName \n * @param selectionSet \n * @returns \n * \n * @since 0.14 Fixed up the type of selectionSet parameter\n */\nexport function setSelection(mapName: string, selectionSet: QueryMapFeaturesResponse | undefined): IMapSetSelectionAction {\n    return {\n        type: ActionType.MAP_SET_SELECTION,\n        payload: {\n            mapName,\n            selection: selectionSet\n        }\n    };\n}\n\n/**\n * Invokes the specified command\n *\n * @export\n * @param {ICommand} cmd\n * @param {*} [parameters]\n * @returns {ReduxThunkedAction}\n */\nexport function invokeCommand(cmd: ICommand, parameters?: any): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        return cmd.invoke(dispatch, getState, getViewer(), parameters);\n    };\n}\n\n/**\n * Sets the busy count of the viewer. A value greater than zero signifies that the viewer is currently\n * busy performing various actions (eg. Loading/Rendering the current map image)\n *\n * @export\n * @param {number} busyCount The current busy count\n * @returns {IMapSetBusyCountAction}\n */\nexport function setBusyCount(busyCount: number): IMapSetBusyCountAction {\n    return {\n        type: ActionType.MAP_SET_BUSY_COUNT,\n        payload: busyCount\n    };\n}\n\n/**\n * Set the given external base layer as the active base layer\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {string} layerName The name of the external base layer to set as active\n * @returns\n */\nexport function setBaseLayer(mapName: string, layerName: string): IMapSetBaseLayerAction {\n    return {\n        type: ActionType.MAP_SET_BASE_LAYER,\n        payload: {\n            mapName,\n            layerName\n        }\n    };\n}\n\n/**\n * Sets the view scale\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {number} scale The scale to set\n * @returns\n */\nexport function setScale(mapName: string, scale: number): IMapSetScaleAction {\n    const viewer = getViewer();\n    let resolution;\n    if (viewer) {\n        resolution = viewer.scaleToResolution(scale);\n    }\n    return {\n        type: ActionType.MAP_SET_SCALE,\n        payload: {\n            mapName,\n            scale,\n            resolution\n        }\n    };\n}\n\n/**\n * Sets the current mouse coordinates\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {*} coord The current mouse coordinates\n * @returns\n */\nexport function setMouseCoordinates(mapName: string, coord: any): IMapSetMouseCoordinatesAction {\n    return {\n        type: ActionType.UPDATE_MOUSE_COORDINATES,\n        payload: {\n            mapName,\n            coord\n        }\n    };\n}\n\n/**\n * Set the transparency for the given OL layer\n * \n * @export\n * @param {string} mapName The name of the current runtime map\n * @param {string} layerName The name of the OL layer\n * @param {number} opacity A value between 0 and 1. 1 - Fully Opaque, 0 - Fully Transparent\n * @returns \n */\nexport function setLayerTransparency(mapName: string, layerName: string, opacity: number): IMapSetLayerTransparencyAction {\n    return {\n        type: ActionType.MAP_SET_LAYER_TRANSPARENCY,\n        payload: {\n            mapName,\n            layerName,\n            opacity\n        }\n    };\n}\n\n/**\n * Sets the units for the map view size display\n * \n * @export\n * @param {UnitOfMeasure} unit \n * @returns {IMapSetViewSizeUnitsAction} \n */\nexport function setViewSizeUnits(unit: UnitOfMeasure): IMapSetViewSizeUnitsAction {\n    return {\n        type: ActionType.MAP_SET_VIEW_SIZE_UNITS,\n        payload: unit\n    };\n}\n\n/**\n * Goes back to the previous view on the navigation stack\n *\n * @export\n * @param {string} mapName The name of the current runtime map\n * @returns\n */\nexport function previousView(mapName: string): IMapPreviousViewAction {\n    return {\n        type: ActionType.MAP_PREVIOUS_VIEW,\n        payload: {\n            mapName\n        }\n    };\n}\n\n/**\n * Goes to the next view on the navigation stack\n *\n * @export\n * @param {string} mapName The name of the current runtime amp\n * @returns\n */\nexport function nextView(mapName: string): IMapNextViewAction {\n    return {\n        type: ActionType.MAP_NEXT_VIEW,\n        payload: {\n            mapName\n        }\n    };\n}\n\n/**\n * Sets the active map tool\n *\n * @export\n * @param {ActiveMapTool} tool The active map tool command\n * @returns\n */\nexport function setActiveTool(tool: ActiveMapTool): ISetActiveMapToolAction {\n    return {\n        type: ActionType.MAP_SET_ACTIVE_TOOL,\n        payload: tool\n    };\n}\n\n/**\n * Sets the active runtime map\n *\n * @export\n * @param {string} mapName The name of the runtime map to set as active\n * @returns\n */\nexport function setActiveMap(mapName: string): ISetActiveMapAction {\n    return {\n        type: ActionType.MAP_SET_ACTIVE_MAP,\n        payload: mapName\n    };\n}\n\n/**\n * Sets whether feature tooltips (aka. Map Tips) are enabled\n *\n * @export\n * @param {boolean} enabled\n * @returns\n */\nexport function setFeatureTooltipsEnabled(enabled: boolean): ISetFeatureTooltipsEnabledAction {\n    return {\n        type: ActionType.MAP_SET_MAPTIP,\n        payload: enabled\n    };\n}\n\n/**\n * Sets whether manual feature tooltips (aka. Map Tips) are enabled\n *\n * @export\n * @param {boolean} enabled\n * @returns\n */\nexport function setManualFeatureTooltipsEnabled(enabled: boolean): ISetManualFeatureTooltipsEnabledAction {\n    return {\n        type: ActionType.MAP_SET_MANUAL_MAPTIP,\n        payload: enabled\n    };\n}\n\n/**\n * Sets the rotation of the current view\n * \n * @export\n * @param {number} rotation \n * @returns \n */\nexport function setViewRotation(rotation: number): IMapSetViewRotationAction {\n    return {\n        type: ActionType.MAP_SET_VIEW_ROTATION,\n        payload: rotation\n    };\n}\n\n/**\n * Sets whether view rotation is enabled or not\n * \n * @export\n * @param {boolean} enabled \n */\nexport function setViewRotationEnabled(enabled: boolean): IMapSetViewRotationEnabledAction {\n    return {\n        type: ActionType.MAP_SET_VIEW_ROTATION_ENABLED,\n        payload: enabled\n    };\n}\n\n/**\n * Shows the selected feature on the map\n * \n * @export\n * @param {string} mapName \n * @param {string} layerId \n * @param {string} selectionKey \n * @returns {IShowSelectedFeatureAction} \n */\nexport function showSelectedFeature(mapName: string, layerId: string, selectionKey: string): IShowSelectedFeatureAction {\n    return {\n        type: ActionType.MAP_SHOW_SELECTED_FEATURE,\n        payload: {\n            mapName,\n            layerId,\n            selectionKey\n        }\n    };\n}\n\n/**\n * NOTE: Dispatching this action does not add the layer to the map. This is a means to notify others\n * that a new layer has been added. It is expected to be dispatched by any component that is managing\n * layers\n * \n * @export\n * @param {string} mapName\n * @param {ILayerInfo} layer\n * @param {IVectorLayerStyle} [defaultStyle]\n * @returns {IAddedLayerAction}\n * @since 0.13\n * @since 0.14 defaultStyle argument changed to IVectorLayerStyle\n */\nexport function mapLayerAdded(mapName: string, layer: ILayerInfo, defaultStyle?: IVectorLayerStyle): IAddedLayerAction {\n    return {\n        type: ActionType.LAYER_ADDED,\n        payload: {\n            mapName,\n            layer,\n            defaultStyle\n        }\n    };\n}\n\n/**\n * An action that signals the externa layers for the given map name is ready. This action\n * is only dispatched when there is no external layers to initially add\n * \n * @param mapName \n * @since 0.14\n */\nexport function externalLayersReady(mapName: string) {\n    return {\n        type: ActionType.EXTERNAL_LAYERS_READY,\n        payload: {\n            mapName\n        }\n    }\n}\n\n/**\n * Removes a given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @returns {IRemoveLayerAction}\n * @since 0.13\n */\nexport function removeMapLayer(mapName: string, layerName: string): IRemoveLayerAction {\n    return {\n        type: ActionType.REMOVE_LAYER,\n        payload: {\n            mapName,\n            layerName\n        }\n    };\n}\n\n/**\n * Sets the display order index for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @param {number} index\n * @returns {ISetLayerIndexAction}\n * @since 0.13\n */\nexport function setMapLayerIndex(mapName: string, layerName: string, index: number): ISetLayerIndexAction {\n    return {\n        type: ActionType.SET_LAYER_INDEX,\n        payload: {\n            mapName,\n            layerName,\n            index\n        }\n    };\n}\n\n/**\n * Sets the opacity for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @param {number} opacity\n * @returns {ISetLayerOpacityAction}\n * @since 0.13\n */\nexport function setMapLayerOpacity(mapName: string, layerName: string, opacity: number): ISetLayerOpacityAction {\n    return {\n        type: ActionType.SET_LAYER_OPACITY,\n        payload: {\n            mapName,\n            layerName,\n            opacity\n        }\n    };\n}\n\n/**\n * Sets the heatmap blur for the given external heatmap layer for the given map\n * \n * @param mapName \n * @param layerName \n * @param blur \n */\nexport function setHeatmapLayerBlur(mapName: string, layerName: string, blur: number): ISetHeatmapLayerBlurAction {\n    return {\n        type: ActionType.SET_HEATMAP_LAYER_BLUR,\n        payload: {\n            mapName,\n            layerName,\n            blur\n        }\n    };\n}\n\n/**\n * Sets the heatmap radius for the given external heatmap layer for the given map\n * \n * @param mapName \n * @param layerName \n * @param radius \n */\nexport function setHeatmapLayerRadius(mapName: string, layerName: string, radius: number): ISetHeatmapLayerRadiusAction {\n    return {\n        type: ActionType.SET_HEATMAP_LAYER_RADIUS,\n        payload: {\n            mapName,\n            layerName,\n            radius\n        }\n    };\n}\n\n/**\n * Sets the visibility for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @param {boolean} visible\n * @returns {ISetLayerVisibilityAction}\n * @since 0.13\n */\nexport function setMapLayerVisibility(mapName: string, layerName: string, visible: boolean): ISetLayerVisibilityAction {\n    return {\n        type: ActionType.SET_LAYER_VISIBILITY,\n        payload: {\n            mapName,\n            layerName,\n            visible\n        }\n    };\n}\n\n/**\n * Sets the vector style for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @param {IVectorLayerStyle} style\n * @param {VectorStyleSource} which\n * @returns {ISetMapLayerVectorStyle}\n * @since 0.13\n * @since 0.14 style and which arguments changed to IVectorLayerStyle\n */\nexport function setMapLayerVectorStyle(mapName: string, layerName: string, style: IVectorLayerStyle, which: VectorStyleSource): ISetMapLayerVectorStyle {\n    return {\n        type: ActionType.SET_LAYER_VECTOR_STYLE,\n        payload: {\n            mapName,\n            layerName,\n            style,\n            which\n        }\n    };\n}\n\n/**\n * Adds a busy worker for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @returns {IAddMapLayerBusyWorkerAction}\n * @since 0.13\n */\nexport function addMapLayerBusyWorker(mapName: string, layerName: string): IAddMapLayerBusyWorkerAction {\n    return {\n        type: ActionType.ADD_LAYER_BUSY_WORKER,\n        payload: {\n            mapName,\n            layerName\n        }\n    }\n}\n\n/**\n * Removes a busy worker for the given external layer for the given map\n * \n * @export\n * @param {string} mapName\n * @param {string} layerName\n * @returns {IRemoveMapLayerBusyWorkerAction}\n * @since 0.13\n */\nexport function removeMapLayerBusyWorker(mapName: string, layerName: string): IRemoveMapLayerBusyWorkerAction {\n    return {\n        type: ActionType.REMOVE_LAYER_BUSY_WORKER,\n        payload: {\n            mapName,\n            layerName\n        }\n    }\n}\n\n/**\n * Adds a feature to the client selection set for the given map\n * \n * @param mapName \n * @param layerName \n * @param feature \n * @returns \n * @since 0.14\n */\nexport function addClientSelectedFeature(mapName: string, layerName: string, feature: ClientSelectionFeature): IAddClientSelectedFeatureAction {\n    return {\n        type: ActionType.MAP_ADD_CLIENT_SELECTED_FEATURE,\n        payload: {\n            mapName,\n            layerName,\n            feature\n        }\n    }\n}\n\n/**\n * Clears the client selection set for the given map\n * \n * @param mapName \n * @since 0.14\n */\nexport function clearClientSelection(mapName: string): IClearClientSelectionAction {\n    return {\n        type: ActionType.MAP_CLEAR_CLIENT_SELECTION,\n        payload: {\n            mapName\n        }\n    }\n}","import {\n    IModalComponentDisplayOptions,\n    IModalDisplayOptions\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ICloseModalAction, IShowModalUrlAction, IShowComponentInModalAction } from './defs';\n\n/**\n * Displays the specified component in a modal dialog\n *\n * @export\n * @param {*} options Modal dialog display options\n * @returns {IShowComponentInModalAction}\n */\nexport function showModalComponent(options: IModalComponentDisplayOptions): IShowComponentInModalAction {\n    return {\n        type: ActionType.MODAL_SHOW_COMPONENT,\n        payload: {\n            ...options\n        }\n    };\n}\n\n/**\n * Displays the specified URL in a modal dialog\n *\n * @export\n * @param {*} options Modal dialog display options\n * @returns {IShowModalUrlAction}\n */\nexport function showModalUrl(options: IModalDisplayOptions): IShowModalUrlAction {\n    return {\n        type: ActionType.MODAL_SHOW_URL,\n        payload: {\n            ...options\n        }\n    };\n}\n\n/**\n * Hides an open modal dialog\n *\n * @export\n * @param name The name of the modal to hide\n * @returns {ICloseModalAction}\n */\nexport function hideModal(name: string): ICloseModalAction {\n    return {\n        type: ActionType.MODAL_CLOSE,\n        payload: name\n    };\n}","import { MgError } from \"../api/error\";\nimport {\n    ReduxThunkedAction\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ITaskPaneBackAction, ITaskPaneForwardAction, ITaskPanePushUrlAction } from './defs';\n\n/**\n * Go back to the initial task URL\n *\n * @export\n * @returns {ReduxThunkedAction}\n */\nexport function goHome(): ReduxThunkedAction {\n    return (dispatch, getState) => {\n        const initUrl = getState().taskpane.initialUrl;\n        if (initUrl != null) {\n            dispatch({\n                type: ActionType.TASK_PANE_HOME\n            });\n        } else {\n            throw new MgError(\"Case not handled yet: Home action when no initial task URL set\");\n        }\n    };\n}\n\n/**\n * Go back one entry in the task pane navigation history\n *\n * @export\n * @returns\n */\nexport function goBack(): ITaskPaneBackAction {\n    return {\n        type: ActionType.TASK_PANE_BACK\n    };\n}\n\n/**\n * Go forward one entry in the task pane navigation history\n *\n * @export\n * @returns\n */\nexport function goForward(): ITaskPaneForwardAction {\n    return {\n        type: ActionType.TASK_PANE_FORWARD\n    };\n}\n\n/**\n * Pushes the given URL to the task pane navigation history stack\n *\n * @export\n * @param {string} url\n * @param {boolean} [silent]\n * @returns\n */\nexport function pushUrl(url: string, silent?: boolean): ITaskPanePushUrlAction {\n    return {\n        type: ActionType.TASK_PANE_PUSH_URL,\n        payload: {\n            url: url,\n            silent: silent\n        }\n    };\n}","/**\n * template.ts\n *\n * Actions to support fusion templates\n */\nimport { ActionType } from '../constants/actions';\nimport { IElementState, ITemplateSetElementStateAction, ITemplateSetTaskPaneVisibilityAction, ITemplateSetSelectionPanelVisibility, ITemplateSetLegendVisibility } from './defs';\n\nexport function setElementStates(states: IElementState): ITemplateSetElementStateAction {\n    return {\n        type: ActionType.FUSION_SET_ELEMENT_STATE,\n        payload: states\n    };\n}\n\nexport function setTaskPaneVisibility(visible: boolean): ITemplateSetTaskPaneVisibilityAction {\n    return {\n        type: ActionType.FUSION_SET_TASK_PANE_VISIBILITY,\n        payload: visible\n    };\n}\n\nexport function setSelectionPanelVisibility(visible: boolean): ITemplateSetSelectionPanelVisibility {\n    return {\n        type: ActionType.FUSION_SET_SELECTION_PANEL_VISIBILITY,\n        payload: visible\n    };\n}\n\n/*\nexport function setOverviewMapVisibility(visible: boolean): ReduxAction {\n    return {\n        type: ActionType.FUSION_SET_OVERVIEW_MAP_VISIBILITY,\n        payload: visible\n    };\n}\n*/\n\nexport function setLegendVisibility(visible: boolean): ITemplateSetLegendVisibility {\n    return {\n        type: ActionType.FUSION_SET_LEGEND_VISIBILITY,\n        payload: visible\n    };\n}","/**\n * @module\n * @hidden\n */\n\nimport { ILayerSetOL } from './layer-set-contracts';\nimport LayerGroup from 'ol/layer/Group';\nimport { Bounds, IExternalBaseLayer, RefreshMode, LayerTransparencySet, Size } from './common';\nimport View from 'ol/View';\nimport LayerBase from \"ol/layer/Base\";\nimport * as olHas from \"ol/has\";\nimport Source from 'ol/source/Source';\n\n/**\n * @hidden\n */\nexport abstract class BaseLayerSetOL implements ILayerSetOL {\n    constructor(public readonly externalBaseLayersGroup: LayerGroup | undefined,\n        public readonly projection: string | undefined,\n        public readonly dpi: number,\n        public readonly extent: Bounds,\n        private readonly inPerUnit: number,\n        public readonly view: View) {\n\n    }\n    public getMetersPerUnit(): number {\n        return this.inPerUnit / 39.37\n    }\n    public scaleToResolution(scale: number): number {\n        return (scale / this.inPerUnit / this.dpi) * olHas.DEVICE_PIXEL_RATIO;\n    }\n    public resolutionToScale(resolution: number): number {\n        return (resolution * this.dpi * this.inPerUnit) / olHas.DEVICE_PIXEL_RATIO;\n    }\n    public updateExternalBaseLayers(externalBaseLayers: IExternalBaseLayer[]) {\n        if (this.externalBaseLayersGroup) {\n            const layers = this.externalBaseLayersGroup.getLayers();\n            layers.forEach((l: LayerBase) => {\n                const match = (externalBaseLayers || []).filter(el => el.name === l.get(\"title\"));\n                if (match.length == 1) {\n                    l.setVisible(!!match[0].visible);\n                } else {\n                    l.setVisible(false);\n                }\n            });\n        }\n    }\n    /**\n     *\n     * @virtual\n     * @param {RefreshMode} mode\n     * @memberof BaseLayerSetOL\n     */\n    refreshMap(mode: RefreshMode): void { }\n    abstract getLayers(): LayerBase[];\n    abstract getSourcesForProgressTracking(): Source[];\n    abstract updateTransparency(trans: LayerTransparencySet): void;\n    abstract showActiveSelectedFeature(mapExtent: Bounds, size: Size, uri: string): void;\n    abstract update(showGroups: string[] | undefined, showLayers: string[] | undefined, hideGroups: string[] | undefined, hideLayers: string[] | undefined): void;\n    abstract updateSelectionColor(color: string): void;\n}","/**\n * Sets up key dependencies needed by the viewer. This only needs to be called on the entry point of your custom viewer bundle\n *\n * @export\n */\nexport function bootstrap() {\n    \n}","/**\n * deArrayify.ts\n *\n * This module provides JSON sanitization of JSON responses from the mapagent\n *\n * Being a transformation of the XML form, and taking a lowest-common-denominator\n * approach to JSON conversion, the JSON responses from MapGuide are un-wieldy to\n * use from the client-side due to:\n *\n *  a) All properties being arrays\n *  b) All property values being strings\n *\n * These functions help \"clean\" those responses to be of the form we expect (and prefer)\n */\nimport { MgError } from \"../error\";\nimport { ActiveSelectedFeature, getExternalBaseLayers } from \"../common\";\nimport { RuleInfo, FeatureStyleInfo, ScaleRangeInfo, FeatureSourceInfo, MapLayer, MapGroup, CoordinateSystemType, EnvCoordinate, Envelope, RuntimeMap } from '../contracts/runtime-map';\nimport { FeatureSetClass, FeatureSetLayer, FeatureSet, SelectionImage, FeatureProperty, SelectedFeature, LayerPropertyMetadata, LayerMetadata, SelectedLayer, SelectedFeatureSet, QueryMapFeaturesResponse } from '../contracts/query';\nimport { WebLayoutMap, WebLayoutControl, WebLayoutInfoPane, MapView, TaskButton, WebLayoutTaskBar, UIItem, WebLayoutTaskPane, CommandUIItem, FlyoutUIItem, ResultColumnSet, ResultColumn, LayerSet, ParameterPair, CommandDef, BasicCommandDef, InvokeScriptCommandDef, InvokeURLCommandDef, SearchCommandDef, WebLayoutCommandSet, WebLayout, WebLayoutToolbar, WebLayoutContextMenu, WebLayoutStatusBar, WebLayoutZoomControl } from '../contracts/weblayout';\nimport { MapSetGroup, MapInitialView, MapConfiguration, MapSet, ContainerItem, FlyoutItem, WidgetItem, ContainerDefinition, Widget, UIWidget, MapWidget, WidgetSet, ApplicationDefinition } from '../contracts/fusion';\nimport { MDF_INFINITY } from '../../constants';\nimport { MapDefinition, MapDefinitionLayerGroup, MapDefinitionLayer as MdfLayer, TileSetSource } from \"../contracts/map-definition\";\nimport { BaseMapLayer, BaseMapLayerGroup, TileSetDefinition, TileStoreParameters } from \"../contracts/tile-set-definition\";\nimport { SiteVersionResponse } from '../contracts/common';\n\ntype ElementType = \"string\" | \"boolean\" | \"int\" | \"float\";\n\nfunction buildPropertyGetter<T>() {\n    return (el: any, name: keyof T, type: ElementType = \"string\") => {\n        return tryGetAsProperty<T>(el, name, type);\n    }\n}\n\nfunction tryGetAsProperty<T>(el: any, name: keyof T, type: ElementType = \"string\"): any {\n    if (!el[name]) {\n        return null;\n    } else if (el[name].length === 1) {\n        const val: string = el[name][0];\n        switch (type) {\n            case \"int\":\n                return parseInt(val, 10);\n            case \"float\":\n                return parseFloat(val);\n            case \"boolean\":\n                return val.toLowerCase() === \"true\";\n            default:\n                return val;\n        }\n    }\n}\n\nfunction deArrayifyRules(rules: any[]): RuleInfo[] {\n    const getter = buildPropertyGetter<RuleInfo>();\n    return rules.map(r => {\n        const rule: RuleInfo = {\n            LegendLabel: getter(r, \"LegendLabel\"),\n            Filter: getter(r, \"Filter\"),\n            Icon: getter(r, \"Icon\")\n        };\n        return rule;\n    });\n}\n\nfunction deArrayifyFeatureStyles(fts: any[]): FeatureStyleInfo[] {\n    if (!fts) {\n        return [];\n    }\n    const getter = buildPropertyGetter<FeatureStyleInfo>();\n    return fts.map(ft => {\n        const featureStyle: FeatureStyleInfo = {\n            Type: getter(ft, \"Type\", \"int\"),\n            Rule: deArrayifyRules(ft.Rule)\n        };\n        return featureStyle;\n    });\n}\n\nfunction deArrayifyScaleRanges(scales: any[]): ScaleRangeInfo[] {\n    if (!scales) { //Happens with raster layers (this is probably a bug in CREATERUNTIMEMAP)\n        const defaultRange: ScaleRangeInfo = {\n            MinScale: 0,\n            MaxScale: MDF_INFINITY,\n            FeatureStyle: []\n        };\n        return [defaultRange];\n    }\n    \n    const getter = buildPropertyGetter<ScaleRangeInfo>();\n    return scales.map(sc => {\n        const scale: ScaleRangeInfo = {\n            MinScale: getter(sc, \"MinScale\", \"float\"),\n            MaxScale: getter(sc, \"MaxScale\", \"float\"),\n            FeatureStyle: deArrayifyFeatureStyles(sc.FeatureStyle)\n        };\n        return scale;\n    });\n}\n\nfunction deArrayifyFeatureSourceInfo(fs: any[]): FeatureSourceInfo | undefined {\n    if (!fs || fs.length !== 1) {\n        return undefined;\n    }\n    const getter = buildPropertyGetter<FeatureSourceInfo>();\n    return {\n        ResourceId: getter(fs[0], \"ResourceId\"),\n        ClassName: getter(fs[0], \"ClassName\"),\n        Geometry: getter(fs[0], \"Geometry\")\n    };\n}\n\nfunction deArrayifyLayers(layers: any[]): MapLayer[] {\n    if (!layers)\n        return layers;\n\n    const getter = buildPropertyGetter<MapLayer>();\n    return layers.map(lyr => {\n        const layer: MapLayer = {\n            Type: getter(lyr, \"Type\", \"int\"),\n            Selectable: getter(lyr, \"Selectable\", \"boolean\"),\n            LayerDefinition: getter(lyr, \"LayerDefinition\"),\n            Name: getter(lyr, \"Name\"),\n            LegendLabel: getter(lyr, \"LegendLabel\"),\n            ObjectId: getter(lyr, \"ObjectId\"),\n            ParentId: getter(lyr, \"ParentId\"),\n            DisplayInLegend: getter(lyr, \"DisplayInLegend\", \"boolean\"),\n            ExpandInLegend: getter(lyr, \"ExpandInLegend\", \"boolean\"),\n            Visible: getter(lyr, \"Visible\", \"boolean\"),\n            ActuallyVisible: getter(lyr, \"ActuallyVisible\", \"boolean\"),\n            FeatureSource: deArrayifyFeatureSourceInfo(lyr.FeatureSource),\n            ScaleRange: deArrayifyScaleRanges(lyr.ScaleRange)\n        };\n        //This is either a raster or drawing layer, in this case disregard the\n        //selectability flag (and set it to false). This is to prevent false positive\n        //errors trying to do tooltip/selections against raster/drawing layers\n        if (!lyr.ScaleRange) {\n            layer.Selectable = false;\n        }\n        return layer;\n    });\n}\n\nfunction deArrayifyGroups(groups: any[]): MapGroup[] | undefined {\n    if (!groups)\n        return undefined;\n\n    const getter = buildPropertyGetter<MapGroup>();\n    return groups.map(grp => {\n        const group: MapGroup = {\n            Type: getter(grp, \"Type\", \"int\"),\n            Name: getter(grp, \"Name\"),\n            LegendLabel: getter(grp, \"LegendLabel\"),\n            ObjectId: getter(grp, \"ObjectId\"),\n            ParentId: getter(grp, \"ParentId\"),\n            DisplayInLegend: getter(grp, \"DisplayInLegend\", \"boolean\"),\n            ExpandInLegend: getter(grp, \"ExpandInLegend\", \"boolean\"),\n            Visible: getter(grp, \"Visible\", \"boolean\"),\n            ActuallyVisible: getter(grp, \"ActuallyVisible\", \"boolean\")\n        };\n        return group;\n    });\n}\n\nfunction deArrayifyCoordinateSystem(cs: any[]): CoordinateSystemType {\n    if (!cs || cs.length !== 1) {\n        throw new MgError(\"Malformed input. Expected CoordinateSystem element\");\n    }\n    const getter = buildPropertyGetter<CoordinateSystemType>();\n    const res: CoordinateSystemType = {\n        Wkt: getter(cs[0], \"Wkt\"),\n        MentorCode: getter(cs[0], \"MentorCode\"),\n        EpsgCode: getter(cs[0], \"EpsgCode\"),\n        MetersPerUnit: getter(cs[0], \"MetersPerUnit\", \"float\")\n    };\n    return res;\n}\n\nfunction deArrayifyCoordinate(coord: any[]): EnvCoordinate {\n    if (!coord || coord.length !== 1) {\n        throw new MgError(\"Malformed input. Expected coordinate array\");\n    }\n    const getter = buildPropertyGetter<EnvCoordinate>();\n    return {\n        X: getter(coord[0], \"X\", \"float\"),\n        Y: getter(coord[0], \"Y\", \"float\")\n    };\n}\n\nfunction deArrayifyExtents(extents: any[]): Envelope {\n    if (!extents || extents.length !== 1) {\n        throw new MgError(\"Malformed input. Expected extent element\");\n    }\n    const env: Envelope = {\n        LowerLeftCoordinate: deArrayifyCoordinate(extents[0].LowerLeftCoordinate),\n        UpperRightCoordinate: deArrayifyCoordinate(extents[0].UpperRightCoordinate)\n    };\n    return env;\n}\n\nfunction deArrayifyFiniteDisplayScales(fds: any[]): number[] | undefined {\n    if (!fds)\n        return undefined;\n\n    return fds.map(parseFloat);\n}\n\nfunction deArrayifyRuntimeMap(json: any): RuntimeMap {\n    const root = json;\n    const getter = buildPropertyGetter<RuntimeMap>();\n    const rtMap: RuntimeMap = {\n        SessionId: getter(root, \"SessionId\"),\n        SiteVersion: getter(root, \"SiteVersion\"),\n        Name: getter(root, \"Name\"),\n        MapDefinition: getter(root, \"MapDefinition\"),\n        TileSetDefinition: getter(root, \"TileSetDefinition\"),\n        TileWidth: getter(root, \"TileWidth\", \"int\"),\n        TileHeight: getter(root, \"TileHeight\", \"int\"),\n        BackgroundColor: getter(root, \"BackgroundColor\"),\n        DisplayDpi: getter(root, \"DisplayDpi\", \"int\"),\n        IconMimeType: getter(root, \"IconMimeType\"),\n        CoordinateSystem: deArrayifyCoordinateSystem(root.CoordinateSystem),\n        Extents: deArrayifyExtents(root.Extents),\n        Group: deArrayifyGroups(root.Group),\n        Layer: deArrayifyLayers(root.Layer),\n        FiniteDisplayScale: deArrayifyFiniteDisplayScales(root.FiniteDisplayScale)\n    };\n    return rtMap;\n}\n\nfunction deArrayifyFeatureSetClass(json: any): FeatureSetClass {\n    const root = json;\n    const getter = buildPropertyGetter<FeatureSetClass>();\n    if (root.length != 1) {\n        throw new MgError(\"Malformed input. Expected Class element\");\n    }\n    const cls = {\n        \"@id\": getter(root[0], \"@id\"),\n        ID: root[0].ID\n    };\n    return cls;\n}\n\nfunction deArrayifyFeatureSetLayers(json: any[]): FeatureSetLayer[] {\n    const getter = buildPropertyGetter<FeatureSetLayer>();\n    return (json || []).map(root => {\n        const layer = {\n            \"@id\": getter(root, \"@id\"),\n            \"@name\": getter(root, \"@name\"),\n            Class: deArrayifyFeatureSetClass(root.Class)\n        };\n        return layer;\n    });\n}\n\nfunction deArrayifyFeatureSet(json: any): FeatureSet | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const fs = {\n        Layer: deArrayifyFeatureSetLayers(root[0].Layer)\n    };\n    return fs;\n}\n\nfunction deArrayifyInlineSelectionImage(json: any): SelectionImage | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const getter = buildPropertyGetter<SelectionImage>();\n    const img = {\n        MimeType: getter(root[0], \"MimeType\"),\n        Content: getter(root[0], \"Content\")\n    };\n    return img;\n}\n\nfunction deArrayifyFeatureProperties(json: any[]): FeatureProperty[] {\n    const getter = buildPropertyGetter<FeatureProperty>();\n    return (json || []).map(root => {\n        const prop = {\n            Name: getter(root, \"Name\"),\n            Value: getter(root, \"Value\")\n        };\n        return prop;\n    });\n}\n\nfunction deArrayifyFeatures(json: any[]): SelectedFeature[] {\n    const getter = buildPropertyGetter<SelectedFeature>();\n    return (json || []).map(root => {\n        const feat = {\n            Bounds: getter(root, \"Bounds\"),\n            Property: deArrayifyFeatureProperties(root.Property),\n            SelectionKey: getter(root, \"SelectionKey\")\n        };\n        return feat;\n    });\n}\n\nfunction deArrayifyLayerMetadataProperties(json: any[]): LayerPropertyMetadata[] {\n    const getter = buildPropertyGetter<LayerPropertyMetadata>();\n    return (json || []).map(root => {\n        const prop = {\n            DisplayName: getter(root, \"DisplayName\"),\n            Name: getter(root, \"Name\"),\n            Type: getter(root, \"Type\", \"int\")\n        };\n        return prop;\n    });\n}\n\nfunction deArrayifyLayerMetadata(json: any): LayerMetadata | undefined {\n    const root = json;\n    //NOTE: root could be null if the layer selected has no properties beyond id/geom\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const meta = {\n        Property: deArrayifyLayerMetadataProperties(root[0].Property)\n    };\n    return meta;\n}\n\nfunction deArrayifySelectedLayer(json: any[]): SelectedLayer[] {\n    const getter = buildPropertyGetter<SelectedLayer>();\n    return (json || []).map(root => {\n        const layer = {\n            \"@id\": getter(root, \"@id\"),\n            \"@name\": getter(root, \"@name\"),\n            Feature: deArrayifyFeatures(root.Feature),\n            LayerMetadata: deArrayifyLayerMetadata(root.LayerMetadata)\n        };\n        return layer;\n    });\n}\n\nfunction deArrayifySelectedFeatures(json: any): SelectedFeatureSet | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const sf = {\n        SelectedLayer: deArrayifySelectedLayer(root[0].SelectedLayer)\n    };\n    return sf;\n}\n\nfunction deArrayifyFeatureInformation(json: any): QueryMapFeaturesResponse {\n    const root = json;\n    const getter = buildPropertyGetter<QueryMapFeaturesResponse>();\n    const resp = {\n        FeatureSet: deArrayifyFeatureSet(root.FeatureSet),\n        Hyperlink: getter(root, \"Hyperlink\"),\n        InlineSelectionImage: deArrayifyInlineSelectionImage(root.InlineSelectionImage),\n        SelectedFeatures: deArrayifySelectedFeatures(root.SelectedFeatures),\n        Tooltip: getter(root, \"Tooltip\")\n    };\n    return resp;\n}\n\nfunction deArrayifyWebLayoutControl<T extends WebLayoutControl>(json: any): T {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected control element\");\n    }\n    const getter = buildPropertyGetter<T>();\n    const control: any = {\n        Visible: getter(root[0], \"Visible\", \"boolean\")\n    };\n    return control;\n}\n\nfunction deArrayifyWebLayoutInfoPane(json: any): WebLayoutInfoPane {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected InformationPane element\");\n    }\n    const getter = buildPropertyGetter<WebLayoutInfoPane>();\n    const infoPane = {\n        Visible: getter(root[0], \"Visible\", \"boolean\"),\n        Width: getter(root[0], \"Width\", \"int\"),\n        LegendVisible: getter(root[0], \"LegendVisible\", \"boolean\"),\n        PropertiesVisible: getter(root[0], \"PropertiesVisible\", \"boolean\")\n    };\n    return infoPane;\n}\n\nfunction deArrayifyWebLayoutInitialView(json: any): MapView | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const getter = buildPropertyGetter<MapView>();\n    const view = {\n        CenterX: getter(root[0], \"CenterX\", \"float\"),\n        CenterY: getter(root[0], \"CenterY\", \"float\"),\n        Scale: getter(root[0], \"Scale\", \"float\")\n    };\n    return view;\n}\n\nfunction deArrayifyWebLayoutMap(json: any): WebLayoutMap {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected Map element\");\n    }\n    const getter = buildPropertyGetter<WebLayoutMap>();\n    const map = {\n        ResourceId: getter(root[0], \"ResourceId\"),\n        InitialView: deArrayifyWebLayoutInitialView(root[0].InitialView),\n        HyperlinkTarget: getter(root[0], \"HyperlinkTarget\"),\n        HyperlinkTargetFrame: getter(root[0], \"HyperlinkTargetFrame\")\n    };\n    return map;\n}\n\nfunction deArrayifyTaskButton(json: any): TaskButton {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected TaskButton element\");\n    }\n    const getter = buildPropertyGetter<TaskButton>();\n    const button = {\n        Name: getter(root[0], \"Name\"),\n        Tooltip: getter(root[0], \"Tooltip\"),\n        Description: getter(root[0], \"Description\"),\n        ImageURL: getter(root[0], \"ImageURL\"),\n        DisabledImageURL: getter(root[0], \"DisabledImageURL\")\n    };\n    return button;\n}\n\nfunction deArrayifyWebLayoutTaskBar(json: any): WebLayoutTaskBar {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected TaskBar element\");\n    }\n    const getter = buildPropertyGetter<WebLayoutTaskBar>();\n    const taskbar = {\n        Visible: getter(root[0], \"Visible\", \"boolean\"),\n        Home: deArrayifyTaskButton(root[0].Home),\n        Forward: deArrayifyTaskButton(root[0].Forward),\n        Back: deArrayifyTaskButton(root[0].Back),\n        Tasks: deArrayifyTaskButton(root[0].Tasks),\n        MenuButton: [] as UIItem[]\n    };\n    if (root[0].MenuButton) {\n        for (const mb of root[0].MenuButton) {\n            taskbar.MenuButton.push(deArrayifyUIItem(mb));\n        }\n    }\n    return taskbar;\n}\n\nfunction deArrayifyWebLayoutTaskPane(json: any): WebLayoutTaskPane {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected TaskPane element\");\n    }\n    const getter = buildPropertyGetter<WebLayoutTaskPane>();\n    const taskPane = {\n        Visible: getter(root[0], \"Visible\", \"boolean\"),\n        InitialTask: getter(root[0], \"InitialTask\"),\n        Width: getter(root[0], \"Width\", \"int\"),\n        TaskBar: deArrayifyWebLayoutTaskBar(root[0].TaskBar)\n    };\n    return taskPane;\n}\n\nfunction deArrayifyUIItem(json: any): UIItem {\n    const root = json;\n    const getter = buildPropertyGetter<UIItem & CommandUIItem & FlyoutUIItem>();\n    const func: string = getter(root, \"Function\");\n    //Wouldn't it be nice if we could incrementally build up a union type that then becomes a specific\n    //type once certain properties are set?\n    //\n    //Well, that's currently not possible. So we have to resort to \"any\"\n    const item: any = {\n        Function: func\n    };\n    switch (func) {\n        case \"Command\":\n            item.Command = getter(root, \"Command\");\n            break;\n        case \"Flyout\":\n            item.Label = getter(root, \"Label\");\n            item.Tooltip = getter(root, \"Tooltip\");\n            item.Description = getter(root, \"Description\");\n            item.ImageURL = getter(root, \"ImageURL\");\n            item.DisabledImageURL = getter(root, \"DisabledImageURL\");\n            item.SubItem = [];\n            for (const si of root.SubItem) {\n                item.SubItem.push(deArrayifyUIItem(si));\n            }\n            break;\n    }\n    return item;\n}\n\nfunction deArrayifyItemContainer<T extends WebLayoutControl>(json: any, name: string): T {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected container element\");\n    }\n    const getter = buildPropertyGetter<T>();\n    const container: any = {};\n    container[name] = [];\n    for (const item of root[0][name]) {\n        container[name].push(deArrayifyUIItem(item));\n    }\n    if (typeof (root[0].Visible) != 'undefined') {\n        container.Visible = getter(root[0], \"Visible\", \"boolean\");\n    }\n    return container;\n}\n\nfunction deArrayifyWebLayoutSearchResultColumnSet(json: any): ResultColumnSet {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected ResultColumns element\");\n    }\n    const getter = buildPropertyGetter<ResultColumn>();\n    const res = {\n        Column: [] as ResultColumn[]\n    };\n    for (const col of root[0].Column) {\n        res.Column.push({\n            Name: getter(col, \"Name\"),\n            Property: getter(col, \"Property\")\n        });\n    }\n    return res;\n}\n\nfunction deArrayifyWebLayoutInvokeURLLayerSet(json: any): LayerSet | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        return undefined;\n    }\n    const layerset = {\n        Layer: root[0].Layer\n    };\n    return layerset;\n}\n\nfunction deArrayifyWebLayoutParameterPairs(json: any): ParameterPair[] {\n    const root = json;\n    const pairs = [] as ParameterPair[]\n    if (!root) {\n        return pairs;\n    }\n    const getter = buildPropertyGetter<ParameterPair>();\n    for (const kvp of root) {\n        pairs.push({\n            Key: getter(kvp, \"Key\"),\n            Value: getter(kvp, \"Value\")\n        });\n    }\n    return pairs;\n}\n\nfunction deArrayifyCommand(json: any): CommandDef {\n    const root = json;\n    const getter = buildPropertyGetter<CommandDef & BasicCommandDef & InvokeScriptCommandDef & InvokeURLCommandDef & SearchCommandDef>();\n    const cmd: any = {\n        \"@xsi:type\": getter(root, \"@xsi:type\"),\n        Name: getter(root, \"Name\"),\n        Label: getter(root, \"Label\"),\n        Tooltip: getter(root, \"Tooltip\"),\n        Description: getter(root, \"Description\"),\n        ImageURL: getter(root, \"ImageURL\"),\n        DisabledImageURL: getter(root, \"DisabledImageURL\"),\n        TargetViewer: getter(root, \"TargetViewer\")\n    };\n    //Basic\n    if (typeof (root.Action) != 'undefined') {\n        cmd.Action = getter(root, \"Action\");\n    }\n    //Targeted\n    if (typeof (root.Target) != 'undefined') {\n        cmd.Target = getter(root, \"Target\");\n    }\n    if (typeof (root.TargetFrame) != 'undefined') {\n        cmd.TargetFrame = getter(root, \"TargetFrame\");\n    }\n    //Search\n    if (typeof (root.Layer) != 'undefined') {\n        cmd.Layer = getter(root, \"Layer\");\n        cmd.Prompt = getter(root, \"Prompt\");\n        cmd.ResultColumns = deArrayifyWebLayoutSearchResultColumnSet(root.ResultColumns);\n        cmd.Filter = getter(root, \"Filter\");\n        cmd.MatchLimit = getter(root, \"MatchLimit\", \"int\");\n    }\n    //InvokeURL | Help\n    if (typeof (root.URL) != 'undefined') {\n        cmd.URL = getter(root, \"URL\");\n    }\n    if (typeof (root.DisableIfSelectionEmpty) != 'undefined') {\n        cmd.LayerSet = deArrayifyWebLayoutInvokeURLLayerSet(root.LayerSet);\n        cmd.AdditionalParameter = deArrayifyWebLayoutParameterPairs(root.AdditionalParameter);\n        cmd.DisableIfSelectionEmpty = getter(root, \"DisableIfSelectionEmpty\", \"boolean\");\n    }\n    //InvokeScript\n    if (typeof (root.Script) != 'undefined') {\n        cmd.Script = getter(root, \"Script\");\n    }\n    return cmd;\n}\n\nfunction deArrayifyWebLayoutCommandSet(json: any): WebLayoutCommandSet {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected CommandSet element\");\n    }\n    const set = {\n        Command: [] as CommandDef[]\n    };\n    if (root[0].Command) {\n        for (const cmd of root[0].Command) {\n            set.Command.push(deArrayifyCommand(cmd));\n        }\n    }\n    return set;\n}\n\nfunction deArrayifyWebLayout(json: any): WebLayout {\n    const root = json;\n    const getter = buildPropertyGetter<WebLayout>();\n    const resp = {\n        Title: getter(root, \"Title\"),\n        Map: deArrayifyWebLayoutMap(root.Map),\n        EnablePingServer: getter(root, \"EnablePingServer\", \"boolean\"),\n        SelectionColor: getter(root, \"SelectionColor\"),\n        PointSelectionBuffer: getter(root, \"PointSelectionBuffer\", \"int\"),\n        MapImageFormat: getter(root, \"MapImageFormat\"),\n        SelectionImageFormat: getter(root, \"SelectionImageFormat\"),\n        StartupScript: getter(root, \"StartupScript\"),\n        ToolBar: deArrayifyItemContainer<WebLayoutToolbar>(root.ToolBar, \"Button\"),\n        InformationPane: deArrayifyWebLayoutInfoPane(root.InformationPane),\n        ContextMenu: deArrayifyItemContainer<WebLayoutContextMenu>(root.ContextMenu, \"MenuItem\"),\n        TaskPane: deArrayifyWebLayoutTaskPane(root.TaskPane),\n        StatusBar: deArrayifyWebLayoutControl<WebLayoutStatusBar>(root.StatusBar),\n        ZoomControl: deArrayifyWebLayoutControl<WebLayoutZoomControl>(root.ZoomControl),\n        CommandSet: deArrayifyWebLayoutCommandSet(root.CommandSet)\n    };\n    return resp;\n}\n\nfunction deArrayifyMapGroup(json: any): MapSetGroup {\n    const root = json;\n    if (root == null) {\n        throw new MgError(\"Malformed input. Expected MapGroup element\");\n    }\n    const getter = buildPropertyGetter<MapSetGroup & MapInitialView & MapConfiguration>();\n    const mapGroup: MapSetGroup = {\n        \"@id\": getter(root, \"@id\", \"string\"),\n        InitialView: undefined,\n        Map: [] as MapConfiguration[]\n    };\n    if (root.InitialView) {\n        const iview = root.InitialView[0];\n        mapGroup.InitialView = {\n            CenterX: getter(iview, \"CenterX\", \"float\"),\n            CenterY: getter(iview, \"CenterY\", \"float\"),\n            Scale: getter(iview, \"Scale\", \"float\")\n        };\n    }\n    if (root.Map) {\n        for (const m of root.Map) {\n            mapGroup.Map.push({\n                Type: getter(m, \"Type\", \"string\"),\n                //SingleTile: getter(m, \"SingleTile\", \"boolean\"),\n                Extension: deArrayifyExtension(m.Extension)\n            });\n        }\n    }\n    return mapGroup;\n}\n\nfunction deArrayifyMapSet(json: any): MapSet | undefined {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected MapSet element\");\n    }\n    const set = {\n        MapGroup: [] as MapSetGroup[]\n    };\n    if (root[0].MapGroup) {\n        for (const map of root[0].MapGroup) {\n            set.MapGroup.push(deArrayifyMapGroup(map));\n        }\n    }\n    return set;\n}\n\nfunction deArrayifyContainerItems(json: any[]): ContainerItem[] {\n    const items = [] as ContainerItem[];\n    const getter = buildPropertyGetter<ContainerItem & FlyoutItem & WidgetItem>();\n    if (json && json.length) {\n        for (const i of json) {\n            const func = getter(i, \"Function\", \"string\");\n            switch (func) {\n                case \"Separator\":\n                    items.push({\n                        Function: \"Separator\"\n                    });\n                    break;\n                case \"Widget\":\n                    items.push({\n                        Function: \"Widget\",\n                        Widget: getter(i, \"Widget\", \"string\")\n                    })\n                    break;\n                case \"Flyout\":\n                    items.push({\n                        Function: \"Flyout\",\n                        Label: getter(i, \"Label\", \"string\"),\n                        Tooltip: getter(i, \"Tooltip\", \"string\"),\n                        ImageUrl: getter(i, \"ImageUrl\", \"string\"),\n                        ImageClass: getter(i, \"ImageClass\", \"string\"),\n                        Item: deArrayifyContainerItems(i.Item || [])\n                    })\n                    break;\n            }\n        }\n    }\n    return items;\n}\n\nfunction deArrayifyContainer(json: any[]): ContainerDefinition[] {\n    const containers = [] as ContainerDefinition[];\n    const getter = buildPropertyGetter<ContainerDefinition>();\n    for (const c of json) {\n        containers.push({\n            Name: getter(c, \"Name\", \"string\"),\n            Type: getter(c, \"Type\", \"string\"),\n            //Position: getter(c, \"Position\", \"string\"),\n            Extension: deArrayifyExtension(c.Extension),\n            Item: deArrayifyContainerItems(c.Item)\n        });\n    }\n    return containers;\n}\n\nfunction deArrayifyWidgets(json: any[]): Widget[] {\n    const widgets = [] as Widget[];\n    for (const w of json) {\n        if (w[\"@xsi:type\"] == \"UiWidgetType\") {\n            const uiw = deArrayifyUiWidget(w);\n            widgets.push(uiw);\n        } else {\n            widgets.push(deArrayifyWidget(w));\n        }\n    }\n    return widgets;\n}\n\nfunction deArrayifyWidget(json: any): Widget {\n    const root = json;\n    if (root == null) {\n        throw new MgError(\"Malformed input. Expected Widget element\");\n    }\n    const getter = buildPropertyGetter<Widget & { \"@xsi:type\": string }>();\n    const w: Widget = {\n        WidgetType: getter(root, \"@xsi:type\", \"string\"),\n        Name: getter(root, \"Name\", \"string\"),\n        Type: getter(root, \"Type\", \"string\"),\n        //Location: getter(root, \"Location\", \"string\"),\n        Extension: deArrayifyExtension(root.Extension)\n    };\n    return w;\n}\n\nfunction deArrayifyExtension(json: any, arrayCheck: boolean = true): any {\n    const root = json;\n    if (root == null) {\n        return null;\n    }\n    if (arrayCheck && root.length != 1) {\n        throw new MgError(\"Malformed input. Expected Extension element\");\n    }\n    const getter = buildPropertyGetter<{ Key: string, Value: string, [key: string]: string}>();\n    const ext: any = {};\n    for (const key in root[0]) {\n        if (Array.isArray(root[0][key])) {\n            //Special case handling\n            switch (key) {\n                case \"AdditionalParameter\":\n                    {\n                        const params = [];\n                        for (const p of root[0][key]) {\n                            params.push({\n                                Key: getter(p, \"Key\", \"string\"),\n                                Value: getter(p, \"Value\", \"string\")\n                            });\n                        }\n                        ext[key] = params;\n                    }\n                    break;\n                case \"Projection\":\n                    {\n                        ext[key] = root[0][key];\n                    }\n                    break;\n                default:\n                    ext[key] = getter(root[0], key, \"string\");\n                    break;\n            }\n        } else {\n            ext[key] = deArrayifyExtension(root[0][key], false);\n        }\n    }\n    return ext;\n}\n\nfunction deArrayifyUiWidget(json: any): UIWidget {\n    const root = json;\n    if (root == null) {\n        throw new MgError(\"Malformed input. Expected Widget element\");\n    }\n    const getter = buildPropertyGetter<UIWidget & { \"@xsi:type\": string }>();\n    const w: UIWidget = {\n        WidgetType: getter(root, \"@xsi:type\", \"string\"),\n        ImageUrl: getter(root, \"ImageUrl\", \"string\"),\n        ImageClass: getter(root, \"ImageClass\", \"string\"),\n        Label: getter(root, \"Label\", \"string\"),\n        Tooltip: getter(root, \"Tooltip\", \"string\"),\n        StatusText: getter(root, \"StatusText\", \"string\"),\n        Disabled: getter(root, \"Disabled\", \"boolean\"),\n        Name: getter(root, \"Name\", \"string\"),\n        Type: getter(root, \"Type\", \"string\"),\n        //Location: getter(root, \"Location\", \"string\"),\n        Extension: deArrayifyExtension(root.Extension)\n    };\n    return w;\n}\n\nfunction deArrayifyMapWidget(json: any): MapWidget {\n    const root = json;\n    if (root == null || root.length != 1) {\n        throw new MgError(\"Malformed input. Expected MapWidget element\");\n    }\n    const getter = buildPropertyGetter<MapWidget & { \"@xsi:type\": string }>();\n    const mw: MapWidget = {\n        WidgetType: getter(root, \"@xsi:type\", \"string\"),\n        MapId: getter(root, \"MapId\", \"string\"),\n        Name: getter(root, \"Name\", \"string\"),\n        Type: getter(root, \"Type\", \"string\"),\n        //Location: getter(root, \"Location\", \"string\"),\n        Extension: deArrayifyExtension(root.Extension)\n    };\n    return mw;\n}\n\nfunction deArrayifyWidgetSet(json: any): WidgetSet[] {\n    const widgetSet = [] as WidgetSet[];\n    for (const ws of json) {\n        widgetSet.push({\n            Container: deArrayifyContainer(ws.Container),\n            MapWidget: deArrayifyMapWidget(ws.MapWidget),\n            Widget: deArrayifyWidgets(ws.Widget)\n        })\n    }\n    return widgetSet;\n}\n\nfunction deArrayifyFlexibleLayout(json: any): ApplicationDefinition {\n    const root = json;\n    const getter = buildPropertyGetter<ApplicationDefinition>();\n    const resp = {\n        Title: getter(root, \"Title\"),\n        TemplateUrl: getter(root, \"TemplateUrl\"),\n        MapSet: deArrayifyMapSet(root.MapSet),\n        WidgetSet: deArrayifyWidgetSet(root.WidgetSet),\n        Extension: deArrayifyExtension(root.Extension)\n    };\n    return resp;\n}\n\nfunction deArrayifyMapDefinitionGroups(json: any): MapDefinitionLayerGroup[] {\n    const groups = [] as MapDefinitionLayerGroup[];\n    const getter = buildPropertyGetter<MapDefinitionLayerGroup>();\n    for (const g of json) {\n        groups.push({\n            Name: getter(g, \"Name\"),\n            ExpandInLegend: getter(g, \"ExpandInLegend\", \"boolean\"),\n            ShowInLegend: getter(g, \"ShowInLegend\", \"boolean\"),\n            Visible: getter(g, \"Visible\", \"boolean\"),\n            LegendLabel: getter(g, \"LegendLabel\"),\n            Group: getter(g, \"Group\")\n        });\n    }\n    return groups;\n}\n\nfunction deArrayifyMapDefinitionLayers(json: any): MdfLayer[] {\n    const layers = [] as MdfLayer[];\n    const getter = buildPropertyGetter<MdfLayer>();\n    for (const g of json) {\n        layers.push({\n            Name: getter(g, \"Name\"),\n            ResourceId: getter(g, \"ResourceId\"),\n            ExpandInLegend: getter(g, \"ExpandInLegend\", \"boolean\"),\n            ShowInLegend: getter(g, \"ShowInLegend\", \"boolean\"),\n            Selectable: getter(g, \"Selectable\", \"boolean\"),\n            Visible: getter(g, \"Visible\", \"boolean\"),\n            LegendLabel: getter(g, \"LegendLabel\"),\n            Group: getter(g, \"Group\"),\n        });\n    }\n    return layers;\n}\n\nfunction deArrayifyMapDefinition(json: any): MapDefinition {\n    const root = json;\n    const getter = buildPropertyGetter<MapDefinition>();\n    const eGetter = buildPropertyGetter<MapDefinition[\"Extents\"]>();\n    const resp: MapDefinition = {\n        BackgroundColor: getter(root, \"BackgroundColor\"),\n        CoordinateSystem: getter(root, \"CoordinateSystem\"),\n        Extents: {\n            MinX: eGetter(root.Extents[0], \"MinX\", \"float\"),\n            MinY: eGetter(root.Extents[0], \"MinY\", \"float\"),\n            MaxX: eGetter(root.Extents[0], \"MaxX\", \"float\"),\n            MaxY: eGetter(root.Extents[0], \"MaxY\", \"float\")\n        },\n        MapLayer: deArrayifyMapDefinitionLayers(root.MapLayer ?? []),\n        MapLayerGroup: deArrayifyMapDefinitionGroups(root.MapLayerGroup ?? [])\n    };\n    if (root.TileSetSource) {\n        const tGetter = buildPropertyGetter<TileSetSource>();\n        resp.TileSetSource = {\n            ResourceId: tGetter(root.TileSetSource, \"ResourceId\")\n        };\n    }\n    return resp;\n}\n\nfunction deArrayifyTileSetDefinitionLayers(json: any): BaseMapLayer[] {\n    const getter = buildPropertyGetter<BaseMapLayer>();\n    const layers = [] as BaseMapLayer[];\n    for (const l of json) {\n        layers.push({\n            Name: getter(l, \"Name\"),\n            ResourceId: getter(l, \"ResourceId\"),\n            Selectable: getter(l, \"Selectable\", \"boolean\"),\n            ShowInLegend: getter(l, \"ShowInLegend\", \"boolean\"),\n            LegendLabel: getter(l, \"LegendLabel\"),\n            ExpandInLegend: getter(l, \"ExpandInLegend\", \"boolean\")\n        })\n    }\n    return layers;\n}\n\nfunction deArrayifyTileSetDefinitionGroups(json: any): BaseMapLayerGroup[] {\n    const getter = buildPropertyGetter<BaseMapLayerGroup>();\n    const groups = []  as BaseMapLayerGroup[];\n    for (const g of json) {\n        groups.push({\n            Name: getter(g, \"Name\"),\n            Visible: getter(g, \"Visible\", \"boolean\"),\n            ShowInLegend: getter(g, \"ShowInLegend\", \"boolean\"),\n            ExpandInLegend: getter(g, \"ExpandInLegend\", \"boolean\"),\n            LegendLabel: getter(g, \"LegendLabel\"),\n            BaseMapLayer: deArrayifyTileSetDefinitionLayers(g.BaseMapLayer)\n        });\n    }\n    return groups;\n}\n\nfunction deArrayifyTileSetDefinitionParamList(root: any): { Name: string, Value: string }[] {\n    const getter = buildPropertyGetter<{ Name: string, Value: string }>();\n    const params = [] as { Name: string, Value: string }[];\n    for (const p of root) {\n        params.push({\n            Name: getter(p, \"Name\"),\n            Value: getter(p, \"Value\")\n        });\n    }\n    return params;\n}\n\nfunction deArrayifyTileSetDefinitionParams(root: any): TileStoreParameters {\n    const getter = buildPropertyGetter<TileStoreParameters>();\n    const tsp: TileStoreParameters = {\n        TileProvider: getter(root, \"TileProvider\"),\n        Parameter: deArrayifyTileSetDefinitionParamList(root[0].Parameter)\n    };\n    return tsp;\n}\n\nfunction deArrayifyTileSetDefinition(json: any): TileSetDefinition {\n    const root = json;\n    const eGetter = buildPropertyGetter<TileSetDefinition[\"Extents\"]>();\n    const resp: TileSetDefinition = {\n        Extents: {\n            MinX: eGetter(root.Extents[0], \"MinX\", \"float\"),\n            MinY: eGetter(root.Extents[0], \"MinY\", \"float\"),\n            MaxX: eGetter(root.Extents[0], \"MaxX\", \"float\"),\n            MaxY: eGetter(root.Extents[0], \"MaxY\", \"float\")\n        },\n        TileStoreParameters: deArrayifyTileSetDefinitionParams(json.TileStoreParameters),\n        BaseMapLayerGroup: deArrayifyTileSetDefinitionGroups(json.BaseMapLayerGroup)\n    };\n    return resp;\n}\n\n/**\n * Indicates if the de-arrayified result is a {@link WebLayout}\n * \n * @since 0.14\n */\nexport function isWebLayout(arg: DeArrayifiedResult): arg is WebLayout {\n    return (arg as any).CommandSet != null\n        && (arg as any).ContextMenu != null\n        && (arg as any).Map != null\n}\n\n/**\n * Indicates if the de-arrayified result is an {@link ApplicationDefinition}\n * \n * @since 0.14\n */\nexport function isAppDef(arg: DeArrayifiedResult): arg is ApplicationDefinition {\n    return (arg as any).WidgetSet != null;\n}\n\n/**\n * Indicates if the de-arrayified result is a {@link MapDefinition}\n * \n * @since 0.14\n */\nexport function isMapDef(arg: DeArrayifiedResult): arg is MapDefinition {\n    return (arg as any).Extents != null\n        && (arg as any).BackgroundColor != null\n        && (arg as any).CoordinateSystem != null\n        && (arg as any).MapLayer != null\n        && (arg as any).MapLayerGroup != null;\n}\n\n/**\n * Indicates if the de-arrayified result is a {@link TileSetDefinition}\n * \n * @since 0.14\n */\nexport function isTileSet(arg: DeArrayifiedResult): arg is TileSetDefinition {\n    return (arg as any).Extents != null\n        && (arg as any).TileStoreParameters != null\n        && (arg as any).BaseMapLayerGroup != null;\n}\n\n/**\n * Indicates if the de-arrayified result is a {@link SiteVersionResponse}\n * \n * @since 0.14\n */\nexport function isSiteVersion(arg: DeArrayifiedResult): arg is SiteVersionResponse {\n    return (arg as any).Version != null;\n}\n\n/**\n * Indicates if the de-arrayified result is a {@link QueryMapFeaturesResponse}\n * \n * @since 0.14\n */\nexport function isQueryMapFeaturesResponse(arg: DeArrayifiedResult): arg is QueryMapFeaturesResponse {\n    return (arg as any).FeatureSet != null\n        || (arg as any).Hyperlink != null\n        || (arg as any).InlineSelectionImage != null\n        || (arg as any).SelectedFeatures != null\n        || (arg as any).Tooltip != null;\n}\n\n/**\n * The result of the normalization of JSON from the mapagent\n * \n * @since 0.14\n */\nexport type DeArrayifiedResult = RuntimeMap | QueryMapFeaturesResponse | WebLayout | ApplicationDefinition | MapDefinition | TileSetDefinition | SiteVersionResponse;\n\n/**\n * Normalizes the given JSON object to match the content model of its original XML form\n *\n * @export\n * @param {*} json The JSON object to normalize\n * @returns {*} The normalized JSON object\n */\nexport function deArrayify(json: any): DeArrayifiedResult {\n    if (json[\"RuntimeMap\"]) {\n        return deArrayifyRuntimeMap(json.RuntimeMap);\n    }\n    if (json[\"FeatureInformation\"]) {\n        return deArrayifyFeatureInformation(json.FeatureInformation);\n    }\n    if (json[\"WebLayout\"]) {\n        return deArrayifyWebLayout(json.WebLayout);\n    }\n    if (json[\"ApplicationDefinition\"]) {\n        return deArrayifyFlexibleLayout(json.ApplicationDefinition);\n    }\n    if (json[\"MapDefinition\"]) {\n        return deArrayifyMapDefinition(json.MapDefinition);\n    }\n    if (json[\"TileSetDefinition\"]) {\n        return deArrayifyTileSetDefinition(json.TileSetDefinition);\n    }\n    if (json[\"SiteVersion\"]) {\n        return {\n            Version: json.SiteVersion.Version[0]\n        } as SiteVersionResponse;\n    }\n    const keys = [] as string[];\n    for (const k in json) {\n        keys.push(k);\n    }\n    throw new MgError(`Unsure how to process JSON response. Root elements are: (${keys.join(\", \")})`);\n}\n\n/**\n * Builds an XML selection string from the given selection set.\n *\n * @export\n * @param {(FeatureSet | undefined)} selection The selection set\n * @param {string[]} [layerIds] If specified, the selection XML will only include selections from the specified layers\n * @returns {string} The selection XML string\n */\nexport function buildSelectionXml(selection: FeatureSet | undefined, layerIds?: string[]): string {\n    let xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?>';\n    xml += '<FeatureSet xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"FeatureSet-1.0.0.xsd\">';\n    if (selection) {\n        const selLayers = selection.Layer;\n        for (const layer of selLayers) {\n            const layerId = layer[\"@id\"];\n            if (layerIds != null && layerIds.indexOf(layerId) < 0) {\n                continue;\n            }\n            xml += `<Layer id=\"${layerId}\">`;\n            const cls = layer.Class;\n            xml += `<Class id=\"${cls[\"@id\"]}\">`;\n            for (const id of cls.ID) {\n                xml += `<ID>${id}</ID>`;\n            }\n            xml += '</Class>';\n            xml += '</Layer>';\n        }\n    }\n    xml += '</FeatureSet>';\n    return xml;\n}\n\n/**\n * Can only be used for a v4.0.0 or higher QUERYMAPFEATURES request\n * \n * @param selection Current selection set\n * @param feat The active selected feature\n */\nexport function getActiveSelectedFeatureXml(selection: FeatureSet, feat: ActiveSelectedFeature): string | undefined {\n    for (const layer of selection.Layer) {\n        const layerId = layer[\"@id\"];\n        if (layerId == feat.layerId) {\n            const key = feat.selectionKey;\n            let xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?>';\n            xml += '<FeatureSet xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"FeatureSet-1.0.0.xsd\">';\n            xml += `<Layer id=\"${layerId}\">`;\n            xml += `<Class id=\"${layer.Class[\"@id\"]}\">`;\n            xml += `<ID>${key}</ID>`;\n            xml += '</Class>';\n            xml += '</Layer>';\n            xml += '</FeatureSet>';\n            return xml;\n        }\n    }\n}","import { RequestBuilder } from '../request-builder';\nimport { MgError } from '../error';\nimport { ClientKind } from '../common';\nimport { MapAgentRequestBuilder } from './mapagent';\n\n/**\n * A factory method for creating request builders\n * \n * @since 0.13\n */\nexport type RequestBuilderFactory = (agentUri: string, locale?: string) => RequestBuilder;\n\nconst _builders: { [kind: string]: RequestBuilderFactory } = {};\n\n/**\n * Registers a factory for creating request builders for the given kind. This only needs to be called in the entry point of your custom viewer bundle.\n * \n * @param kind \n * @param factory \n * @since 0.13\n */\nexport function registerRequestBuilder(kind: ClientKind, factory: RequestBuilderFactory): void {\n    _builders[kind] = factory;\n}\n\n/**\n * Creates the request builder for the given kind\n * \n * @param agentUri \n * @param kind \n * @since 0.13\n */\nexport function createRequestBuilder(agentUri: string, kind: ClientKind): RequestBuilder {\n    if (_builders[kind]) {\n        return _builders[kind](agentUri);\n    }\n    throw new MgError(`Unknown or unsupported client kind: ${kind}`);\n}","import { MgError } from '../error';\nimport { deArrayify } from './deArrayify';\nimport { DEFAULT_LOCALE } from \"../i18n\";\nimport { RequestBuilder, ICreateRuntimeMapOptions, IQueryMapFeaturesOptions, IDescribeRuntimeMapOptions } from '../request-builder';\nimport { RuntimeMap } from '../contracts/runtime-map';\nimport { QueryMapFeaturesResponse } from '../contracts/query';\nimport { ResourceIdentifier, ResourceBase, SiteVersionResponse } from '../contracts/common';\n\nconst MG_MAPAGENT_ERROR_CODE = 559;\n\n/**\n * Indicates if the given response is an error response\n *\n * @export\n * @param {Response} response\n * @returns {boolean}\n */\nexport function isErrorResponse(response: Response): boolean {\n    return !response.ok || response.status === MG_MAPAGENT_ERROR_CODE;\n}\n\n/**\n * Encodes the given object for a POST submission\n *\n * @export\n * @param {*} data\n * @returns {string}\n */\nexport function serialize(data: any, uppercase: boolean = true): string {\n    return Object.keys(data).map((keyName) => {\n        return encodeURIComponent(uppercase ? keyName.toUpperCase() : keyName) + '=' + encodeURIComponent(data[keyName])\n    }).join('&');\n}\n\n/**\n * The mapagent client\n *\n * @export\n * @class MapAgentRequestBuilder\n * @extends {RequestBuilder}\n */\nexport class MapAgentRequestBuilder extends RequestBuilder {\n    private locale: string;\n    constructor(agentUri: string, locale: string = DEFAULT_LOCALE) {\n        super(agentUri);\n        this.locale = locale;\n    }\n\n    public async get<T>(url: string): Promise<T> {\n        const response = await fetch(url, {\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            } as any,\n            method: \"GET\"\n        });\n        if (isErrorResponse(response)) {\n            throw new MgError(response.statusText);\n        } else {\n            const json = await response.json();\n            return deArrayify(json) as T;\n        }\n    }\n\n    public async post<T>(url: string, data: any): Promise<T> {\n        if (!data.format) {\n            data.format = \"application/json\";\n        }\n        //const form = new FormData();\n        //for (const key in data) {\n        //    form.append(key.toUpperCase(), data[key]);\n        //}\n        const response = await fetch(url, {\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n            } as any,\n            method: \"POST\",\n            body: serialize(data) //form\n        });\n        if (isErrorResponse(response)) {\n            throw new MgError(response.statusText);\n        } else {\n            const json = await response.json();\n            return deArrayify(json) as T;\n        }\n    }\n\n    private stringifyGetUrl(options: any): string {\n        if (!options.version) {\n            options.version = \"1.0.0\";\n        }\n        if (!options.locale) {\n            options.locale = this.locale;\n        }\n        if (!options.format) {\n            options.format = \"application/json\";\n        }\n        let url = this.agentUri;\n        let bFirst = true;\n        for (const key in options) {\n            if (bFirst) {\n                url += `?${key.toUpperCase()}=${options[key]}`;\n                bFirst = false;\n            } else {\n                url += `&${key.toUpperCase()}=${options[key]}`;\n            }\n        }\n        return url;\n    }\n\n    public async createSession(username: string, password: string): Promise<string> {\n        const url = this.agentUri;\n        const data = { operation: \"CREATESESSION\", version: \"1.0.0\", USERNAME: username, PASSWORD: password };\n        const response = await fetch(url, {\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n            } as any,\n            method: \"POST\",\n            body: serialize(data) //form\n        });\n        if (isErrorResponse(response)) {\n            throw new MgError(response.statusText);\n        } else {\n            return await response.text();\n        }\n    }\n\n    public async getServerSessionTimeout(session: string): Promise<number> {\n        const url = this.agentUri;\n        const data = { operation: \"GETSESSIONTIMEOUT\", version: \"1.0.0\", SESSION: session };\n        const response = await fetch(url, {\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n            } as any,\n            method: \"POST\",\n            body: serialize(data) //form\n        });\n        if (isErrorResponse(response)) {\n            throw new MgError(response.statusText);\n        } else {\n            const val = await response.text();\n            return parseInt(val, 10);\n        }\n    }\n\n    public getResource<T extends ResourceBase>(resourceId: ResourceIdentifier, args?: any): Promise<T> {\n        if (args != null) {\n            const p1 = { operation: \"GETRESOURCECONTENT\", resourceId: resourceId };\n            const url = this.stringifyGetUrl({ ...args, ...p1 });\n            return this.get<T>(url);\n        } else {\n            const url = this.stringifyGetUrl({ operation: \"GETRESOURCE\", resourceId: resourceId });\n            return this.get<T>(url);\n        }\n    }\n\n    public getSiteVersion(): Promise<SiteVersionResponse> {\n        const p1 = { operation: \"GETSITEVERSION\", version: \"1.0.0\", username: \"Anonymous\" };\n        const url = this.stringifyGetUrl({ ...p1 });\n        return this.get<SiteVersionResponse>(url);\n    }\n\n    public createRuntimeMap(options: ICreateRuntimeMapOptions): Promise<RuntimeMap> {\n        const p1 = { operation: \"CREATERUNTIMEMAP\", version: \"3.0.0\" };\n        const url = this.stringifyGetUrl({ ...options, ...p1 });\n        return this.get<RuntimeMap>(url);\n    }\n\n    public queryMapFeatures(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse> {\n        const p1 = { operation: \"QUERYMAPFEATURES\", version: \"2.6.0\" };\n        return this.post<QueryMapFeaturesResponse>(this.agentUri, { ...options, ...p1 });\n    }\n\n    public queryMapFeatures_v4(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse> {\n        const p1 = { operation: \"QUERYMAPFEATURES\", version: \"4.0.0\" };\n        return this.post<QueryMapFeaturesResponse>(this.agentUri, { ...options, ...p1 });\n    }\n\n    public describeRuntimeMap(options: IDescribeRuntimeMapOptions): Promise<RuntimeMap> {\n        const p1 = { operation: \"DESCRIBERUNTIMEMAP\", version: \"3.0.0\" };\n        const url = this.stringifyGetUrl({ ...options, ...p1 });\n        return this.get<RuntimeMap>(url);\n    }\n\n    public getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string {\n        const urlTemplate = `${this.agentUri}?OPERATION=GETTILEIMAGE&VERSION=1.2.0&USERNAME=Anonymous&MAPDEFINITION=${resourceId}&BASEMAPLAYERGROUPNAME=${groupName}&TILECOL=${xPlaceholder}&TILEROW=${yPlaceholder}&SCALEINDEX=${zPlaceholder}`;\n        return urlTemplate;\n    }\n}","import { MgError } from './error';\nimport { MapAgentRequestBuilder, isErrorResponse, serialize } from './builders/mapagent';\nimport { ClientKind } from './common';\nimport { createRequestBuilder } from './builders/factory';\nimport { ResourceBase, ResourceIdentifier, SiteVersionResponse } from './contracts/common';\nimport { ICreateRuntimeMapOptions, IMapGuideClient, RequestBuilder, IDescribeRuntimeMapOptions, IQueryMapFeaturesOptions } from './request-builder';\nimport { RuntimeMap } from './contracts/runtime-map';\nimport { QueryMapFeaturesResponse } from './contracts/query';\n\n/**\n * The MapGuide HTTP client\n *\n * @export\n * @class Client\n * @implements {IMapGuideClient}\n */\nexport class Client implements IMapGuideClient {\n    private builder: RequestBuilder;\n    constructor(agentUri: string, kind: ClientKind) {\n        this.builder = createRequestBuilder(agentUri, kind);\n    }\n    public async getText(url: string): Promise<string> {\n        const r = await fetch(url);\n        if (!r.ok)\n            throw new MgError(r.statusText);\n        const text = await r.text();\n        return text;\n    }\n\n    /**\n     * Performs a generic GET request at the specified URL\n     *\n     * @template T The type of the object you are expecting to receive\n     * @param {string} url The url to make the request to\n     * @returns {Promise<T>} A promise for the value of the requested type\n     *\n     * @memberOf Client\n     */\n    public get<T>(url: string): Promise<T> {\n        return new Promise<T>((resolve, reject) => {\n            fetch(url, {\n                headers: {\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json'\n                } as any,\n                method: \"GET\"\n            })\n            .then(response => {\n                if (isErrorResponse(response)) {\n                    throw new MgError(response.statusText);\n                } else {\n                    resolve(response.json());\n                }\n            })\n            .catch(reject);\n        });\n    }\n\n    /**\n     * Performs a generic POST request at the specified URL\n     *\n     * @template T The type of the object you are expecting to receive\n     * @param {string} url The url to make the request to\n     * @param {*} data The POST form data\n     * @returns {Promise<T>} A promise for the value of the requested type\n     *\n     * @memberOf Client\n     */\n    public post<T>(url: string, data: any): Promise<T> {\n        if (!data.format) {\n            data.format = \"application/json\";\n        }\n        //const form = new FormData();\n        //for (const key in data) {\n        //    form.append(key.toUpperCase(), data[key]);\n        //}\n        return new Promise<T>((resolve, reject) => {\n            fetch(url, {\n                headers: {\n                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n                } as any,\n                method: \"POST\",\n                body: serialize(data) //form\n            })\n            .then(response => {\n                if (isErrorResponse(response)) {\n                    throw new MgError(response.statusText);\n                } else {\n                    resolve(response.json());\n                }\n            })\n            .catch(reject);\n        });\n    }\n\n    /**\n     * Creates a new MapGuide session\n     *\n     * @param {string} username\n     * @param {string} password\n     * @returns {Promise<string>}\n     *\n     * @memberOf Client\n     */\n    public createSession(username: string, password: string): Promise<string> {\n        return this.builder.createSession(username, password);\n    }\n\n    /**\n     * Gets the server session timeout for the given session id\n     *\n     * @param {string} session\n     * @returns {Promise<number>}\n     *\n     * @memberOf Client\n     */\n    public getServerSessionTimeout(session: string): Promise<number> {\n        return this.builder.getServerSessionTimeout(session);\n    }\n\n    /**\n     * gets the MapGuide Server version\n     * \n     * @since 0.14\n     */\n    public getSiteVersion(): Promise<SiteVersionResponse> {\n        return this.builder.getSiteVersion();\n    }\n\n    /**\n     * Retrieves the requested resource\n     *\n     * @template T\n     * @param {ResourceIdentifier} resourceId\n     * @param {*} [args]\n     * @returns {Promise<T>}\n     *\n     * @memberOf Client\n     */\n    public getResource<T extends ResourceBase>(resourceId: ResourceIdentifier, args?: any): Promise<T> {\n        return this.builder.getResource<T>(resourceId, args);\n    }\n\n    /**\n     * Creates a runtime map from the specified map definition\n     *\n     * @param {ICreateRuntimeMapOptions} options\n     * @returns {Promise<RuntimeMap>}\n     *\n     * @memberOf Client\n     */\n    public createRuntimeMap(options: ICreateRuntimeMapOptions): Promise<RuntimeMap> {\n        return this.builder.createRuntimeMap(options);\n    }\n\n    /**\n     * Describes a runtime map\n     *\n     * @param {IDescribeRuntimeMapOptions} options\n     * @returns {Promise<RuntimeMap>}\n     *\n     * @memberOf Client\n     */\n    public describeRuntimeMap(options: IDescribeRuntimeMapOptions): Promise<RuntimeMap> {\n        return this.builder.describeRuntimeMap(options);\n    }\n\n    /**\n     * Performs a map selection query on the current map\n     *\n     * @param {IQueryMapFeaturesOptions} options\n     * @returns {Promise<QueryMapFeaturesResponse>}\n     *\n     * @memberOf Client\n     */\n    public queryMapFeatures(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse> {\n        return this.builder.queryMapFeatures(options);\n    }\n\n    /**\n     * Performs a map selection query on the current map. Only applicable for use in MapGuide Open Source\n     * 4.0 and higher\n     *\n     * @param {IQueryMapFeaturesOptions} options\n     * @returns {Promise<QueryMapFeaturesResponse>}\n     *\n     * @memberOf Client\n     */\n    public queryMapFeatures_v4(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse> {\n        return this.builder.queryMapFeatures_v4(options);\n    }\n\n    /**\n     * Gets the tile template URL used by the viewer to send tile requests\n     *\n     * @param {string} resourceId\n     * @param {string} groupName\n     * @param {string} xPlaceholder\n     * @param {string} yPlaceholder\n     * @param {string} zPlaceholder\n     * @returns {string}\n     *\n     * @memberOf Client\n     */\n    public getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string {\n        return this.builder.getTileTemplateUrl(resourceId, groupName, xPlaceholder, yPlaceholder, zPlaceholder);\n    }\n}","import { ResultColumnSet } from \"./contracts/weblayout\";\nimport { RuntimeMap } from \"./contracts/runtime-map\";\nimport { FeatureSet, LayerMetadata, QueryMapFeaturesResponse, SelectedFeature } from \"./contracts/query\";\nimport { IQueryMapFeaturesOptions } from './request-builder';\n\nimport olPoint from \"ol/geom/Point\";\nimport olLineString from \"ol/geom/LineString\";\nimport olCircle from \"ol/geom/Circle\";\nimport olPolygon from \"ol/geom/Polygon\";\nimport olGeometry from \"ol/geom/Geometry\";\n\nimport olLayerBase from \"ol/layer/Base\";\nimport olInteraction from \"ol/interaction/Interaction\";\nimport olOverlay from \"ol/Overlay\";\n\nimport { IOLFactory } from \"./ol-factory\";\nimport { ViewerAction, IGenericSubjectMapLayer, IInitialExternalLayer, ISelectedFeaturePopupTemplateConfiguration } from '../actions/defs';\nimport { ProjectionLike } from 'ol/proj';\nimport { IParsedFeatures } from './layer-manager/parsed-features';\nimport Collection from 'ol/Collection';\nimport Feature from 'ol/Feature';\nimport { ISubscriberProps } from '../containers/subscriber';\nimport Geometry from 'ol/geom/Geometry';\nimport { IBasicPointCircleStyle, IPointIconStyle, IBasicVectorLineStyle, IBasicVectorPolygonStyle, IVectorLayerStyle, IClusterSettings, ClusterClickAction, IHeatmapSettings } from './ol-style-contracts';\nimport { IToolbarAppState } from './registry/command';\nimport { ClientSelectionSet } from \"./contracts/common\";\n\n// Event boilerplate\nexport type GenericEvent = any;\n\nexport type GenericEventHandler = (e: GenericEvent) => void;\n\n/**\n * Defines a size\n */\nexport type Size = { w: number, h: number };\n\n/**\n * The default blank size\n */\nexport const BLANK_SIZE: Size = { w: 1, h: 1 } as const;\n\n/**\n * @deprecated Use UnitOfMeasure enum instead\n */\nexport type UnitName = 'Unknown' | 'Inches' | 'Feet' | 'Yards' | 'Miles' | 'Nautical Miles'\n    | 'Millimeters' | 'Centimeters' | 'Meters' | 'Kilometers'\n    | 'Degrees' | 'Decimal Degrees' | 'Degrees Minutes Seconds' | 'Pixels';\nexport enum UnitOfMeasure {\n    /**\n     * An unknown unit\n     */\n    Unknown = 0,\n    /**\n     * Inch unit\n     */\n    Inches = 1,\n    /**\n     * Feet unit\n     */\n    Feet = 2,\n    /**\n     * Yard unit\n     */\n    Yards = 3,\n    /**\n     * Mile unit\n     */\n    Miles = 4,\n    /**\n     * Nautical Mile unit\n     */\n    NauticalMiles = 5,\n    /**\n     * Millimeter unit\n     */\n    Millimeters = 6,\n    /**\n     * Centimeter unit\n     */\n    Centimeters = 7,\n    /**\n     * Meter unit\n     */\n    Meters = 8,\n    /**\n     * Kilometer unit\n     */\n    Kilometers = 9,\n    /**\n     * Degree unit\n     */\n    Degrees = 10,\n    /**\n     * Decimal Degree unit\n     */\n    DecimalDegrees = 11,\n    /**\n     * DMS unit\n     */\n    DMS = 12,\n    /**\n     * Pixel unit\n     */\n    Pixels = 13,\n}\n\nexport interface UnitInfo {\n    unitsPerMeter: number;\n    metersPerUnit: number;\n    name: UnitName;\n    /**\n     * @since 0.12.2\n     */\n    localizedName: (locale?: string) => string;\n    abbreviation: (locale?: string) => string;\n}\n\n/**\n * Describes a map view\n * @export\n * @interface IMapView\n */\nexport interface IMapView {\n    /**\n     * The x coordinate\n     *\n     * @type {number}\n     * @memberof IMapView\n     */\n    x: number;\n    /**\n     * The Y coordinate\n     *\n     * @type {number}\n     * @memberof IMapView\n     */\n    y: number;\n    /**\n     * The scale\n     *\n     * @type {number}\n     * @memberof IMapView\n     */\n    scale: number;\n    /**\n     * The view resolution\n     * \n     * @type {number | undefined}\n     * @memberof IMapView\n     */\n    resolution?: number;\n}\n\n/**\n * Describes a function that is called when a command is invoked\n */\nexport type DispatcherFunc = (dispatch: ReduxDispatch, getState: () => Readonly<IApplicationState>, viewer?: IMapViewer, parameters?: any) => any;\n\n/**\n * Describes a viewer command\n *\n * @export\n * @interface ICommand\n */\nexport interface ICommand {\n    /**\n     * The icon for this command\n     *\n     * @type {string}\n     * @memberof ICommand\n     */\n    icon?: string;\n    iconClass?: string;\n    //tooltip?: string;\n    /**\n     * @since 0.12.8\n     */\n    title?: string;\n    /**\n     * Indicates if this command is enabled based on the given application state\n     *\n     *\n     * @memberof ICommand\n     */\n    enabled: (state: Readonly<IToolbarAppState>, parameters?: any) => boolean;\n    /**\n     * Indicates if this command is enabled based on the given application state\n     *\n     *\n     * @memberof ICommand\n     */\n    selected: (state: Readonly<IToolbarAppState>) => boolean;\n    /**\n     * Invokes the command\n     *\n     * @type {DispatcherFunc}\n     * @memberof ICommand\n     */\n    invoke: DispatcherFunc;\n}\n\n/**\n * Valid command targets for an InvokeURL command\n */\nexport type CommandTarget = \"TaskPane\" | \"NewWindow\" | \"SpecifiedFrame\";\n\n/**\n * An InvokeURL command parameter\n *\n * @export\n * @interface IInvokeUrlCommandParameter\n */\nexport interface IInvokeUrlCommandParameter {\n    /**\n     * The name of the parameter\n     *\n     * @type {string}\n     * @memberof IInvokeUrlCommandParameter\n     */\n    name: string;\n    /**\n     * The value of the parameter\n     *\n     * @type {string}\n     * @memberof IInvokeUrlCommandParameter\n     */\n    value: string;\n}\n\n/**\n * Describes a command that will run in a pre-defined target frame or window\n *\n * @export\n * @interface ITargetedCommand\n */\nexport interface ITargetedCommand {\n    /**\n     * Specifies the target which the URL should be invoked in\n     *\n     * @type {CommandTarget}\n     * @memberof IInvokeUrlCommand\n     */\n    target: CommandTarget;\n    /**\n     * The name of the frame to run this command in. Only applies if the target is\n     * \"SpecifiedFrame\"\n     */\n    targetFrame?: string;\n}\n\n/**\n * Describes a command that invokes a URL into a specified target\n *\n * @export\n * @interface IInvokeUrlCommand\n */\nexport interface IInvokeUrlCommand extends ITargetedCommand {\n    /**\n     * The icon for this command\n     *\n     * @type {string}\n     * @memberof IInvokeUrlCommand\n     */\n    icon?: string;\n    iconClass?: string;\n    /**\n     * @since 0.12.8\n     */\n    title?: string;\n    /**\n     * The URL to invoke\n     *\n     * @type {string}\n     * @memberof IInvokeUrlCommand\n     */\n    url: string;\n    /**\n     * Indicates whether to disable this command if there is no map selection\n     *\n     * @type {boolean}\n     * @memberof IInvokeUrlCommand\n     */\n    disableIfSelectionEmpty?: boolean;\n    /**\n     * Additional command parameters\n     * @memberof IInvokeUrlCommand\n     */\n    parameters: IInvokeUrlCommandParameter[];\n}\n\n/**\n * Describes a search command\n *\n * @export\n * @interface ISearchCommand\n */\nexport interface ISearchCommand extends ITargetedCommand {\n    /**\n     * The icon for this command\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    icon?: string;\n    iconClass?: string;\n    /**\n     * The name of the map layer this commmand applies to\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    layer: string;\n    /**\n     * The prompt to display in the search command UI\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    prompt: string;\n    /**\n     * The title to display in the search command UI\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    title: string;\n    /**\n     * The set of feature properties to show in the search results\n     *\n     * @type {ResultColumnSet}\n     * @memberof ISearchCommand\n     */\n    resultColumns: ResultColumnSet;\n    /**\n     * The search filter to apply based on user input\n     *\n     * @type {string}\n     * @memberof ISearchCommand\n     */\n    filter?: string;\n    /**\n     * The maximum number of results to return\n     *\n     * @type {number}\n     * @memberof ISearchCommand\n     */\n    matchLimit: number;\n}\n\n/**\n * Type alias for a dictionary-like structure\n */\nexport type Dictionary<T> = { [key: string]: T };\n\n/**\n * A 2d coordinate (renamed to Coordinate2D from Coordinate in 0.13)\n */\nexport type Coordinate2D = [number, number];\n\n/**\n * A size quantity\n * @since 0.13\n */\nexport type Size2 = [number, number];\n\n/**\n * A bounding box array\n */\nexport type Bounds = [number, number, number, number];\n\n/**\n * An active map viewer tool\n *\n * @export\n * @enum {number}\n */\nexport enum ActiveMapTool {\n    /**\n     * Zoom tool\n     */\n    Zoom,\n    /**\n     * Selection tool\n     */\n    Select,\n    /**\n     * Pan tool\n     */\n    Pan,\n    /**\n     * None\n     */\n    None\n}\n\n/**\n * Describes an external base layer\n *\n * @export\n * @interface IExternalBaseLayer\n */\nexport interface IExternalBaseLayer {\n    /**\n     * The name of the external base layer\n     *\n     * @type {string}\n     * @memberof IExternalBaseLayer\n     */\n    name: string;\n    /**\n     * The kind of external base layer\n     *\n     * @type {string}\n     * @memberof IExternalBaseLayer\n     */\n    kind: string;\n    /**\n     * Indicates if this external base layer is visible\n     *\n     * @type {boolean}\n     * @memberof IExternalBaseLayer\n     */\n    visible?: boolean;\n    /**\n     * Additional options for initializing the external base layer\n     *\n     * @type {*}\n     * @memberof IExternalBaseLayer\n     */\n    options?: any;\n}\n\n\n/**\n * Describes a menu entry on the Map Menu component\n *\n * @export\n * @interface IMapMenuEntry\n */\nexport interface IMapMenuEntry {\n    /**\n     * The runtime map name\n     *\n     * @type {string}\n     * @memberof IMapMenuEntry\n     */\n    mapName: string;\n    /**\n     * The menu entry label\n     *\n     * @type {string}\n     * @memberof IMapMenuEntry\n     */\n    label: string;\n}\n\n/**\n * A bit mask indicating how a map viewer should refresh\n *\n * @export\n * @enum {number}\n */\nexport enum RefreshMode {\n    /**\n     * Refresh only the layers\n     */\n    LayersOnly = 1,\n    /**\n     * Refresh only the selection\n     */\n    SelectionOnly = 2\n}\n\n/**\n * The spatial operator to use for selection operations\n */\nexport type SelectionVariant = \"INTERSECTS\" | \"TOUCHES\" | \"WITHIN\" | \"ENVELOPEINTERSECTS\";\n\n/**\n * MapGuide-specific viewer functionality\n *\n * @export\n * @interface IMapGuideViewerSupport\n * @since 0.14\n */\nexport interface IMapGuideViewerSupport {\n    /**\n     * Sets the selection XML\n     *\n     * @param {string} xml\n     * @param {IQueryMapFeaturesOptions} [queryOpts]\n     * @param {(res: QueryMapFeaturesResponse) => void} [success]\n     * @param {(err: Error) => void} [failure]\n     *\n     * @memberof IMapViewer\n     */\n    setSelectionXml(xml: string, queryOpts?: Partial<IQueryMapFeaturesOptions>, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void): void;\n    /**\n     * Clears the map selection\n     *\n     *\n     * @memberof IMapViewer\n     */\n    clearSelection(): void;\n    /**\n     * Performs a map selection by the given geometry\n     *\n     * @param {olGeometry} geom The geometry to select with\n     * @param {SelectionVariant} selectionMethod The selection method\n     * @memberof IMapViewer\n     */\n    selectByGeometry(geom: olGeometry, selectionMethod?: SelectionVariant): void;\n    /**\n     * Performs a map selection by the given query options\n     *\n     * @param {IQueryMapFeaturesOptions} options\n     * @param {(res: QueryMapFeaturesResponse) => void} [success]\n     * @param {(err: Error) => void} [failure]\n     *\n     * @memberof IMapViewer\n     */\n    queryMapFeatures(options: IQueryMapFeaturesOptions, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void): void;\n    /**\n     * Gets the current selection model\n     *\n     * @returns {QueryMapFeaturesResponse}\n     *\n     * @memberof IMapViewer\n     */\n    getSelection(): QueryMapFeaturesResponse | null;\n    /**\n     * Gets the current selection model as a selection XML string\n     *\n     * @param {FeatureSet} selection\n     * @param {string[]} [layerIds]\n     * @returns {string}\n     *\n     * @memberof IMapViewer\n     */\n    getSelectionXml(selection: FeatureSet, layerIds?: string[]): string;\n    /**\n     * Gets the current session id\n     * \n     * @returns {string}\n     * @memberof IMapViewer\n     */\n    getSessionId(): string;\n    /**\n     * Gets whether feature tooltips are enabled\n     *\n     * @returns {boolean}\n     *\n     * @memberof IMapViewer\n     */\n    isFeatureTooltipEnabled(): boolean;\n    /**\n     * Enables/disables feature tooltips\n     *\n     * @param {boolean} enabled\n     *\n     * @memberof IMapViewer\n     */\n    setFeatureTooltipEnabled(enabled: boolean): void;\n}\n\n/**\n * Map image export options\n *\n * @export\n * @interface IMapImageExportOptions\n * @since 0.14\n */\nexport interface IMapImageExportOptions {\n    /**\n     * The size of the image to export. If not specified, it will use the map's current size\n     *\n     * @type {Size2}\n     * @memberof IMapImageExportOptions\n     */\n    size?: Size2;\n    /**\n     * The type to export the mime type as. If not specified, it will default to PNG (image/png)\n     *\n     * @type {string}\n     * @memberof IMapImageExportOptions\n     */\n    exportMimeType?: string;\n    /**\n     * The callback that will receive the content of the exported map image\n     *\n     * @memberof IMapImageExportOptions\n     */\n    callback: (imageBase64: string) => void;\n}\n\n/**\n * Describes the API for interacting with the map viewer\n *\n * @export\n * @interface IMapViewer\n */\nexport interface IMapViewer {\n    /**\n     * Gets MapGuide-specific viewer functionality. If this viewer was not set up with MapGuide support, this is undefined\n     *\n     * @returns {(IMapGuideViewerSupport | undefined)}\n     * @memberof IMapViewer\n     * @since 0.14\n     */\n    mapguideSupport(): IMapGuideViewerSupport | undefined;\n    /**\n     * Gets the projection of the map\n     *\n     * @returns {ol.ProjectionLike}\n     *\n     * @memberof IMapViewer\n     */\n    getProjection(): ProjectionLike;\n    /**\n     * Gets the view for the given extent\n     *\n     * @param {Bounds} extent\n     * @returns {IMapView}\n     *\n     * @memberof IMapViewer\n     * @since 0.14 If given an extent with zero-width or zero-height, the view will be computed off of an \"inflated\" version of this extent. If inflation is required, it will be inflated by 30 meters\n     */\n    getViewForExtent(extent: Bounds): IMapView;\n    /**\n     * Gets the current extent\n     *\n     * @returns {Bounds}\n     *\n     * @memberof IMapViewer\n     */\n    getCurrentExtent(): Bounds;\n    /**\n     * Gets the current map view\n     *\n     * @returns {IMapView}\n     *\n     * @memberof IMapViewer\n     */\n    getCurrentView(): IMapView;\n    /**\n     * Gets the current physical size of the map\n     *\n     * @returns {[number, number]}\n     *\n     * @memberof IMapViewer\n     */\n    getSize(): [number, number];\n    /**\n     * Zooms to the specified map view\n     *\n     * @param {number} x\n     * @param {number} y\n     * @param {number} scale\n     *\n     * @memberof IMapViewer\n     */\n    zoomToView(x: number, y: number, scale: number): void;\n    /**\n     * Refreshes the map\n     *\n     * @param {RefreshMode} [mode]\n     *\n     * @memberof IMapViewer\n     */\n    refreshMap(mode?: RefreshMode): void;\n    /**\n     * Gets the meters per unit value\n     *\n     * @returns {number}\n     *\n     * @memberof IMapViewer\n     */\n    getMetersPerUnit(): number;\n    /**\n     * Sets the active tool\n     *\n     * @param {ActiveMapTool} tool\n     *\n     * @memberof IMapViewer\n     */\n    setActiveTool(tool: ActiveMapTool): void;\n    /**\n     * Gets the active tool\n     *\n     * @returns {ActiveMapTool}\n     *\n     * @memberof IMapViewer\n     */\n    getActiveTool(): ActiveMapTool;\n    /**\n     * Sets the initial map view\n     *\n     *\n     * @memberof IMapViewer\n     */\n    initialView(): void;\n    /**\n     * Zooms in or out by the specified delta\n     *\n     * @param {number} delta\n     *\n     * @memberof IMapViewer\n     */\n    zoomDelta(delta: number): void;\n    /**\n     * Gets whether the viewer is currently in the state of digitizing\n     *\n     * @returns {boolean}\n     *\n     * @memberof IMapViewer\n     */\n    isDigitizing(): boolean;\n    /**\n     * Cancels active digitization\n     *\n     * @memberof IMapViewer\n     */\n    cancelDigitization(): void;\n    /**\n     * Starts the digitization process for a point\n     *\n     * @param {DigitizerCallback<olPoint>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizePoint(handler: DigitizerCallback<olPoint>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a line\n     *\n     * @param {DigitizerCallback<olLineString>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizeLine(handler: DigitizerCallback<olLineString>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a line string\n     *\n     * @param {DigitizerCallback<olLineString>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizeLineString(handler: DigitizerCallback<olLineString>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a circle\n     *\n     * @param {DigitizerCallback<olCircle>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizeCircle(handler: DigitizerCallback<olCircle>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a rectangle\n     *\n     * @param {DigitizerCallback<olPolygon>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizeRectangle(handler: DigitizerCallback<olPolygon>, prompt?: string): void;\n    /**\n     * Starts the digitization process for a polygon\n     *\n     * @param {DigitizerCallback<olPolygon>} handler\n     * @param {string} [prompt]\n     *\n     * @memberof IMapViewer\n     */\n    digitizePolygon(handler: DigitizerCallback<olPolygon>, prompt?: string): void;\n    /**\n     * Zooms to the specified extent\n     *\n     * @param {Bounds} extent\n     *\n     * @memberof IMapViewer\n     */\n    zoomToExtent(extent: Bounds): void;\n    /**\n     * Gets the layer manager for the given map. If map name is not specifed\n     * it will get the layer manager for the currently active map.\n     *\n     * @param {string} [mapName]\n     * @returns {ILayerManager}\n     * @memberof IMapViewer\n     * @since 0.12\n     */\n    getLayerManager(mapName?: string): ILayerManager;\n    /**\n     * Adds an OpenLayers interaction\n     *\n     * @template T\n     * @param {T} interaction\n     * @returns {T}\n     *\n     * @memberof IMapViewer\n     */\n    addInteraction<T extends olInteraction>(interaction: T): T;\n    /**\n     * Removes the given OpenLayers interaction\n     *\n     * @template T\n     * @param {T} interaction\n     *\n     * @memberof IMapViewer\n     */\n    removeInteraction<T extends olInteraction>(interaction: T): void;\n    /**\n     * Adds an OpenLayers overlay\n     *\n     * @param {olOverlay} overlay\n     *\n     * @memberof IMapViewer\n     */\n    addOverlay(overlay: olOverlay): void;\n    /**\n     * Removes the given OpenLayers overlay\n     *\n     * @param {olOverlay} overlay\n     *\n     * @memberof IMapViewer\n     */\n    removeOverlay(overlay: olOverlay): void;\n    /**\n     * Adds an event handler for the specified event\n     *\n     * @param {string} eventName\n     * @param {Function} handler\n     *\n     * @memberof IMapViewer\n     */\n    addHandler(eventName: string, handler: Function): void;\n    /**\n     * Removes an event handler for the specified event\n     *\n     * @param {string} eventName\n     * @param {Function} handler\n     *\n     * @memberof IMapViewer\n     */\n    removeHandler(eventName: string, handler: Function): void;\n    /**\n     * Gets the OL object factory\n     */\n    getOLFactory(): IOLFactory;\n    /**\n     * Gets the view resolution\n     *\n     * @returns {number}\n     *\n     * @memberof IMapViewer\n     */\n    getResolution(): number | undefined;\n    /**\n     * Gets the resolution for the given scale\n     *\n     * @returns {number}\n     *\n     * @memberof IMapViewer\n     */\n    scaleToResolution(scale: number): number;\n    /**\n     * Gets the name of the current runtime map\n     * \n     * @returns {string} \n     * @memberof IMapViewer\n     */\n    getMapName(): string;\n    /**\n     * Sets the current view rotation\n     * \n     * @param {number} rotation \n     * @memberof IMapViewer\n     */\n    setViewRotation(rotation: number): void;\n    /**\n     * Gets the current view rotation\n     * \n     * @returns {number} \n     * @memberof IMapViewer\n     */\n    getViewRotation(): number;\n    /**\n     * Gets whether view rotation is enabled\n     * \n     * @returns {boolean} \n     * @memberof IMapViewer\n     */\n    isViewRotationEnabled(): boolean;\n    /**\n     * Sets whether view rotation is enabled or not\n     * \n     * @param {boolean} enabled \n     * @memberof IMapViewer\n     */\n    setViewRotationEnabled(enabled: boolean): void;\n    /**\n     * \n     * @since 0.11\n     * @param {number} x \n     * @param {number} y \n     * @returns {[number, number]} \n     * @memberof IMapViewer\n     */\n    screenToMapUnits(x: number, y: number): [number, number];\n\n    toastSuccess(icon: string, message: string | JSX.Element): string | undefined;\n    toastWarning(icon: string, message: string | JSX.Element): string | undefined;\n    toastError(icon: string, message: string | JSX.Element): string | undefined;\n    toastPrimary(icon: string, message: string | JSX.Element): string | undefined;\n    dismissToast(key: string): void;\n    updateSize(): void;\n\n    /**\n     * Returns the collection of selected client-side vector features. This collection\n     * is observable, so you may hold onto a reference to this collection and subscribe\n     * to events on this collection for when new features are added or removed from this collection\n     * \n     * @returns {Collection<Feature>}\n     * @memberof IMapViewer\n     * @since 0.13\n     * @since 0.14 - The return value may be undefined if called when the map viewer is detached/disposed/destroyed\n     */\n    getSelectedFeatures(): Collection<Feature<Geometry>> | undefined;\n\n    /**\n     * INTERNAL API. Not for public use\n     * @hidden\n     */\n    addImageLoading(): void;\n    /**\n     * INTERNAL API. Not for public use\n     * @hidden\n     */\n    addImageLoaded(): void;\n    /**\n     * EXPERIMENTAL:\n     * Adds the given application state subscribers\n     * \n     * NOTE: Calling this method will trigger a re-render of the component. Due to this quirk, \n     * calling this method again while a re-render is taking place may cause the subscriber to\n     * not actually be registered. Calling this method multiple times in succession is therefore\n     * not advised. If you need to add multiple subscribers, pass an array of the subscribers to\n     * register in a single method call.\n     * \n     * @param props \n     * @since 0.13\n     */\n    addSubscribers(props: ISubscriberProps[]): string[];\n    /**\n     * EXPERIMENTAL:\n     * Removes application state subscribers of the given names\n     * \n     * @param name \n     * @since 0.13\n     */\n    removeSubscribers(names: string[]): boolean;\n    /**\n     * EXPERIMENTAL:\n     * Gets all application state subscriber names\n     * \n     * @since 0.13\n     */\n    getSubscribers(): string[];\n    /**\n     * Dispatches the given action\n     * \n     * @remarks Usage outside of the react component context (eg. Plain HTML Task Pane content) should be used sparingly. In particular\n     * you should avoid trying to call this method multiple times in succession. You should call this method once in response to a DOM element\n     * event (eg. A button click)\n     * @alpha\n     * @since 0.13\n     */\n    dispatch(action: any): void;\n\n    /**\n     * Gets the default point circle style\n     * @since 0.13\n     */\n    getDefaultPointCircleStyle(): IBasicPointCircleStyle;\n\n    /**\n     * Gets the default point icon style\n     * @since 0.13\n     */\n    getDefaultPointIconStyle(): IPointIconStyle;\n\n    /**\n     * Gets the default line style\n     * @since 0.13\n     */\n    getDefaultLineStyle(): IBasicVectorLineStyle;\n\n    /**\n     * Gets the default polygon style\n     * @since 0.13\n     */\n    getDefaultPolygonStyle(): IBasicVectorPolygonStyle;\n\n    /**\n     * Exports an image of the current map view\n     *\n     * @param {IMapImageExportOptions} options\n     * @memberof IMapViewer\n     * @since 0.14\n     */\n    exportImage(options: IMapImageExportOptions): void;\n}\n\n/**\n * WMS layer extension data\n * \n * @since 0.13\n */\nexport interface IWmsLayerExtensions {\n    type: \"WMS\";\n    getLegendUrl?: (resolution?: number) => string;\n}\n\n/**\n * Layer extension data\n * \n * @since 0.13\n */\nexport type LayerExtensions = IWmsLayerExtensions;\n\nexport interface ILayerInfo {\n    /**\n     * The name of the layer\n     * \n     * @type {string}\n     * @memberof ILayerInfo\n    * */\n    name: string;\n    /**\n     * The display name of this layer\n     *\n     * @type {string}\n     * @memberof ILayerInfo\n     * @since 0.14\n     */\n    displayName: string;\n    /**\n     * The type of layer\n     * \n     * @type {string}\n     * @memberof ILayerInfo\n     */\n    type: string;\n    /**\n     * An optional description for the layer\n     *\n     * @type {string}\n     * @memberof ILayerInfo\n     * @since 0.14\n     */\n    description?: string;\n    /**\n     * Indicates if this layer is an external layer\n     * \n     * @since 0.13\n     */\n    isExternal: boolean;\n    /** \n     * Indicates if this layer is visible\n     * \n     * @since 0.13\n     */\n    visible: boolean;\n    /**\n     * Indicates if this layer is selectable by the select tool\n     * \n     * @since 0.13\n     */\n    selectable: boolean;\n    /**\n     * The opacity of this layer\n     * \n     * @since 0.13\n     * @type {number}\n     * @memberof ILayerInfo\n     */\n    opacity: number;\n    /**\n     * Extension data for this layer\n     * \n     * @since 0.13\n     */\n    extensions?: LayerExtensions;\n    /**\n     * The vector style for this layer. Not applicable for raster layers.\n     * \n     * @since 0.13\n     * @since 0.14 Changed to IVectorLayerStyle\n     */\n    vectorStyle?: IVectorLayerStyle;\n    /**\n     * Cluster style settings\n     * @since 0.14\n     */\n    cluster?: IClusterSettings;\n    /**\n     * Heatmap settings\n     * @since 0.14\n     */\n    heatmap?: IHeatmapSettings;\n    /**\n     * The busy worker count of this layer. If greater than 0, the layer\n     * is considered to be in the process of loading\n     * \n     * @since 0.13\n     */\n    busyWorkerCount: number;\n    /**\n     * Metadata attached to the layer\n     * \n     * @since 0.14\n     * @memberof ILayerInfo\n     */\n    metadata?: any;\n}\n\n/**\n * Point layer clustering options\n * \n * @since 0.14\n */\nexport interface AddVectorLayerClusteringOptions {\n    kind: \"Cluster\";\n    /**\n     * The distance to use for clustering. Setting this value will create a clustered layer.\n     * \n     *  * If {@see clusterDistance} is set, but {@see clusterStyle} is not set, the {@see IAddLayerFromParsedFeaturesOptions.defaultStyle} will be used if set, otherwise the default vector style will be used\n     */\n    clusterDistance: number;\n    /**\n     * The style to use for this clustered layer. \n     * \n     *  * If {@see clusterDistance} is not set, this has no effect\n     *  * If {@see clusterDistance} is set but this is not set, the {@see IAddLayerFromParsedFeaturesOptions.defaultStyle} will be used if set, otherwise the default vector style will be used\n     */\n    clusterStyle?: IVectorLayerStyle;\n    /**\n     * The action to perform when the cluster is clicked\n     */\n    onClusterClickAction?: ClusterClickAction;\n}\n\n/**\n * Theming options\n * @since 0.14\n */\nexport interface AddVectorLayerThemeOptions {\n    kind: \"Theme\";\n    /**\n     * Generate a thematic ramp based on the given property\n     */\n    themeOnProperty: string;\n    /**\n     * The colorbrewer theme to apply\n     */\n    colorBrewerTheme: string;\n}\n\n/**\n * Heatmap options\n * @since 0.14\n */\nexport interface AddVectorLayerHeatmapOptions {\n    kind: \"Heatmap\",\n    /**\n     * The weight property\n     */\n    weightProperty?: string;\n}\n\nexport type AddVectorLayerExtraOptions = AddVectorLayerClusteringOptions | AddVectorLayerThemeOptions | AddVectorLayerHeatmapOptions;\n\n/**\n * Options to add a new layer from parsed features\n * \n * @export\n * @interface IAddLayerFromParsedFeaturesOptions\n * @since 0.13\n */\nexport interface IAddLayerFromParsedFeaturesOptions {\n    /**\n     * The projection to assign for this layer. If not specified, the map's projection\n     * is assumed\n     */\n    projection?: ProjectionLike;\n    /**\n     * The parsed features to add the layer with\n     */\n    features: IParsedFeatures;\n    /**\n     * The style to use for this layer. If not specified, a default style will be assigned\n     * to this layer\n     * \n     * @since 0.13\n     * @since 0.14 changed to IVectorLayerStyle\n     */\n    defaultStyle?: IVectorLayerStyle;\n    /**\n     * Extra options for the layer to be added\n     * @since 0.14\n     */\n    extraOptions?: AddVectorLayerExtraOptions;\n    /**\n     * The property to use for labeling\n     * @since 0.14\n     */\n    labelOnProperty?: string;\n    /**\n     * The popup template to use when features are selected on this layer\n     * @since 0.14\n     */\n    selectedPopupTemplate?: ISelectedFeaturePopupTemplateConfiguration;\n    /**\n     * Metadata for this layer\n     * @since 0.14\n     */\n    metadata?: any;\n}\n\n/**\n * Options for parsing features from a file\n * \n * @export\n * @interface IParseFeaturesFromFileOptions\n * @since 0.13\n */\nexport interface IParseFeaturesFromFileOptions {\n    file: File;\n    name: string;\n    locale: string;\n}\n\n/**\n * Manages custom layers for a map\n * \n * @export\n * @interface ILayerManager\n */\nexport interface ILayerManager {\n    /**\n     * Get the active subject layer if present on the current map. In a MapGuide-specific context, subject layers do not exist\n     * and this method will always return undefined in such cases\n     *\n     * @returns {olLayerBase}\n     * @memberof ILayerManager\n     * @since 0.14\n     */\n    tryGetSubjectLayer(): olLayerBase | undefined;\n    /**\n     * Gets all custom layers on this map, sorted by draw order (First item is top-most layer. Last item is bottom-most layer.)\n     * \n     * @returns {ILayerInfo[]} \n     * @memberof ILayerManager\n    * */\n    getLayers(): ILayerInfo[];\n    /**\n     * Gets whether the specified custom layer exists on the map\n     */\n    hasLayer(name: string): boolean;\n    /**\n     * Adds a layer to the map\n     * \n     * @template T \n     * @param {string} name The name of the layer\n     * @param {T} layer The layer object\n     * @param {boolean} [allowReplace] If false or not set, this method will throw an error if a layer of the specified name already exists. Otherwise that layer will be replaced with the given layer\n     * @returns {T} The added layer\n     * @memberof ILayerManager\n     */\n    addLayer<T extends olLayerBase>(name: string, layer: T, allowReplace?: boolean): ILayerInfo;\n    /**\n     * Removes a layer by the given name\n     *\n     * @param {string} name\n     * @returns {(olLayerBase | undefined)}\n     *\n     * @memberof IMapViewer\n     */\n    removeLayer(name: string): olLayerBase | undefined;\n    /**\n     * Gets a layer by the given name\n     *\n     * @template T\n     * @param {string} name\n     * @returns {T}\n     *\n     * @memberof IMapViewer\n     */\n    getLayer<T extends olLayerBase>(name: string): T | undefined;\n\n    /**\n     * Attempts to parse features for the given input file. A failed attempt is when\n     * calling hasFeatures() on the returned parsed features returns false.\n     * \n     * @param {IParseFeaturesFromFileOptions} options\n     * @returns {Promise<IParsedFeatures>}\n     * @memberof ILayerManager\n     * @since 0.13\n     */\n    parseFeaturesFromFile(options: IParseFeaturesFromFileOptions): Promise<IParsedFeatures>;\n\n    /**\n     * Adds the given parsed features as a new external layer\n     * \n     * @param {IAddLayerFromParsedFeaturesOptions} options\n     * @returns {Promise<ILayerInfo>}\n     * @memberof ILayerManager\n     * @since 0.13\n     * @since 0.14 Styles for geometry types not found in the parsed features will be deleted\n     */\n    addLayerFromParsedFeatures(options: IAddLayerFromParsedFeaturesOptions): Promise<ILayerInfo>;\n\n    /**\n     * Applies draw order/opacity/visibility\n     * @hidden\n     */\n    apply(layers: ILayerInfo[]): void;\n}\n\n/**\n * Function signature for a digitization callback\n */\nexport type DigitizerCallback<T extends olGeometry> = (geom: T) => void;\n\n/**\n * Valid image formats\n */\nexport type ImageFormat = \"PNG\" | \"PNG8\" | \"JPG\" | \"GIF\";\n\n/**\n * The type of client\n */\nexport type ClientKind = \"mapagent\" | \"mapguide-rest\";\n\nexport interface IModalParameters {\n    title: string;\n    backdrop: boolean;\n    size: [number, number];\n    overflowYScroll?: boolean;\n}\n\n/**\n * The default modal dialog size\n */\nexport const DEFAULT_MODAL_SIZE: [number, number] = [350, 500];\n\n/**\n * Base modal display options\n *\n * @export\n * @interface IModalDisplayOptionsBase\n */\nexport interface IModalDisplayOptionsBase {\n    modal: IModalParameters;\n    name: string;\n}\n\n/**\n * Modal display options for URL content\n *\n * @export\n * @interface IModalDisplayOptions\n * @extends {IModalDisplayOptionsBase}\n */\nexport interface IModalDisplayOptions extends IModalDisplayOptionsBase {\n    /**\n     * The URL of the content to load in the modal dialog\n     *\n     * @type {string}\n     * @memberof IModalDisplayOptions\n     */\n    url: string;\n}\n\nexport interface IModalComponentDisplayOptions extends IModalDisplayOptionsBase {\n    /**\n     * The id of the component to display\n     *\n     * @type {string}\n     * @memberof IModalComponentDisplayOptions\n     */\n    component: string;\n    /**\n     * Component properties\n     *\n     * @type {*}\n     * @memberof IModalComponentDisplayOptions\n     */\n    componentProps?: any;\n}\n\nexport interface IToolbarReducerState {\n    toolbars: any;\n    flyouts: any;\n}\n\n/**\n * Describes the reducer state branch for Task Pane component\n *\n * @export\n * @interface ITaskPaneReducerState\n */\nexport interface ITaskPaneReducerState {\n    /**\n     * The current navigation index\n     *\n     * @type {number}\n     * @memberof ITaskPaneReducerState\n     */\n    navIndex: number;\n    /**\n     * The current navigation history stack\n     *\n     * @type {string[]}\n     * @memberof ITaskPaneReducerState\n     */\n    navigation: string[];\n    /**\n     * The initial URL\n     *\n     * @type {(string | undefined)}\n     * @memberof ITaskPaneReducerState\n     */\n    initialUrl: string | undefined;\n    /**\n     * The last pushed URL\n     *\n     * @type {boolean}\n     * @memberof ITaskPaneReducerState\n     */\n    lastUrlPushed: boolean;\n}\n\nexport type IModalReducerState = {\n    /**\n     * Gets the modal parameters for the given key\n     */\n    [key: string]: IModalDisplayOptions | IModalComponentDisplayOptions;\n};\n\n/*\nexport interface IModalReducerState {\n\n}\n*/\n\n/**\n * A set of layer transpareny values by layer name\n */\nexport type LayerTransparencySet = { [layerName: string]: number };\n\n/**\n * Selection key of an active selected feature\n */\nexport interface ActiveSelectedFeature {\n    /**\n     * The selected layer id\n     * \n     * @type {string}\n     */\n    layerId: string;\n    /**\n     * The selection key of the feature\n     * \n     * @type {string}\n     */\n    selectionKey: string;\n}\n\n/**\n * Generic layer sub-state\n *\n * @export\n * @interface IGenericLayerSubState\n * @since 0.14\n */\nexport interface IGenericLayerSubState {\n    /**\n     * The subject layer\n     *\n     * @type {IGenericSubjectMapLayer}\n     * @memberof IGenericLayerSubState\n     */\n    subject: IGenericSubjectMapLayer;\n}\n\n/**\n * MapGuide-specific map sub-state\n *\n * @export\n * @interface IMapGuideSubState\n * @since 0.14\n */\nexport interface IMapGuideSubState {\n    /**\n     * The runtime map state\n     *\n     * @type {(RuntimeMap | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    runtimeMap: RuntimeMap | undefined;\n    /**\n     * A set of selectable layer ids\n     *\n     * @type {*}\n     * @memberof IBranchedMapSubState\n     */\n    selectableLayers: any;\n    /**\n     * A set of expanded group ids\n     *\n     * @type {*}\n     * @memberof IBranchedMapSubState\n     */\n    expandedGroups: any;\n    /**\n     * The current MapGuide selection state\n     *\n     * @type {(QueryMapFeaturesResponse | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    selectionSet: QueryMapFeaturesResponse | undefined;\n    /**\n     * The array of ids of layers to show\n     *\n     * @type {string[]}\n     * @memberof IBranchedMapSubState\n     */\n    showLayers: string[];\n    /**\n     * The array of ids of groups to show\n     *\n     * @type {string[]}\n     * @memberof IBranchedMapSubState\n     */\n    showGroups: string[];\n    /**\n     * The array of ids of layers to hide\n     *\n     * @type {string[]}\n     * @memberof IBranchedMapSubState\n     */\n    hideLayers: string[];\n    /**\n     * The array of ids of groups to hide\n     *\n     * @type {string[]}\n     * @memberof IBranchedMapSubState\n     */\n    hideGroups: string[];\n    /**\n     * Layer transparency settings\n     * \n     * @type {{ [layerName: string]: number }}\n     * @memberof IBranchedMapSubState\n     */\n    layerTransparency: LayerTransparencySet;\n    /**\n     * The active selected feature to highlight\n     * \n     * @type {(ActiveSelectedFeature | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    activeSelectedFeature: ActiveSelectedFeature | undefined;\n}\n\n/**\n * Describes the reducer state branch for a particular map group\n *\n * @export\n * @interface IBranchedMapSubState\n */\nexport interface IBranchedMapSubState {\n    /**\n     * The external base layers for the map group\n     *\n     * @type {IExternalBaseLayer[]}\n     * @memberof IBranchedMapSubState\n     */\n    externalBaseLayers: IExternalBaseLayer[];\n    /**\n     * Initial external layers. This does not reflect the current state of external layers added. This merely instructs what external layers\n     * to pre-load on viewer startup.\n     *\n     * @type {IInitialExternalLayer[]}\n     * @memberof IBranchedMapSubState\n     * @since 0.14\n     */\n    initialExternalLayers: IInitialExternalLayer[];\n    /**\n     * The layers in this viewer. First item is top-most layer. Last item is bottom-most layer.\n     * @since 0.13\n     */\n    layers: ILayerInfo[] | undefined;\n    /**\n     * The current map view\n     *\n     * @type {(IMapView | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    currentView: IMapView | undefined;\n    /**\n     * The initial map view\n     *\n     * @type {(IMapView | undefined)}\n     * @memberof IBranchedMapSubState\n     */\n    initialView: IMapView | undefined;\n    /**\n     * The view navigation history stack\n     *\n     * @type {IMapView[]}\n     * @memberof IBranchedMapSubState\n     */\n    history: IMapView[];\n    /**\n     * The current position in the view navigation history stack\n     *\n     * @type {number}\n     * @memberof IBranchedMapSubState\n     */\n    historyIndex: number;\n    /**\n     * MapGuide-specific sub-state\n     *\n     * @type {IMapGuideSubState}\n     * @memberof IBranchedMapSubState\n     * @since 0.14\n     */\n    mapguide: IMapGuideSubState | undefined;\n    /**\n     * The current client-side selection state\n     * \n     * @since 0.14\n     */\n    clientSelection: ClientSelectionSet | undefined;\n    /**\n     * Generic layer sub-state\n     *\n     * @type {(IGenericLayerSubState | undefined)}\n     * @memberof IBranchedMapSubState\n     * @since 0.14\n     */\n    generic: IGenericLayerSubState | undefined;\n}\n\n/**\n * The reducer state branch for runtime map state. Map-specific state is keyed on\n * their respective runtime map name as sub-branches on this branch\n *\n * @export\n * @interface IBranchedMapState\n */\nexport interface IBranchedMapState {\n    [mapName: string]: IBranchedMapSubState;\n}\n\n/**\n * Coordinate display configuration\n *\n * @export\n * @interface ICoordinateConfiguration\n */\nexport interface ICoordinateConfiguration {\n    /**\n     * The number of decimal places to show\n     *\n     * @type {number}\n     * @memberof ICoordinateConfiguration\n     */\n    decimals: number;\n    /**\n     * The display projection for these coordinates\n     * \n     * @type {string}\n     * @memberof ICoordinateConfiguration\n     */\n    projection: string;\n    /**\n     * Display format string\n     * \n     * @type {string}\n     * @memberof ICoordinateConfiguration\n     */\n    format?: string;\n}\n\n/**\n * Describes the capabilities of the current view\n *\n * @export\n * @interface IViewerCapabilities\n */\nexport interface IViewerCapabilities {\n    /**\n     * Indicates if this viewer as a Task Pane component mounted\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasTaskPane: boolean;\n    /**\n     * Indicates if the Task Pane on this viewer has a Task Bar\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasTaskBar: boolean;\n    /**\n     * Indicates if this viewer has a status bar\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasStatusBar: boolean;\n    /**\n     * Indicates if this viewer has a zoom slider\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasNavigator: boolean;\n    /**\n     * Indicates if this viewer has a selection panel component mounted\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasSelectionPanel: boolean;\n    /**\n     * Indicates if this viewer has a legend component mounted\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasLegend: boolean;\n    /**\n     * Indicates if this viewer has a primary toolbar mounted\n     *\n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasToolbar: boolean;\n    /**\n     * Indicates if this viewer has the view size mounted\n     * \n     * @type {boolean}\n     * @memberof IViewerCapabilities\n     */\n    hasViewSize: boolean;\n}\n\n/**\n * Describes a name/value pair\n *\n * @export\n * @interface INameValuePair\n */\nexport interface INameValuePair {\n    /**\n     * The name\n     *\n     * @type {string}\n     * @memberof INameValuePair\n     */\n    name: string;\n    /**\n     * The value\n     *\n     * @type {string}\n     * @memberof INameValuePair\n     */\n    value: string;\n}\n\n/**\n * Describes a redux reducer function\n */\nexport type ReducerFunction<TState> = (state: TState, action: ViewerAction) => TState;\n\n/**\n * Describes the reducer state branch for the current viewer template\n *\n * @export\n * @interface ITemplateReducerState\n */\nexport interface ITemplateReducerState {\n    /**\n     * The initial width of the information pane. Only certain templates will recognise this setting\n     * \n     * @type {number}\n     * @memberof ITemplateReducerState\n     */\n    initialInfoPaneWidth: number;\n    /**\n     * The initial width of the task pane. Only certain templates will recognise this setting\n     * \n     * @type {number}\n     * @memberof ITemplateReducerState\n     */\n    initialTaskPaneWidth: number;\n    /**\n     * Indicates if the task pane is visible\n     *\n     * @type {boolean}\n     * @memberof ITemplateReducerState\n     */\n    taskPaneVisible: boolean;\n    /**\n     * Indicates if the legend is visible\n     *\n     * @type {boolean}\n     * @memberof ITemplateReducerState\n     */\n    legendVisible: boolean;\n    /**\n     * Indicates if the selection panel is visible\n     *\n     * @type {boolean}\n     * @memberof ITemplateReducerState\n     */\n    selectionPanelVisible: boolean;\n    /**\n     * If true, the selection panel will auto-display when a selection is made\n     * and there are results to show\n     * \n     * @since 0.13\n     */\n    autoDisplaySelectionPanelOnSelection: boolean;\n}\n\n/**\n * Signature for a template state reducer function\n * \n * @since 0.13\n */\nexport type TemplateReducerFunction = (origState: ITemplateReducerState, currentState: ITemplateReducerState, action: ViewerAction) => ITemplateReducerState;\n\n/**\n * Keyboard code for ESCAPE\n */\nexport const KC_ESCAPE = 27;\n\n/**\n * Keyboard code for the letter U\n */\nexport const KC_U = 85;\n\n/**\n * The positioning of the map load indicator\n */\nexport type MapLoadIndicatorPositioning = \"top\" | \"bottom\";\n\n/**\n * Describes the reducer state branch for various configuration properties\n *\n * @export\n * @interface IConfigurationReducerState\n */\nexport interface IConfigurationReducerState {\n    /**\n     * The agent URI\n     *\n     * @type {(string | undefined)}\n     * @memberof IConfigurationReducerState\n     */\n    agentUri: string | undefined;\n    /**\n     * The type of agent\n     *\n     * @type {ClientKind}\n     * @memberof IConfigurationReducerState\n     */\n    agentKind: ClientKind;\n    /**\n     * The current locale\n     *\n     * @type {string}\n     * @memberof IConfigurationReducerState\n     */\n    locale: string;\n    /**\n     * The current active map name\n     *\n     * @type {(string | undefined)}\n     * @memberof IConfigurationReducerState\n     */\n    activeMapName: string | undefined;\n    /**\n     * The array of available runtime maps\n     *\n     * @type {(INameValuePair[] | undefined)}\n     * @memberof IConfigurationReducerState\n     */\n    availableMaps: INameValuePair[] | undefined;\n    /**\n     * Coordinate display configuration\n     *\n     * @type {ICoordinateConfiguration}\n     * @memberof IConfigurationReducerState\n     */\n    coordinates: ICoordinateConfiguration;\n    /**\n     * Viewer capabilities\n     *\n     * @type {IViewerCapabilities}\n     * @memberof IConfigurationReducerState\n     */\n    capabilities: IViewerCapabilities;\n    /**\n     * A dictionary of arbitrary app settings\n     * \n     * @since 0.14\n     */\n    appSettings?: Dictionary<string>;\n    /**\n     * Viewer configuration\n     *\n     * @type {{\n     *         imageFormat: ImageFormat;\n     *         selectionImageFormat: ImageFormat;\n     *         selectionColor: string;\n     *         pointSelectionBuffer: number;\n     *     }}\n     * @memberof IConfigurationReducerState\n     */\n    viewer: {\n        /**\n         * Whether this viewer will use stateless MapGuide rendering operations\n         * \n         * @since 0.14\n         */\n        isStateless: boolean;\n        /**\n         * The current image format\n         *\n         * @type {ImageFormat}\n         */\n        imageFormat: ImageFormat;\n        /**\n         * The current selection image format\n         *\n         * @type {ImageFormat}\n         */\n        selectionImageFormat: ImageFormat;\n        /**\n         * The current selection color\n         *\n         * @type {string}\n         */\n        selectionColor: string;\n        /**\n         * The color to use for highlighting active selected features\n         * \n         * @type {string}\n         */\n        activeSelectedFeatureColor: string;\n        /**\n         * The current point selection pixel tolerance\n         *\n         * @type {number}\n         */\n        pointSelectionBuffer: number;\n        /**\n         * The position of the map loading indicator\n         * \n         * @type {MapLoadIndicatorPositioning}\n         */\n        loadIndicatorPositioning: MapLoadIndicatorPositioning;\n        /**\n         * The color of the map loading indicator. This is an valid CSS color expression\n         * \n         * @type {string}\n         */\n        loadIndicatorColor: string;\n    },\n    /**\n     * Indicates if view rotation is enabled\n     * \n     * @type {boolean}\n     * @memberof IConfigurationReducerState\n     */\n    viewRotationEnabled: boolean;\n    /**\n     * The current view rotation\n     * \n     * @type {number}\n     * @memberof IConfigurationReducerState\n     */\n    viewRotation: number;\n    /**\n     * The unit to display view size in\n     * \n     * @type {UnitOfMeasure}\n     * @memberof IConfigurationReducerState\n     */\n    viewSizeUnits: UnitOfMeasure;\n    /**\n     * If specified and true and the MapTip component is active, then feature tooltips are activated\n     * by mouse click instead of idle mouse cursor at a given point on the map for a certain period of time. \n     * \n     * An active MapTip component with this setting enabled will override normal click-based selection.\n     * \n     * @type {boolean}\n     * @memberof IConfigurationReducerState\n     */\n    manualFeatureTooltips: boolean;\n    /**\n     * The key code to listen for cancelling an active digitization\n     * \n     * @type {number}\n     * @memberof IKeyBindingConfiguration\n     */\n    cancelDigitizationKey: number;\n    /**\n     * The key code to listen for undoing the last drawn point of an active digitization\n     * \n     * @type {number}\n     * @memberof IKeyBindingConfiguration\n     */\n    undoLastPointKey: number;\n}\n\n/**\n * Describes an error thrown during initialization\n *\n * @export\n * @interface InitError\n */\nexport interface InitError {\n    /**\n     * The error message\n     *\n     * @type {string}\n     * @memberof InitError\n     */\n    message: string;\n    /**\n     * The error stack trace\n     *\n     * @type {string[]}\n     * @memberof InitError\n     */\n    stack: string[];\n}\n\n/**\n * Describes the reducer state branch for initialization errors\n *\n * @export\n * @interface IInitErrorReducerState\n */\nexport interface IInitErrorReducerState {\n    /**\n     * The caught initialization error\n     *\n     * @type {(InitError | undefined)}\n     * @memberof IInitErrorReducerState\n     */\n    error: InitError | undefined;\n    /**\n     * The initialization options\n     *\n     * @type {*}\n     * @memberof IInitErrorReducerState\n     */\n    options: any;\n    /**\n     * Indicates if the stack trace should be shown\n     *\n     * @type {boolean}\n     * @memberof IInitErrorReducerState\n     */\n    includeStack: boolean;\n    /**\n     * Any warnings that were encountered during initialization\n     * \n     * @type {string[]}\n     * @memberof IInitErrorReducerState\n     */\n    warnings: string[];\n}\n\n/**\n * Describes the reducer state branch for viewer state\n *\n * @export\n * @interface IViewerReducerState\n */\nexport interface IViewerReducerState {\n    /**\n     * The current size of the map viewport (in pixels)\n     * \n     * @type {([number, number] | undefined)}\n     * @memberof IViewerReducerState\n     */\n    size: [number, number] | undefined;\n    /**\n     * The number of active busy actions. Zero indicates no busy activity. One or more\n     * indicates busy activity.\n     *\n     * @type {number}\n     * @memberof IViewerReducerState\n     */\n    busyCount: number;\n    /**\n     * The active map tool\n     *\n     * @type {ActiveMapTool}\n     * @memberof IViewerReducerState\n     */\n    tool: ActiveMapTool;\n    /**\n     * Indicates if feature tooltips are enabled\n     *\n     * @type {boolean}\n     * @memberof IViewerReducerState\n     */\n    featureTooltipsEnabled: boolean;\n}\n\n/**\n * Describes the reducer state branch for tracked mouse coordinates\n *\n * @export\n * @interface IMouseReducerState\n */\nexport interface IMouseReducerState {\n    /**\n     * The last tracked mouse coordinate\n     *\n     * @type {(Coordinate2D | undefined)}\n     * @memberof IMouseReducerState\n     */\n    coords: Coordinate2D | undefined;\n}\n\n/**\n * Describes the full application state tree. Redux-aware components can connect and subscribe to\n * various properties and branches of this tree and be automatically notified of any changes and\n * update and re-render themselves accordingly\n *\n * @export\n * @interface IApplicationState\n */\nexport interface IApplicationState {\n    /**\n     * Initialization errors\n     *\n     * @type {Readonly<IInitErrorReducerState>}\n     * @memberof IApplicationState\n     */\n    initError: Readonly<IInitErrorReducerState>;\n    /**\n     * Viewer configuration\n     *\n     * @type {Readonly<IConfigurationReducerState>}\n     * @memberof IApplicationState\n     */\n    config: Readonly<IConfigurationReducerState>;\n    /**\n     * Current template state\n     *\n     * @type {Readonly<ITemplateReducerState>}\n     * @memberof IApplicationState\n     */\n    template: Readonly<ITemplateReducerState>;\n    /**\n     * Viewer state\n     *\n     * @type {Readonly<IViewerReducerState>}\n     * @memberof IApplicationState\n     */\n    viewer: Readonly<IViewerReducerState>;\n    /**\n     * Runtime map state\n     *\n     * @type {Readonly<IBranchedMapState>}\n     * @memberof IApplicationState\n     */\n    mapState: Readonly<IBranchedMapState>;\n    /**\n     * Toolbar state\n     *\n     * @type {Readonly<IToolbarReducerState>}\n     * @memberof IApplicationState\n     */\n    toolbar: Readonly<IToolbarReducerState>;\n    /**\n     * Task Pane component state\n     *\n     * @type {Readonly<ITaskPaneReducerState>}\n     * @memberof IApplicationState\n     */\n    taskpane: Readonly<ITaskPaneReducerState>;\n    /**\n     * Modal dialog state\n     *\n     * @type {Readonly<IModalReducerState>}\n     * @memberof IApplicationState\n     */\n    modal: Readonly<IModalReducerState>;\n    /**\n     * Tracked mouse coordinate state\n     *\n     * @type {Readonly<IMouseReducerState>}\n     * @memberof IApplicationState\n     */\n    mouse: Readonly<IMouseReducerState>;\n    /**\n     * Tracks the last dispatched action\n     *\n     * @type {*}\n     * @memberof IApplicationState\n     */\n    lastaction: any;\n}\n\n// Redux typedefs to tighten up our redux code\n\n/**\n * Describes the redux store\n *\n * @export\n * @interface ReduxStore\n */\nexport interface ReduxStore {\n    /**\n     * Gets the application state\n     *\n     * @returns {Readonly<IApplicationState>}\n     *\n     * @memberof ReduxStore\n     */\n    getState(): Readonly<IApplicationState>;\n}\n\n/**\n * Describes a thunked redux action. Thunked redux actions are generally used for actions that push state\n * asynchronously (eg. In response to an AJAX request)\n */\nexport type ReduxThunkedAction = (dispatch: ReduxDispatch, getState: () => Readonly<IApplicationState>) => any;\n\n/**\n * Describes a redux dispatcher function. A redux dispatch pushes new state to the redux store\n */\nexport type ReduxDispatch = (action: ViewerAction | ReduxThunkedAction) => void;\n\n/**\n * A function that does nothing\n *\n * @export\n */\nexport function NOOP() { }\n\n/**\n * A function that always returns false\n *\n * @export\n * @returns false\n */\nexport function ALWAYS_FALSE() { return false; }\n\n/**\n * A function that always returns true\n *\n * @export\n * @returns true\n */\nexport function ALWAYS_TRUE() { return true; }\n\n/**\n * Describe the size/dimensions of a DOM element in a toolbar or flyout menu\n *\n * @export\n * @interface IDOMElementMetrics\n */\nexport interface IDOMElementMetrics {\n    /**\n     * The X position of this element\n     *\n     * @type {number}\n     * @memberof IDOMElementMetrics\n     */\n    posX: number;\n    /**\n     * The Y position of this element\n     *\n     * @type {number}\n     * @memberof IDOMElementMetrics\n     */\n    posY: number;\n    /**\n     * The width of this element\n     *\n     * @type {number}\n     * @memberof IDOMElementMetrics\n     */\n    width: number;\n    /**\n     * The height of this element\n     *\n     * @type {number}\n     * @memberof IDOMElementMetrics\n     */\n    height: number;\n    /**\n     * Indicates of this toolbar is vertically-oriented\n     *\n     * @type {boolean}\n     * @memberof IDOMElementMetrics\n     */\n    vertical?: boolean;\n}\n\n/**\n * Helper function to get the initial map view from the application state\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(IMapView | undefined)}\n */\nexport function getInitialView(state: Readonly<IApplicationState>): IMapView | undefined {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName].initialView;\n    }\n    return undefined;\n}\n\n/**\n * Helper function to get the mapguide-specific sub state of the current map group\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(IMapGuideSubState | undefined)}\n * @since 0.14\n */\nexport function getMapGuideSubState(state: Readonly<IApplicationState>): IMapGuideSubState | undefined {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName].mapguide;\n    }\n    return undefined;\n}\n\n/**\n * Helper function to get the current selection set from the application state\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(QueryMapFeaturesResponse | undefined)}\n */\nexport function getSelectionSet(state: Readonly<IApplicationState>): QueryMapFeaturesResponse | undefined {\n    return getMapGuideSubState(state)?.selectionSet;\n}\n\n/**\n * Helper function to get the current runtime map state from the application state\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(RuntimeMap | undefined)}\n */\nexport function getRuntimeMap(state: Readonly<IApplicationState>): RuntimeMap | undefined {\n    return getMapGuideSubState(state)?.runtimeMap;\n}\n\n/**\n * Helper function to get the current view from the application state\n *\n * @export\n * @param {Readonly<IApplicationState>} state\n * @returns {(IMapView | undefined)}\n */\nexport function getCurrentView(state: Readonly<IApplicationState>): IMapView | undefined {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName].currentView;\n    }\n    return undefined;\n}\n\n/**\n * Helper function to get the current set of available external base layers from the application state\n *\n * @remarks This does not include \"non-visual\" base layers such as UTFGrid tilesets\n * \n * @export\n * @param {Readonly<IApplicationState>} state\n * @param includeNonVisual Include \"non-visual\" base layers like UTFGrid tile sets\n * @returns {(IExternalBaseLayer[] | undefined)}\n */\nexport function getExternalBaseLayers(state: Readonly<IApplicationState>, includeNonVisual: boolean): IExternalBaseLayer[] | undefined {\n    if (state.config.activeMapName) {\n        if (includeNonVisual) {\n            return state.mapState[state.config.activeMapName].externalBaseLayers;\n        } else {\n            // UTFGrid may exist as a \"base layer\", but it has no visual representation so it is not a switchable candidate, so\n            // exclude it from the list if present\n            return state.mapState[state.config.activeMapName].externalBaseLayers.filter(ebl => ebl.kind != \"UTFGrid\");\n        }\n    }\n    return undefined;\n}\n\n/**\n * Defines the visibility of flyout menus\n */\nexport type FlyoutVisibilitySet = { [flyoutId: string]: boolean | undefined };\n\n/**\n * Defines the capabilities of a WMS service\n * \n * @since 0.11\n */\nexport interface WmsCapabilitiesDocument {\n    /**\n     * WMS service version\n     * \n     * @type {string}\n     * @memberof WmsCapabilitiesDocument\n     */\n    version: string;\n    Service: WMSServiceDescription;\n    Capability: WMSServiceCapabilities;\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSServiceCapabilities {\n    Request: any;\n    Exception: string[];\n    Layer: WMSRootPublishedLayer;\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSLayerBoundingBox {\n    crs: string;\n    extent: [number, number, number, number],\n    res: [any, any]\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSPublishedLayer {\n    Name: string;\n    Title: string;\n    Abstract: string;\n    KeywordList: string;\n    CRS: string[];\n    EX_GeographicBoundingBox: [number, number, number, number];\n    BoundingBox: WMSLayerBoundingBox[];\n    Style: WMSLayerStyle[];\n    queryable: boolean;\n    opaque: boolean;\n    noSubsets: boolean;\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSRootPublishedLayer extends WMSPublishedLayer {\n    Layer: WMSPublishedLayer[];\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSLegendURLDefinition {\n    Format: string;\n    OnlineResource: string;\n    size: [number, number];\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSLayerStyle {\n    Name: string;\n    Title: string;\n    Abstract: string;\n    LegendURL: WMSLegendURLDefinition[];\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSContactAddress {\n    AddressType: string,\n    Address: string,\n    City: string,\n    StateOrProvince: string,\n    PostCode: string,\n    Country: string\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSContact {\n    ContactPerson: string;\n    ContactOrganization: string;\n}\n\n/**\n * @since 0.12\n */\nexport interface WMSContactInformation {\n    ContactPersonPrimary: WMSContact,\n    ContactPosition: string,\n    ContactAddress: WMSContactAddress,\n    ContactVoiceTelephone: string,\n    ContactFacsimileTelephone: string,\n    ContactElectronicMailAddress: string\n}\n\n/**\n * @since 0.11\n */\nexport interface WMSServiceDescription {\n    Name: string;\n    Title: string;\n    Abstract: string;\n    KeywordList: string[];\n    OnlineResource: string;\n    ContactInformation: WMSContactInformation,\n    Fees: string;\n    AccessConstraints: string;\n}\n\nexport interface IMapGuideImageSource {\n    on(event: string, handler: Function): void;\n    updateParams(params: any): void;\n}\n\n/**\n * Custom properties that can be attached to OpenLayers layer instances\n * \n * @since 0.13\n */\nexport enum LayerProperty {\n    LAYER_TYPE = \"layer_type\",\n    LAYER_NAME = \"name\",\n    /**\n     * @since 0.14\n     */\n    LAYER_DISPLAY_NAME = \"display_name\",\n    IS_GROUP = \"is_group\",\n    IS_EXTERNAL = \"is_external\",\n    IS_SELECTABLE = \"is_selectable\",\n    IS_SCRATCH = \"is_scratch\",\n    HAS_WMS_LEGEND = \"has_wms_legend\",\n    VECTOR_STYLE = \"vector_style\",\n    WGS84_BBOX = \"wgs84_bbox\",\n    BUSY_WORKER_COUNT = \"busy_worker_count\",\n    /**\n     * @since 0.14\n     */\n    SELECTED_POPUP_CONFIGURATION = \"popup_config\",\n    /**\n     * @since 0.14\n     */\n    LAYER_DESCRIPTION = \"layer_description\",\n    /**\n     * @since 0.14\n     */\n    LAYER_METADATA = \"layer_metadata\",\n    /**\n     * @since 0.14\n     */\n    IS_HOVER_HIGHLIGHT = \"is_hover_highlight\",\n    /**\n     * @since 0.14\n     */\n    IS_MEASURE = \"is_measure\",\n    /**\n     * @since 0.14\n     */\n    IS_WMS_SELECTION_OVERLAY = \"is_wms_selection_overlay\",\n    /**\n     * @since 0.14\n     */\n    IS_HEATMAP = \"is_heatmap\"\n}\n\n/**\n * Custom properties that can be attached to OpenLayers image source instances\n * \n * @since 0.13\n */\nexport enum SourceProperty {\n    SUPPRESS_LOAD_EVENTS = \"suppress_load_events\"\n}\n\n/**\n * MapGuide layer types\n * \n * @since 0.13\n */\nexport enum MgLayerType {\n    Untiled = \"MapGuide_Untiled\",\n    Tiled = \"MapGuide_Tiled\"\n}\n\n/**\n * The type name for a MapGuide layer\n * \n * @since 0.13\n */\nexport const MG_LAYER_TYPE_NAME = \"MapGuide\";\n\n/**\n * The default group name for MapGuide tiled layers. This value\n * is not meant for localized display\n * \n * @since 0.13\n */\nexport const MG_BASE_LAYER_GROUP_NAME = \"Base Tile Layers\";\n\n/**\n * Default names for MapGuide built-in layer types. These value\n * are not meant for localized display\n * \n * @since 0.13\n */\nexport enum MgBuiltInLayers {\n    Overlay = \"MapGuide Dynamic Overlay\",\n    SelectionOverlay = \"MapGuide Selection Overlay\",\n    ActiveFeatureSelectionOverlay = \"MapGuide Active Feature Selection Overlay\"\n}\n\n/**\n * A layer of a {@link ICompositeSelection}\n * \n * @since 0.14\n */\nexport interface ICompositeSelectionLayer {\n    /**\n     * The id of this selection layer\n     */\n    getLayerId(): string | undefined;\n    /**\n     * The name of this layer\n     */\n    getName(): string;\n    /**\n     * The metadata of this layer\n     */\n    getLayerMetadata(): LayerMetadata | undefined;\n    /**\n     * Gets the feature at the given index\n     */\n    getFeatureAt(featureIndex: number): SelectedFeature;\n    /**\n     * Gets the total number of features in this layer\n     */\n    getFeatureCount(): number;\n}\n\n/**\n * A composition of a MapGuide selection set and a client-side vector feature selection\n * \n * @since 0.14\n */\nexport interface ICompositeSelection {\n    /**\n     * Gets the number of layers in this selection set\n     */\n    getLayerCount(): number;\n    /**\n     * Gets the array of layers in this selection set\n     */\n    getLayers(): ICompositeSelectionLayer[];\n    /**\n     * Gets the layer at the specified index\n     * \n     * @param layerIndex The selection layer index\n     */\n    getLayerAt(layerIndex: number): ICompositeSelectionLayer | undefined;\n    /**\n     * Gets the feature for the given layer at the specified indices\n     * \n     * @param layerIndex The selection layer index\n     * @param featureIndex The feature index\n     */\n    getFeatureAt(layerIndex: number, featureIndex: number): SelectedFeature | undefined;\n}","import { ICompositeSelectionLayer, ICompositeSelection, Bounds } from \"./common\";\nimport { ClientSelectionLayer, ClientSelectionSet } from \"./contracts/common\";\nimport { SelectedFeature, SelectedLayer, FeatureProperty, SelectedFeatureSet } from \"./contracts/query\";\n\n//FIXME: We are inlining extend of ol/Extent here so that this module can be included in any jest test case\n//without jest complaining about not being able to import ol's ES6 modules. I don't know how to get jest to\n//recognize ol imports. None of the solutions I tried worked!\nfunction extend(extent1: Bounds, extent2: Bounds) {\n    if (extent2[0] < extent1[0]) {\n        extent1[0] = extent2[0];\n    }\n    if (extent2[2] > extent1[2]) {\n        extent1[2] = extent2[2];\n    }\n    if (extent2[1] < extent1[1]) {\n        extent1[1] = extent2[1];\n    }\n    if (extent2[3] > extent1[3]) {\n        extent1[3] = extent2[3];\n    }\n    return extent1;\n}\n\n/**\n * A layer of a {@link CompositeSelection}\n * \n * @since 0.14\n */\nexport class CompositeSelectionLayer implements ICompositeSelectionLayer {\n    private features: SelectedFeature[];\n    constructor(private layer: SelectedLayer | ClientSelectionLayer) {\n        this.features = [];\n        if (this.isSelectedLayer(this.layer)) {\n            for (const f of this.layer.Feature) {\n                this.features.push(f);\n            }\n        } else {\n            for (const f of this.layer.features) {\n                const fp = [] as FeatureProperty[];\n                for (const k in f.properties) {\n                    fp.push({\n                        Name: k,\n                        Value: f.properties[k]\n                    })\n                }\n                const fb = f.bounds ? f.bounds.join(\" \") : undefined;\n                this.features.push({\n                    Bounds: fb,\n                    Property: fp\n                });\n            }\n        }\n    }\n    private isSelectedLayer(layer: SelectedLayer | ClientSelectionLayer): layer is SelectedLayer {\n        return (layer as any).Feature\n            && (layer as any)[\"@id\"]\n            && (layer as any)[\"@name\"]\n    }\n    /**\n     * Gets the combined bounds of all selected features\n     * \n     * @returns The combined bounds of all selected features in the projection of the current map view\n     */\n    public getBounds(): Bounds | undefined {\n        let bounds: Bounds | undefined;\n        if (this.isSelectedLayer(this.layer)) {\n            this.layer.Feature.forEach(feat => {\n                const b: Bounds | undefined = feat.Bounds\n                    ? (feat.Bounds.split(\" \").map(s => parseFloat(s)) as Bounds)\n                    : undefined;\n                if (b) {\n                    if (!bounds) {\n                        bounds = b;\n                    } else {\n                        bounds = extend(bounds, b) as Bounds;\n                    }\n                }\n            });\n        } else {\n            for (const f of this.layer.features) {\n                if (f.bounds) {\n                    if (bounds == null) {\n                        bounds = f.bounds;\n                    } else {\n                        bounds = extend(bounds, f.bounds) as Bounds;\n                    }\n                }\n            }\n        }\n        return bounds;\n    }\n    public getLayerId() {\n        if (this.isSelectedLayer(this.layer)) {\n            return this.layer[\"@id\"];\n        }\n        return undefined;\n    }\n    public getName() {\n        if (this.isSelectedLayer(this.layer)) {\n            return this.layer[\"@name\"];\n        } else {\n            return this.layer.name;\n        }\n    }\n    public getFeatureAt(featureIndex: number) {\n        return this.features[featureIndex];\n    }\n    public getFeatureCount() { return this.features.length; }\n    public getLayerMetadata() {\n        if (this.isSelectedLayer(this.layer)) {\n            return this.layer.LayerMetadata;\n        }\n        return undefined;\n    }\n}\n\n/**\n * A composition of a MapGuide selection set and a client-side vector feature selection\n * \n * @since 0.14\n */\nexport class CompositeSelection implements ICompositeSelection {\n    private layers: CompositeSelectionLayer[];\n    constructor(mgSelection?: SelectedFeatureSet, clientSelection?: ClientSelectionSet) {\n        this.layers = [];\n        if (mgSelection) {\n            for (const layer of mgSelection.SelectedLayer) {\n                this.layers.push(new CompositeSelectionLayer(layer));\n            }\n        }\n        if (clientSelection) {\n            for (const layer of clientSelection.layers) {\n                this.layers.push(new CompositeSelectionLayer(layer));\n            }\n        }\n    }\n    public getBounds(): Bounds | undefined {\n        if (this.layers.length == 0) {\n            return undefined;\n        }\n        let bounds: Bounds | undefined;\n        for (const lyr of this.layers) {\n            let layerBounds = lyr.getBounds();\n            if (layerBounds) {\n                if (bounds) {\n                    bounds = extend(bounds, layerBounds) as Bounds;\n                } else {\n                    bounds = layerBounds;\n                }\n            }\n        }\n        return bounds;\n    }\n    public getLayers() { return this.layers; }\n    public getLayerCount() {\n        return this.layers.length;\n    }\n    public getLayerAt(layerIndex: number) {\n        return this.layers[layerIndex];\n    }\n    public getFeatureAt(layerIndex: number, featureIndex: number) {\n        const layer = this.getLayerAt(layerIndex);\n        return layer?.getFeatureAt(featureIndex);\n    }\n}","//TODO: When TypeScript 2.0 drops, some of these interfaces can be converted to discriminated unions\n\nimport { ResourceBase } from \"./common\";\n\nexport interface ResourceReference {\n    ResourceId: string;\n}\n\nexport interface MapView {\n    CenterX: number;\n    CenterY: number;\n    Scale: number;\n}\n\nexport type TargetType = \"TaskPane\" | \"NewWindow\" | \"SpecifiedFrame\";\n\nexport interface WebLayoutMap extends ResourceReference {\n    InitialView?: MapView | undefined;\n    HyperlinkTarget: TargetType;\n    HyperlinkTargetFrame?: string | undefined;\n}\n\nexport interface WebLayoutControl {\n    Visible: boolean;\n}\n\nexport interface WebLayoutResizableControl extends WebLayoutControl {\n    Width: number;\n}\n\nexport interface FlyoutUIItem {\n    Function: \"Flyout\";\n    Label: string;\n    Tooltip?: string | undefined;\n    Description?: string | undefined;\n    ImageURL?: string | undefined;\n    DisabledImageURL?: string | undefined;\n    SubItem?: UIItem[] | undefined;\n}\n\nexport interface SeparatorUIItem {\n    Function: \"Separator\";\n}\n\nexport interface CommandUIItem {\n    Function: \"Command\";\n    Command: string;\n}\n\nexport type UIItem = FlyoutUIItem | SeparatorUIItem | CommandUIItem;\n\nexport function isCommandItem(item: UIItem): item is CommandUIItem {\n    return item.Function === \"Command\";\n}\n\nexport function isFlyoutItem(item: UIItem): item is FlyoutUIItem {\n    return item.Function === \"Flyout\";\n}\n\nexport function isSeparatorItem(item: UIItem): item is SeparatorUIItem {\n    return item.Function === \"Separator\";\n}\n\nexport interface WebLayoutToolbar extends WebLayoutControl {\n    Button: UIItem[];\n}\n\nexport interface WebLayoutContextMenu extends WebLayoutControl {\n    MenuItem: UIItem[];\n}\n\nexport interface TaskButton {\n    Name: string;\n    Tooltip: string;\n    Description: string;\n    ImageURL: string;\n    DisabledImageURL: string;\n}\n\nexport interface WebLayoutTaskBar extends WebLayoutControl {\n    Home: TaskButton;\n    Forward: TaskButton;\n    Back: TaskButton;\n    Tasks: TaskButton;\n    MenuButton: UIItem[];\n}\n\nexport interface WebLayoutTaskPane extends WebLayoutResizableControl {\n    InitialTask: string;\n    TaskBar: WebLayoutTaskBar;\n}\n\nexport interface WebLayoutStatusBar extends WebLayoutControl {\n\n}\n\nexport interface WebLayoutZoomControl extends WebLayoutControl {\n\n}\n\nexport interface WebLayoutInfoPane extends WebLayoutResizableControl {\n    LegendVisible: boolean;\n    PropertiesVisible: boolean;\n}\n\nexport type TargetViewerType = \"Dwf\" | \"Ajax\" | \"All\";\n\nexport interface CommandDef {\n    \"@xsi:type\": string;\n    Name: string;\n    Label: string;\n    Tooltip?: string | undefined;\n    Description?: string | undefined;\n    ImageURL?: string | undefined;\n    DisabledImageURL?: string | undefined;\n    TargetViewer: TargetViewerType;\n}\n\nexport type BasicCommandActionType =\n    \"Pan\" |\n    \"PanUp\" |\n    \"PanDown\" |\n    \"PanRight\" |\n    \"PanLeft\" |\n    \"Zoom\" |\n    \"ZoomIn\" |\n    \"ZoomOut\" |\n    \"ZoomRectangle\" |\n    \"ZoomToSelection\" |\n    \"FitToWindow\" |\n    \"PreviousView\" |\n    \"NextView\" |\n    \"RestoreView\" |\n    \"Select\" |\n    \"SelectRadius\" |\n    \"SelectPolygon\" |\n    \"ClearSelection\" |\n    \"Refresh\" |\n    \"CopyMap\" |\n    \"About\" |\n    \"MapTip\";\n\nexport interface BasicCommandDef extends CommandDef {\n    Action: BasicCommandActionType;\n}\n\nexport function isBasicCommand(cmd: any): cmd is BasicCommandDef {\n    return typeof(cmd.Action) != 'undefined';\n}\n\nexport function isTargetedCommand(cmd: any): cmd is TargetedCommandDef {\n    return typeof(cmd.Target) != 'undefined';\n}\n\nexport interface CustomCommandDef extends CommandDef {\n\n}\n\nexport interface TargetedCommandDef extends CustomCommandDef {\n    Target: TargetType;\n    TargetFrame?: string | undefined;\n}\n\nexport interface ParameterPair {\n    Key: string;\n    Value: string;\n}\n\nexport interface LayerSet {\n    Layer?: string[] | undefined;\n}\n\nexport function isInvokeURLCommand(cmd: any): cmd is InvokeURLCommandDef {\n    return typeof(cmd.URL) != 'undefined' && typeof(cmd.DisableIfSelectionEmpty) != 'undefined';\n}\n\nexport function isSearchCommand(cmd: CommandDef): cmd is SearchCommandDef {\n    return cmd[\"@xsi:type\"] == \"SearchCommandType\";\n}\n\nexport interface InvokeURLCommandDef extends TargetedCommandDef {\n    URL: string;\n    LayerSet?: LayerSet | undefined;\n    AdditionalParameter?: ParameterPair[] | undefined;\n    DisableIfSelectionEmpty: boolean;\n}\n\nexport interface InvokeScriptCommandDef extends TargetedCommandDef {\n    Script: string;\n}\n\nexport interface ResultColumn {\n    Name: string;\n    Property: string;\n}\n\nexport interface ResultColumnSet {\n    Column?: ResultColumn[] | undefined;\n}\n\nexport interface SearchCommandDef extends TargetedCommandDef {\n    Layer: string;\n    Prompt: string;\n    ResultColumns: ResultColumnSet;\n    Filter?: string;\n    MatchLimit: number;\n}\n\nexport interface BufferCommandDef extends TargetedCommandDef { }\n\nexport interface SelectWithinCommandDef extends TargetedCommandDef { }\n\nexport interface PrintCommandDef extends TargetedCommandDef {\n    PrintLayout?: ResourceReference[];\n}\n\nexport interface GetPrintablePageCommandDef extends TargetedCommandDef { }\n\nexport interface MeasureCommandDef extends TargetedCommandDef { }\n\nexport interface ViewOptionsCommandDef extends TargetedCommandDef { }\n\nexport interface HelpCommandDef extends TargetedCommandDef {\n    URL: string;\n}\n\nexport interface WebLayoutCommandSet {\n    Command: CommandDef[];\n}\n\nexport interface WebLayout extends ResourceBase {\n    Title: string;\n    Map: WebLayoutMap;\n    EnablePingServer?: boolean;\n    SelectionColor?: string;\n    PointSelectionBuffer?: number;\n    MapImageFormat?: string;\n    SelectionImageFormat?: string;\n    StartupScript?: string;\n    ToolBar: WebLayoutToolbar;\n    InformationPane: WebLayoutInfoPane;\n    ContextMenu: WebLayoutContextMenu;\n    TaskPane: WebLayoutTaskPane;\n    StatusBar: WebLayoutStatusBar;\n    ZoomControl: WebLayoutZoomControl;\n    CommandSet: WebLayoutCommandSet;\n}","/**\n * The base of any viewer-related error\n *\n * @export\n * @class MgError\n * @extends {Error}\n */\nexport class MgError extends Error {\n    constructor(public message: string) {\n        super(message);\n        this.name = \"MgError\";\n        this.message = message;\n        this.stack = (<any>new Error()).stack;\n    }\n}\n\n/**\n * Indicates if this error is a session expired error\n *\n * @export\n * @param {MgError} err\n * @returns {boolean}\n */\nexport function isSessionExpiredError(err: MgError): boolean {\n    return err.message.indexOf(\"MgSessionExpiredException\") >= 0;\n}","import Feature from \"ol/Feature\";\nimport Geometry from 'ol/geom/Geometry';\nimport { Expression, Parser } from 'expr-eval';\nimport { strReplaceAll } from '../utils/string';\nimport { isClusteredFeature } from './ol-style-helpers';\nexport class ExprEvalContext {\n    private exprCache: {\n        [expr: string]: Expression;\n    };\n    private filterCache: {\n        [expr: string]: Expression;\n    };\n    private clusterExprCache: {\n        [expr: string]: Expression;\n    };\n    private clusterFilterCache: {\n        [expr: string]: Expression;\n    };\n    private parser: Parser;\n    constructor() {\n        this.exprCache = {};\n        this.filterCache = {};\n        this.clusterExprCache = {};\n        this.clusterFilterCache = {};\n        this.parser = new Parser();\n        this.parser.functions.agg_sum = function (collectionProperty: any, property: string) {\n            if (Array.isArray(collectionProperty)) {\n                const res = collectionProperty.reduce((running, currentItem) => running + (currentItem.get(property) ?? 0), 0);\n                return res;\n            }\n            return undefined;\n        };\n        this.parser.functions.arr_size = function(collectionProperty: any) {\n            if (Array.isArray(collectionProperty)) {\n                return collectionProperty.length;\n            }\n            return 1;\n        };\n        this.parser.functions.feat_property = function(feature: any, name: string) {\n            if (feature) {\n                return feature.get(name);\n            } else {\n                return undefined;\n            }\n        }\n    }\n    public addFilter(expr: string) {\n        if (!this.filterCache[expr]) {\n            this.filterCache[expr] = this.parser.parse(expr);\n        }\n    }\n    public addExpr(expr: string) {\n        if (!this.exprCache[expr]) {\n            this.exprCache[expr] = this.parser.parse(expr);\n        }\n    }\n    public addClusterFilter(expr: string) {\n        if (!this.clusterFilterCache[expr]) {\n            this.clusterFilterCache[expr] = this.parser.parse(expr);\n        }\n    }\n    public addClusterExpr(expr: string) {\n        if (!this.clusterExprCache[expr]) {\n            this.clusterExprCache[expr] = this.parser.parse(expr);\n        }\n    }\n    private cleanValues(feat: Feature<Geometry>) {\n        const vals = feat.getProperties();\n        //UGLY: We have no guarantee that the properties in question will not have\n        //spaces in them (that will break evaluation), so force the matter by replacing\n        //spaces with underscores. What this means is if we find a property named \"OFFICE TYPE\", it\n        //will be converted to \"OFFICE_TYPE\"\n        const keys = Object.keys(vals);\n        const cvals: any = {};\n        for (const k of keys) {\n            cvals[strReplaceAll(k, \" \", \"_\")] = vals[k];\n        }\n        return cvals;\n    }\n    public evaluateFilter(feat: Feature<Geometry>): string | undefined {\n        const cvals = this.cleanValues(feat);\n        const cache = isClusteredFeature(feat) ? this.clusterFilterCache : this.filterCache;\n        for (const filter in cache) {\n            // Does this feature match an expression?\n            if (cache[filter].evaluate(cvals) == true) {\n                return filter;\n            }\n        }\n        return undefined;\n    }\n    public evaluate(expr: string, feat: Feature<Geometry>): any {\n        const cvals = this.cleanValues(feat);\n        if (isClusteredFeature(feat)) {\n            this.addClusterExpr(expr);\n            return this.clusterExprCache[expr].evaluate(cvals);\n        }\n        else {\n            this.addExpr(expr);\n            return this.exprCache[expr].evaluate(cvals);\n        }\n    }\n}\n","import { BaseLayerSetOL } from './base-layer-set';\nimport LayerGroup from 'ol/layer/Group';\nimport { Bounds, LayerTransparencySet, Size } from './common';\nimport View from 'ol/View';\nimport Source from 'ol/source/Source';\nimport LayerBase from \"ol/layer/Base\";\nimport TileLayer from \"ol/layer/Tile\";\nimport ImageLayer from \"ol/layer/Image\";\n\nexport const DEFAULT_METERS_PER_UNIT = 1.0;\nconst M_TO_IN = 39.37;\nconst DEFAULT_DPI = 96;\n\n/**\n * @hidden\n */\nexport class GenericLayerSetOL extends BaseLayerSetOL {\n    constructor(view: View,\n        public subjectLayer: LayerBase | undefined,\n        extent: Bounds,\n        externalBaseLayersGroup: LayerGroup | undefined,\n        projection: string,\n        metersPerUnit: number = DEFAULT_METERS_PER_UNIT,\n        dpi: number = DEFAULT_DPI) {\n        super(externalBaseLayersGroup, projection, dpi, extent, M_TO_IN * metersPerUnit, view);\n    }\n    getLayers(): LayerBase[] {\n        const layers: LayerBase[] = [];\n        if (this.externalBaseLayersGroup) {\n            layers.push(this.externalBaseLayersGroup);\n        }\n        if (this.subjectLayer) {\n            layers.push(this.subjectLayer);\n        }\n        return layers;\n    }\n    getSourcesForProgressTracking(): Source[] {\n        const sources: Source[] = [];\n        if (this.externalBaseLayersGroup) {\n            const bls = this.externalBaseLayersGroup.getLayersArray();\n            for (const bl of bls) {\n                if (bl instanceof ImageLayer || bl instanceof TileLayer) {\n                    sources.push(bl.getSource());\n                }\n            }\n        }\n        if (this.subjectLayer instanceof ImageLayer) {\n            sources.push(this.subjectLayer.getSource())\n        } else if (this.subjectLayer instanceof TileLayer) {\n            sources.push(this.subjectLayer.getSource())\n        }\n        return sources;\n    }\n    updateTransparency(trans: LayerTransparencySet): void {\n        //throw new Error(\"Method not implemented.\");\n    }\n    showActiveSelectedFeature(mapExtent: Bounds, size: Size, uri: string): void {\n        //throw new Error(\"Method not implemented.\");\n    }\n    update(showGroups: string[] | undefined, showLayers: string[] | undefined, hideGroups: string[] | undefined, hideLayers: string[] | undefined): void {\n        //throw new Error(\"Method not implemented.\");\n    }\n    updateSelectionColor(color: string): void {\n        //throw new Error(\"Method not implemented.\");\n    }\n}","import { STRINGS_EN } from \"../strings/en\";\nimport { ILocalizedMessages } from \"../strings/msgdef\";\nimport { warn } from '../utils/logger';\n\nexport const DEFAULT_LOCALE = \"en\";\n\nconst STRINGS: { [locale: string]: ILocalizedMessages } = {\n    \"en\": STRINGS_EN\n};\n\n/**\n * Registers a string bundle for the given locale\n *\n * @export\n * @param {string} locale\n * @param {ILocalizedMessages} bundle\n */\nexport function registerStringBundle(locale: string, bundle: ILocalizedMessages) {\n    STRINGS[locale] = bundle;\n}\n\n/**\n * Formats the specified string and substitutes any placeholders (enclosed in {})\n * with the specified arguments\n *\n * @export\n * @param {string} format\n * @param {*} [args]\n * @returns {string}\n */\nexport function fmt(format: string, args?: any): string {\n    let str = format;\n    if (args != null) {\n        for (const p in args) {\n            //str = str.replace(new RegExp(`\\{${p}\\}`, \"g\"), `${args[p]}`);\n            str = str.split(`{${p}}`).join(args[p]);\n        }\n        return str;\n    };\n    return str;\n}\n\n\n/**\n * Returns the localized string for the given key\n * \n * @export\n * @param {keyof ILocalizedMessages} key Any property name of {@link ILocalizedMessages}\n * @param {string} [locale=\"en\"] \n * @param {*} [args] If a localized string has placeholders, they will be replaced with the values defined here\n * @returns {string} \n */\nexport function tr(key: keyof ILocalizedMessages, locale = DEFAULT_LOCALE, args?: any): string {\n    const bundle = STRINGS[locale];\n    if (!bundle) {\n        warn(`No such string bundle for locale: ${locale}`);\n        return key;\n    } else {\n        let str = bundle[key];\n        if (!str) {\n            warn(`String bundle for locale (${locale}) is missing localized string for key: ${key}`);\n            return key;\n        } else {\n            if (args != null) {\n                return fmt(str, args);\n            }\n            return str;\n        }\n    }\n}","import { LayerProperty, ILayerManager, ILayerInfo, IParseFeaturesFromFileOptions, IAddLayerFromParsedFeaturesOptions, SourceProperty, IWmsLayerExtensions, LayerExtensions, Dictionary } from './common';\nimport olSourceVector from \"ol/source/Vector\";\nimport olMap from \"ol/Map\";\nimport olLayerBase from \"ol/layer/Base\";\nimport { setOLVectorLayerStyle } from './ol-style-helpers';\nimport olTileLayer from \"ol/layer/Tile\";\nimport olImageLayer from \"ol/layer/Image\";\nimport olWmsSource from \"ol/source/ImageWMS\";\nimport olTileWmsSource from \"ol/source/TileWMS\";\nimport olVectorLayer from \"ol/layer/Vector\";\nimport olHeatmapLayer from \"ol/layer/Heatmap\";\nimport { getFormatDrivers } from './layer-manager/driver-registry';\nimport { IFormatDriver } from './layer-manager/format-driver';\nimport { tr } from './i18n';\nimport { IParsedFeatures } from './layer-manager/parsed-features';\nimport { LayerSetGroupBase } from './layer-set-group-base';\nimport { IInitialExternalLayer } from '../actions/defs';\nimport { IVectorLayerStyle, DEFAULT_VECTOR_LAYER_STYLE, IClusterSettings, ClusterClickAction, DEFAULT_CLUSTERED_LAYER_STYLE, IBasicVectorPointStyle, IBasicVectorPolygonStyle, IBasicVectorLineStyle, IVectorLabelSettings, ExprOr, IVectorFeatureStyle, IHeatmapSettings } from './ol-style-contracts';\nimport { OLStyleMapSet } from './ol-style-map-set';\nimport { clusterSourceIfRequired } from '../components/external-layer-factory';\nimport colorbrewer from \"colorbrewer\";\nimport { strIsNullOrEmpty } from '../utils/string';\nimport { getMaxRamp } from '../components/layer-manager/color-brewer';\n\nfunction cloneObject<T>(obj: T) {\n    return JSON.parse(JSON.stringify(obj)) as T;\n}\n\nfunction clonePointWithFill(baseTemplate: IBasicVectorPointStyle | undefined, fillColor: string) {\n    if (!baseTemplate) {\n        return undefined;\n    }\n    const clone = cloneObject(baseTemplate);\n    switch (clone.type) {\n        case \"Circle\":\n            clone.fill.color = fillColor;\n            break;\n    }\n    return clone;\n}\nfunction cloneLineWithFill(baseTemplate: IBasicVectorLineStyle | undefined, fillColor: string) {\n    if (!baseTemplate) {\n        return undefined;\n    }\n    const clone = cloneObject(baseTemplate);\n    clone.color = fillColor;\n    return clone;\n}\nfunction clonePolyWithFill(baseTemplate: IBasicVectorPolygonStyle | undefined, fillColor: string) {\n    if (!baseTemplate) {\n        return undefined;\n    }\n    const clone = cloneObject(baseTemplate);\n    clone.fill.color = fillColor;\n    return clone;\n}\nfunction ensureLabelText(style: IVectorLabelSettings, expr: ExprOr<string>, isLine: boolean = false) {\n    if (!style.label) {\n        style.label = {\n            text: expr,\n            textAlign: \"left\",\n            offsetX: 15,\n            fill: {\n                color: \"#000000\",\n                alpha: 255\n            },\n            stroke: {\n                color: \"#ffffff\",\n                alpha: 255,\n                width: 3\n            }\n        };\n        if (isLine) {\n            style.label.placement = \"line\";\n        }\n    } else {\n        style.label.text = expr;\n    }\n}\nfunction ensureLabelTextForStyle(fstyle: IVectorFeatureStyle, expr: ExprOr<string>) {\n    if (fstyle.line) {\n        ensureLabelText(fstyle.line, expr, true);\n    }\n    if (fstyle.point) {\n        ensureLabelText(fstyle.point, expr);\n    }\n    if (fstyle.polygon) {\n        ensureLabelText(fstyle.polygon, expr);\n    }\n}\n\nexport function getLayerInfo(layer: olLayerBase, isExternal: boolean): ILayerInfo {\n    let vectorStyle: IVectorLayerStyle | undefined;\n    let cs: IClusterSettings | undefined;\n    let ext: LayerExtensions | undefined;\n    let hs: IHeatmapSettings | undefined;\n    if (layer instanceof olImageLayer || layer instanceof olTileLayer) {\n        const source = layer.getSource();\n        if (layer.get(LayerProperty.HAS_WMS_LEGEND) == true && (source instanceof olWmsSource || source instanceof olTileWmsSource)) {\n            ext = {\n                type: \"WMS\",\n                getLegendUrl: (res?: number) => source.getLegendUrl(res)\n            } as IWmsLayerExtensions;\n        }\n    }\n    if (layer instanceof olVectorLayer) {\n        const vs: OLStyleMapSet | undefined = layer.get(LayerProperty.VECTOR_STYLE);\n        if (vs) {\n            vectorStyle = vs.toVectorLayerStyle();\n            cs = vs.toClusterSettings();\n        }\n    }\n    if (layer instanceof olHeatmapLayer) {\n        hs = {\n            blur: layer.getBlur(),\n            radius: layer.getRadius()\n        };\n    }\n    return {\n        visible: layer.getVisible(),\n        selectable: layer.get(LayerProperty.IS_SELECTABLE) == true,\n        name: layer.get(LayerProperty.LAYER_NAME),\n        displayName: layer.get(LayerProperty.LAYER_DISPLAY_NAME) ?? layer.get(LayerProperty.LAYER_NAME),\n        description: layer.get(LayerProperty.LAYER_DESCRIPTION),\n        type: layer.get(LayerProperty.LAYER_TYPE),\n        opacity: layer.getOpacity(),\n        isExternal: isExternal,\n        extensions: ext,\n        vectorStyle,\n        cluster: cs,\n        heatmap: hs,\n        busyWorkerCount: layer.get(LayerProperty.BUSY_WORKER_COUNT) ?? 0,\n        metadata: layer.get(LayerProperty.LAYER_METADATA)\n    }\n}\n\nexport class LayerManager implements ILayerManager {\n    private _olFormats: IFormatDriver[];\n    constructor(private map: olMap, private layerSet: LayerSetGroupBase) {\n        this._olFormats = getFormatDrivers();\n    }\n    tryGetSubjectLayer(): olLayerBase | undefined {\n        return this.layerSet.tryGetSubjectLayer();\n    }\n    /**\n     * INTERNAL API\n     * @param {IInitialExternalLayer} extLayer\n     * @returns\n     * @memberof LayerManager\n     */\n    addExternalLayer(extLayer: IInitialExternalLayer, onlyAddIfNotExists: boolean, appSettings: Dictionary<string>) {\n        if (onlyAddIfNotExists && this.hasLayer(extLayer.name)) {\n            return undefined;\n        }\n        return this.layerSet.addExternalLayer(this.map, extLayer, appSettings);\n    }\n    getLayers(): ILayerInfo[] {\n        return this.layerSet.getCustomLayers(this.map);\n    }\n    hasLayer(name: string): boolean {\n        return this.layerSet.hasLayer(name);\n    }\n    addLayer<T extends olLayerBase>(name: string, layer: T, allowReplace?: boolean | undefined): ILayerInfo {\n        return this.layerSet.addLayer(this.map, name, layer, allowReplace);\n    }\n    removeLayer(name: string): olLayerBase | undefined {\n        return this.layerSet.removeLayer(this.map, name);\n    }\n    getLayer<T extends olLayerBase>(name: string): T | undefined {\n        return this.layerSet.getLayer(name);\n    }\n    apply(layers: ILayerInfo[]): void {\n        this.layerSet.apply(this.map, layers);\n    }\n    parseFeaturesFromFile(options: IParseFeaturesFromFileOptions): Promise<IParsedFeatures> {\n        const { file, name: layerName, locale } = options;\n        const that = this;\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            const handler = async function (e: ProgressEvent<FileReader>) {\n                const result = e.target?.result;\n                if (result && typeof (result) == 'string') {\n                    const formats = that._olFormats;\n                    if (formats.length == 0) {\n                        reject(new Error(tr(\"ADD_LOCAL_FILE_LAYER_FAILURE_NO_FORMATS\", locale)));\n                    }\n                    let loadedType: IParsedFeatures | undefined;\n                    let bLoaded = false;\n                    for (let i = 0, ii = formats.length; i < ii; ++i) {\n                        const format = formats[i];\n                        try {\n                            loadedType = await format.tryParse(file.size, result);\n                        } catch (e) {\n                            //console.log(e);\n                        }\n                        if (loadedType && loadedType.hasFeatures()) {\n                            loadedType.name = layerName;\n                            bLoaded = true;\n                            break;\n                        }\n                    }\n                    if (bLoaded && loadedType) {\n                        resolve(loadedType);\n                    } else {\n                        reject(new Error(tr(\"ADD_LOCAL_FILE_LAYER_FAILURE\", locale)));\n                    }\n                } else {\n                    reject(new Error(tr(\"ADD_LOCAL_FILE_LAYER_FAILURE_NOT_TEXT\", locale)));\n                }\n            };\n            reader.addEventListener(\"load\", handler);\n            reader.readAsText(file);\n        });\n    }\n    async addLayerFromParsedFeatures(options: IAddLayerFromParsedFeaturesOptions): Promise<ILayerInfo> {\n        const { features, projection, defaultStyle, extraOptions, labelOnProperty, selectedPopupTemplate, metadata } = options;\n\n        let proj = projection;\n        if (!proj) {\n            const view = this.map.getView();\n            proj = view.getProjection();\n        }\n        const source = new olSourceVector();\n        source.set(SourceProperty.SUPPRESS_LOAD_EVENTS, true);\n\n        let csArgs;\n        if (extraOptions?.kind == \"Cluster\") {\n            csArgs = {\n                distance: extraOptions.clusterDistance\n            };\n        }\n        let layer: olLayerBase;\n        if (extraOptions?.kind == \"Heatmap\") {\n            layer = new olHeatmapLayer({\n                source: source,\n                weight: extraOptions.weightProperty\n            });\n        } else {\n            layer = new olVectorLayer({\n                source: clusterSourceIfRequired(source, { cluster: csArgs }),\n                className: \"external-vector-layer\", //This is to avoid false positives for map.forEachLayerAtPixel\n                declutter: true\n            });\n        }\n        await features.addTo(source, this.map.getView().getProjection(), proj);\n        layer.set(LayerProperty.LAYER_NAME, features.name);\n        layer.set(LayerProperty.LAYER_DISPLAY_NAME, features.name);\n        layer.set(LayerProperty.LAYER_TYPE, features.type);\n        if (extraOptions?.kind == \"Heatmap\") {\n            layer.set(LayerProperty.IS_HEATMAP, true);\n        } else {\n            layer.set(LayerProperty.IS_SELECTABLE, true);\n        }\n        layer.set(LayerProperty.IS_EXTERNAL, true);\n        layer.set(LayerProperty.IS_GROUP, false);\n        if (metadata) {\n            layer.set(LayerProperty.LAYER_METADATA, metadata);\n        }\n        if (selectedPopupTemplate) {\n            layer.set(LayerProperty.SELECTED_POPUP_CONFIGURATION, selectedPopupTemplate);\n        }\n\n        let clusterSettings: IClusterSettings | undefined;\n        if (extraOptions?.kind == \"Cluster\") {\n            clusterSettings = {\n                distance: extraOptions.clusterDistance,\n                onClick: extraOptions.onClusterClickAction ?? ClusterClickAction.ShowPopup,\n                style: cloneObject(extraOptions.clusterStyle ?? defaultStyle ?? DEFAULT_CLUSTERED_LAYER_STYLE)\n            };\n            if (!strIsNullOrEmpty(labelOnProperty)) {\n                for (const k in clusterSettings.style) {\n                    ensureLabelTextForStyle(clusterSettings.style[k], { expr: `if (arr_size(features) == 1, feat_property(features[0], '${labelOnProperty}'), '')` });\n                }\n            }\n        }\n        // Delete irrelevant styles based on geometry types encountered\n        const bStyle: IVectorLayerStyle = defaultStyle ?? cloneObject(DEFAULT_VECTOR_LAYER_STYLE);\n        if (!features.geometryTypes.includes(\"Point\")) {\n            delete bStyle.default.point;\n            delete clusterSettings?.style.default.point;\n        }\n        if (!features.geometryTypes.includes(\"LineString\")) {\n            delete bStyle.default.line;\n            delete clusterSettings?.style.default.line;\n        }\n        if (!features.geometryTypes.includes(\"Polygon\")) {\n            delete bStyle.default.polygon;\n            delete clusterSettings?.style.default.polygon;\n        }\n\n        if (!strIsNullOrEmpty(labelOnProperty)) {\n            ensureLabelTextForStyle(bStyle.default, { expr: labelOnProperty });\n        }\n\n        if (extraOptions?.kind == \"Theme\") {\n            const values = await features.getDistinctValues(extraOptions.themeOnProperty);\n            let baseTemplatePoint = bStyle.default.point;\n            let baseTemplateLine = bStyle.default.line;\n            let baseTemplatePoly = bStyle.default.polygon;\n\n            const th = extraOptions.colorBrewerTheme;\n            let ramp = colorbrewer[th];\n            if (!ramp) {\n                ramp = colorbrewer.Blues;\n            }\n            const chosenRamp = getMaxRamp(ramp);\n            const ruleCount = Math.min(values.length, chosenRamp.length);\n            const palette = ramp[ruleCount];\n            for (let i = 0; i < ruleCount; i++) {\n                const v = values[i];\n                const filter = `${extraOptions.themeOnProperty} == '${v}'`;\n                const style = {\n                    label: v,\n                    point: clonePointWithFill(baseTemplatePoint, palette[i]),\n                    line: cloneLineWithFill(baseTemplateLine, palette[i]),\n                    polygon: clonePolyWithFill(baseTemplatePoly, palette[i]),\n                };\n                if (!strIsNullOrEmpty(labelOnProperty)) {\n                    ensureLabelTextForStyle(style, { expr: labelOnProperty });\n                }\n                (bStyle as any)[filter] = style;\n            }\n        }\n        if (layer instanceof olVectorLayer) {\n            setOLVectorLayerStyle(layer, bStyle, clusterSettings);\n        }\n        const layerInfo = this.addLayer(features.name, layer);\n        return layerInfo;\n    }\n}\n","import GeoJSON from \"ol/format/GeoJSON\";\nimport { IFormatDriver } from \"./format-driver\";\nimport { IParsedFeatures, ParsedFeatures } from './parsed-features';\nimport { strIsNullOrEmpty } from '../../utils/string';\n\nconst Papa = require(\"papaparse\");\n\ninterface IPapaParsedResults {\n    data: any[];\n    errors: {\n        type: string;\n        code: string;\n        message: string;\n        row: number;\n    }[];\n    meta: {\n        delimiter?: string;\n        linebreak?: string;\n        aborted?: boolean;\n        fields?: string[];\n        truncated?: boolean;\n    }\n}\n\nexport class CsvFormatDriver implements IFormatDriver {\n    private type: string;\n    constructor(private aliases: { xColumn: string, yColumn: string }[]) {\n        this.type = \"CSV\";\n    }\n    public tryParse(size: number, text: string): Promise<IParsedFeatures> {\n        const aliases = this.aliases;\n        const type = this.type;\n        return new Promise((resolve, reject) => {\n            Papa.parse(text, {\n                header: true,\n                complete: function (results: IPapaParsedResults) {\n                    if (!results.data || results.data.length == 0) {\n                        reject(new Error(\"No data parsed. Probably not a CSV file\"));\n                    } else {\n                        if (results.meta.fields) {\n                            let parsed: IParsedFeatures | undefined;\n                            //Run through the alias list and see if we get any matches\n                            for (const alias of aliases) {\n                                if (parsed) {\n                                    break;\n                                }\n                                const xc = results.meta.fields.filter(s => s.toLowerCase() == alias.xColumn.toLowerCase())?.[0];\n                                const yc = results.meta.fields.filter(s => s.toLowerCase() == alias.yColumn.toLowerCase())?.[0];\n                                // We found the columns, but before we accept this set, the columns\n                                // in question must be numeric. Being CSV and all, we'll use the most\n                                // scientific method to determine this: Sample the first row of data /s\n                                if (!strIsNullOrEmpty(xc) && !strIsNullOrEmpty(yc)) {\n                                    const first = results.data[0];\n                                    const firstX = parseFloat(first[xc]);\n                                    const firstY = parseFloat(first[yc]);\n                                    if (first && !isNaN(firstX) && !isNaN(firstY)) {\n                                        const json = {\n                                            type: 'FeatureCollection',\n                                            features: [] as any[]\n                                        };\n                                        for (const d of results.data) {\n                                            const x = parseFloat(d[xc]);\n                                            const y = parseFloat(d[yc]);\n                                            if (!isNaN(x) && !isNaN(y)) {\n                                                const f = {\n                                                    type: 'Feature',\n                                                    geometry: {\n                                                        coordinates: [x, y],\n                                                        type: 'Point'\n                                                    },\n                                                    properties: d\n                                                }\n                                                delete f.properties[xc];\n                                                delete f.properties[yc];\n                                                json.features.push(f);\n                                            }\n                                        }\n                                        const fmt = new GeoJSON();\n                                        const features = fmt.readFeatures(json);\n                                        const propNames: string[] = [];\n                                        if (features.length > 0) {\n                                            const first = features[0];\n                                            for (const k of first.getKeys()) {\n                                                if (k == first.getGeometryName()) {\n                                                    continue;\n                                                }\n                                                propNames.push(k);\n                                            }\n                                        }\n                                        const pfs = async () => features;\n                                        parsed = new ParsedFeatures(type, size, pfs, features.length > 0, [\"Point\"], propNames);\n                                        break;\n                                    }\n                                }\n                            }\n                            if (parsed) {\n                                resolve(parsed);\n                            } else {\n                                reject(new Error(\"Data successfully parsed as CSV, but coordinate columns could not be found\"));\n                            }\n                        } else {\n                            reject(new Error(\"No fields found in CSV metadata\"));\n                        }\n                    }\n                }\n            });\n        });\n    }\n}\n\nexport const CSV_COLUMN_ALIASES = [\n    { xColumn: \"lon\", yColumn: \"lat\" },\n    { xColumn: \"lng\", yColumn: \"lat\" },\n    { xColumn: \"longitude\", yColumn: \"latitude\" },\n    { xColumn: \"x\", yColumn: \"y\" },\n    { xColumn: \"easting\", yColumn: \"northing\" }\n];","import { IFormatDriver } from \"./format-driver\";\n\nconst _drivers: IFormatDriver[] = [];\n\nexport function getFormatDrivers() { return _drivers; }\n\nexport function addFormatDriver(driver: IFormatDriver) {\n    _drivers.push(driver);\n}","import { ParsedFeatures, IParsedFeatures } from './parsed-features';\nimport TextFeature from 'ol/format/TextFeature';\nimport JSONFeature from 'ol/format/JSONFeature';\nimport XMLFeature from 'ol/format/XMLFeature';\nimport Geometry from 'ol/geom/Geometry';\n\n/**\n * Defines a format driver for reading plain text into vector features\n *\n * @export\n * @interface IFormatDriver\n * @since 0.13\n */\nexport interface IFormatDriver {\n    /**\n     * Attempts to read the given text content into vector features. A failure\n     * of this driver to parse the features is expressed by returning an object\n     * where calling hasFeatures() on it returns false.\n     *\n     * @param {number} size\n     * @param {string} text\n     * @returns {Promise<IParsedFeatures>}\n     * @memberof IFormatDriver\n     */\n    tryParse(size: number, text: string): Promise<IParsedFeatures>;\n}\n\n/**\n * A default format driver implementation primarily for interfacing with any\n * existing OpenLayers format driver instances\n *\n * @export\n * @class FormatDriver\n * @implements {IFormatDriver}\n * @since 0.13\n */\nexport class FormatDriver implements IFormatDriver {\n    constructor(private type: string, private format: TextFeature | JSONFeature | XMLFeature, private defaultProjection: string | null = null) { }\n    public async tryParse(size: number, text: string): Promise<IParsedFeatures> {\n        const fs = this.format.readFeatures(text);\n        let bHasPoint = false;\n        let bHasLine = false;\n        let bHasPoly = false;\n        for (const f of fs) {\n            const g: Geometry = f.getGeometry();\n            switch (g?.getType()) {\n                case \"Point\":\n                    bHasPoint = true;\n                    break;\n                case \"LineString\":\n                    bHasLine = true;\n                    break;\n                case \"LinearRing\":\n                    bHasLine = true;\n                    break;\n                case \"Polygon\":\n                    bHasPoly = true;\n                    break;\n                case \"MultiPoint\":\n                    bHasPoint = true;\n                    break;\n                case \"MultiLineString\":\n                    bHasLine = true;\n                    break;\n                case \"MultiPolygon\":\n                    bHasPoly = true;\n                    break;\n                case \"GeometryCollection\":\n                    bHasPoint = true;\n                    break;\n                case \"Circle\":\n                    bHasPoly = true;\n                    break;\n            }\n        }\n        let geomTypes: (\"Point\" | \"LineString\" | \"Polygon\")[] = [];\n        if (bHasPoint) {\n            geomTypes.push(\"Point\");\n        }\n        if (bHasLine) {\n            geomTypes.push(\"LineString\");\n        }\n        if (bHasPoly) {\n            geomTypes.push(\"Polygon\");\n        }\n        const propNames: string[] = [];\n        if (fs.length > 0) {\n            const first = fs[0];\n            for (const k of first.getKeys()) {\n                if (k == first.getGeometryName()) {\n                    continue;\n                }\n                propNames.push(k);\n            }\n        }\n        const features = async () => fs;\n        return new ParsedFeatures(this.type, size, features, fs.length > 0, geomTypes, propNames, this.defaultProjection);\n    }\n}","import { ProjectionLike } from 'ol/proj';\nimport olSourceVector from \"ol/source/Vector\";\nimport Geometry from 'ol/geom/Geometry';\nimport Feature from 'ol/Feature';\nimport { strIsNullOrEmpty } from '../../utils/string';\n\n/**\n * Defines parsed features\n * \n * @export\n * @interface IParsedFeatures\n * @since 0.13\n */\nexport interface IParsedFeatures {\n    /**\n     * The name of this source\n     */\n    name: string;\n    /**\n     * Indicates if there are any features. If false, it signals that the parsing attempt failed\n     */\n    hasFeatures(): boolean;\n    /**\n     * The projection of this feature. If not set, the projection is unknown and the user should specify\n     * the projection for these features. If set, it should be the projection used when adding the features\n     * to a vector layer\n     */\n    projection: string | null;\n    /**\n     * The type of the source file\n     */\n    readonly type: string;\n    /**\n     * The size of the source file\n     */\n    readonly size: number;\n    /**\n     * Adds the parsed features from this file to the given vector data source\n     * @param source \n     * @param mapProjection \n     * @param dataProjection \n     * @since 0.14 This method is now async (returns a promise)\n     */\n    addTo(source: olSourceVector<Geometry>, mapProjection: ProjectionLike, dataProjection?: ProjectionLike): Promise<void>;\n    /**\n     * The geometry types encountered in this source file\n     * @since 0.14\n     */\n    geometryTypes: (\"Point\" | \"LineString\" | \"Polygon\")[];\n    /**\n     * The property names of features in this source file. This is generally based on sampling the first feature.\n     * @since 0.14\n     */\n    propertyNames: string[];\n    /**\n     * Get all distinct values for the given property name\n     * @param propertyName\n     * @since 0.14\n     */\n    getDistinctValues(propertyName: string): Promise<string[]>;\n}\n\nexport class ParsedFeatures implements IParsedFeatures {\n    constructor(public type: string,\n        public size: number,\n        private features: () => Promise<Feature<Geometry>[]>,\n        private hasFeaturesFlag: boolean,\n        public geometryTypes: (\"Point\" | \"LineString\" | \"Polygon\")[],\n        public propertyNames: string[],\n        public projection: string | null = null) { }\n    public hasFeatures(): boolean { return this.hasFeaturesFlag; }\n    public name: string;\n    public async addTo(source: olSourceVector<Geometry>, mapProjection: ProjectionLike, dataProjection?: ProjectionLike) {\n        const features = await this.features();\n        if (dataProjection) {\n            for (const f of features) {\n                const g = f.getGeometry();\n                if (g) {\n                    const tg = g.transform(dataProjection, mapProjection)\n                    f.setGeometry(tg);\n                }\n            }\n        }\n        source.addFeatures(features);\n    }\n    public async getDistinctValues(propertyName: string): Promise<string[]> {\n        const values = [] as string[];\n        const features = await this.features();\n        for (const f of features) {\n            const v = f.get(propertyName);\n            if (!strIsNullOrEmpty(v) && !values.includes(v))\n                values.push(v);\n        }\n        return values;\n    }\n}","import LayerBase from \"ol/layer/Base\";\nimport { LayerProperty, IExternalBaseLayer, LayerTransparencySet, RefreshMode, Bounds, Size, ILayerInfo, Dictionary } from './common';\nimport { ILayerSetOL, IImageLayerEvents } from './layer-set-contracts';\nimport Feature from 'ol/Feature';\nimport { isMapGuideImageSource } from './ol-mapguide-source-factory';\nimport { getLayerInfo } from './layer-manager';\nimport { MgError } from './error';\nimport { tr } from './i18n';\nimport { setOLVectorLayerStyle } from './ol-style-helpers';\nimport VectorLayer from \"ol/layer/Vector\";\nimport VectorSource from \"ol/source/Vector\";\nimport Source from 'ol/source/Source';\nimport ImageSource from 'ol/source/Image';\nimport ImageWMSSource from \"ol/source/ImageWMS\";\nimport TileWMSSource from \"ol/source/TileWMS\";\nimport TileImageSource from \"ol/source/TileImage\";\nimport Map from \"ol/Map\";\nimport OverviewMap from \"ol/control/OverviewMap\"\nimport View from 'ol/View';\nimport { IInitialExternalLayer } from '../actions/defs';\nimport { createOLLayerFromSubjectDefn } from '../components/external-layer-factory';\nimport Geometry from 'ol/geom/Geometry';\nimport TileLayer from 'ol/layer/Tile';\nimport UrlTile from 'ol/source/UrlTile';\nimport ImageLayer from 'ol/layer/Image';\nimport { debug } from '../utils/logger';\nimport { OLVectorLayer } from \"./ol-types\";\nimport Fill from \"ol/style/Fill\";\nimport Stroke from \"ol/style/Stroke\";\nimport Style from \"ol/style/Style\";\nimport Text from \"ol/style/Text\";\nimport Heatmap from \"ol/layer/Heatmap\";\n\nconst HIGHLIGHT_STYLE = new Style({\n    stroke: new Stroke({\n        color: '#f00',\n        width: 3,\n    }),\n    fill: new Fill({\n        color: 'rgba(255,0,0,0.1)',\n    }),\n    text: new Text({\n        font: '12px Calibri,sans-serif',\n        fill: new Fill({\n            color: '#000',\n        }),\n        stroke: new Stroke({\n            color: '#f00',\n            width: 3,\n        }),\n    }),\n});\n\nexport abstract class LayerSetGroupBase {\n    protected mainSet: ILayerSetOL;\n    protected overviewSet: ILayerSetOL;\n    protected wmsSelOverlayLayer: OLVectorLayer;\n    protected scratchLayer: OLVectorLayer;\n    protected hoverHighlightLayer: OLVectorLayer;\n    protected _customLayers: {\n        [name: string]: {\n            layer: LayerBase,\n            order: number\n        }\n    };\n    constructor(protected callback: IImageLayerEvents) {\n        this._customLayers = {};\n        this.scratchLayer = new VectorLayer({\n            source: new VectorSource()\n        });\n        this.scratchLayer.set(LayerProperty.LAYER_NAME, \"__SCRATCH__\"); //NOXLATE\n        this.scratchLayer.set(LayerProperty.IS_SCRATCH, true);\n        this.wmsSelOverlayLayer = new VectorLayer({\n            source: new VectorSource()\n        });\n        this.wmsSelOverlayLayer.set(LayerProperty.LAYER_NAME, \"__WMS_SELECTION_OVERLAY__\");\n        this.wmsSelOverlayLayer.set(LayerProperty.IS_WMS_SELECTION_OVERLAY, true);\n        this.hoverHighlightLayer = new VectorLayer({\n            source: new VectorSource(),\n            style: feature => {\n                return HIGHLIGHT_STYLE\n            }\n        });\n        this.hoverHighlightLayer.set(LayerProperty.LAYER_NAME, \"__HOVER_HIGHLIGHT__\"); //NOXLATE\n        this.hoverHighlightLayer.set(LayerProperty.IS_HOVER_HIGHLIGHT, true)\n    }\n    addHighlightedFeature(feature: Feature<Geometry>) {\n        this.hoverHighlightLayer.getSource().addFeature(feature);\n    }\n    removeHighlightedFeature(feature: Feature<Geometry>) {\n        const hs = this.hoverHighlightLayer.getSource();\n        if (hs.hasFeature(feature)) {\n            hs.removeFeature(feature);\n        }\n    }\n    clearHighlightedFeatures() {\n        this.hoverHighlightLayer.getSource().clear();\n    }\n    /**\n     * @virtual\n     * @returns {(LayerBase | undefined)}\n     * @memberof LayerSetGroupBase\n     */\n    public tryGetSubjectLayer(): LayerBase | undefined { return undefined; }\n    public addWmsSelectionOverlay(feat: Feature<Geometry>) {\n        this.wmsSelOverlayLayer.getSource().addFeature(feat);\n    }\n    public clearWmsSelectionOverlay() {\n        this.wmsSelOverlayLayer.getSource().clear();\n    }\n    public addScratchFeature(feat: Feature<Geometry>) {\n        this.scratchLayer.getSource().addFeature(feat);\n    }\n    public clearScratchLayer() {\n        this.scratchLayer.getSource().clear();\n    }\n    public abstract tryGetWmsSource(): [LayerBase, (ImageWMSSource | TileWMSSource)] | undefined;\n    protected registerSourceEvents(source: Source): void {\n        if (source instanceof ImageSource) {\n            source.on(\"imageloadstart\", this.callback.addImageLoading);\n            //onImageError is a MapGuide-specific callback\n            if (isMapGuideImageSource(source)) {\n                source.on(\"imageloaderror\", this.callback.onImageError);\n            }\n            source.on(\"imageloaderror\", this.callback.addImageLoaded);\n            source.on(\"imageloadend\", this.callback.addImageLoaded);\n        } else if (source instanceof TileImageSource) {\n            source.on(\"tileloadstart\", this.callback.addImageLoading);\n            source.on(\"tileloaderror\", this.callback.addImageLoaded);\n            source.on(\"tileloadend\", this.callback.addImageLoaded);\n        }\n    }\n\n    public updateExternalBaseLayers(externalBaseLayers: IExternalBaseLayer[]) {\n        this.mainSet.updateExternalBaseLayers(externalBaseLayers);\n        this.overviewSet.updateExternalBaseLayers(externalBaseLayers);\n    }\n    public updateTransparency = (trans: LayerTransparencySet) => this.mainSet.updateTransparency(trans);\n    public fitViewToExtent = () => this.mainSet.view.fit(this.mainSet.extent);\n    public getView = () => this.mainSet.view;\n    public getDpi = () => this.mainSet.dpi;\n    public getExtent = () => this.mainSet.extent;\n    public getLayersForOverviewMap = () => this.overviewSet.getLayers();\n    public getProjection = () => this.mainSet.projection;\n    public refreshMap = (mode: RefreshMode) => this.mainSet.refreshMap(mode);\n    public showActiveSelectedFeature = (mapExtent: Bounds, size: Size, uri: string) => this.mainSet.showActiveSelectedFeature(mapExtent, size, uri);\n    public getMetersPerUnit = () => this.mainSet.getMetersPerUnit();\n    public scaleToResolution = (scale: number) => this.mainSet.scaleToResolution(scale);\n    public resolutionToScale = (resolution: number) => this.mainSet.resolutionToScale(resolution);\n\n    public attach(map: Map, ovMapControl: OverviewMap, bSetLayers = true): void {\n        // To guard against the possibility that we may be attaching layers to a map that\n        // already has layers (eg. Measurements), we reverse iterate all the layers we need to\n        // add and insert them to the front one-by-one, ensuring all the layers we add will be\n        // at the bottom of the draw order\n        const layers = map.getLayers();\n        // Attach hover layers\n        layers.insertAt(0, this.hoverHighlightLayer);\n        // Attach scratch layer\n        layers.insertAt(0, this.scratchLayer);\n        // Attach custom layers\n        const customLayers = Object.keys(this._customLayers).map(k => this._customLayers[k]);\n        customLayers.sort((a, b) => {\n            return a.order - b.order;\n        });\n        // External layers may have been pre-loaded, to clear out any existing external layers\n        for (const item of customLayers) {\n            layers.remove(item.layer);\n        }\n        for (const item of customLayers) {\n            layers.insertAt(0, item.layer);\n        }\n        // Then the regular layers\n        const allLayers = this.mainSet.getLayers();\n        for (let i = allLayers.length - 1; i >= 0; i--) {\n            layers.insertAt(0, allLayers[i]);\n        }\n        map.setView(this.mainSet.view);\n        if (bSetLayers) {\n            const ovMap = ovMapControl.getOverviewMap();\n            const ovLayers = this.getLayersForOverviewMap();\n            for (const layer of ovLayers) {\n                ovMap.addLayer(layer);\n            }\n            //ol.View has immutable projection, so we have to replace the whole view on the OverviewMap\n            const center = this.mainSet.view.getCenter();\n            if (center) {\n                ovMap.setView(new View({\n                    center: [center[0], center[1]],\n                    resolution: this.mainSet.view.getResolution(),\n                    projection: this.mainSet.view.getProjection()\n                }));\n            } else {\n                const view = new View({\n                    projection: this.mainSet.view.getProjection()\n                });\n                ovMap.setView(view);\n                view.fit(this.mainSet.extent, { size: ovMap.getSize() });\n            }\n        }\n    }\n    public detach(map: Map, ovMapControl: OverviewMap): void {\n        const allLayers = this.mainSet.getLayers();\n        for (const layer of allLayers) {\n            map.removeLayer(layer);\n        }\n        //Detach custom layers\n        for (const layerName in this._customLayers) {\n            map.removeLayer(this._customLayers[layerName].layer);\n        }\n        //Detach scratch layer\n        map.removeLayer(this.scratchLayer);\n        //Detach hover highlight layer\n        map.removeLayer(this.hoverHighlightLayer);\n        const ovLayers = this.getLayersForOverviewMap();\n        const ovMap = ovMapControl.getOverviewMap();\n        for (const layer of ovLayers) {\n            ovMap.removeLayer(layer);\n        }\n    }\n    public getCustomLayers(map: Map): ILayerInfo[] {\n        const larr = map.getLayers().getArray();\n        const layers = larr\n            .filter(l => this._customLayers[l.get(LayerProperty.LAYER_NAME)] != null)\n            .map(l => ({\n                ...getLayerInfo(l, true),\n                //Smuggle these values out for debugging purposes\n                isSelectable: this._customLayers[l.get(LayerProperty.LAYER_NAME)].layer.get(LayerProperty.IS_SELECTABLE) == true,\n                order: this._customLayers[l.get(LayerProperty.LAYER_NAME)].order\n            }));\n        return layers.reverse();\n    }\n    public hasLayer(name: string): boolean {\n        return this._customLayers[name] != null;\n    }\n    public addExternalLayer(map: Map, extLayer: IInitialExternalLayer, appSettings: Dictionary<string>): ILayerInfo {\n        const layer = createOLLayerFromSubjectDefn(extLayer, map.getView().getProjection(), true, appSettings);\n        return this.addLayer(map, extLayer.name, layer);\n    }\n    public addLayer<T extends LayerBase>(map: Map, name: string, layer: T, allowReplace?: boolean): ILayerInfo {\n        const bAllow = !!allowReplace;\n        if (this._customLayers[name]) {\n            if (!bAllow) {\n                throw new MgError(tr(\"LAYER_NAME_EXISTS\", this.callback.getLocale(), { name: name }));\n            } else {\n                //Remove the layer that is about to be replaced first \n                map.removeLayer(this._customLayers[name].layer);\n            }\n        }\n\n        //These layer properties may have already been set, so only set if not set already (display name) or it is different (layer name)\n        if (layer.get(LayerProperty.LAYER_NAME) != name)\n            layer.set(LayerProperty.LAYER_NAME, name);\n        if (!layer.get(LayerProperty.LAYER_DISPLAY_NAME))\n            layer.set(LayerProperty.LAYER_DISPLAY_NAME, name);\n\n        //console.log(`addLayer(): ${layer.get(LayerProperty.LAYER_NAME)}`);\n\n        //HACK: For reasons unknown, measurement layers aren't being cleanly detached/attached during apply() so there is a possibility\n        //we are re-adding this measurement layer (from measure context activation), and the layer is already there!\n        //\n        //So as a nuclear solution, remove the layer we're about to add (as un-intutitive as that sounds!)\n        map.removeLayer(layer);\n        map.addLayer(layer);\n        this._customLayers[name] = { layer, order: map.getLayers().getArray().indexOf(layer) };\n\n        const tileLoaders = this.callback.getTileLoaders();\n        for (const k in tileLoaders) {\n            const func = tileLoaders[k];\n            const layer = this.getLayer(k);\n            if (layer) {\n                if (layer instanceof TileLayer) {\n                    const source = layer.getSource();\n                    if (source instanceof UrlTile) {\n                        source.setTileLoadFunction(func);\n                        debug(`Added custom tile loader for layer: ${k}`);\n                    }/* else {\n                        warn(`Layer has a source is not a valid candidate for adding a custom tile loader: ${k}`);\n                    }*/\n                }/* else {\n                    warn(`Layer is not a valid candidate for adding a custom tile loader: ${k}`);\n                }*/\n            }\n        }\n        const imageLoaders = this.callback.getImageLoaders();\n        for (const k in imageLoaders) {\n            const func = imageLoaders[k];\n            const layer = this.getLayer(k);\n            if (layer) {\n                if (layer instanceof ImageLayer) {\n                    const source: any = layer.getSource();\n                    if (typeof (source.setImageLoadFunction) == 'function') {\n                        source.setImageLoadFunction(func);\n                        debug(`Added custom tile loader for layer: ${k}`);\n                    }/* else {\n                        warn(`Layer has a source is not a valid candidate for adding a custom tile loader: ${k}`);\n                    }*/\n                }/* else {\n                    warn(`Layer is not a valid candidate for adding a custom tile loader: ${k}`);\n                }*/\n            }\n        }\n\n        return {\n            ...getLayerInfo(layer, true),\n            //Smuggle these values out for debugging purposes\n            ...{\n                isSelectable: this._customLayers[name].layer.get(LayerProperty.IS_SELECTABLE) == true,\n                order: this._customLayers[name].order\n            }\n        };\n    }\n    public removeLayer(map: Map, name: string): LayerBase | undefined {\n        let layer: LayerBase;\n        if (this._customLayers[name]) {\n            layer = this._customLayers[name].layer;\n            //console.log(`removeLayer(): ${layer.get(LayerProperty.LAYER_NAME)}`);\n            map.removeLayer(layer);\n            delete this._customLayers[name];\n            return layer;\n        }\n    }\n    public getLayer<T extends LayerBase>(name: string): T | undefined {\n        let layer: T | undefined;\n        if (this._customLayers[name]) {\n            layer = this._customLayers[name]?.layer as T;\n        }\n        return layer;\n    }\n    public apply(map: Map, layers: ILayerInfo[]): void {\n        const layersByName = layers.reduce((current, layer) => {\n            current[layer.name] = layer;\n            return current;\n        }, {} as any);\n        //Apply opacity/visibility/styling and other top-level properties\n        for (const layer of layers) {\n            const oll = this._customLayers[layer.name]?.layer;\n            if (oll) {\n                oll.setVisible(layer.visible);\n                oll.setOpacity(layer.opacity);\n                oll.set(LayerProperty.BUSY_WORKER_COUNT, layer.busyWorkerCount);\n                if (oll instanceof VectorLayer && layer.vectorStyle) {\n                    setOLVectorLayerStyle(oll, layer.vectorStyle, layer.cluster);\n                }\n                if (layer.heatmap) {\n                    if (oll instanceof Heatmap) {\n                        oll.setBlur(layer.heatmap.blur);\n                        oll.setRadius(layer.heatmap.radius);\n                    }\n                }\n            }\n        }\n\n        //Measurement layer is hidden and is not tracked by the layer manager (in terms of round-tripped layer information)\n        //so if it is present in our custom layers set, it may be removed. So if we find it, capture it for restoration\n        let theMeasureLayer: LayerBase | undefined;\n        //Apply removals \n        for (const layerName in this._customLayers) {\n            if (!layersByName[layerName]) {\n                const removed = this.removeLayer(map, layerName);\n                if (removed?.get(LayerProperty.IS_MEASURE) === true) {\n                    //console.log(`Removed measurement layer: ${removed.get(LayerProperty.LAYER_NAME)}`);\n                    theMeasureLayer = removed;\n                }\n            }\n        }\n\n        //Fix order if required\n        //First item, top-most\n        //Last item, bottom-most\n        const cCurrentLayers = map.getLayers();\n        const aCurrentLayers = cCurrentLayers.getArray();\n        const currentLayers = aCurrentLayers.map(l => ({\n            name: l.get(LayerProperty.LAYER_NAME),\n            type: l.get(LayerProperty.LAYER_TYPE),\n            isExternal: l.get(LayerProperty.IS_EXTERNAL),\n            isGroup: l.get(LayerProperty.IS_GROUP),\n            layer: l\n        })).filter(l => l.isExternal == true);\n        //console.assert(currentLayers.length == layers.length);\n        //console.table(currentLayers);\n        //console.table(layers);\n\n        //If sizes don't match, do a full invalidation\n        if (currentLayers.length != layers.length) {\n            //Clear everything custom\n            for (const toRemove of currentLayers) {\n                map.removeLayer(toRemove.layer);\n            }\n            for (const rn in this._customLayers) {\n                const toRemove = this._customLayers[rn];\n                map.removeLayer(toRemove.layer);\n            }\n            //Re-add in order according to layers array\n            for (let i = layers.length - 1; i >= 0; i--) {\n                const item = this._customLayers[layers[i].name];\n                if (item) {\n                    map.addLayer(item.layer);\n                    item.order = cCurrentLayers.getArray().indexOf(item.layer);\n                }\n            }\n        } else { //Otherwise see if we need to re-order\n            let bReorder = false;\n            let ii = 0;\n            for (let i = layers.length - 1; i >= 0; i--) {\n                const layer = layers[i];\n                //console.log(`Checking if layer (${layer.name}) needs re-ordering`);\n                if (layer.name != currentLayers[ii].name) {\n                    bReorder = true;\n                    break;\n                }\n                ii++;\n            }\n            if (bReorder) {\n                //console.log(\"Re-ordering layers\");\n                for (const toRemove of currentLayers) {\n                    map.removeLayer(toRemove.layer);\n                }\n                //Re-add in order according to layers array\n                for (let i = layers.length - 1; i >= 0; i--) {\n                    const toAdd = currentLayers.filter(l => l.name == layers[i].name)[0];\n                    map.addLayer(toAdd.layer);\n                    const item = this._customLayers[layers[i].name];\n                    if (item) {\n                        item.order = cCurrentLayers.getArray().indexOf(toAdd.layer);\n                    }\n                }\n            }\n        }\n        // The scratch layer (where client-side selection overlays and other temp vector features reside) must always be topmost\n        if (cCurrentLayers.item(cCurrentLayers.getLength() - 1) != this.scratchLayer) {\n            map.removeLayer(this.scratchLayer);\n            map.addLayer(this.scratchLayer);\n            //const layers2 = cCurrentLayers.getArray();\n            //console.log(layers2);\n        }\n\n        // And the wms selection overlay layer\n        if (cCurrentLayers.item(cCurrentLayers.getLength() - 1) != this.wmsSelOverlayLayer) {\n            map.removeLayer(this.wmsSelOverlayLayer);\n            map.addLayer(this.wmsSelOverlayLayer);\n            //const layers2 = cCurrentLayers.getArray();\n            //console.log(layers2);\n        }\n\n        // And the hover highlight layer on top of that\n        if (cCurrentLayers.item(cCurrentLayers.getLength() - 1) != this.hoverHighlightLayer) {\n            map.removeLayer(this.hoverHighlightLayer);\n            map.addLayer(this.hoverHighlightLayer);\n            //const layers2 = cCurrentLayers.getArray();\n            //console.log(layers2);\n        }\n\n        // And then the measurement layer, if present\n        if (theMeasureLayer) {\n            if (cCurrentLayers.item(cCurrentLayers.getLength() - 1) != theMeasureLayer) {\n                map.removeLayer(theMeasureLayer);\n                map.addLayer(theMeasureLayer);\n                //console.log(`Re-adding measurement layer: ${theMeasureLayer.get(LayerProperty.LAYER_NAME)}`);\n            }\n        }\n    }\n}","import { RefreshMode, IExternalBaseLayer, Bounds, LayerTransparencySet, LayerProperty, MgBuiltInLayers, MgLayerType, MG_LAYER_TYPE_NAME, MG_BASE_LAYER_GROUP_NAME, ILayerInfo, ImageFormat, GenericEvent, ClientKind, Coordinate2D, Size, BLANK_SIZE, Dictionary } from './common';\nimport LayerGroup from \"ol/layer/Group\";\nimport TileGrid from \"ol/tilegrid/TileGrid\";\nimport AbstractSource from \"ol/source/Source\";\nimport TileImageSource from \"ol/source/TileImage\";\nimport { createMapGuideSource } from \"./ol-mapguide-source-factory\";\nimport ImageStaticSource from \"ol/source/ImageStatic\";\nimport { restrictToRange } from \"../utils/number\";\nimport View from \"ol/View\";\nimport * as olExtent from \"ol/extent\";\nimport TileLayer from \"ol/layer/Tile\";\nimport ImageLayer from \"ol/layer/Image\";\nimport LayerBase from \"ol/layer/Base\";\nimport { RuntimeMap } from './contracts/runtime-map';\nimport { createExternalSource, createOLLayerFromSubjectDefn } from '../components/external-layer-factory';\nimport { strIsNullOrEmpty } from '../utils/string';\nimport { parseUrl } from '../utils/url';\nimport ImageWrapper from 'ol/Image';\nimport { DEFAULT_LOCALE, tr } from './i18n';\nimport * as olHas from \"ol/has\";\nimport Feature from \"ol/Feature\";\nimport { debug } from '../utils/logger';\nimport { Client } from './client';\nimport { ILayerSetOL, IImageLayerEvents } from './layer-set-contracts';\nimport Geometry from 'ol/geom/Geometry';\nimport UrlTile from 'ol/source/UrlTile';\nimport { LoadFunction as TileLoadFunction } from 'ol/Tile';\nimport { MapGuideMockMode } from '../components/mapguide-debug-context';\nimport { BLANK_GIF_DATA_URI, LAYER_ID_BASE, LAYER_ID_MG_BASE, LAYER_ID_MG_SEL_OVERLAY } from '../constants';\nimport { OLImageLayer, OLTileLayer } from './ol-types';\nimport { IGenericSubjectMapLayer } from '../actions/defs';\nimport { GenericLayerSetOL } from './generic-layer-set';\nimport { get } from \"ol/proj\";\nimport { isRuntimeMap } from '../utils/type-guards';\nimport { MgError } from './error';\nimport { Source } from 'webpack-sources';\n\nconst DEFAULT_BOUNDS_3857: Bounds = [\n    -20026376.39,\n    -20048966.10,\n    20026376.39,\n    20048966.10\n];\nconst DEFAULT_BOUNDS_4326: Bounds = [-180, -90, 180, 90];\n\nfunction getMetersPerUnit(projection: string) {\n    const proj = get(projection);\n    return proj.getMetersPerUnit();\n}\n\nexport function blankImageLoadFunction(image: ImageWrapper) {\n    (image.getImage() as any).src = BLANK_GIF_DATA_URI;\n}\n\nexport function mockMapGuideImageLoadFunction(image: ImageWrapper, src: string) {\n    let el = document.getElementById(\"mg-debug-text-canvas\");\n    if (!el) {\n        el = document.createElement(\"canvas\");\n        el.style.visibility = \"hidden\";\n        el.id = \"mg-debug-text-canvas\";\n        document.body.append(el);\n    }\n    const tCtx = (el as HTMLCanvasElement).getContext(\"2d\");\n    if (tCtx) {\n        tCtx.clearRect(0, 0, tCtx.canvas.width, tCtx.canvas.height);\n\n        const strings = [];\n        const parsed = parseUrl(src);\n        strings.push(\"[Mock MapGuide Map Image Request]\");\n        strings.push(`Agent: ${parsed.url}`);\n\n        const xoff = 10;\n        const yoff = 30;\n        const fontSize = 14;\n        let mm = tCtx.measureText(strings[0])\n        let maxSize = mm.width + xoff;\n\n        let ch = yoff + fontSize + 2;\n\n        maxSize = Math.max(tCtx.measureText(strings[1]).width + xoff, maxSize);\n        ch += (fontSize + 2);\n\n        const keys = Object.keys(parsed.query);\n        for (const k of keys) {\n            if (k == \"MAPNAME\" || k == \"SETDISPLAYWIDTH\" || k == \"SETDISPLAYHEIGHT\" || k == \"SETVIEWCENTERX\" || k == \"SETVIEWCENTERY\" || k == \"SETVIEWSCALE\") {\n                if (!strIsNullOrEmpty(parsed.query[k])) {\n                    const s = `${k}: ${parsed.query[k]}`;\n                    strings.push(s);\n                    maxSize = Math.max(tCtx.measureText(s).width + xoff, maxSize);\n                    ch += (fontSize + 2);\n                }\n            }\n        }\n\n        tCtx.canvas.width = maxSize;\n        tCtx.canvas.height = ch;\n        tCtx.fillStyle = \"rgba(255, 0, 0, 0.5)\";\n        tCtx.fillRect(0, 0, maxSize, ch);\n\n        tCtx.fillStyle = \"rgba(255, 255, 0, 1.0)\";\n        //console.log(`Canvas size: [${tCtx.canvas.width}, ${tCtx.canvas.height}]`);\n        tCtx.font = `${fontSize}px sans-serif`;\n\n        let y = yoff;\n        for (const str of strings) {\n            //console.log(`Draw (${str}) at [10, ${y}]`);\n            tCtx.fillText(str, 10, y);\n            y += (fontSize + 1);\n        }\n        (image.getImage() as any).src = tCtx.canvas.toDataURL();\n    }\n}\n\nexport enum MgLayerSetMode {\n    Stateless,\n    Stateful,\n    OverviewMap\n}\n\n/**\n * @hidden\n */\nexport class MgLayerSetOL implements ILayerSetOL {\n    constructor(public readonly mgTiledLayers: OLTileLayer[],\n        public readonly externalBaseLayersGroup: LayerGroup | undefined,\n        public readonly overlay: OLImageLayer,\n        public readonly projection: string | undefined,\n        public readonly dpi: number,\n        public readonly extent: Bounds,\n        private readonly inPerUnit: number,\n        public readonly view: View) { }\n\n    public selectionOverlay: OLImageLayer | undefined;\n    public activeSelectedFeatureOverlay: OLImageLayer | undefined;\n\n    public getMetersPerUnit(): number {\n        return this.inPerUnit / 39.37\n    }\n    public scaleToResolution(scale: number): number {\n        return (scale / this.inPerUnit / this.dpi) * olHas.DEVICE_PIXEL_RATIO;\n    }\n    public resolutionToScale(resolution: number): number {\n        return (resolution * this.dpi * this.inPerUnit) / olHas.DEVICE_PIXEL_RATIO;\n    }\n    public getSourcesForProgressTracking(): AbstractSource[] {\n        const sources: AbstractSource[] = [];\n        if (this.externalBaseLayersGroup) {\n            const bls = this.externalBaseLayersGroup.getLayersArray();\n            for (const bl of bls) {\n                if (bl instanceof ImageLayer || bl instanceof TileLayer) {\n                    sources.push(bl.getSource());\n                }\n            }\n        }\n        for (let i = this.mgTiledLayers.length - 1; i >= 0; i--) {\n            sources.push(this.mgTiledLayers[i].getSource());\n        }\n        sources.push(this.overlay.getSource());\n        if (this.selectionOverlay) {\n            sources.push(this.selectionOverlay.getSource());\n        }\n        if (this.activeSelectedFeatureOverlay) {\n            sources.push(this.activeSelectedFeatureOverlay.getSource());\n        }\n        return sources;\n    }\n    public getLayers(): LayerBase[] {\n        const layers: LayerBase[] = [];\n        if (this.externalBaseLayersGroup) {\n            layers.push(this.externalBaseLayersGroup);\n        }\n        for (let i = this.mgTiledLayers.length - 1; i >= 0; i--) {\n            layers.push(this.mgTiledLayers[i]);\n        }\n        layers.push(this.overlay);\n        if (this.selectionOverlay) {\n            layers.push(this.selectionOverlay);\n        }\n        if (this.activeSelectedFeatureOverlay) {\n            layers.push(this.activeSelectedFeatureOverlay);\n        }\n        return layers;\n    }\n    public update(showGroups: string[] | undefined, showLayers: string[] | undefined, hideGroups: string[] | undefined, hideLayers: string[] | undefined) {\n        //Send the request\n        const imgSource = this.overlay.getSource() as any; //olMapGuideSource;\n        //NOTE: Even if these group ids being shown/hidden are MG base layer groups, it still has to be\n        //done as the server-side snapshot of the runtime map needs to be aware as well. This will be\n        //apparent if you were to plot a runtime-map server-side that has base layer groups.\n        imgSource.updateParams({\n            showlayers: showLayers,\n            showgroups: showGroups,\n            hidelayers: hideLayers,\n            hidegroups: hideGroups\n        });\n        //As MG base layer groups are separate ol layer instances, we have to toggle them on the client-side as well\n        if (showGroups && showGroups.length > 0) {\n            for (const groupId of showGroups) {\n                const match = this.mgTiledLayers.filter(l => l.get(LayerProperty.LAYER_NAME) === groupId);\n                if (match.length == 1) {\n                    match[0].setVisible(true);\n                }\n            }\n        }\n        if (hideGroups && hideGroups.length > 0) {\n            for (const groupId of hideGroups) {\n                const match = this.mgTiledLayers.filter(l => l.get(LayerProperty.LAYER_NAME) === groupId);\n                if (match.length == 1) {\n                    match[0].setVisible(false);\n                }\n            }\n        }\n    }\n    public updateSelectionColor(color: string) {\n        if (this.selectionOverlay) {\n            const source = this.selectionOverlay.getSource() as any; // olMapGuideSource;\n            source.updateParams({\n                SELECTIONCOLOR: color\n            });\n        }\n    }\n    public updateExternalBaseLayers(externalBaseLayers: IExternalBaseLayer[]) {\n        if (this.externalBaseLayersGroup) {\n            const layers = this.externalBaseLayersGroup.getLayers();\n            layers.forEach((l: LayerBase) => {\n                const match = (externalBaseLayers || []).filter(el => el.name === l.get(\"title\"));\n                if (match.length == 1) {\n                    l.setVisible(!!match[0].visible);\n                } else {\n                    l.setVisible(false);\n                }\n            });\n        }\n    }\n    public updateTransparency(trans: LayerTransparencySet) {\n        //If no external layers defined, this won't be set\n        if (this.externalBaseLayersGroup) {\n            if (LAYER_ID_BASE in trans) {\n                this.externalBaseLayersGroup.setOpacity(restrictToRange(trans[LAYER_ID_BASE], 0, 1.0));\n            } else {\n                this.externalBaseLayersGroup.setOpacity(1.0);\n            }\n        }\n\n        if (LAYER_ID_MG_BASE in trans) {\n            const opacity = restrictToRange(trans[LAYER_ID_MG_BASE], 0, 1.0);\n            this.overlay.setOpacity(opacity);\n            for (const group of this.mgTiledLayers) {\n                group.setOpacity(opacity);\n            }\n        } else {\n            this.overlay.setOpacity(1.0);\n            for (const group of this.mgTiledLayers) {\n                group.setOpacity(1.0);\n            }\n        }\n\n        if (this.selectionOverlay) {\n            if (LAYER_ID_MG_SEL_OVERLAY in trans) {\n                this.selectionOverlay.setOpacity(restrictToRange(trans[LAYER_ID_MG_SEL_OVERLAY], 0, 1.0));\n            } else {\n                this.selectionOverlay.setOpacity(1.0);\n            }\n        }\n    }\n    public refreshMap(mode: RefreshMode = RefreshMode.LayersOnly | RefreshMode.SelectionOnly): void {\n        if ((mode & RefreshMode.LayersOnly) == RefreshMode.LayersOnly) {\n            const imgSource = this.overlay.getSource() as any; // olMapGuideSource;\n            imgSource.updateParams({\n                seq: (new Date()).getTime()\n            });\n        }\n        if (this.selectionOverlay) {\n            if ((mode & RefreshMode.SelectionOnly) == RefreshMode.SelectionOnly) {\n                const imgSource = this.selectionOverlay.getSource() as any; // olMapGuideSource;\n                imgSource.updateParams({\n                    seq: (new Date()).getTime()\n                });\n            }\n        }\n    }\n    private makeActiveSelectedFeatureSource(mapExtent: Bounds, size: Size, url: string = BLANK_GIF_DATA_URI) {\n        return new ImageStaticSource({\n            imageExtent: mapExtent,\n            imageSize: [size.w, size.h],\n            url: url\n        });\n    }\n    public showActiveSelectedFeature(mapExtent: Bounds, size: Size, uri: string) {\n        if (this.activeSelectedFeatureOverlay) {\n            this.activeSelectedFeatureOverlay.setSource(this.makeActiveSelectedFeatureSource(mapExtent, size, uri));\n            this.activeSelectedFeatureOverlay.setVisible(true);\n        }\n    }\n}\n\nexport interface IMapViewerContextCallback {\n    getMockMode(): MapGuideMockMode | undefined;\n    incrementBusyWorker(): void;\n    decrementBusyWorker(): void;\n    addImageLoading(): void;\n    addImageLoaded(): void;\n    onImageError(e: GenericEvent): void;\n    onSessionExpired(): void;\n    getSelectableLayers(): string[];\n    getClient(): Client;\n    isContextMenuOpen(): boolean;\n    getAgentUri(): string;\n    getAgentKind(): ClientKind;\n    getMapName(): string;\n    getSessionId(): string;\n    getLocale(): string | undefined;\n    isFeatureTooltipEnabled(): boolean;\n    getPointSelectionBox(point: Coordinate2D): Bounds;\n    openTooltipLink(url: string): void;\n    addFeatureToHighlight(feat: Feature<Geometry> | undefined, bAppend: boolean): void;\n    getBaseTileLoaders(): Dictionary<TileLoadFunction>;\n}\n\nexport interface ILayerSetFactory {\n    create(locale: string | undefined,\n        externalBaseLayers: IExternalBaseLayer[] | undefined,\n        mode: MgLayerSetMode,\n        appSettings: Dictionary<string>): ILayerSetOL\n}\n\nexport class MgInnerLayerSetFactory implements ILayerSetFactory {\n    private dynamicOverlayParams: any;\n    private staticOverlayParams: any;\n    private selectionOverlayParams: any;\n    constructor(private callback: IMapViewerContextCallback,\n        private map: RuntimeMap | IGenericSubjectMapLayer,\n        private agentUri: string | undefined,\n        imageFormat: string,\n        selectionImageFormat: string | undefined,\n        selectionColor: string | undefined) {\n        if (isRuntimeMap(map)) {\n            this.dynamicOverlayParams = {\n                MAPNAME: map.Name,\n                FORMAT: imageFormat,\n                SESSION: map.SessionId,\n                BEHAVIOR: 2\n            };\n            this.staticOverlayParams = {\n                MAPDEFINITION: map.MapDefinition,\n                FORMAT: imageFormat,\n                CLIENTAGENT: \"ol.source.ImageMapGuide for OverviewMap\",\n                USERNAME: \"Anonymous\",\n                VERSION: \"3.0.0\"\n            };\n            this.selectionOverlayParams = {\n                MAPNAME: map.Name,\n                FORMAT: selectionImageFormat || \"PNG8\",\n                SESSION: map.SessionId,\n                SELECTIONCOLOR: selectionColor,\n                BEHAVIOR: 1 | 4 //selected features + include outside current scale\n            };\n        }\n    }\n    private getTileUrlFunctionForGroup(resourceId: string, groupName: string, zOrigin: number) {\n        const urlTemplate = this.callback.getClient().getTileTemplateUrl(resourceId, groupName, '{x}', '{y}', '{z}');\n        return function (tileCoord: [number, number, number]) {\n            const z = tileCoord[0];\n            const x = tileCoord[1];\n            const y = tileCoord[2]; //NOTE: tileCoord format changed in OL 6.0, no longer need to negate and subtract by 1\n            return urlTemplate\n                .replace('{z}', (zOrigin - z).toString())\n                .replace('{x}', x.toString())\n                .replace('{y}', (y).toString());\n        };\n    }\n    public create(locale: string | undefined,\n        externalBaseLayers: IExternalBaseLayer[] | undefined,\n        mode: MgLayerSetMode,\n        appSettings: Dictionary<string>): ILayerSetOL {\n        const { map, agentUri } = this;\n        if (isRuntimeMap(map)) {\n            if (strIsNullOrEmpty(agentUri)) {\n                throw new MgError(\"Expected agentUri to be set\");\n            }\n            //If a tile set definition is defined it takes precedence over the map definition, this enables\n            //this example to work with older releases of MapGuide where no such resource type exists.\n            const resourceId = map.TileSetDefinition || map.MapDefinition;\n            //On MGOS 2.6 or older, tile width/height is never returned, so default to 300x300\n            const tileWidth = map.TileWidth || 300;\n            const tileHeight = map.TileHeight || 300;\n            const metersPerUnit = map.CoordinateSystem.MetersPerUnit;\n            const finiteScales = [] as number[];\n            if (map.FiniteDisplayScale) {\n                for (let i = map.FiniteDisplayScale.length - 1; i >= 0; i--) {\n                    finiteScales.push(map.FiniteDisplayScale[i]);\n                }\n            }\n            const extent: olExtent.Extent = [\n                map.Extents.LowerLeftCoordinate.X,\n                map.Extents.LowerLeftCoordinate.Y,\n                map.Extents.UpperRightCoordinate.X,\n                map.Extents.UpperRightCoordinate.Y\n            ];\n            const dpi = map.DisplayDpi;\n            const inPerUnit = 39.37 * map.CoordinateSystem.MetersPerUnit;\n            const resolutions = new Array(finiteScales.length);\n            let projection: string | undefined;\n            for (let i = 0; i < finiteScales.length; ++i) {\n                resolutions[i] = finiteScales[i] / inPerUnit / dpi;\n            }\n\n            if (map.CoordinateSystem.EpsgCode.length > 0) {\n                projection = `EPSG:${map.CoordinateSystem.EpsgCode}`;\n            }\n\n            const tileGrid = new TileGrid({\n                origin: olExtent.getTopLeft(extent),\n                resolutions: resolutions,\n                tileSize: [tileWidth, tileHeight]\n            });\n\n            const zOrigin = finiteScales.length - 1;\n            const mgTiledLayers = [];\n\n            //const groupLayers = [] as TileLayer[];\n            if (map.Group) {\n                for (let i = 0; i < map.Group.length; i++) {\n                    const group = map.Group[i];\n                    if (group.Type != 2 && group.Type != 3) { //BaseMap or LinkedTileSet\n                        continue;\n                    }\n                    const tileSource = new TileImageSource({\n                        tileGrid: tileGrid,\n                        projection: projection,\n                        tileUrlFunction: this.getTileUrlFunctionForGroup(resourceId, group.Name, zOrigin),\n                        wrapX: false\n                    });\n                    const tileLayer = new TileLayer({\n                        //name: group.Name,\n                        source: tileSource\n                    });\n                    tileLayer.set(LayerProperty.LAYER_NAME, group.ObjectId);\n                    tileLayer.set(LayerProperty.LAYER_DISPLAY_NAME, group.ObjectId);\n                    tileLayer.set(LayerProperty.LAYER_TYPE, MgLayerType.Tiled);\n                    tileLayer.set(LayerProperty.IS_EXTERNAL, false);\n                    tileLayer.set(LayerProperty.IS_GROUP, false);\n                    tileLayer.setVisible(group.Visible);\n                    //groupLayers.push(tileLayer);\n                    mgTiledLayers.push(tileLayer);\n                }\n            }\n            /*\n            if (groupLayers.length > 0) {\n                groupLayers.push(\n                    new ol.layer.Tile({\n                        source: new ol.source.TileDebug({\n                            tileGrid: tileGrid,\n                            projection: projection,\n                            tileUrlFunction: function(tileCoord) {\n                                const z = tileCoord[0];\n                                const x = tileCoord[1];\n                                const y = tileCoord[2]; //NOTE: tileCoord format changed in OL 6.0, no longer need to negate and subtract by 1\n                                return urlTemplate\n                                    .replace('{z}', (zOrigin - z).toString())\n                                    .replace('{x}', x.toString())\n                                    .replace('{y}', (y).toString());\n                            },\n                            wrapX: false\n                        })\n                    })\n                );\n            }\n            */\n            const overlay = this.createMgOverlayLayer(MgBuiltInLayers.Overlay, agentUri, locale, metersPerUnit, projection, mode == MgLayerSetMode.Stateful, mode == MgLayerSetMode.Stateful ? this.dynamicOverlayParams : this.staticOverlayParams);\n\n            let selectionOverlay: OLImageLayer | undefined;\n            let activeSelectedFeatureOverlay: OLImageLayer | undefined;\n            if (mode == MgLayerSetMode.Stateful) {\n                selectionOverlay = this.createMgOverlayLayer(MgBuiltInLayers.SelectionOverlay, agentUri, locale, metersPerUnit, projection, true, this.selectionOverlayParams);\n            }\n            if (mode == MgLayerSetMode.Stateful) {\n                //NOTE: Not tracking this source atm\n                activeSelectedFeatureOverlay = new ImageLayer({\n                    //OL6: need to specify a source up-front otherwise it will error blindly\n                    //trying to get a source out of this URL, so set up a source with an empty\n                    //image data URI, it will be updated if we receive a request to show an\n                    //active selected feature image\n                    source: new ImageStaticSource({\n                        imageExtent: extent,\n                        imageSize: [BLANK_SIZE.w, BLANK_SIZE.h],\n                        url: BLANK_GIF_DATA_URI\n                    })\n                });\n                activeSelectedFeatureOverlay.set(LayerProperty.LAYER_NAME, MgBuiltInLayers.ActiveFeatureSelectionOverlay);\n                activeSelectedFeatureOverlay.set(LayerProperty.LAYER_DISPLAY_NAME, MgBuiltInLayers.ActiveFeatureSelectionOverlay);\n                activeSelectedFeatureOverlay.set(LayerProperty.LAYER_TYPE, MG_LAYER_TYPE_NAME);\n                activeSelectedFeatureOverlay.set(LayerProperty.IS_EXTERNAL, false)\n                activeSelectedFeatureOverlay.set(LayerProperty.IS_GROUP, false);\n            }\n            let externalBaseLayersGroup: LayerGroup | undefined;\n            //NOTE: Don't bother adding external base layers for overview map as the main map in the\n            //overview is rendered with GETMAPIMAGE and not GETDYNAMICMAPOVERLAYIMAGE meaning the background\n            //is opaque and you won't be able to see the base layers underneath anyways.\n            if (mode != MgLayerSetMode.OverviewMap && externalBaseLayers != null) {\n                const groupOpts: any = {\n                    title: tr(\"EXTERNAL_BASE_LAYERS\", locale),\n                    layers: externalBaseLayers.map(ext => {\n                        const tl = this.createExternalBaseLayer(ext);\n                        return tl;\n                    })\n                };\n                externalBaseLayersGroup = new LayerGroup(groupOpts);\n                externalBaseLayersGroup.set(LayerProperty.LAYER_NAME, MG_BASE_LAYER_GROUP_NAME);\n                externalBaseLayersGroup.set(LayerProperty.LAYER_DISPLAY_NAME, MG_BASE_LAYER_GROUP_NAME);\n                externalBaseLayersGroup.set(LayerProperty.IS_EXTERNAL, false);\n                externalBaseLayersGroup.set(LayerProperty.IS_GROUP, true);\n            }\n\n            debug(`Creating OL view with projection ${projection} and ${resolutions.length} resolutions`);\n            let view: View;\n            if (resolutions.length == 0) {\n                view = new View({\n                    projection: projection\n                });\n            } else {\n                view = new View({\n                    projection: projection,\n                    resolutions: resolutions\n                });\n            }\n\n            const layerSet = new MgLayerSetOL(mgTiledLayers,\n                externalBaseLayersGroup,\n                overlay,\n                projection,\n                dpi,\n                extent as Bounds,\n                inPerUnit,\n                view);\n            layerSet.selectionOverlay = selectionOverlay;\n            layerSet.activeSelectedFeatureOverlay = activeSelectedFeatureOverlay;\n            return layerSet;\n        } else {\n            let projection = map?.meta?.projection;\n            let bounds: Bounds | undefined;\n            let externalBaseLayersGroup: LayerGroup | undefined;\n            if (externalBaseLayers != null) {\n                const groupOpts: any = {\n                    title: tr(\"EXTERNAL_BASE_LAYERS\", locale),\n                    layers: externalBaseLayers.map(ext => {\n                        const tl = this.createExternalBaseLayer(ext);\n                        return tl;\n                    })\n                };\n                externalBaseLayersGroup = new LayerGroup(groupOpts);\n                externalBaseLayersGroup.set(LayerProperty.LAYER_NAME, MG_BASE_LAYER_GROUP_NAME);\n                externalBaseLayersGroup.set(LayerProperty.IS_EXTERNAL, false);\n                externalBaseLayersGroup.set(LayerProperty.IS_GROUP, true);\n                projection = \"EPSG:3857\";\n                bounds = DEFAULT_BOUNDS_3857;\n            }\n            let subjectLayer;\n            if (map) {\n                subjectLayer = createOLLayerFromSubjectDefn(map, projection, false, appSettings);\n                if (map.meta) {\n                    projection = map.meta.projection;\n                    bounds = map.meta.extents;\n                }\n            }\n            if (!projection && !bounds) {\n                projection = \"EPSG:4326\";\n                bounds = DEFAULT_BOUNDS_4326;\n            }\n            const metersPerUnit = getMetersPerUnit(projection!);\n            const view = new View({\n                projection: projection\n            });\n            return new GenericLayerSetOL(view, subjectLayer, bounds!, externalBaseLayersGroup, projection!, metersPerUnit);\n        }\n    }\n    private createExternalBaseLayer(ext: IExternalBaseLayer) {\n        const extSource = createExternalSource(ext);\n        if (extSource instanceof UrlTile) {\n            const loaders = this.callback.getBaseTileLoaders();\n            if (loaders[ext.name])\n                extSource.setTileLoadFunction(loaders[ext.name]);\n        }\n        const options: any = {\n            title: ext.name,\n            type: \"base\",\n            visible: ext.visible === true,\n            source: extSource\n        };\n        const tl = new TileLayer(options);\n        tl.set(LayerProperty.LAYER_TYPE, ext.kind);\n        tl.set(LayerProperty.LAYER_NAME, ext.name);\n        tl.set(LayerProperty.LAYER_DISPLAY_NAME, ext.name);\n        tl.set(LayerProperty.IS_EXTERNAL, false);\n        tl.set(LayerProperty.IS_GROUP, false);\n        return tl;\n    }\n    private createMgOverlayLayer(layerName: string, agentUri: string, locale: string | undefined, metersPerUnit: number, projection: string | undefined, useImageOverlayOp: boolean, params: any): OLImageLayer {\n        const overlaySource = createMapGuideSource({\n            projection: projection,\n            url: agentUri,\n            useOverlay: useImageOverlayOp,\n            metersPerUnit: metersPerUnit,\n            params: params,\n            ratio: 1,\n            // For mobile devices with retina/hidpi displays, the default 96 DPI produces\n            // really low quality map images. For such devices, the DPI should be some\n            // function of the device pixel ratio reported. As this value can be fractional\n            // round it down to the nearest integer\n            displayDpi: Math.floor(olHas.DEVICE_PIXEL_RATIO) * 96\n        });\n        overlaySource.setAttributions(tr(\"PBMG\", locale ?? DEFAULT_LOCALE));\n        const layer = new ImageLayer({\n            //name: \"MapGuide Dynamic Overlay\",\n            source: overlaySource\n        });\n        layer.set(LayerProperty.LAYER_NAME, layerName);\n        layer.set(LayerProperty.LAYER_DISPLAY_NAME, layerName);\n        layer.set(LayerProperty.LAYER_TYPE, MG_LAYER_TYPE_NAME);\n        layer.set(LayerProperty.IS_EXTERNAL, false);\n        layer.set(LayerProperty.IS_GROUP, false);\n        return layer;\n    }\n}\n\nexport interface IMgLayerSetProps {\n    /**\n     * @since 0.14 This property can now also be a IGenericSubjectMapLayer\n     */\n    map: RuntimeMap | IGenericSubjectMapLayer;\n    /**\n     * Use stateless GETMAP requests for map rendering\n     * @since 0.14\n     */\n    stateless?: boolean;\n    imageFormat: ImageFormat;\n    selectionImageFormat?: ImageFormat;\n    selectionColor?: string;\n    /**\n     * @since 0.14 Made optional\n     */\n    agentUri?: string;\n    externalBaseLayers?: IExternalBaseLayer[];\n    locale?: string;\n    /**\n     * @since 0.14\n     */\n    appSettings: Dictionary<string>;\n}\n\nexport interface IMgLayerSetCallback extends IImageLayerEvents {\n    getMockMode(): MapGuideMockMode | undefined;\n    incrementBusyWorker(): void;\n    decrementBusyWorker(): void;\n    onSessionExpired(): void;\n    getSelectableLayers(): string[];\n    getClient(): Client;\n    isContextMenuOpen(): boolean;\n    getAgentUri(): string;\n    getAgentKind(): ClientKind;\n    getMapName(): string;\n    getSessionId(): string;\n    isFeatureTooltipEnabled(): boolean;\n    getPointSelectionBox(point: Coordinate2D): Bounds;\n    openTooltipLink(url: string): void;\n    addFeatureToHighlight(feat: Feature<Geometry> | undefined, bAppend: boolean): void;\n}\n\n\n\n","export class Lazy<T> {\n    private _value: T | undefined;\n    constructor(private value: () => T) { }\n    public getValue() { \n        if (!this._value) {\n            this._value = this.value();\n        }\n        return this._value;\n    }\n}\n\nexport class AsyncLazy<T> {\n    private _value: Promise<T> | undefined;\n    constructor(private value: () => Promise<T>) { }\n    public getValueAsync(): Promise<T> { \n        if (!this._value) {\n            this._value = this.value();\n        }\n        return this._value;\n    }\n}","import { SourceProperty } from './common';\nimport { defaultImageLoadFunction } from \"ol/source/Image\";\nimport olMapGuideSource from \"ol/source/ImageMapGuide\";\nimport olImageLayer from \"ol/layer/Image\";\nimport { assertNever } from '../utils/never';\nimport { LayerSetGroupBase } from './layer-set-group-base';\nimport { IMgLayerSetProps, IMgLayerSetCallback, MgInnerLayerSetFactory, mockMapGuideImageLoadFunction, blankImageLoadFunction, MgLayerSetMode, MgLayerSetOL } from './layer-set';\nimport { MapGuideMockMode } from '../components/mapguide-debug-context';\nimport { isRuntimeMap } from '../utils/type-guards';\nimport { strIsNullOrEmpty } from '../utils/string';\nimport { MgError } from './error';\nimport { GenericLayerSetOL } from './generic-layer-set';\nimport ImageLayer from 'ol/layer/Image';\nimport TileLayer from 'ol/layer/Tile';\nimport TileWMS from 'ol/source/TileWMS';\nimport ImageWMS from 'ol/source/ImageWMS';\nimport LayerBase from \"ol/layer/Base\";\n\nexport class MgLayerSetGroup extends LayerSetGroupBase {\n    constructor(props: IMgLayerSetProps, callback: IMgLayerSetCallback) {\n        super(callback);\n        const { map, agentUri } = props;\n        const isRtMap = isRuntimeMap(map);\n        const hasAgentUri = strIsNullOrEmpty(agentUri);\n        if (isRtMap) {\n            if (hasAgentUri) {\n                throw new MgError(\"Expected agentUri to be set\");\n            }\n        }\n        const factory = new MgInnerLayerSetFactory(callback, map, agentUri, props.imageFormat, props.selectionImageFormat, props.selectionColor);\n        \n        //NOTE: MapGuide does not like concurrent map rendering operations of the same mapname/session pair, which\n        //this will do when the MG overlay is shared between the main viewer and the overview map. This is probably\n        //because the concurrent requests both have SET[X/Y/SCALE/DPI/etc] parameters attached, so there is concurrent\n        //requests to modify and persist the runtime map state (in addition to the rendering) and there is most likely\n        //server-side lock contention to safely update the map state. Long story short: re-using the main overlay for the\n        //OverviewMap control IS A BAD THING. Same thing happens with selection overlays\n        //\n        //As of OL6, this unwanted behavior from shared layers extends to all layer types, so what this means is that\n        //we have to create 2 sets of layers, one for the main map and one for the overview map. We CANNOT and DO NOT share\n        //any of these layer instances between the main map and the overview map!\n        this.mainSet = factory.create(props.locale, props.externalBaseLayers, props.stateless ? MgLayerSetMode.Stateless : MgLayerSetMode.Stateful, props.appSettings);\n        this.overviewSet = factory.create(props.locale, props.externalBaseLayers, MgLayerSetMode.OverviewMap, props.appSettings);\n        const progressNotifySources = this.mainSet.getSourcesForProgressTracking();\n        /*\n        console.log(\"Draw Order:\");\n        for (let i = 0; i < layers.length; i++) {\n            console.log(\" \" + layers[i].get(LayerProperty.LAYER_NAME));\n        }\n        */\n        for (const src of progressNotifySources) {\n            const suppress: boolean | undefined = src.get(SourceProperty.SUPPRESS_LOAD_EVENTS);\n            if (!(suppress == true))\n                this.registerSourceEvents(src);\n        }\n    }\n    /**\n     * @override\n     */\n    public tryGetSubjectLayer() {\n        if (this.mainSet instanceof GenericLayerSetOL) {\n            return this.mainSet.subjectLayer;\n        } else if (this.mainSet instanceof MgLayerSetOL) {\n            return this.mainSet.overlay;\n        }\n        return undefined;\n    }\n    /**\n     * @override\n     * @returns\n     * @memberof MgLayerSetGroup\n     */\n    public tryGetWmsSource(): [LayerBase, (ImageWMS | TileWMS)] | undefined {\n        const subjectLayer = this.tryGetSubjectLayer();\n        if (subjectLayer instanceof ImageLayer || subjectLayer instanceof TileLayer) {\n            const source = subjectLayer.getSource();\n            if (source instanceof ImageWMS || source instanceof TileWMS) {\n                return [subjectLayer, source];\n            }\n        }\n        return undefined;\n    }\n    public updateSelectionColor = (color: string) => this.mainSet.updateSelectionColor(color);\n    public setMapGuideMocking(mock: MapGuideMockMode | undefined) {\n        const allLayers = this.mainSet.getLayers();\n        for (const layer of allLayers) {\n            if (layer instanceof olImageLayer) {\n                const source = layer.getSource();\n                if (source instanceof olMapGuideSource) {\n                    if (typeof (mock) != 'undefined') {\n                        switch (mock) {\n                            case MapGuideMockMode.RenderPlaceholder:\n                                source.setImageLoadFunction(mockMapGuideImageLoadFunction);\n                                break;\n                            case MapGuideMockMode.DoNotRender:\n                                source.setImageLoadFunction(blankImageLoadFunction);\n                                break;\n                            default:\n                                assertNever(mock);\n                                break;\n                        }\n                    }\n                    else {\n                        source.setImageLoadFunction(defaultImageLoadFunction);\n                    }\n                }\n            }\n        }\n    }\n    public update = (showGroups: string[] | undefined, showLayers: string[] | undefined, hideGroups: string[] | undefined, hideLayers: string[] | undefined) => this.mainSet.update(showGroups, showLayers, hideGroups, hideLayers);\n}\n","import Point from \"ol/geom/Point\";\nimport LineString from \"ol/geom/LineString\";\nimport Circle from \"ol/geom/Circle\";\nimport Polygon, { fromCircle } from \"ol/geom/Polygon\";\nimport LinearRing from \"ol/geom/LinearRing\";\nimport MultiLineString from \"ol/geom/MultiLineString\";\nimport MultiPoint from \"ol/geom/MultiPoint\";\nimport MultiPolygon from \"ol/geom/MultiPolygon\";\nimport Geometry from \"ol/geom/Geometry\";\nimport GeometryCollection from \"ol/geom/GeometryCollection\";\n\nimport Overlay, { Options as OverlayOptions } from \"ol/Overlay\";\nimport * as olExtent from \"ol/extent\";\nimport * as olProj from \"ol/proj\";\nimport Projection, { Options as ProjectionOptions } from \"ol/proj/Projection\";\n\nimport { Options as VectorLayerOptions } from \"ol/layer/BaseVector\";\nimport VectorLayer from \"ol/layer/Vector\";\nimport VectorSource, { Options as VectorOptions } from \"ol/source/Vector\";\n\nimport Collection from \"ol/Collection\";\nimport Feature from \"ol/Feature\";\n\nimport ExtentInteraction, { Options as ExtentOptions } from \"ol/interaction/Extent\";\nimport SnapInteraction, { Options as SnapOptions } from \"ol/interaction/Snap\";\nimport DrawInteraction, { Options as DrawOptions } from \"ol/interaction/Draw\";\nimport TranslateInteraction, { Options as TranslateOptions } from \"ol/interaction/Translate\";\nimport ModifyInteraction, { Options as ModifyOptions } from \"ol/interaction/Modify\";\nimport SelectInteraction, { Options as SelectOptions } from \"ol/interaction/Select\";\n\nimport GeoJSONFormat, { Options as GeoJSONOptions } from \"ol/format/GeoJSON\";\nimport WKTFormat, { Options as WKTOptions } from \"ol/format/WKT\";\n\nimport Style, { Options as StyleOptions } from \"ol/style/Style\";\nimport IconStyle, { Options as IconOptions } from \"ol/style/Icon\";\nimport RegularShapeStyle, { Options as RegularShapeOptions } from \"ol/style/RegularShape\";\nimport TextStyle, { Options as TextOptions } from \"ol/style/Text\";\nimport FillStyle, { Options as FillOptions } from \"ol/style/Fill\";\nimport StrokeStyle, { Options as StrokeOptions } from \"ol/style/Stroke\";\nimport CircleStyle, { Options as CircleOptions } from \"ol/style/Circle\";\nimport { Bounds, Coordinate2D } from './common';\nimport { ProjectionLike } from 'ol/proj';\nimport { OLVectorLayer, OLVectorLayerOptions } from \"./ol-types\";\n\n/**\n * Creates various OpenLayers types used by the viewer\n *\n * @export\n * @interface IOLFactory\n */\nexport interface IOLFactory {\n    /**\n     * \n     * @param options \n     * @deprecated Will be removed in favor of the IVectorFeatureStyle as that better integrates with the external layer manager component\n     */\n    createStyle(options?: StyleOptions): Style;\n    /**\n     * \n     * @param options \n     * @deprecated Will be removed in favor of the IVectorFeatureStyle as that better integrates with the external layer manager component\n     */\n    createStyleFill(options?: FillOptions): FillStyle;\n    /**\n     * \n     * @param options \n     * @deprecated Will be removed in favor of the IVectorFeatureStyle as that better integrates with the external layer manager component\n     */\n    createStyleStroke(options?: StrokeOptions): StrokeStyle;\n    /**\n     * \n     * @param options \n     * @deprecated Will be removed in favor of the IVectorFeatureStyle as that better integrates with the external layer manager component\n     */\n    createStyleCircle(options?: CircleOptions): CircleStyle;\n    /**\n     * @since 0.12.6\n     * @deprecated Will be removed in favor of the IVectorFeatureStyle as that better integrates with the external layer manager component\n     */\n    createStyleIcon(options?: IconOptions): IconStyle;\n    /**\n     * @since 0.12.6\n     * @deprecated Will be removed in favor of the IVectorFeatureStyle as that better integrates with the external layer manager component\n     */\n    createStyleRegularShape(options: RegularShapeOptions): RegularShapeStyle;\n    /**\n     * @since 0.12.6\n     * @deprecated Will be removed in favor of the IVectorFeatureStyle as that better integrates with the external layer manager component\n     */\n    createStyleText(options?: TextOptions): TextStyle;\n    createFeatureCollection(): Collection<Feature<Geometry>>;\n    extentContainsXY(extent: Bounds, x: number, y: number): boolean;\n    extendExtent(extent: Bounds, other: Bounds): Bounds;\n    createProjection(options: ProjectionOptions): Projection;\n    transformCoordinateFromLonLat(lonlat: Coordinate2D, proj?: ProjectionLike): Coordinate2D;\n    transformCoordinate(coordinate: Coordinate2D, source: ProjectionLike, target: ProjectionLike): Coordinate2D;\n    transformExtent(extent: Bounds, source: ProjectionLike, target: ProjectionLike): Bounds;\n    createGeomPoint(coordinates: Coordinate2D): Point;\n    createGeomLineString(coordinates: Coordinate2D[]): LineString;\n    createGeomCircle(center: Coordinate2D, radius: number | undefined): Circle;\n    createGeomLinearRing(coordinates: Coordinate2D[]): LinearRing;\n    createGeomPolygon(coordinates: Coordinate2D[][]): Polygon;\n    createGeomPolygonFromCircle(circle: Circle): Polygon;\n    createGeomMultiLineString(coordinates: Coordinate2D[][]): MultiLineString;\n    createGeomMultiPoint(coordinates: Coordinate2D[]): MultiPoint;\n    createGeomMultiPolygon(coordinates: Coordinate2D[][][]): MultiPolygon;\n    createGeomCollection(geometries: Geometry[]): GeometryCollection;\n    createVectorSource(options?: VectorOptions): VectorSource<Geometry>;\n    createVectorLayer(options?: OLVectorLayerOptions | undefined): OLVectorLayer;\n    createOverlay(options: OverlayOptions): Overlay;\n    createInteractionDraw(options: DrawOptions): DrawInteraction;\n    /**\n     * \n     * @since 0.11\n     * @param {ModifyOptions} options \n     * @returns {ModifyInteraction} \n     * @memberof IOLFactory\n     */\n    createInteractionModify(options: ModifyOptions): ModifyInteraction;\n    /**\n     * \n     * @since 0.11\n     * @param {SelectOptions} options \n     * @returns {SelectInteraction} \n     * @memberof IOLFactory\n     */\n    createInteractionSelect(options: SelectOptions): SelectInteraction;\n    createInteractionExtent(options: ExtentOptions): ExtentInteraction;\n    createInteractionSnap(options: SnapOptions): SnapInteraction;\n    createInteractionTranslate(options: TranslateOptions): TranslateInteraction;\n    createFeature(geomOrProps?: Geometry | { [key: string]: any }): Feature<Geometry>;\n    createFormatGeoJSON(options?: GeoJSONOptions | undefined): GeoJSONFormat;\n    createFormatWKT(options?: WKTOptions | undefined): WKTFormat;\n}\n\n/**\n * Creates various OpenLayers types used by the viewer\n *\n * @export\n * @class OLFactory\n * @implements {IOLFactory}\n */\nexport class OLFactory implements IOLFactory {\n    public createStyle(options?: StyleOptions): Style {\n        return new Style(options);\n    }\n    public createStyleFill(options?: FillOptions): FillStyle {\n        return new FillStyle(options);\n    }\n    public createStyleStroke(options?: StrokeOptions): StrokeStyle {\n        return new StrokeStyle(options);\n    }\n    public createStyleCircle(options?: CircleOptions): CircleStyle {\n        return new CircleStyle(options);\n    }\n    public createFeatureCollection(): Collection<Feature<Geometry>> {\n        return new Collection<Feature<Geometry>>();\n    }\n    public extentContainsXY(extent: Bounds, x: number, y: number): boolean {\n        return olExtent.containsXY(extent, x, y);\n    }\n    public extendExtent(extent: Bounds, other: Bounds): Bounds {\n        return olExtent.extend(extent, other) as Bounds;\n    }\n    public createProjection(options: ProjectionOptions): Projection {\n        return new Projection(options);\n    }\n    public transformCoordinateFromLonLat(lonlat: Coordinate2D, proj?: ProjectionLike): Coordinate2D {\n        return olProj.fromLonLat(lonlat, proj) as Coordinate2D;\n    }\n    public transformCoordinate(coordinate: Coordinate2D, source: ProjectionLike, target: ProjectionLike): Coordinate2D {\n        return olProj.transform(coordinate, source, target) as Coordinate2D;\n    }\n    public transformExtent(extent: Bounds, source: ProjectionLike, target: ProjectionLike): Bounds {\n        return olProj.transformExtent(extent, source, target) as Bounds;\n    }\n    public createGeomPoint(coordinates: Coordinate2D): Point {\n        return new Point(coordinates);\n    }\n    public createGeomLineString(coordinates: Coordinate2D[]): LineString {\n        return new LineString(coordinates);\n    }\n    public createGeomCircle(center: Coordinate2D, radius: number | undefined): Circle {\n        return new Circle(center, radius);\n    }\n    public createGeomLinearRing(coordinates: Coordinate2D[]): LinearRing {\n        return new LinearRing(coordinates);\n    }\n    public createGeomPolygon(coordinates: Coordinate2D[][]): Polygon {\n        return new Polygon(coordinates);\n    }\n    public createGeomPolygonFromCircle(circle: Circle): Polygon {\n        return fromCircle(circle);\n    }\n    public createGeomMultiLineString(coordinates: Coordinate2D[][]): MultiLineString {\n        return new MultiLineString(coordinates);\n    }\n    public createGeomMultiPoint(coordinates: Coordinate2D[]): MultiPoint {\n        return new MultiPoint(coordinates);\n    }\n    public createGeomMultiPolygon(coordinates: Coordinate2D[][][]): MultiPolygon {\n        return new MultiPolygon(coordinates);\n    }\n    public createGeomCollection(geometries: Geometry[]): GeometryCollection {\n        return new GeometryCollection(geometries);\n    }\n    public createVectorSource(options?: VectorOptions): VectorSource<Geometry> {\n        return new VectorSource(options);\n    }\n    public createVectorLayer(options?: OLVectorLayerOptions | undefined): OLVectorLayer {\n        return new VectorLayer(options);\n    }\n    public createOverlay(options: OverlayOptions): Overlay {\n        return new Overlay(options);\n    }\n    public createInteractionDraw(options: DrawOptions): DrawInteraction {\n        return new DrawInteraction(options);\n    }\n    public createInteractionExtent(options: ExtentOptions): ExtentInteraction {\n        return new ExtentInteraction(options);\n    }\n    public createInteractionTranslate(options: TranslateOptions): TranslateInteraction {\n        return new TranslateInteraction(options);\n    }\n    public createInteractionSnap(options: SnapOptions): SnapInteraction {\n        return new SnapInteraction(options);\n    }\n    public createInteractionModify(options: ModifyOptions): ModifyInteraction {\n        return new ModifyInteraction(options);\n    }\n    public createInteractionSelect(options: SelectOptions): SelectInteraction {\n        return new SelectInteraction(options);\n    }\n    public createFeature(geomOrProps?: Geometry | { [key: string]: any }): Feature<Geometry> {\n        return new Feature(geomOrProps);\n    }\n    public createFormatGeoJSON(options?: GeoJSONOptions | undefined): GeoJSONFormat {\n        return new GeoJSONFormat(options);\n    }\n    public createFormatWKT(options?: WKTOptions | undefined): WKTFormat {\n        return new WKTFormat(options);\n    }\n\n    /**\n     * @since 0.12.6\n     */\n    public createStyleIcon(options?: IconOptions | undefined): IconStyle {\n        return new IconStyle(options);\n    }\n    /**\n     * @since 0.12.6\n     */\n    public createStyleRegularShape(options: RegularShapeOptions): RegularShapeStyle {\n        return new RegularShapeStyle(options);\n    }\n    /**\n     * @since 0.12.6\n     */\n    public createStyleText(options?: TextOptions | undefined): TextStyle {\n        return new TextStyle(options);\n    }\n}","import { IMapGuideImageSource } from \"./common\";\n//import { MapGuideImageSource } from \"./ol-mapguide-source\";\nimport olMapGuideSource from \"ol/source/ImageMapGuide\";\nimport { OLMapGuideImageSourceOptions } from './ol-types';\n\n/**\n * @hidden\n */\nexport function isMapGuideImageSource(arg: any): arg is IMapGuideImageSource {\n    return typeof(arg.updateParams) != 'undefined';\n}\n\n/**\n * @hidden\n */\nexport function createMapGuideSource(options: OLMapGuideImageSourceOptions): olMapGuideSource {\n    //const ctor: any = MapGuideImageSource;\n    //const source = new ctor(options);\n    const source = new olMapGuideSource(options);\n    return source;\n}","import { ExprOr, isEvaluatable, IVectorLabelSettings, IBasicStroke, IBasicFill, IEvaluatable } from \"./ol-style-contracts\";\nimport { ExprEvalContext } from \"./expr-eval-context\";\nimport TextStyle, { Options as TextStyleOptions } from \"ol/style/Text\";\nimport Stroke from 'ol/style/Stroke';\nimport Fill from 'ol/style/Fill';\nimport { asArray } from 'ol/color';\nimport { OLFeature } from \"./ol-types\";\n\nfunction toOLColor(color: string, alpha: number | undefined) {\n    const c = asArray(color);\n    if (typeof (alpha) != 'undefined') {\n        c[3] = (alpha / 255);\n    }\n    return c;\n}\n\nexport function evalFeature<T>(expr: ExprOr<T>, feat: OLFeature | undefined, context: ExprEvalContext | undefined): any | undefined {\n    if (!isEvaluatable(expr)) {\n        return expr;\n    } else if (feat && context) {\n        try {\n            return context.evaluate(expr.expr, feat);\n        } catch (e) {\n            return undefined;\n        }\n    } else {\n        return undefined;\n    }\n}\n\nfunction setIfNotUndefined<T, K extends keyof T>(obj: T, prop: K, value: T[K]) {\n    if (typeof (value) != 'undefined') {\n        obj[prop] = value;\n    }\n}\n\nexport function buildStroke(stroke: IBasicStroke, feat: OLFeature | undefined, context: ExprEvalContext | undefined): Stroke {\n    return new Stroke({\n        color: toOLColor(evalFeature(stroke.color, feat, context), evalFeature(stroke.alpha, feat, context)),\n        width: evalFeature(stroke.width, feat, context)\n    })\n}\n\nexport function buildFill(fill: IBasicFill, feat: OLFeature | undefined, context: ExprEvalContext | undefined): Fill {\n    return new Fill({\n        color: toOLColor(evalFeature(fill.color, feat, context), evalFeature(fill.alpha, feat, context))\n    });\n}\n\nexport function tryBuildTextStyle(style: IVectorLabelSettings, feat: OLFeature | undefined, context: ExprEvalContext | undefined): TextStyle | undefined {\n    const { label } = style;\n    if (label) {\n        const textOpts: TextStyleOptions = {};\n        setIfNotUndefined(textOpts, \"font\", evalFeature(label.font, feat, context));\n        setIfNotUndefined(textOpts, \"maxAngle\", evalFeature(label.maxAngle, feat, context));\n        setIfNotUndefined(textOpts, \"offsetX\", evalFeature(label.offsetX, feat, context));\n        setIfNotUndefined(textOpts, \"offsetY\", evalFeature(label.offsetY, feat, context));\n        setIfNotUndefined(textOpts, \"overflow\", evalFeature(label.overflow, feat, context));\n        setIfNotUndefined(textOpts, \"placement\", evalFeature(label.placement, feat, context));\n        setIfNotUndefined(textOpts, \"rotateWithView\", evalFeature(label.rotateWithView, feat, context));\n        setIfNotUndefined(textOpts, \"rotation\", evalFeature(label.rotation, feat, context));\n        setIfNotUndefined(textOpts, \"scale\", evalFeature(label.scale, feat, context));\n        const txt = evalFeature(label.text, feat, context);\n        if (typeof (txt) != 'undefined') {\n            textOpts.text = `${txt}`; //Need to stringify this\n        }\n        setIfNotUndefined(textOpts, \"textAlign\", evalFeature(label.textAlign, feat, context));\n        setIfNotUndefined(textOpts, \"textBaseline\", evalFeature(label.textBaseline, feat, context));\n        const text = new TextStyle(textOpts);\n        if (label.padding) {\n            text.setPadding(label.padding);\n        }\n        if (label.fill) {\n            const f = buildFill(label.fill, feat, context);\n            text.setFill(f);\n        }\n        if (label.backgroundFill) {\n            const f = buildFill(label.backgroundFill, feat, context);\n            text.setBackgroundFill(f);\n        }\n        if (label.stroke) {\n            const s = buildStroke(label.stroke, feat, context);\n            text.setStroke(s);\n        }\n        if (label.backgroundStroke) {\n            const s = buildStroke(label.backgroundStroke, feat, context);\n            text.setBackgroundStroke(s);\n        }\n        return text;\n    }\n    return undefined;\n}","import type Style from 'ol/style/Style';\nimport { MAP_MARKER_ICON } from '../constants/assets';\nimport { ExprEvalContext } from './expr-eval-context';\nimport { OLFeature } from './ol-types';\n\n/**\n * The source of a vector layer style\n * \n * @since 0.14\n */\nexport enum VectorStyleSource {\n    /**\n     * The base vector layer style\n     */\n    Base,\n    /**\n     * The clustered layer style\n     */\n    Cluster\n}\n\n/**\n * Defines a style for a vector layer\n */\nexport interface IVectorLayerStyle {\n    /**\n     * The vector style for the given filter\n     */\n    [filter: string]: IVectorFeatureStyle;\n    /**\n     * The default vector style\n     */\n    default: IVectorFeatureStyle;\n}\n\n/**\n * @since 0.14\n */\nexport enum ClusterClickAction {\n    ZoomToClusterExtents = \"ZoomToClusterExtents\",\n    ShowPopup = \"ShowPopup\"\n}\n\n/**\n * Point cluster settings\n * \n * @since 0.14\n */\nexport interface IClusterSettings {\n    /**\n     * The clustering distance\n     */\n    distance: number;\n    /**\n     * What happens if this cluster is clicked\n     */\n    onClick: ClusterClickAction;\n    /**\n     * The style to use for point clusters\n     */\n    style: IVectorLayerStyle;\n}\n\n/**\n * Heatmap layer settings\n * @since 0.14\n */\nexport interface IHeatmapSettings {\n    /**\n     * Heatmap blur\n     */\n    blur: number;\n    /**\n     * Heatmap radius\n     */\n    radius: number;\n}\n\n/**\n * @since 0.14\n */\nexport type TextPlacement = \"point\" | \"line\";\n\n/**\n * @since 0.14\n */\nexport type TextBaseline = \"bottom\" | \"top\" | \"middle\" | \"alphabetic\" | \"hanging\" | \"ideographic\";\n\n/**\n * @since 0.14\n */\nexport interface IEvaluatable {\n    expr: string;\n}\n\n/**\n * @since 0.14\n */\nexport type ExprOr<T> = IEvaluatable | T;\n\n/**\n * @since 0.14\n */\nexport function isEvaluatable<T>(arg: any): arg is IEvaluatable {\n    return typeof (arg?.expr) == 'string';\n}\n\n/**\n * Label settings\n * @since 0.14\n */\nexport interface ILabelSettings {\n    font?: ExprOr<string>;\n    maxAngle?: ExprOr<number>;\n    offsetX?: ExprOr<number>;\n    offsetY?: ExprOr<number>;\n    overflow?: ExprOr<boolean>;\n    placement?: TextPlacement;\n    scale?: ExprOr<number>;\n    rotateWithView?: ExprOr<boolean>;\n    rotation?: ExprOr<number>;\n    text?: ExprOr<string>;\n    textAlign?: ExprOr<string>;\n    textBaseline?: ExprOr<string>;\n    fill?: IBasicFill;\n    stroke?: IBasicStroke;\n    backgroundFill?: IBasicFill;\n    backgroundStroke?: IBasicStroke;\n    padding?: [number, number, number, number];\n}\n\n/**\n * Defines label settings for a vector layer\n * @since 0.14\n */\nexport interface IVectorLabelSettings {\n    label?: ILabelSettings;\n}\n\n/**\n * Defines a style for vector features\n * @since 0.13\n */\nexport interface IVectorFeatureStyle {\n    /**\n     * @since 0.14\n     */\n    label?: string;\n    point?: IBasicVectorPointStyle;\n    line?: IBasicVectorLineStyle;\n    polygon?: IBasicVectorPolygonStyle;\n}\n\n/**\n * Point circle style settings\n * @since 0.13\n */\nexport interface IBasicPointCircleStyle extends IVectorLabelSettings {\n    type: \"Circle\";\n    fill: IBasicFill;\n    radius: ExprOr<number>;\n    stroke: IBasicStroke;\n}\n\n/**\n * Point icon style settings\n * @since 0.13\n */\nexport interface IPointIconStyle extends IVectorLabelSettings {\n    type: \"Icon\";\n    anchor: [number, number],\n    src: ExprOr<string>;\n    //size: [number, number];\n    rotateWithView: ExprOr<boolean>;\n    rotation: ExprOr<number>;\n    //opacity: ExprOr<number>;\n    scale: ExprOr<number>;\n}\n\n/**\n * Point style settings\n * @since 0.13\n */\nexport type IBasicVectorPointStyle = (IBasicPointCircleStyle | IPointIconStyle) & IVectorLabelSettings;\n\n/**\n * Line style settings\n * @since 0.13\n */\nexport type IBasicVectorLineStyle = IBasicStroke & IVectorLabelSettings;\n\n/**\n * Polygon style settings\n * @since 0.13\n */\nexport interface IBasicVectorPolygonStyle extends IVectorLabelSettings {\n    fill: IBasicFill;\n    stroke: IBasicStroke;\n}\n\n/**\n * Line stroke settings\n * @since 0.13\n */\nexport interface IBasicStroke {\n    color: ExprOr<string>;\n    alpha: ExprOr<number>;\n    width: ExprOr<number>;\n}\n\n/**\n * Color fill settings\n * @since 0.13\n */\nexport interface IBasicFill {\n    color: ExprOr<string>;\n    alpha: ExprOr<number>;\n}\n\n/**\n * The default style for point features\n * @since 0.13\n * @since 0.14 Made deep const immutable\n */\nexport const DEFAULT_POINT_CIRCLE_STYLE: IBasicPointCircleStyle = {\n    type: \"Circle\",\n    fill: {\n        color: \"#ff0000\",\n        alpha: 255\n    },\n    radius: 5,\n    stroke: {\n        color: \"#0000ff\",\n        alpha: 255,\n        width: 1\n    }\n} as const;\n\n/**\n * The default style for clustered point features\n * @since 0.14\n */\nexport const DEFAULT_CLUSTERED_POINT_CIRCLE_STYLE: IBasicPointCircleStyle = {\n    type: \"Circle\",\n    fill: {\n        color: \"#ff0000\",\n        alpha: 255\n    },\n    radius: { expr: \"min(arr_size(features) + 4, 25)\" },\n    /*\n    label: {\n        text: expr(\"if(arr_size(features) > 1, '', arr_size(features))\"),\n    },*/\n    stroke: {\n        color: \"#0000ff\",\n        alpha: 255,\n        width: 1\n    }\n} as const;\n\n/**\n * The default icon style for point features\n * @since 0.13\n * @since 0.14 Made deep const immutable\n */\nexport const DEFAULT_POINT_ICON_STYLE: IPointIconStyle = {\n    type: \"Icon\",\n    anchor: [0.5, 0.5] as [number, number],\n    src: MAP_MARKER_ICON,\n    //size: [24, 24],\n    rotateWithView: false,\n    rotation: 0,\n    //opacity: 255,\n    scale: 1\n} as const;\n\n/**\n * The default color\n * @since 0.13\n */\nexport const DEFAULT_COLOR = \"#000000\";\n\n/**\n * The default style for line features\n * @since 0.13\n * @since 0.14 Made deep const immutable\n */\nexport const DEFAULT_LINE_STYLE: IBasicVectorLineStyle = {\n    color: \"#0000ff\",\n    alpha: 255,\n    width: 1\n} as const;\n\n/**\n * The default style for polygon features\n * @since 0.13\n * @since 0.14 Made deep const immutable\n */\nexport const DEFAULT_POLY_STYLE: IBasicVectorPolygonStyle = {\n    fill: {\n        color: \"#00ff00\",\n        alpha: 255\n    },\n    stroke: {\n        color: DEFAULT_COLOR,\n        alpha: 255,\n        width: 1\n    }\n} as const;\n\n/**\n * The default vector layer style\n * @since 0.14\n */\nexport const DEFAULT_VECTOR_LAYER_STYLE = {\n    default: {\n        point: DEFAULT_POINT_CIRCLE_STYLE,\n        line: DEFAULT_LINE_STYLE,\n        polygon: DEFAULT_POLY_STYLE\n    }\n} as const;\n\n/**\n * The default vector layer style for clustered points\n * @since 0.14\n */\nexport const DEFAULT_CLUSTERED_LAYER_STYLE = {\n    default: {\n        point: DEFAULT_CLUSTERED_POINT_CIRCLE_STYLE\n    }\n} as const;\n\n/**\n * An OpenLayers style map\n * \n * @export\n * @interface IOlStyleMap\n * @since 0.13\n */\nexport interface IOlStyleMap {\n    id: string;\n    \"Point\": Style;\n    \"LineString\": Style;\n    \"MultiLineString\": Style;\n    \"MultiPoint\": Style;\n    \"MultiPolygon\": Style;\n    \"Polygon\": Style;\n    \"GeometryCollection\": Style;\n    \"Circle\": Style;\n}\n\nexport type DynamicStyleMap = (feature: OLFeature | undefined, context: ExprEvalContext | undefined) => IOlStyleMap;","import { IVectorLayerStyle, IClusterSettings } from './ol-style-contracts';\nimport Feature from 'ol/Feature';\nimport { OLStyleMapSet } from './ol-style-map-set';\nimport Geometry from 'ol/geom/Geometry';\nimport { LayerProperty } from './common';\nimport VectorTileLayer from 'ol/layer/VectorTile';\nimport { OLFeature, OLVectorLayer } from './ol-types';\n\n/**\n * @since 0.14\n */\nexport const DEFAULT_STYLE_KEY = \"default\";\n\nexport function isClusteredFeature(feature: OLFeature): boolean {\n    if (getClusterSubFeatures(feature)?.length) {\n        return true;\n    }\n    return false;\n}\n\nexport function getClusterSubFeatures(feature: OLFeature): OLFeature[] {\n    return feature.get(\"features\");\n}\n\n/**\n * Sets the vector layer style for the given OpenLayers vector layer\n * \n * @since 0.13\n * @since 0.14 style now takes IVectorLayerStyle instead of IVectorFeatureStyle and accepts an optional cluster style \n * and layer can be either a vector layer or a vector tile layer\n */\nexport function setOLVectorLayerStyle(layer: OLVectorLayer | VectorTileLayer, style: IVectorLayerStyle, clusterStyle: IClusterSettings | undefined) {\n    const olstyles = new OLStyleMapSet(style, clusterStyle);\n    layer.set(LayerProperty.VECTOR_STYLE, olstyles);\n    const layerStyleFunc = function (feature: Feature<Geometry>) {\n        //TODO: Perf opportunity, cache styles by type_filter|default. Of course, if we ever\n        //decide to go for fully dynamic styles (where any property could be an expression to evaluate)\n        //such styles are not candidates for caching.\n        const sset: OLStyleMapSet = this;\n        return sset.evaluateStyle(feature);\n    }.bind(olstyles);\n    layer.setStyle(layerStyleFunc);\n}\n\n/**\n * Gets the OL style function for the given style\n * \n * @param style \n * @param clusterStyle \n * @returns \n * @since 0.14\n */\nexport function getOLStyleFunction(style: IVectorLayerStyle, clusterStyle: IClusterSettings | undefined) {\n    const olstyles = new OLStyleMapSet(style, clusterStyle);\n    const layerStyleFunc = function (feature: Feature<Geometry>) {\n        //TODO: Perf opportunity, cache styles by type_filter|default. Of course, if we ever\n        //decide to go for fully dynamic styles (where any property could be an expression to evaluate)\n        //such styles are not candidates for caching.\n        const sset: OLStyleMapSet = this;\n        return sset.evaluateStyle(feature);\n    }.bind(olstyles);\n    return layerStyleFunc;\n}","import { DEFAULT_STYLE_KEY, isClusteredFeature } from './ol-style-helpers';\nimport { ExprEvalContext } from './expr-eval-context';\nimport Feature from 'ol/Feature';\nimport Geometry from 'ol/geom/Geometry';\nimport { DynamicStyleMap, IOlStyleMap, IVectorLayerStyle, IVectorFeatureStyle, DEFAULT_POINT_CIRCLE_STYLE, DEFAULT_LINE_STYLE, DEFAULT_POLY_STYLE, IBasicStroke, isEvaluatable, IBasicFill, IVectorLabelSettings, IBasicVectorPointStyle, IBasicVectorLineStyle, IBasicVectorPolygonStyle, IClusterSettings, ClusterClickAction } from './ol-style-contracts';\nimport Style from 'ol/style/Style';\nimport CircleStyle from 'ol/style/Circle';\nimport { buildFill, buildStroke, tryBuildTextStyle, evalFeature } from './ol-style-builders';\nimport IconStyle from \"ol/style/Icon\";\nimport * as shortid from \"shortid\";\nimport { deg2rad } from '../utils/number';\n\nfunction isDynamicStroke(stroke: IBasicStroke | undefined): boolean {\n    if (!stroke) {\n        return false;\n    }\n    return isEvaluatable(stroke.alpha)\n        || isEvaluatable(stroke.color)\n        || isEvaluatable(stroke.width);\n}\n\nfunction isDynamicFill(fill: IBasicFill | undefined): boolean {\n    if (!fill) {\n        return false;\n    }\n    return isEvaluatable(fill.alpha)\n        || isEvaluatable(fill.color);\n}\n\nfunction isDynamicLabel(labelSettings: IVectorLabelSettings): boolean {\n    const { label } = labelSettings;\n    if (!label) {\n        return false;\n    }\n    return isDynamicFill(label.backgroundFill)\n        || isDynamicStroke(label.backgroundStroke)\n        || isDynamicFill(label.fill)\n        || isEvaluatable(label.font)\n        || isEvaluatable(label.maxAngle)\n        || isEvaluatable(label.offsetX)\n        || isEvaluatable(label.offsetY)\n        || isEvaluatable(label.overflow)\n        || isEvaluatable(label.padding)\n        || isEvaluatable(label.placement)\n        || isEvaluatable(label.rotateWithView)\n        || isEvaluatable(label.rotation)\n        || isEvaluatable(label.scale)\n        || isDynamicStroke(label.stroke)\n        || isEvaluatable(label.text)\n        || isEvaluatable(label.textAlign)\n        || isEvaluatable(label.textBaseline);\n}\n\nfunction isDynamicPointStyle(style: IBasicVectorPointStyle): boolean {\n    const apts: any = style;\n    const isBaseDynamic = isEvaluatable(apts.radius)\n        || isDynamicFill(apts.fill)\n        || isDynamicStroke(apts.stroke);\n    if (isBaseDynamic) {\n        return true;\n    }\n    return isDynamicLabel(style);\n}\n\nfunction isDynamicLineStyle(style: IBasicVectorLineStyle): boolean {\n    return isDynamicStroke(style)\n        || isDynamicLabel(style);\n}\n\nfunction isDynamicPolygonStyle(style: IBasicVectorPolygonStyle): boolean {\n    return isDynamicStroke(style.stroke)\n        || isDynamicFill(style.fill)\n        || isDynamicLabel(style);\n}\n\nfunction buildStyleMap(pts: Style, lns: Style, pls: Style) {\n    //For GeometryCollection, combine point and polygon styles\n    const cpts = pts.clone();\n    const cpls = pls.clone();\n    const gcs = new Style({\n        image: cpts.getImage(),\n        stroke: cpls.getStroke(),\n        fill: cpls.getFill()\n    });\n    return {\n        id: shortid.generate(),\n        Point: pts,\n        MultiPoint: pts,\n        LineString: lns,\n        MultiLineString: lns,\n        Polygon: pls,\n        MultiPolygon: pls,\n        Circle: pls,\n        GeometryCollection: gcs\n    };\n}\n\nexport function vectorStyleToStyleMap(style: IVectorFeatureStyle): IOlStyleMap | DynamicStyleMap {\n    const ptStyle = style.point ?? DEFAULT_POINT_CIRCLE_STYLE;\n    const lnStyle = style.line ?? DEFAULT_LINE_STYLE;\n    const plStyle = style.polygon ?? DEFAULT_POLY_STYLE;\n\n    const builder: DynamicStyleMap = (feat, context) => {\n        const pts = new Style();\n        if (ptStyle.type == \"Circle\") {\n            pts.setImage(new CircleStyle({\n                radius: evalFeature(ptStyle.radius, feat, context),\n                fill: buildFill(ptStyle.fill, feat, context),\n                stroke: buildStroke(ptStyle.stroke, feat, context)\n            }));\n        } else {\n            pts.setImage(new IconStyle({\n                anchor: ptStyle.anchor,\n                src: evalFeature(ptStyle.src, feat, context),\n                rotateWithView: evalFeature(ptStyle.rotateWithView, feat, context),\n                rotation: deg2rad(evalFeature(ptStyle.rotation, feat, context)),\n                scale: evalFeature(ptStyle.scale, feat, context)\n            }));\n        }\n        const lns = new Style({\n            stroke: buildStroke(lnStyle, feat, context)\n        });\n        const pls = new Style({\n            stroke: buildStroke(plStyle.stroke, feat, context),\n            fill: buildFill(plStyle.fill, feat, context)\n        });\n\n        const ptText = tryBuildTextStyle(ptStyle, feat, context);\n        const lnText = tryBuildTextStyle(lnStyle, feat, context);\n        const plsText = tryBuildTextStyle(plStyle, feat, context);\n        if (ptText) {\n            pts.setText(ptText);\n        }\n        if (lnText) {\n            lns.setText(lnText);\n        }\n        if (plsText) {\n            pls.setText(plsText);\n        }\n        return buildStyleMap(pts, lns, pls);\n    }\n\n    const isDynamic = isDynamicPointStyle(ptStyle)\n        || isDynamicLineStyle(lnStyle)\n        || isDynamicPolygonStyle(plStyle);\n\n    if (isDynamic) {\n        return builder;\n    } else {\n        return builder(undefined, undefined);\n    }\n}\n\n/**\n * @since 0.14\n */\nexport class OLStyleMapSet {\n    private rules: {\n        [filter: string]: IOlStyleMap | DynamicStyleMap;\n        default: IOlStyleMap | DynamicStyleMap;\n    };\n    private clusterRules: {\n        [filter: string]: IOlStyleMap | DynamicStyleMap;\n        default: IOlStyleMap | DynamicStyleMap;\n    } | undefined;\n    private exprContext: ExprEvalContext;\n    private defaultStyleMap: IOlStyleMap | DynamicStyleMap;\n    constructor(private readonly origStyleDef: IVectorLayerStyle, private readonly clusterStyleDef: IClusterSettings | undefined) {\n        this.rules = {\n            default: vectorStyleToStyleMap(origStyleDef.default)\n        };\n        this.exprContext = new ExprEvalContext();\n        for (const k in origStyleDef) {\n            if (k != DEFAULT_STYLE_KEY && origStyleDef[k]) {\n                this.rules[k] = vectorStyleToStyleMap(origStyleDef[k]);\n            }\n            if (k != DEFAULT_STYLE_KEY) {\n                this.exprContext.addFilter(k);\n            }\n        }\n        if (clusterStyleDef?.style) {\n            const { style } = clusterStyleDef;\n            this.clusterRules = {\n                default: vectorStyleToStyleMap(style.default)\n            };\n            for (const k in style) {\n                if (k != DEFAULT_STYLE_KEY && style[k]) {\n                    this.clusterRules[k] = vectorStyleToStyleMap(style[k]);\n                }\n                if (k != DEFAULT_STYLE_KEY) {\n                    this.exprContext.addClusterFilter(k);\n                }\n            }\n        }\n        this.defaultStyleMap = vectorStyleToStyleMap({});\n    }\n    public toVectorLayerStyle(): IVectorLayerStyle {\n        return this.origStyleDef;\n    }\n    public toClusterSettings(): IClusterSettings | undefined {\n        return this.clusterStyleDef;\n    }\n    public getClusterClickAction(): ClusterClickAction | undefined {\n        return this.clusterStyleDef?.onClick;\n    }\n    public evaluateStyle(feature: Feature<Geometry>) {\n        try {\n            const g = feature.getGeometry();\n            if (!g) {\n                return null;\n            }\n            const gt: any = g.getType();\n            const filter = this.exprContext.evaluateFilter(feature);\n            let matchingStyle: IOlStyleMap | DynamicStyleMap;\n            const r = isClusteredFeature(feature) ? this.clusterRules : this.rules;\n            if (filter) {\n                matchingStyle = r?.[filter] ?? this.defaultStyleMap;\n            } else {\n                //Fallback to default\n                matchingStyle = r?.default ?? this.defaultStyleMap;\n            }\n            if (typeof (matchingStyle) == 'function') {\n                const esm = matchingStyle(feature, this.exprContext);\n                return (esm as any)[gt];\n            } else {\n                return (matchingStyle as any)[gt];\n            }\n        } catch (e) {\n            console.error(e);\n            return null;\n        }\n    }\n}","import { ApplicationDefinition, ContainerItem, UIWidget, Widget } from '../contracts/fusion';\nimport { DefaultCommands, isSupportedCommandInStatelessMode } from './command';\nimport * as shortid from \"shortid\";\nimport { DefaultComponentNames } from './component';\nimport { tr } from '../i18n';\nimport { CommandTarget, Dictionary, ICommand, IInvokeUrlCommand, ISearchCommand } from '../common';\nimport { assertNever } from '../../utils/never';\nimport { strIsNullOrEmpty } from '../../utils/string';\nimport { warn } from '../../utils/logger';\nimport { UIItem, CommandDef, isCommandItem, isTargetedCommand, isBasicCommand, isSeparatorItem, isFlyoutItem, WebLayout, isInvokeURLCommand, isSearchCommand } from '../contracts/weblayout';\nimport { isStateless } from '../../actions/init-command';\nimport { SPRITE_INVOKE_SCRIPT, SPRITE_INVOKE_URL } from '../../constants/assets';\nimport { WEBLAYOUT_CONTEXTMENU, WEBLAYOUT_TASKMENU } from '../../constants';\n\nfunction isCommandSpec(cmd: ICommandSpec | IUnknownCommandSpec): cmd is ICommandSpec {\n    return !strIsNullOrEmpty((cmd as any).command);\n}\n\nexport function isUIWidget(widget: any): widget is UIWidget {\n    return widget.WidgetType === \"UiWidgetType\";\n}\n\n/**\n *\n */\nexport interface ToolbarConf {\n    items: (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec)[];\n}\n\n/**\n *\n */\nexport interface PreparedSubMenuSet {\n    toolbars: Dictionary<ToolbarConf>;\n    flyouts: Dictionary<IFlyoutSpec>;\n}\n\n/**\n * @hidden\n */\nexport function isFlyoutSpec(item: any): item is IFlyoutSpec {\n    return typeof (item.children) != 'undefined';\n}\n\n/**\n *\n */\nexport interface IFlyoutSpec {\n    label?: string;\n    tooltip?: string;\n    icon?: string;\n    spriteClass?: string;\n    children: (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec)[];\n}\n\n/**\n *\n */\nexport interface ISeparatorSpec {\n    isSeparator: boolean;\n}\n\n/**\n *\n */\nexport interface IUnknownCommandSpec {\n    error: string;\n}\n\n/**\n *\n */\nexport interface ICommandSpec {\n    icon: string;\n    spriteClass: string;\n    label: string | null;\n    tooltip: string;\n    parameters: any;\n    command?: string;\n    componentName?: string;\n    flyoutId?: string;\n}\n\nfunction makeCommand(widget: UIWidget, noToolbarLabels: boolean, cmdType: DefaultCommands): ICommandSpec {\n    return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: cmdType, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n}\n\nfunction convertWidget(widget: UIWidget, locale: string, noToolbarLabels: boolean): ICommandSpec | IUnknownCommandSpec {\n    switch (widget.Type) {\n        case \"Select\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Select);\n        case \"Pan\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Pan);\n        //case \"PanQuery\":\n        //case \"PanOnClick\":\n        case \"Zoom\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Zoom);\n        case \"ZoomOnClick\": //Covers in and out. Look at Factor parameter\n            {\n                const factor = parseFloat(widget.Extension.Factor);\n                if (factor >= 1.0) {\n                    return makeCommand(widget, noToolbarLabels, DefaultCommands.ZoomIn);\n                } else {\n                    return makeCommand(widget, noToolbarLabels, DefaultCommands.ZoomOut);\n                }\n            }\n        case \"InitialMapView\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.ZoomExtents);\n        case \"ZoomToSelection\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.ZoomToSelection);\n        case \"ExtentHistory\": //Covers prev and next. Look at Direction parameter\n            {\n                if (widget.Extension.Direction == \"previous\") {\n                    return makeCommand(widget, noToolbarLabels, DefaultCommands.PreviousView);\n                } else {\n                    return makeCommand(widget, noToolbarLabels, DefaultCommands.NextView);\n                }\n            }\n        case \"CenterSelection\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.CenterSelection);\n        case \"About\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.About);\n        case \"BufferPanel\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Buffer);\n        case \"ClearSelection\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.ClearSelection);\n        //case \"ColorPicker\":\n        case \"CoordinateTracker\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.CoordinateTracker);\n        case \"FeatureInfo\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.FeatureInfo);\n        case \"Geolocation\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Geolocation);\n        //case \"GoogleStreetViewer\":\n        case \"Help\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Help);\n        case \"Maptip\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.MapTip);\n        case \"MapMenu\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, componentName: DefaultComponentNames.MapMenu, flyoutId: `${DefaultComponentNames.MapMenu}_${shortid.generate()}`, parameters: widget.Extension };\n        case \"Query\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Query);\n        case \"QuickPlot\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.QuickPlot);\n        case \"Redline\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Redline);\n        case \"RefreshMap\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.RefreshMap);\n        //case \"SaveMap\":\n        case \"InvokeURL\": //Commands with this name would've been registered beforehand\n        case \"Search\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: widget.Name, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        case \"SelectPolygon\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.SelectPolygon);\n        case \"SelectRadius\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.SelectRadius);\n        //case \"SelectRadiusValue\":\n        case \"SelectWithin\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.SelectWithin);\n        case \"Theme\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Theme);\n        case \"ViewOptions\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.ViewerOptions);\n        case \"ZoomToSelection\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.ZoomToSelection);\n        case \"Measure\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Measure);\n        case \"Print\":\n            return makeCommand(widget, noToolbarLabels, DefaultCommands.Print);\n        case \"BasemapSwitcher\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, componentName: DefaultComponentNames.BaseMapSwitcher, flyoutId: `${DefaultComponentNames.BaseMapSwitcher}_${shortid.generate()}`, parameters: widget.Extension };\n        case \"InvokeScript\":\n            return { icon: widget.ImageUrl, spriteClass: widget.ImageClass, command: widget.Name, label: (noToolbarLabels ? null : widget.Label), tooltip: widget.Tooltip, parameters: widget.Extension };\n        default:\n            return { error: tr(\"UNKNOWN_WIDGET\", locale, { widget: widget.Type }) }\n    }\n}\n\n/**\n * @hidden\n * \n * @param isStateless \n * @param items \n * @param widgetsByKey \n * @param locale \n * @param noToolbarLabels \n * @returns \n */\nexport function convertFlexLayoutUIItems(isStateless: boolean, items: ContainerItem[], widgetsByKey: Dictionary<Widget>, locale: string, noToolbarLabels = false): (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec)[] {\n    const converted = items.map(item => {\n        switch (item.Function) {\n            case \"Widget\":\n                {\n                    const widget = widgetsByKey[item.Widget];\n                    if (widget && isUIWidget(widget)) {\n                        const cmd = convertWidget(widget, locale, noToolbarLabels);\n                        if (isStateless && isCommandSpec(cmd) && !isSupportedCommandInStatelessMode(cmd.command)) {\n                            console.warn(`The widget (${widget.Name}) references a command (${cmd.command}) that is not supported in stateless mode. This widget will always be disabled`);\n                        }\n                        return cmd;\n                    }\n                }\n            case \"Separator\":\n                return { isSeparator: true } as ISeparatorSpec;\n            case \"Flyout\":\n                return {\n                    label: item.Label,\n                    tooltip: item.Tooltip,\n                    icon: item.ImageUrl,\n                    spriteClass: item.ImageClass,\n                    children: convertFlexLayoutUIItems(isStateless, item.Item, widgetsByKey, locale)\n                } as IFlyoutSpec;\n            default:\n                assertNever(item);\n        }\n        return null;\n    })\n        .filter(i => i != null)\n        .map(i => i as (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec));\n    return converted;\n}\n\nfunction tryTranslateImageUrlToSpriteClass(imageUrl: string): string | undefined {\n    switch (imageUrl) {\n        case \"../stdicons/icon_invokeurl.gif\":\n            return SPRITE_INVOKE_URL;\n        case \"../stdicons/icon_invokescript.gif\":\n            return SPRITE_INVOKE_SCRIPT;\n    }\n}\n\n/**\n * @hidden\n * \n * @param items \n * @param cmdsByKey \n * @param locale \n * @param noToolbarLabels \n * @returns \n */\nexport function convertWebLayoutUIItems(items: UIItem[] | undefined, cmdsByKey: Dictionary<CommandDef>, locale: string, noToolbarLabels = true): (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec)[] {\n    const converted = (items || []).map(item => {\n        if (isCommandItem(item)) {\n            const cmdDef: CommandDef = cmdsByKey[item.Command];\n            if (!cmdDef) {\n                warn(`Invalid reference to command: ${item.Command}`);\n                return { error: tr(\"UNKNOWN_COMMAND_REFERENCE\", locale, { command: item.Command }) } as IUnknownCommandSpec;\n            } else if (cmdDef.TargetViewer != \"Dwf\") {\n                let icon: Partial<Pick<ICommandSpec, \"icon\" | \"spriteClass\">> = {};\n                if (cmdDef.ImageURL) {\n                    icon.spriteClass = tryTranslateImageUrlToSpriteClass(cmdDef.ImageURL);\n                    if (!icon.spriteClass) {\n                        icon.icon = cmdDef.ImageURL;\n                    }\n                }\n                const commonParams: any = {};\n                if (isTargetedCommand(cmdDef)) {\n                    commonParams.Target = cmdDef.Target;\n                    commonParams.TargetFrame = cmdDef.TargetFrame;\n                }\n                if (isBasicCommand(cmdDef)) {\n                    let action: string = cmdDef.Action;\n                    if (action == \"ZoomRectangle\") {\n                        action = DefaultCommands.Zoom;\n                    } else if (action == \"FitToWindow\") {\n                        action = DefaultCommands.ZoomExtents;\n                    } else if (action == \"Refresh\") {\n                        action = DefaultCommands.RefreshMap;\n                    }\n                    return { command: action, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams, ...icon };\n                } else {\n                    switch (cmdDef[\"@xsi:type\"]) {\n                        case \"ViewOptionsCommandType\":\n                            return { command: DefaultCommands.ViewerOptions, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"MeasureCommandType\":\n                            return { command: DefaultCommands.Measure, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"HelpCommandType\":\n                            return { command: DefaultCommands.Help, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"BufferCommandType\":\n                            return { command: DefaultCommands.Buffer, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"SelectWithinCommandType\":\n                            return { command: DefaultCommands.SelectWithin, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        case \"GetPrintablePageCommandType\":\n                            return { command: DefaultCommands.QuickPlot, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams };\n                        default:\n                            return { command: cmdDef.Name, label: (noToolbarLabels ? null : cmdDef.Label), tooltip: cmdDef.Tooltip, parameters: commonParams, ...icon };\n                    }\n                }\n            }\n        } else if (isSeparatorItem(item)) {\n            return { isSeparator: true } as ISeparatorSpec;\n        } else if (isFlyoutItem(item)) {\n            return {\n                label: item.Label,\n                tooltip: item.Tooltip,\n                children: convertWebLayoutUIItems(item.SubItem, cmdsByKey, locale, false)\n            } as IFlyoutSpec;\n        } else {\n            assertNever(item);\n        }\n        return null;\n    })\n        .filter(i => i != null)\n        .map(i => i as (IFlyoutSpec | ISeparatorSpec | IUnknownCommandSpec | ICommandSpec));\n    return converted;\n}\n\nfunction convertToCommandTarget(fusionCmdTarget: string): CommandTarget {\n    //Treat empty/undefined target as new window\n    if (strIsNullOrEmpty(fusionCmdTarget)) {\n        return \"NewWindow\";\n    }\n    switch (fusionCmdTarget) {\n        case \"SearchWindow\":\n        case \"InvokeUrlWindow\":\n            return \"NewWindow\";\n        case \"TaskPane\":\n            return \"TaskPane\";\n        default:\n            return \"SpecifiedFrame\";\n    }\n}\nexport type CommandRegistrationFunc = (name: string, cmdDef: ICommand | IInvokeUrlCommand | ISearchCommand) => void;\n\nexport function parseWidgetsInAppDef(appDef: ApplicationDefinition, cmdRegister: CommandRegistrationFunc) {\n    let taskPane: Widget | undefined;\n    let viewSize: Widget | undefined;\n    let hasLegend = false;\n    let hasStatus = false;\n    let hasNavigator = false;\n    let hasSelectionPanel = false;\n    let hasTaskBar = false;\n    let initialTask: string;\n    const isStatelessAppDef = isStateless(appDef);\n    const widgetsByKey: Dictionary<Widget> = {};\n    //Register any InvokeURL and Search commands. Also set capabilities along the way\n    for (const widgetSet of appDef.WidgetSet) {\n        for (const widget of widgetSet.Widget) {\n            const cmd = widget.Extension;\n            switch (widget.Type) {\n                case \"TaskPane\":\n                    taskPane = widget;\n                    break;\n                case \"ViewSize\":\n                    viewSize = widget;\n                    break;\n                case \"Legend\":\n                    hasLegend = true;\n                    break;\n                case \"SelectionPanel\":\n                    hasSelectionPanel = true;\n                    break;\n                case \"CursorPosition\":\n                case \"SelectionInfo\":\n                    hasStatus = true;\n                    break;\n                case \"Navigator\":\n                    hasNavigator = true;\n                    break;\n                case \"Search\":\n                    cmdRegister(widget.Name, {\n                        layer: cmd.Layer,\n                        prompt: cmd.Prompt,\n                        resultColumns: cmd.ResultColumns,\n                        filter: cmd.Filter,\n                        matchLimit: cmd.MatchLimit,\n                        title: (cmd.Title || (isUIWidget(widget) ? widget.Label : undefined)),\n                        target: convertToCommandTarget(cmd.Target),\n                        targetFrame: cmd.Target\n                    });\n                    if (isStatelessAppDef) {\n                        console.warn(`The search command (${widget.Name}) is not supported in stateless mode. This widget will always be disabled`);\n                    }\n                    break;\n                case \"InvokeURL\":\n                    cmdRegister(widget.Name, {\n                        url: cmd.Url,\n                        disableIfSelectionEmpty: cmd.DisableIfSelectionEmpty,\n                        target: convertToCommandTarget(cmd.Target),\n                        targetFrame: cmd.Target,\n                        parameters: (cmd.AdditionalParameter || []).map((p: any) => {\n                            return { name: p.Key, value: p.Value };\n                        }),\n                        title: isUIWidget(widget) ? widget.Label : undefined\n                    });/*\n                        if (config.isStateless && !strStartsWith(cmd.Url, \"component://\")) {\n                            console.warn(`The InvokeURL command (${widget.Name}) is not supported in stateless mode. This widget will always be disabled`);\n                        }*/\n                    break;\n            }\n            widgetsByKey[widget.Name] = widget;\n        }\n    }\n\n    if (taskPane) {\n        hasTaskBar = true; //Fusion flex layouts can't control the visiblity of this\n        initialTask = taskPane.Extension.InitialTask || \"server/TaskPane.html\";\n    } else {\n        initialTask = \"server/TaskPane.html\";\n    }\n\n    return {\n        taskPane,\n        viewSize,\n        initialTask,\n        hasLegend,\n        hasStatus,\n        hasNavigator,\n        hasSelectionPanel,\n        hasTaskBar,\n        isStateless: isStatelessAppDef,\n        widgetsByKey\n    };\n}\n\nexport function parseCommandsInWebLayout(webLayout: WebLayout, cmdRegister: CommandRegistrationFunc) {\n    const cmdsByKey: Dictionary<CommandDef> = {};\n    //Register any InvokeURL and Search commands\n    for (const cmd of webLayout.CommandSet.Command) {\n        if (isInvokeURLCommand(cmd)) {\n            cmdRegister(cmd.Name, {\n                url: cmd.URL,\n                disableIfSelectionEmpty: cmd.DisableIfSelectionEmpty,\n                target: cmd.Target,\n                targetFrame: cmd.TargetFrame,\n                parameters: (cmd.AdditionalParameter || []).map(p => {\n                    return { name: p.Key, value: p.Value };\n                }),\n                title: cmd.Label\n            });\n        } else if (isSearchCommand(cmd)) {\n            cmdRegister(cmd.Name, {\n                layer: cmd.Layer,\n                prompt: cmd.Prompt,\n                target: cmd.Target,\n                targetFrame: cmd.TargetFrame,\n                resultColumns: cmd.ResultColumns,\n                filter: cmd.Filter,\n                matchLimit: cmd.MatchLimit,\n                title: cmd.Label\n            });\n        }\n        cmdsByKey[cmd.Name] = cmd;\n    }\n    return cmdsByKey;\n}\n\n/**\n * @hidden\n * \n * @param tbConf \n * @returns \n */\nexport function prepareSubMenus(tbConf: Dictionary<ToolbarConf>): [PreparedSubMenuSet, boolean] {\n    const prepared: PreparedSubMenuSet = {\n        toolbars: {},\n        flyouts: {}\n    };\n    let bFoundContextMenu = false;\n    for (const key in tbConf) {\n        if (key == WEBLAYOUT_CONTEXTMENU) {\n            bFoundContextMenu = true;\n        }\n\n        //Special cases: Task pane and Context Menu. Transfer all to flyout\n        if (key == WEBLAYOUT_TASKMENU || key == WEBLAYOUT_CONTEXTMENU) {\n            const flyoutId = key;\n            prepared.flyouts[flyoutId] = {\n                children: tbConf[key].items\n            }\n        } else {\n            prepared.toolbars[key] = {\n                items: []\n            };\n            for (const item of tbConf[key].items) {\n                //Special case: contextmenu is all inline\n                if (isFlyoutSpec(item) && key != WEBLAYOUT_CONTEXTMENU) {\n                    const flyoutId = `${item.label}_${shortid.generate()}`;\n                    prepared.toolbars[key].items.push({\n                        label: item.label,\n                        tooltip: item.tooltip,\n                        icon: item.icon,\n                        spriteClass: item.spriteClass,\n                        flyoutId: flyoutId\n                    } as ICommandSpec);\n                    prepared.flyouts[flyoutId] = {\n                        children: item.children\n                    }\n                } else {\n                    prepared.toolbars[key].items.push(item);\n                }\n            }\n        }\n    }\n    return [prepared, bFoundContextMenu]\n}","import {\n    IMapViewer,\n    ICommand,\n    Dictionary,\n    IInvokeUrlCommand,\n    ISearchCommand,\n    ITargetedCommand,\n    IApplicationState,\n    ReduxDispatch,\n    ReduxStore,\n    getSelectionSet,\n    getRuntimeMap,\n    DEFAULT_MODAL_SIZE,\n    NOOP,\n    ALWAYS_FALSE,\n    IInvokeUrlCommandParameter,\n    ActiveMapTool\n} from \"../../api/common\";\nimport { getFusionRoot } from \"../../api/runtime\";\nimport { IItem, IInlineMenu, IFlyoutMenu, IComponentFlyoutItem } from \"../../components/toolbar\";\nimport { tr } from \"../i18n\";\nimport { getAssetRoot } from \"../../utils/asset\";\nimport {\n    SPRITE_ICON_ERROR\n} from \"../../constants/assets\";\nimport { assertNever } from \"../../utils/never\";\nimport { ensureParameters } from \"../../utils/url\";\nimport { ActionType } from '../../constants/actions';\nimport { showModalUrl } from '../../actions/modal';\nimport { error } from '../../utils/logger';\n\nconst FUSION_ICON_REGEX = /images\\/icons\\/[a-zA-Z\\-]*.png/\n\nfunction fixIconPath(path: string): string {\n    if (FUSION_ICON_REGEX.test(path)) {\n        return `${getAssetRoot()}/${path}`.replace(/\\/\\//g, \"/\");\n    }\n    return path;\n}\n\nfunction fusionFixSpriteClass(tb: any, cmd?: ICommand): string | undefined {\n    if (tb.spriteClass) {\n        return tb.spriteClass;\n    }\n    if (cmd && cmd.iconClass) {\n        return cmd.iconClass;\n    }\n    return undefined;\n}\n\n/**\n * @hidden\n */\nexport function mergeInvokeUrlParameters(currentParameters: IInvokeUrlCommandParameter[], extraParameters?: any) {\n    const currentP = currentParameters.reduce<any>((prev, current, i, arr) => {\n        prev[current.name] = current.value;\n        return prev;\n    }, {});\n    if (extraParameters) {\n        const keys = Object.keys(extraParameters);\n        for (const k of keys) {\n            currentP[k] = extraParameters[k];\n        }\n    }\n    const merged: IInvokeUrlCommandParameter[] = [];\n    const mkeys = Object.keys(currentP);\n    for (const k of mkeys) {\n        merged.push({ name: k, value: currentP[k] });\n    }\n    return merged;\n}\n\nfunction fixChildItems(childItems: any[], state: IToolbarAppState, commandInvoker: (cmd: ICommand, parameters?: any) => void): IItem[] {\n    return childItems\n        .map(tb => mapToolbarReference(tb, state, commandInvoker))\n        .filter(tb => tb != null) as IItem[];\n}\n\n//TODO: This function should be its own react hook that layers on top of the\n//useDispatch() and useSelector() hooks provided by react-redux\n/**\n * @hidden\n */\nexport function mapToolbarReference(tb: any, state: IToolbarAppState, commandInvoker: (cmd: ICommand, parameters?: any) => void): IItem | IInlineMenu | IFlyoutMenu | IComponentFlyoutItem | null {\n    if (tb.error) {\n        const cmdItem: IItem = {\n            iconClass: SPRITE_ICON_ERROR,\n            tooltip: tb.error,\n            label: tr(\"ERROR\"),\n            selected: ALWAYS_FALSE,\n            enabled: ALWAYS_FALSE,\n            invoke: NOOP\n        };\n        return cmdItem;\n    } else if (tb.componentName) {\n        return {\n            icon: tb.icon,\n            iconClass: fusionFixSpriteClass(tb),\n            flyoutId: tb.flyoutId,\n            tooltip: tb.tooltip,\n            label: tb.label,\n            componentName: tb.componentName,\n            componentProps: tb.componentProps\n        };\n    } else if (tb.isSeparator === true) {\n        return { isSeparator: true };\n    } else if (tb.command) {\n        const cmd = getCommand(tb.command);\n        if (cmd != null) {\n            const cmdItem: IItem = {\n                icon: fixIconPath(tb.icon || cmd.icon),\n                iconClass: fusionFixSpriteClass(tb, cmd),\n                tooltip: tb.tooltip,\n                label: tb.label,\n                selected: () => cmd.selected(state),\n                enabled: () => cmd.enabled(state, tb.parameters),\n                invoke: () => commandInvoker(cmd, tb.parameters)\n            };\n            return cmdItem;\n        }\n    } else if (tb.children) {\n        const childItems: any[] = tb.children;\n        return {\n            icon: fixIconPath(tb.icon),\n            iconClass: fusionFixSpriteClass(tb),\n            label: tb.label,\n            tooltip: tb.tooltip,\n            childItems: fixChildItems(childItems, state, commandInvoker)\n        };\n    } else if (tb.label && tb.flyoutId) {\n        return {\n            icon: fixIconPath(tb.icon),\n            iconClass: fusionFixSpriteClass(tb),\n            label: tb.label,\n            tooltip: tb.tooltip,\n            flyoutId: tb.flyoutId\n        }\n    }\n    return null;\n}\n\n/**\n * A subset of IApplicationState that's only relevant for toolbar items\n * @since 0.13\n */\nexport interface IToolbarAppState {\n    /**\n     * @since 0.14\n     */\n    stateless: boolean;\n    visibleAndSelectableWmsLayerCount: number;\n    busyWorkerCount: number;\n    hasSelection: boolean;\n    /**\n     * @since 0.14\n     */\n    hasClientSelection: boolean;\n    hasPreviousView: boolean;\n    hasNextView: boolean;\n    featureTooltipsEnabled: boolean;\n    activeTool: ActiveMapTool;\n}\n\n/**\n * Helper function to reduce full application state to state relevant for toolbar items\n * \n * @param state The full application state\n * @since 0.13\n */\nexport function reduceAppToToolbarState(state: Readonly<IApplicationState>): Readonly<IToolbarAppState> {\n    let hasSelection = false;\n    let hasClientSelection = false;\n    let hasPreviousView = false;\n    let hasNextView = false;\n    let visibleWmsLayerCount = 0;\n    const selection = getSelectionSet(state);\n    hasSelection = (selection != null && selection.SelectedFeatures != null);\n    if (state.config.activeMapName) {\n        hasClientSelection = state.mapState[state.config.activeMapName].clientSelection != null;\n        hasPreviousView = state.mapState[state.config.activeMapName].historyIndex > 0;\n        hasNextView = state.mapState[state.config.activeMapName].historyIndex < state.mapState[state.config.activeMapName].history.length - 1;\n        visibleWmsLayerCount = (state.mapState[state.config.activeMapName].layers ?? []).filter(l => l.visible && l.selectable && l.type == \"WMS\").length;\n    }\n    return {\n        stateless: state.config.viewer.isStateless,\n        visibleAndSelectableWmsLayerCount: visibleWmsLayerCount,\n        busyWorkerCount: state.viewer.busyCount,\n        hasSelection,\n        hasClientSelection,\n        hasPreviousView,\n        hasNextView,\n        activeTool: state.viewer.tool,\n        featureTooltipsEnabled: state.viewer.featureTooltipsEnabled\n    }\n}\n\n/**\n * Common command condition evaluators\n *\n * @export\n * @class CommandConditions\n */\nexport class CommandConditions {\n    /**\n     * The viewer is not busy\n     *\n     * @static\n     * @param {Readonly<IToolbarAppState>} state\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static isNotBusy(state: Readonly<IToolbarAppState>): boolean {\n        return state.busyWorkerCount == 0;\n    }\n    /**\n     * The viewer has a MapGuide selection set\n     *\n     * @static\n     * @param {Readonly<IToolbarAppState>} state\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static hasSelection(state: Readonly<IToolbarAppState>): boolean {\n        return state.hasSelection;\n    }\n    /**\n     * The viewer has a client-side selection set\n     *\n     * @static\n     * @param state \n     * @returns \n     * \n     * @since 0.14\n     */\n    public static hasClientSelection(state: Readonly<IToolbarAppState>): boolean {\n        return state.hasClientSelection;\n    }\n    /**\n     * The command is set to be disabled if selection is empty\n     *\n     * @static\n     * @param {*} [parameters]\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static disabledIfEmptySelection(state: Readonly<IToolbarAppState>, parameters?: any): boolean {\n        if (!state.hasSelection) {\n            return (parameters != null && (parameters.DisableIfSelectionEmpty == \"true\" || parameters.DisableIfSelectionEmpty == true));\n        } else\n            return false;\n    }\n    /**\n     * The viewer has a previous view in the view navigation stack\n     *\n     * @static\n     * @param {Readonly<IToolbarAppState>} state\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static hasPreviousView(state: Readonly<IToolbarAppState>): boolean {\n        return state.hasPreviousView;\n    }\n    /**\n     * The viewer has a next view in the view navigation stack\n     *\n     * @static\n     * @param {Readonly<IToolbarAppState>} state\n     * @returns {boolean}\n     *\n     * @memberof CommandConditions\n     */\n    public static hasNextView(state: Readonly<IToolbarAppState>): boolean {\n        return state.hasNextView;\n    }\n}\n\n/**\n * The set of default command names\n *\n * @export\n * @class DefaultCommands\n */\nexport enum DefaultCommands {\n    Select = \"Select\",\n    Pan = \"Pan\",\n    Zoom = \"Zoom\",\n    MapTip = \"MapTip\",\n    ZoomIn = \"ZoomIn\",\n    ZoomOut = \"ZoomOut\",\n    RestoreView = \"RestoreView\",\n    ZoomExtents = \"ZoomExtents\",\n    SelectRadius = \"SelectRadius\",\n    SelectPolygon = \"SelectPolygon\",\n    ClearSelection = \"ClearSelection\",\n    ZoomToSelection = \"ZoomToSelection\",\n    PanLeft = \"PanLeft\",\n    PanRight = \"PanRight\",\n    PanUp = \"PanUp\",\n    PanDown = \"PanDown\",\n    RefreshMap = \"RefreshMap\",\n    PreviousView = \"PreviousView\",\n    NextView = \"NextView\",\n    About = \"About\",\n    Help = \"Help\",\n    Measure = \"Measure\",\n    ViewerOptions = \"ViewerOptions\",\n    Buffer = \"Buffer\",\n    SelectWithin = \"SelectWithin\",\n    QuickPlot = \"QuickPlot\",\n    Redline = \"Redline\",\n    FeatureInfo = \"FeatureInfo\",\n    Theme = \"Theme\",\n    Query = \"Query\",\n    Geolocation = \"Geolocation\",\n    CoordinateTracker = \"CoordinateTracker\",\n    /**\n     * @since 0.11\n     */\n    AddManageLayers = \"AddManageLayers\",\n    /**\n     * @since 0.11\n     */\n    CenterSelection = \"CenterSelection\",\n    /**\n     * @since 0.14\n     */\n    Print = \"Print\"\n}\n\nconst commands: Dictionary<ICommand> = {};\n\nfunction isInvokeUrlCommand(cmdDef: any): cmdDef is IInvokeUrlCommand {\n    return typeof cmdDef.url !== 'undefined';\n}\n\nfunction isSearchCommand(cmdDef: any): cmdDef is ISearchCommand {\n    return typeof cmdDef.layer !== 'undefined';\n}\n\nfunction openModalUrl(name: string, dispatch: ReduxDispatch, url: string, modalTitle?: string) {\n    dispatch(showModalUrl({\n        modal: {\n            title: modalTitle || tr(name as any),\n            backdrop: false,\n            size: DEFAULT_MODAL_SIZE,\n            overflowYScroll: true\n        },\n        name: name,\n        url: url\n    }));\n}\n\nexport function isSupportedCommandInStatelessMode(name: string | undefined) {\n    switch (name) {\n        case DefaultCommands.Select:\n        case DefaultCommands.MapTip:\n        case DefaultCommands.QuickPlot:\n        case DefaultCommands.SelectRadius:\n        case DefaultCommands.SelectPolygon:\n        case DefaultCommands.ClearSelection:\n        case DefaultCommands.ZoomToSelection:\n        case DefaultCommands.Buffer:\n        case DefaultCommands.SelectWithin:\n        case DefaultCommands.Redline:\n        case DefaultCommands.FeatureInfo:\n        case DefaultCommands.Query:\n        case DefaultCommands.Theme:\n        case DefaultCommands.CenterSelection:\n            return false;\n    }\n    return true;\n}\n\n/**\n * Opens the given URL in the specified target\n *\n * @hidden\n * @param name\n * @param cmdDef\n * @param dispatch\n * @param url\n */\nexport function openUrlInTarget(name: string, cmdDef: ITargetedCommand, hasTaskPane: boolean, dispatch: ReduxDispatch, url: string, modalTitle?: string): void {\n    const target = cmdDef.target;\n    if (target == \"TaskPane\") {\n        //If there's no actual task pane, fallback to modal dialog\n        if (!hasTaskPane) {\n            openModalUrl(name, dispatch, url, modalTitle);\n        } else {\n            dispatch({\n                type: ActionType.TASK_INVOKE_URL,\n                payload: {\n                    url: url\n                }\n            });\n        }\n    } else if (target == \"NewWindow\") {\n        openModalUrl(name, dispatch, url, modalTitle);\n    } else if (target == \"SpecifiedFrame\") {\n        if (cmdDef.targetFrame) {\n            const frames = (window as any).frames as any[];\n            let bInvoked = false;\n            for (let i = 0; i < frames.length; i++) {\n                if (frames[i].name == cmdDef.targetFrame) {\n                    frames[i].location = url;\n                    bInvoked = true;\n                    break;\n                }\n            }\n            if (!bInvoked) {\n                error(`Frame not found: ${cmdDef.targetFrame}`);\n            }\n        } else {\n            error(`Command ${name} has a target of \"SpecifiedFrame\", but does not specify a target frame`);\n        }\n    } else {\n        assertNever(target);\n    }\n}\n\n/**\n * Registers a viewer command\n *\n * @export\n * @param {string} name\n * @param {(ICommand | IInvokeUrlCommand | ISearchCommand)} cmdDef\n */\nexport function registerCommand(name: string, cmdDef: ICommand | IInvokeUrlCommand | ISearchCommand) {\n    let cmd: ICommand;\n    if (isInvokeUrlCommand(cmdDef)) {\n        cmd = {\n            icon: cmdDef.icon,\n            iconClass: cmdDef.iconClass,\n            title: cmdDef.title,\n            enabled: (state) => {\n                if (cmdDef.disableIfSelectionEmpty === true) {\n                    return CommandConditions.hasSelection(state);\n                }\n                return true;\n            },\n            selected: () => false,\n            invoke: (dispatch: ReduxDispatch, getState: () => IApplicationState, viewer: IMapViewer, parameters?: any) => {\n                const state = getState();\n                const config = state.config;\n                const map = getRuntimeMap(state);\n                const params = mergeInvokeUrlParameters(cmdDef.parameters, parameters);\n                const url = ensureParameters(cmdDef.url, map?.Name, map?.SessionId, config.locale, true, params);\n                openUrlInTarget(name, cmdDef, config.capabilities.hasTaskPane, dispatch, url, cmd.title);\n            }\n        };\n    } else if (isSearchCommand(cmdDef)) {\n        cmd = {\n            icon: cmdDef.icon,\n            iconClass: cmdDef.iconClass,\n            title: cmdDef.title,\n            enabled: state => !state.stateless,\n            selected: () => false,\n            invoke: (dispatch: ReduxDispatch, getState: () => IApplicationState, viewer: IMapViewer, parameters?: any) => {\n                const state = getState();\n                const config = state.config;\n                const map = getRuntimeMap(state);\n                if (map) {\n                    const url = ensureParameters(`${getFusionRoot()}/widgets/Search/SearchPrompt.php`, map.Name, map.SessionId, config.locale, false)\n                        + `&popup=0`\n                        + `&target=TaskPane`\n                        + `&title=${encodeURIComponent(cmdDef.title)}`\n                        + `&prompt=${encodeURIComponent(cmdDef.prompt)}`\n                        + `&layer=${encodeURIComponent(cmdDef.layer)}`\n                        + `&pointZoomLevel=${parameters.PointZoomLevel}`\n                        + (cmdDef.filter ? `&filter=${encodeURIComponent(cmdDef.filter)}` : '')\n                        + `&limit=${cmdDef.matchLimit}`\n                        + `&properties=${(cmdDef.resultColumns.Column || []).map(col => col.Property).join(\",\")}`\n                        + `&propNames=${(cmdDef.resultColumns.Column || []).map(col => col.Name).join(\",\")}`;\n                    openUrlInTarget(name, cmdDef, config.capabilities.hasTaskPane, dispatch, url, cmd.title);\n                }\n            }\n        };\n    } else {\n        cmd = cmdDef;\n    }\n    commands[name] = cmd;\n}\n\n/**\n * Gets a registered viewer command by its name\n *\n * @export\n * @param {string} name\n * @returns {(ICommand | undefined)}\n */\nexport function getCommand(name: string): ICommand | undefined {\n    return commands[name];\n}","import * as React from \"react\";\nimport { Error } from \"../../components/error\";\nimport { tr } from \"../i18n\";\n\n/**\n * The default set of component names\n *\n * @export\n * @class DefaultComponentNames\n */\nexport enum DefaultComponentNames {\n    Legend = \"Legend\",\n    SelectionPanel = \"SelectionPanel\",\n    Map = \"Map\",\n    Navigator = \"Navigator\",\n    MouseCoordinates = \"MouseCoordinates\",\n    ScaleDisplay = \"ScaleDisplay\",\n    SelectedFeatureCount = \"SelectedFeatureCount\",\n    PoweredByMapGuide = \"PoweredByMapGuide\",\n    TaskPane = \"TaskPane\",\n    About = \"About\",\n    SessionExpired = \"SessionExpired\",\n    Measure = \"Measure\",\n    ViewerOptions = \"ViewerOptions\",\n    QuickPlot = \"QuickPlot\",\n    BaseMapSwitcher = \"BaseMapSwitcher\",\n    MapMenu = \"MapMenu\",\n    ViewSize = \"ViewSize\",\n    CoordinateTracker = \"CoordinateTracker\",\n    AddManageLayers = \"AddManageLayers\",\n    ShareLinkToView = \"ShareLinkToView\"\n}\n\n/**\n * A react component factory function signature\n */\nexport type ComponentFactory = (props: any) => JSX.Element;\n\nconst components: { [id: string]: ComponentFactory } = {};\n\n/**\n * Registers a react component factory function for the given component id\n *\n * @export\n * @param {string} id\n * @param {ComponentFactory} factory\n */\nexport function registerComponentFactory(id: string, factory: ComponentFactory): void {\n    components[id] = factory;\n}\n\n/**\n * Gets the registered component factory function for the given component id\n *\n * @export\n * @param {string} id\n * @returns {ComponentFactory}\n */\nexport function getComponentFactory(id: string): ComponentFactory | undefined {\n    return components[id];\n}\n\n/**\n * Placeholder component properties\n *\n * @export\n * @interface IPlaceholderComponentProps\n */\nexport interface IPlaceholderComponentProps {\n    /**\n     * The id of the component this placeholder is for\n     *\n     * @type {string}\n     * @memberOf IPlaceholderComponentProps\n     */\n    id: string;\n    /**\n     * The locale\n     *\n     * @type {string}\n     * @memberOf IPlaceholderComponentProps\n     */\n    locale?: string;\n    /**\n     * The props of the underlying component\n     *\n     * @type {*}\n     * @memberOf IPlaceholderComponentProps\n     */\n    componentProps?: any;\n}\n\n/**\n * A component placeholder\n *\n * @export\n * @class PlaceholderComponent\n * @extends {React.Component<IPlaceholderComponentProps, any>}\n */\nexport class PlaceholderComponent extends React.Component<IPlaceholderComponentProps, any> {\n    constructor(props: IPlaceholderComponentProps) {\n        super(props);\n    }\n    render(): JSX.Element {\n        const { id, componentProps } = this.props;\n        const factory = getComponentFactory(id);\n        if (factory) {\n            return factory(componentProps);\n        } else {\n            return <Error error={tr(\"ERR_UNREGISTERED_COMPONENT\", this.props.locale, { componentId: id })} />;\n        }\n    }\n}","import BaseLayer from 'ol/layer/Base';\nimport { IGenericSubjectMapLayerMetadata } from '../../actions/defs';\nimport { Dictionary } from '../common';\n\n/**\n * A factory method for creating OpenLayers layers from a JSON definition\n * \n * @since 0.14\n */\nexport type ExternalLayerCreator = (data: any, meta: IGenericSubjectMapLayerMetadata | undefined, layerOptions: any, appSettings: Dictionary<string>) => BaseLayer;\n\n/**\n * Defines a registry of custom vector layer source drivers\n */\nexport class ExternalLayerFactoryRegistry {\n\n    private static _instance: ExternalLayerFactoryRegistry = new ExternalLayerFactoryRegistry();\n\n    private _vectorCreators: { [driverName: string]: ExternalLayerCreator } = {};\n\n    constructor() {\n        if (ExternalLayerFactoryRegistry._instance) {\n            throw new Error(\"Error: Instantiation failed: Use ExternalLayerFactoryRegistry.getInstance() instead of new.\");\n        }\n        ExternalLayerFactoryRegistry._instance = this;\n    }\n\n    /**\n     * Gets the registry instance\n     * @since 0.14\n     */\n    public static getInstance(): ExternalLayerFactoryRegistry {\n        return ExternalLayerFactoryRegistry._instance;\n    }\n\n    /**\n     * Registers the given external vector layer factory method\n     * \n     * @param driverName \n     * @param creator \n     * @since 0.14\n     */\n    public registerExternalVectorLayerCreator(driverName: string, creator: ExternalLayerCreator) {\n        this._vectorCreators[driverName] = creator;\n    }\n\n    /**\n     * Gets the external vector layer factory method for the given driver\n     * \n     * @param driverName \n     */\n    public getExternalVectorLayerCreator(driverName: string): ExternalLayerCreator | undefined {\n        return this._vectorCreators[driverName];\n    }\n}","/**\n * A react layout template component factory function signature\n */\nexport type LayoutFactory = (() => JSX.Element);\n\n/**\n * Capabilities of a viewer layout template\n * \n * @since 0.14\n */\nexport type LayoutCapabilities = {\n    /**\n     * Indicates if this viewer layout template has a task pane\n     */\n    readonly hasTaskPane: boolean;\n};\n\nconst layouts: { [key: string]: LayoutFactory } = {};\nconst layoutCaps: { [key: string]: LayoutCapabilities } = {};\n\n/**\n * Gets the capabilities of the given layout template\n * \n * @param name \n * @returns \n * @since 0.14\n */\nexport function getLayoutCapabilities(name: string): LayoutCapabilities | undefined {\n    return layoutCaps[name];\n}\n\n/**\n * Register the given react layout template component factory function for the given\n * template name\n *\n * @export\n * @param {string} name\n * @param {LayoutFactory} factory\n * @param caps The capabilities of this template\n * @since 0.14 \n */\nexport function registerLayout(name: string, factory: LayoutFactory, caps: LayoutCapabilities) {\n    layouts[name] = factory;\n    layoutCaps[name] = caps;\n}\n\n/**\n * Gets the registerd react layout template component factory function for the given\n * template name\n *\n * @export\n * @param {string} name\n * @returns {LayoutFactory}\n */\nexport function getLayout(name: string): LayoutFactory {\n    return layouts[name];\n}","import proj4 from \"proj4\";\nimport { MgError } from '../error';\nimport { tr } from '../i18n';\nimport { strIsNullOrEmpty } from '../../utils/string';\nimport { register } from 'ol/proj/proj4';\nimport { debug } from '../../utils/logger';\n\n/**\n * Performs a projection definititon lookup at epsg.io for the given EPSG code\n *\n * @export\n * @param {string | number} epsg\n * @param {string} locale\n * @param {string} mapDef\n * @returns {Promise<any>}\n * @since 0.13\n */\nexport async function resolveProjectionFromEpsgIoAsync(epsg: string | number, locale: string, mapDef: string): Promise<any> {\n    const r = await fetch(`//epsg.io?format=json&q=${epsg}`);\n    const resp = await r.json();\n    if (resp.results && resp.results.length > 0) {\n        proj4.defs(`EPSG:${epsg}`, resp.results[0].proj4);\n        debug(`Registered projection EPSG:${epsg} from epsg.io`);\n        return proj4.defs[`EPSG:${epsg}`];\n    } else {\n        throw new MgError(tr(\"INIT_ERROR_UNREGISTERED_EPSG_CODE\", locale, { epsg: epsg, mapDefinition: mapDef }));\n    }\n}\n\n/**\n * Ensures the given projection (by EPSG code) exists and if not invokes the given factory function (or does an epsg.io lookup)\n * to fetch the definition to be registered.\n * \n * Once registered, it will update the projection set within OpenLayers\n * \n * @export\n * @param {number} epsgCode\n * @param {() => Promise<string>} [factoryIfNotFound] A custom factory function to provide the required proj4js string for this projection. If not specified, a lookup to epsg.io will be done instead\n * @param {string} alias\n * @returns {Promise<string>}\n * @since 0.13\n */\nexport async function ensureProjection(epsgCode: number, locale: string, alias?: string, factoryIfNotFound?: () => Promise<string>): Promise<[number, string]> {\n    let resolvedName: string;\n    let bAdded = false;\n    const name = `EPSG:${epsgCode}`;\n    if (proj4.defs[name]) {\n        resolvedName = name;\n    } else {\n        if (factoryIfNotFound) {\n            proj4.defs[name] = factoryIfNotFound();\n            bAdded = true;\n            resolvedName = name;\n        } else {\n            await resolveProjectionFromEpsgIoAsync(epsgCode, locale, \"\");\n            resolvedName = name;\n        }\n    }\n    //Register the alias if specified\n    if (!strIsNullOrEmpty(alias) && !proj4.defs[alias]) {\n        proj4.defs[alias] = proj4.defs[resolvedName];\n        bAdded = true;\n    }\n    //Need to call re-register if proj4.defs got changed so OL can pick it up\n    if (bAdded) {\n        register(proj4);\n    }\n    return [epsgCode, resolvedName];\n}","import { SelectionVariant } from './common';\nimport { ResourceIdentifier, ResourceBase, SiteVersionResponse } from './contracts/common';\nimport { RuntimeMap } from './contracts/runtime-map';\nimport { QueryMapFeaturesResponse } from './contracts/query';\n\n/**\n * Describes a request that takes either a session or username/password pair\n *\n * @export\n * @interface IAuthenticatedRequest\n */\nexport interface IAuthenticatedRequest {\n    /**\n     * The session id\n     *\n     * @type {string}\n     * @memberOf IAuthenticatedRequest\n     */\n    session?: string;\n    /**\n     * The username\n     *\n     * @type {string}\n     * @memberOf IAuthenticatedRequest\n     */\n    username?: string;\n    /**\n     * The password\n     *\n     * @type {string}\n     * @memberOf IAuthenticatedRequest\n     */\n    password?: string;\n}\n\n/**\n * Bitmask describing what data to return when creating a runtime map\n *\n * @export\n * @enum {number}\n */\nexport enum RuntimeMapFeatureFlags {\n    /**\n     * Include data about layers and groups\n     */\n    LayersAndGroups = 1,\n    /**\n     * Include layer icons\n     */\n    LayerIcons = 2,\n    /**\n     * Include data about layer feature sources\n     */\n    LayerFeatureSources = 4\n}\n\n/**\n * Describes options for creating a runtime map\n *\n * @export\n * @interface ICreateRuntimeMapOptions\n * @extends {IAuthenticatedRequest}\n */\nexport interface ICreateRuntimeMapOptions extends IAuthenticatedRequest {\n    /**\n     * The map definition id\n     *\n     * @type {ResourceIdentifier}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    mapDefinition: ResourceIdentifier;\n    /**\n     * A bitmask indicating what data to return\n     *\n     * @type {(number | RuntimeMapFeatureFlags)}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    requestedFeatures: number | RuntimeMapFeatureFlags;\n    /**\n     * If requesting icons, the number of icons per scale range\n     *\n     * @type {number}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    iconsPerScaleRange?: number;\n    /**\n     * The image format for requested icons\n     *\n     * @type {(\"PNG\" | \"PNG8\" | \"GIF\" | \"JPG\")}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    iconFormat?: \"PNG\" | \"PNG8\" | \"GIF\" | \"JPG\";\n    /**\n     * The width of requested icons\n     *\n     * @type {number}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    iconWidth?: number;\n    /**\n     * The height of requested icons\n     *\n     * @type {number}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    iconHeight?: number;\n    /**\n     * The target map name to assign. Otherwise the map name will be computed from the map definition id\n     *\n     * @type {string}\n     * @memberOf ICreateRuntimeMapOptions\n     */\n    targetMapName?: string;\n}\n\n/**\n * Describes operations requiring a session id\n *\n * @export\n * @interface ISessionBasedRequest\n */\nexport interface ISessionBasedRequest {\n    /**\n     * The session id\n     *\n     * @type {string}\n     * @memberOf ISessionBasedRequest\n     */\n    session: string;\n}\n\n/**\n * Describes operations against a runtime map\n *\n * @export\n * @interface IRuntimeMapRequest\n * @extends {ISessionBasedRequest}\n */\nexport interface IRuntimeMapRequest extends ISessionBasedRequest {\n    /**\n     * The name of the runtime map\n     *\n     * @type {string}\n     * @memberOf IRuntimeMapRequest\n     */\n    mapname: string;\n}\n\n/**\n * A bitmask indicating what to return when querying map features\n *\n * @export\n * @enum {number}\n */\nexport enum QueryFeaturesSet {\n    /**\n     * Include attributes of selected features\n     */\n    Attributes = 1,\n    /**\n     * Include an inline image of the selected features\n     */\n    InlineSelection = 2,\n    /**\n     * Include tooltips for the first matching feature\n     */\n    Tooltip = 4,\n    /**\n     * Include hyperlink for the first matching feature\n     */\n    Hyperlink = 8\n}\n\n\n\n/**\n * Options for querying map features\n *\n * @export\n * @interface IQueryMapFeaturesOptions\n * @extends {IRuntimeMapRequest}\n */\nexport interface IQueryMapFeaturesOptions extends IRuntimeMapRequest {\n    /**\n     * A comma-seperated list of layer name to restrict the query on. Omit to\n     * cover all selectable layers\n     *\n     * @type {string}\n     */\n    layernames?: string;\n    /**\n     * The WKT of the query geometry\n     *\n     * @type {string}\n     */\n    geometry?: string;\n    /**\n     * The spatial query operator to use with the input geometry\n     *\n     * @type {SelectionVariant}\n     */\n    selectionvariant?: SelectionVariant;\n    /**\n     * A bitmask containing what features to ask for\n     *\n     * @type {QueryFeaturesSet}\n     */\n    requestdata?: QueryFeaturesSet;\n    /**\n     * The color of the selection\n     *\n     * @type {string}\n     */\n    selectioncolor?: string;\n    /**\n     * The image format of the requested selection image\n     *\n     * @type {(\"PNG\" | \"JPG\" | \"GIF\" | \"PNG8\")}\n     */\n    selectionformat?: \"PNG\" | \"JPG\" | \"GIF\" | \"PNG8\";\n    /**\n     * The maximum number of features to select. Use -1 for no limit.\n     *\n     * @type {number}\n     */\n    maxfeatures?: number;\n    /**\n     * 1 = Persist the query selection changes to the current selection set\n     * 0 = The query selection does not modify the current selection set\n     *\n     * @type {number}\n     */\n    persist?: number;\n    /**\n     * An optional selection XML string. If specified, the rendering/query will be based off of\n     * a selection initialized with this selection XML\n     */\n    featurefilter?: string;\n    layerattributefilter?: number;\n}\n\n/**\n * Options for describing a runtime map\n *\n * @export\n * @interface IDescribeRuntimeMapOptions\n * @extends {IRuntimeMapRequest}\n */\nexport interface IDescribeRuntimeMapOptions extends IRuntimeMapRequest {\n    /**\n     * A bitmask of data to return about a runtime map\n     *\n     * @type {(number | RuntimeMapFeatureFlags)}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    requestedFeatures?: number | RuntimeMapFeatureFlags;\n    /**\n     * If requesting icons, the number of icons per scale range\n     *\n     * @type {number}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    iconsPerScaleRange?: number;\n    /**\n     * The image format for requested icons\n     *\n     * @type {(\"PNG\" | \"PNG8\" | \"GIF\" | \"JPG\")}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    iconFormat?: \"PNG\" | \"PNG8\" | \"GIF\" | \"JPG\";\n    /**\n     * The width of requested icons\n     *\n     * @type {number}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    iconWidth?: number;\n    /**\n     * The height of requested icons\n     *\n     * @type {number}\n     * @memberOf IDescribeRuntimeMapOptions\n     */\n    iconHeight?: number;\n}\n\n/**\n * Provides client services for a MapGuide map viewer\n *\n * @export\n * @interface IMapGuideClient\n */\nexport interface IMapGuideClient {\n    /**\n     * Creates a new MapGuide session\n     *\n     * @param {string} username\n     * @param {string} password\n     * @returns {Promise<string>}\n     */\n    createSession(username: string, password: string): Promise<string>;\n\n    /**\n     * Retrieves the requested resource\n     *\n     * @abstract\n     * @template T\n     * @param {string} resourceId\n     * @returns {PromiseLike<T>}\n     */\n    getResource<T extends ResourceBase>(resourceId: ResourceIdentifier, args?: any): Promise<T>;\n\n    /**\n     * Creates a runtime map from the specified map definition\n     *\n     * @abstract\n     * @param {ICreateRuntimeMapOptions} options\n     * @returns {PromiseLike<RuntimeMap>}\n     */\n    createRuntimeMap(options: ICreateRuntimeMapOptions): Promise<RuntimeMap>;\n\n    /**\n     * Performs a map selection query on the current map\n     *\n     * @abstract\n     * @param {IQueryMapFeaturesOptions} options\n     * @returns {PromiseLike<QueryMapFeaturesResponse>}\n     */\n    queryMapFeatures(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse>;\n\n    /**\n     * Performs a map selection query on the current map. Only applicable for use with MapGuide\n     * Open Source 4.0 and higher\n     *\n     * @abstract\n     * @param {IQueryMapFeaturesOptions} options\n     * @returns {PromiseLike<QueryMapFeaturesResponse>}\n     */\n    queryMapFeatures_v4(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse>;\n\n    /**\n     * Describes a runtime map\n     *\n     * @abstract\n     * @param {IDescribeRuntimeMapOptions} options\n     * @returns {PromiseLike<RuntimeMap>}\n     */\n    describeRuntimeMap(options: IDescribeRuntimeMapOptions): Promise<RuntimeMap>;\n\n    /**\n     * Gets the tile template URL used by the viewer to send tile requests\n     *\n     * @param {string} resourceId\n     * @param {string} groupName\n     * @param {string} xPlaceholder\n     * @param {string} yPlaceholder\n     * @param {string} zPlaceholder\n     * @returns {string}\n     */\n    getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string;\n}\n\n/**\n * An abstract MapGuide service client\n *\n * @export\n * @abstract\n * @class RequestBuilder\n * @implements {IMapGuideClient}\n */\nexport abstract class RequestBuilder implements IMapGuideClient {\n    protected agentUri: string;\n    constructor(agentUri: string) {\n        this.agentUri = agentUri;\n    }\n\n    public abstract createSession(username: string, password: string): Promise<string>;\n\n    public abstract getServerSessionTimeout(session: string): Promise<number>;\n\n    public abstract getResource<T extends ResourceBase>(resourceId: ResourceIdentifier, args?: any): Promise<T>;\n\n    public abstract createRuntimeMap(options: ICreateRuntimeMapOptions): Promise<RuntimeMap>;\n\n    public abstract queryMapFeatures(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse>;\n\n    public abstract queryMapFeatures_v4(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse>;\n\n    public abstract describeRuntimeMap(options: IDescribeRuntimeMapOptions): Promise<RuntimeMap>;\n\n    public abstract getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string;\n\n    public abstract getSiteVersion(): Promise<SiteVersionResponse>;\n}","/**\n * runtime.ts\n *\n * This represents a runtime environment where components can interact with the map viewer\n * in the traditional way. This module is mainly for servicing the AJAX viewer API emulation.\n *\n * Where possible, use actions instead of this module\n */\nimport { IMapViewer } from \"../api/common\";\nimport { debug } from '../utils/logger';\n\nlet _fusionRoot: string | undefined;\nlet _viewer: IMapViewer | undefined;\n\n/**\n * Sets the Fusion base URL\n *\n * @export\n * @param {string} root\n */\nexport function setFusionRoot(root: string): void {\n    _fusionRoot = root;\n    debug(`Fusion root set to: ${root}. Access to Fusion backend services and widget content will be relative to this value`);\n}\n\n/**\n * Gets the Fusion base URL\n *\n * @export\n * @returns {string}\n */\nexport function getFusionRoot(): string {\n    return _fusionRoot || \"../fusion\";\n}\n\n/**\n * Sets the viewer instance. Called by the map viewer component when it has mounted.\n *\n * DO NOT CALL DIRECTLY\n *\n * @hidden\n * @param {IMapViewer} viewer\n */\nexport function setViewer(viewer: IMapViewer): void {\n    _viewer = viewer;\n}\n\n/**\n * Gets whether the runtime environment is ready\n *\n * @export\n * @returns {boolean}\n */\nexport function isReady(): boolean {\n    return _viewer != null;\n}\n\n/**\n * Gets the map viewer in this runtime environment\n *\n * @export\n * @returns {IMapViewer}\n * @deprecated You should be using the map provider context accessed via the {@link useMapProviderContext} hook where possible\n */\nexport function getViewer(): IMapViewer | undefined {\n    return _viewer;\n}","import { ClientSelectionSet } from \"./contracts/common\";\nimport { SelectedFeatureSet, FeatureSet } from \"./contracts/query\";\n\nfunction isSelectedFeatureSet(ss: SelectedFeatureSet | FeatureSet): ss is SelectedFeatureSet {\n    return (ss as any).SelectedLayer;\n}\n\nexport function countSelection(mgSelection?: SelectedFeatureSet | FeatureSet, clientSelection?: ClientSelectionSet) {\n    const summary = { total: 0, layerCount: 0 };\n    if (mgSelection) {\n        if (isSelectedFeatureSet(mgSelection)) {\n            summary.layerCount = mgSelection.SelectedLayer.length;\n            for (const lyr of mgSelection.SelectedLayer) {\n                summary.total += lyr.Feature?.length ?? 0;\n            }\n        } else {\n            summary.layerCount = mgSelection.Layer.length;\n            for (const lyr of mgSelection.Layer) {\n                summary.total += lyr.Class?.ID?.length ?? 0;\n            }\n        }\n    }\n    if (clientSelection) {\n        summary.layerCount = clientSelection.layers.length;\n        for (const lyr of clientSelection.layers) {\n            summary.total += lyr.features?.length ?? 0;\n        }\n    }\n    if (summary.total == 0 && summary.layerCount == 0) {\n        return undefined;\n    }\n    return summary;\n}","import { strStartsWith } from '../utils/string';\nimport { QueryMapFeaturesResponse } from './contracts/query';\nimport { AsyncLazy } from './lazy';\n\n/**\n * session-store.ts\n * \n * A thin-wrapper layer over local storage for storing any data related to viewer sessions\n */\n\n/**\n * @since 0.12\n */\nexport async function clearSessionStore(): Promise<void> {\n    try {\n        for (const key in window.localStorage) {\n            if (strStartsWith(key, \"selection_\")) {\n                window.localStorage.removeItem(key);\n            }\n        }\n    } catch (e) {\n\n    }\n}\n\nfunction encodeKey(sessionId: string, mapName: string) {\n    return `selection_${sessionId}_${mapName}`;\n}\n\nexport async function persistSelectionSetToLocalStorage(sessionId: string, mapName: string, resp: QueryMapFeaturesResponse): Promise<void> {\n    const key = encodeKey(sessionId, mapName);\n    const value = JSON.stringify(resp);\n    try {\n        window.localStorage.setItem(key, value);\n    } catch (e) {\n\n    }\n}\n\nexport async function retrieveSelectionSetFromLocalStorage(sessionId: AsyncLazy<string>, mapName: string): Promise<QueryMapFeaturesResponse | undefined> {\n    const key = encodeKey(await sessionId.getValueAsync(), mapName);\n    const content = window.localStorage.getItem(key);\n    if (content) {\n        return JSON.parse(content);\n    }\n}","import * as React from \"react\";\nimport {\n    GenericEvent\n} from \"../api/common\";\nimport { Collapse, Icon as BpIcon, ResizeSensor, IResizeEntry } from '@blueprintjs/core';\n\n/**\n * Accordion panel dimensions\n *\n * @export\n * @interface IAccordionPanelContentDimensions\n */\nexport interface IAccordionPanelContentDimensions {\n    width: number;\n    height: number;\n}\n\n/**\n * Describes a panel in the accordion\n *\n * @export\n * @interface IAccordionPanelSpec\n */\nexport interface IAccordionPanelSpec {\n    id: string;\n    title: string;\n    contentRenderer: (dim: IAccordionPanelContentDimensions, isResizing?: boolean) => JSX.Element;\n}\n\n/**\n * Accordion component props\n *\n * @export\n * @interface IAccordionProps\n */\nexport interface IAccordionProps {\n    style: React.CSSProperties;\n    panels: IAccordionPanelSpec[];\n    onActivePanelChanged?: (id: string) => void;\n    activePanelId?: string;\n    isResizing?: boolean;\n}\n\nconst PANEL_HEADER_HEIGHT = 24;\n\nfunction validatePanelId(panels: IAccordionPanelSpec[], id: string | undefined): string | null {\n    if (!id) {\n        return null;\n    }\n    const panel = panels.filter(p => p.id == id)[0];\n    if (panel) {\n        return id;\n    }\n    return null;\n}\n\n/**\n * A generic, reusable Accordion component\n * @param props \n */\nexport const Accordion = (props: IAccordionProps) => {\n    const { style, panels, isResizing, onActivePanelChanged } = props;\n    const activeId = validatePanelId(props.panels, props.activePanelId);\n    const [dim, setDim] = React.useState<Pick<DOMRectReadOnly, \"width\" | \"height\">>({\n        width: -1,\n        height: -1\n    });\n    const [openPanel, setOpenPanel] = React.useState(activeId || panels[panels.length - 1].id);\n    React.useEffect(() => {\n        setOpenPanel(activeId || panels[panels.length - 1].id);\n    }, [activeId]);\n    const onResize = (entries: IResizeEntry[]) => {\n        setDim(entries[0].contentRect);\n    };\n    const onTogglePanel = (e: GenericEvent) => {\n        const id = e.currentTarget.attributes[\"data-accordion-panel-id\"].value;\n        if (openPanel != id) {\n            setOpenPanel(id);\n            onActivePanelChanged?.(id);\n        }\n    }\n    return <ResizeSensor onResize={onResize}>\n        <div style={style} className=\"component-accordion\">\n            {panels.map(p => {\n                const isOpen = (p.id == openPanel);\n                return <div key={p.id} className=\"component-accordion-panel\">\n                    <div className=\"component-accordion-panel-header\" style={{ height: PANEL_HEADER_HEIGHT }} data-accordion-panel-id={p.id} onClick={onTogglePanel}>\n                        <BpIcon icon={isOpen ? \"chevron-up\" : \"chevron-down\"} /> {p.title}\n                    </div>\n                    <Collapse isOpen={isOpen}>\n                        {p.contentRenderer({ width: dim.width, height: (dim.height - (panels.length * PANEL_HEADER_HEIGHT)) }, isResizing)}\n                    </Collapse>\n                </div>;\n            })}\n        </div>\n    </ResizeSensor>;\n}","import * as React from \"react\";\nimport { IExternalBaseLayer } from \"../api/common\";\nimport { STR_EMPTY, strIsNullOrEmpty } from \"../utils/string\";\nimport { tr } from \"../api/i18n\";\n\n/**\n * BaseLayersSwitcher component props\n *\n * @export\n * @interface IBaseLayerSwitcherProps\n */\nexport interface IBaseLayerSwitcherProps {\n    locale: string | undefined;\n    externalBaseLayers: IExternalBaseLayer[];\n    onBaseLayerChanged?: (name: string) => void;\n}\n\n/**\n * The BaseLayerSwitcher component provides a user interface for switching the active external\n * base layer of the current map\n * @param props \n */\nexport const BaseLayerSwitcher = (props: IBaseLayerSwitcherProps) => {\n    const { locale, externalBaseLayers } = props;\n    const visLayers = externalBaseLayers.filter(layer => layer.visible === true);\n    const [selected, setSelected] = React.useState(visLayers.length == 1 ? visLayers[0].name : STR_EMPTY);\n    const onBaseLayerChanged = (e: any) => {\n        const value = e.currentTarget.value;\n        setSelected(value);\n        props.onBaseLayerChanged?.(value);\n    }\n    React.useEffect(() => {\n        setSelected(visLayers.length == 1 ? visLayers[0].name : STR_EMPTY);\n    }, [visLayers]);\n    return <div>\n        <div className=\"base-layer-switcher-item-container\">\n            <label className=\"bp3-control bp3-radio\">\n                <input className=\"base-layer-switcher-option\" type=\"radio\" value={STR_EMPTY} checked={strIsNullOrEmpty(selected)} onChange={onBaseLayerChanged} />\n                <span className=\"bp3-control-indicator\" />\n                {tr(\"NONE\", locale)}\n            </label>\n        </div>\n        {externalBaseLayers.map(layer => {\n            return <div className=\"base-layer-switcher-item-container\" key={`base-layer-${layer.name}`}>\n                <label className=\"bp3-control bp3-radio\">\n                    <input className=\"base-layer-switcher-option\" type=\"radio\" value={layer.name} checked={layer.name === selected} onChange={onBaseLayerChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {layer.name}\n                </label>\n            </div>;\n        })}\n    </div>;\n}","import * as React from \"react\";\nimport { Collapse, Button, Intent, Card } from '@blueprintjs/core';\nimport { tr } from \"../api/i18n\";\nimport { NBSP } from '../constants';\nimport { DEFAULT_COLOR } from '../api/ol-style-contracts';\nimport { HexColorPicker } from \"react-colorful\";\n\n/**\n * Color picker props\n * \n * @since 0.13\n */\nexport interface IColorPickerProps {\n    value?: string;\n    locale: string;\n    onChange: (value: string) => void;\n    disabled?: boolean;\n}\n\n/**\n * A basic color picker component\n * \n * @since 0.13\n */\nexport const ColorPicker = (props: IColorPickerProps) => {\n    const [isPickerOpen, setIsPickerOpen] = React.useState(false);\n    const onPickerToggle = () => {\n        setIsPickerOpen(!isPickerOpen);\n    };\n    return <div>\n        <button disabled={props.disabled} style={{ width: 80, borderRadius: 3, backgroundColor: props.value ?? DEFAULT_COLOR }} onClick={onPickerToggle}>{NBSP}{NBSP}{NBSP}</button>\n        <Collapse isOpen={isPickerOpen}>\n            <Card>\n                <HexColorPicker style={{ width: \"100%\" }} color={props.value ?? DEFAULT_COLOR} onChange={(c: any) => props.onChange(c)} />\n                <Button icon=\"chevron-up\" intent={Intent.PRIMARY} onClick={() => setIsPickerOpen(false)}>{tr(\"ACTION_CLOSE\", props.locale)}</Button>\n            </Card>\n        </Collapse>\n    </div>\n}","/**\n * context.ts\n *\n * This module holds various React component contexts and validation maps\n */\nimport * as React from \"react\";\nimport { IDOMElementMetrics } from \"../api/common\";\nimport { MapLayer, MapGroup } from \"../api/contracts/runtime-map\";\nimport { DEFAULT_LOCALE } from '../api/i18n';\nimport { STR_EMPTY } from '../utils/string';\n\nconst VOID_NOOP = () => {}\n\nexport interface IApplicationContext {\n    /**\n     * Gets whether to display HTML property values in the selection panel (provided via mount option)\n     * \n     * @since 0.11\n     * @memberof IApplicationContext\n     */\n    allowHtmlValuesInSelection: () => boolean;\n    /**\n     * Gets a HTML sanitization function (if provided via mount option)\n     * \n     * @since 0.11\n     * @memberof IApplicationContext\n     */\n    getHTMLCleaner: () => (((value: string) => string) | undefined);\n}\n\nexport const AppContext = React.createContext<IApplicationContext>({\n    allowHtmlValuesInSelection: () => false,\n    getHTMLCleaner: () => v => v\n});\n\nexport interface ILegendContext {\n    stateless: boolean;\n    isFiltering(): boolean;\n    getMapName(): string | undefined;\n    getFilterText(): string;\n    getLocale(): string;\n    getBaseIconSize(): number;\n    getIconMimeType(): string | undefined;\n    getChildren(objectId: string): (MapLayer | MapGroup)[];\n    getCurrentScale(): number;\n    getTree(): any;\n    getLayerVisibility(layer: MapLayer): boolean;\n    getGroupVisibility(group: MapGroup): boolean;\n    setGroupVisibility(groupId: string, visible: boolean): void;\n    setLayerVisibility(layerId: string, visible: boolean): void;\n    getLayerSelectability(layerId: string): boolean;\n    setLayerSelectability(layerId: string, selectable: boolean): void;\n    getGroupExpanded(groupId: string): boolean;\n    setGroupExpanded(groupId: string, expanded: boolean): void;\n    getLayerExpanded(layerId: string): boolean;\n    setLayerExpanded(layerId: string, expanded: boolean): void;\n}\n\nexport const LegendContext = React.createContext<ILegendContext>({\n    stateless: false,\n    getMapName: () => undefined,\n    isFiltering: () => false,\n    getFilterText: () => STR_EMPTY,\n    getLocale: () => DEFAULT_LOCALE,\n    getBaseIconSize: () => 0,\n    getIconMimeType: () => STR_EMPTY,\n    getChildren: () => [],\n    getCurrentScale: () => -1,\n    getTree: VOID_NOOP,\n    getLayerVisibility: () => false,\n    getGroupVisibility: () => false,\n    setGroupVisibility: VOID_NOOP,\n    setLayerVisibility: VOID_NOOP,\n    getLayerSelectability: () => false,\n    setLayerSelectability: () => false,\n    getGroupExpanded: () => false,\n    setGroupExpanded: VOID_NOOP,\n    getLayerExpanded: () => false,\n    setLayerExpanded: VOID_NOOP,\n});\n\nexport interface IToolbarContext {\n    openFlyout(id: string, metrics: IDOMElementMetrics): void;\n    closeFlyout(id: string): void;\n    openComponent(id: string, metrics: IDOMElementMetrics, name: string, props?: any): void;\n    closeComponent(id: string): void;\n}\n\nexport const ToolbarContext = React.createContext<IToolbarContext>({\n    openFlyout: VOID_NOOP,\n    closeFlyout: VOID_NOOP,\n    openComponent: VOID_NOOP,\n    closeComponent: VOID_NOOP\n});","import * as React from \"react\";\nimport { InitError } from \"../api/common\";\nimport { isError, isInitError } from \"../utils/type-guards\";\nimport { Intent, Callout } from '@blueprintjs/core';\n\n/**\n * Error component props\n *\n * @export\n * @interface IErrorProps\n */\nexport interface IErrorProps {\n    error: Error|InitError|string;\n    errorRenderer?: (err: Error|InitError) => JSX.Element;\n}\n\n/**\n * Returns a normalized stack trace for the given error object\n *\n * @export\n * @param {(Error|InitError)} err\n * @returns {string[]}\n */\nexport function normalizeStack(err: Error|InitError): string[] {\n    let stack: string[];\n    if (err.stack instanceof Array) {\n        stack = err.stack || [];\n    } else if (typeof(err.stack) == 'string') {\n        stack = (err.stack || \"\").split(\"\\n\");\n    } else {\n        stack = [];\n    }\n    return stack;\n}\n\n/**\n * The Error component displays an error object in a nicely formatted manner\n * @param props\n */\nexport const Error = (props: IErrorProps) => {\n    const err = props.error;\n    if (isError(err) || isInitError(err)) {\n        if (props.errorRenderer) {\n            return props.errorRenderer(err);\n        } else {\n            const message = err.message;\n            const stack = normalizeStack(err);\n            return <Callout intent={Intent.DANGER} icon=\"error\">\n                <h5 className=\"error-header\">{err.message}</h5>\n                <ul className=\"error-stack\">\n                    {stack.map((ln, i) => <li key={`stack-line-${i}`}>{ln}</li>)}\n                </ul>\n            </Callout>;\n        }\n    } else {\n        return <Callout intent={Intent.DANGER} icon=\"error\">\n            <h5 className=\"error-header\">{err}</h5>\n        </Callout>;\n    }\n};","import { MgError } from \"../api/error\";\nimport { Dictionary, IExternalBaseLayer, LayerProperty } from \"../api/common\";\nimport { IGenericSubjectMapLayer, IInitialExternalLayer, GenericSubjectLayerType } from '../actions/defs';\nimport olSource from \"ol/source/Source\";\nimport XYZ from \"ol/source/XYZ\";\nimport OSM from \"ol/source/OSM\";\nimport Stamen from \"ol/source/Stamen\";\nimport BingMaps from \"ol/source/BingMaps\";\nimport UTFGrid from \"ol/source/UTFGrid\";\nimport TileLayer from 'ol/layer/Tile';\nimport TileWMS from 'ol/source/TileWMS';\nimport LayerBase from \"ol/layer/Base\";\nimport VectorLayer from 'ol/layer/Vector';\nimport VectorSource from 'ol/source/Vector';\nimport ClusterSource from 'ol/source/Cluster';\nimport VectorTileSource from 'ol/source/VectorTile';\nimport VectorTileLayer from 'ol/layer/VectorTile';\nimport { CsvFormatDriver, CSV_COLUMN_ALIASES } from '../api/layer-manager/csv-driver';\nimport KML from 'ol/format/KML';\nimport GeoJSON from \"ol/format/GeoJSON\";\nimport MVT from 'ol/format/MVT';\nimport type { Options as MVTOptions } from 'ol/format/MVT';\nimport { ExternalLayerFactoryRegistry } from '../api/registry/external-layer';\nimport { strIsNullOrEmpty } from '../utils/string';\nimport GeometryType from 'ol/geom/GeometryType';\nimport { setOLVectorLayerStyle } from '../api/ol-style-helpers';\nimport { DEFAULT_VECTOR_LAYER_STYLE } from '../api/ol-style-contracts';\nimport VectorTile from \"ol/VectorTile\";\nimport Feature from \"ol/Feature\";\nimport { OLVectorLayer, OLVectorSource } from \"../api/ol-types\";\nimport geojsonvt from 'geojson-vt';\nimport Projection from \"ol/proj/Projection\";\nimport { ProjectionLike, get, equivalent } from \"ol/proj\";\nimport { AsyncLazy } from \"../api/lazy\";\nimport { debug } from \"../utils/logger\";\n\nfunction sameProjectionAs(proj1: ProjectionLike, proj2: ProjectionLike) {\n    const nproj1 = get(proj1);\n    const nproj2 = get(proj2);\n    return equivalent(nproj1, nproj2);\n}\n\n// Converts geojson-vt data to GeoJSON\nconst geoJsonVt2GeoJSON = (key: string, value: any) => {\n    if (value.geometry) {\n        let type;\n        const rawType = value.type;\n        let geometry = value.geometry;\n\n        if (rawType === 1) {\n            type = 'MultiPoint';\n            if (geometry.length == 1) {\n                type = 'Point';\n                geometry = geometry[0];\n            }\n        } else if (rawType === 2) {\n            type = 'MultiLineString';\n            if (geometry.length == 1) {\n                type = 'LineString';\n                geometry = geometry[0];\n            }\n        } else if (rawType === 3) {\n            type = 'Polygon';\n            if (geometry.length > 1) {\n                type = 'MultiPolygon';\n                geometry = [geometry];\n            }\n        }\n\n        return {\n            'type': 'Feature',\n            'geometry': {\n                'type': type,\n                'coordinates': geometry,\n            },\n            'properties': value.tags,\n        };\n    } else {\n        return value;\n    }\n};\n\nfunction applyVectorLayerProperties(defn: IGenericSubjectMapLayer | IInitialExternalLayer, layer: LayerBase, isExternal: boolean) {\n    layer.set(LayerProperty.LAYER_NAME, defn.name);\n    layer.set(LayerProperty.LAYER_DESCRIPTION, defn.description);\n    layer.set(LayerProperty.LAYER_DISPLAY_NAME, defn.displayName);\n    layer.set(LayerProperty.LAYER_TYPE, defn.type);\n    layer.set(LayerProperty.IS_SELECTABLE, defn.selectable);\n    layer.set(LayerProperty.IS_EXTERNAL, isExternal);\n    layer.set(LayerProperty.SELECTED_POPUP_CONFIGURATION, defn.popupTemplate);\n    layer.set(LayerProperty.IS_GROUP, false);\n    layer.set(LayerProperty.LAYER_METADATA, defn.meta);\n    layer.setVisible(defn.initiallyVisible);\n}\n\nconst EMPTY_GEOJSON = { type: \"FeatureCollection\", features: [] as any[] };\n\nexport function clusterSourceIfRequired(source: OLVectorSource, def: { cluster?: { distance: number } }): ClusterSource | OLVectorSource {\n    if (def.cluster) {\n        const cluster = new ClusterSource({\n            source: source,\n            distance: def.cluster.distance,\n            geometryFunction: (feature) => {\n                const geometry = feature.getGeometry();\n                if (geometry && geometry.getType() == GeometryType.POINT) {\n                    return geometry;\n                }\n                return undefined as any;\n            }\n        });\n        return cluster;\n    }\n    return source;\n}\n\nexport function createOLLayerFromSubjectDefn(defn: IGenericSubjectMapLayer | IInitialExternalLayer, mapProjection: ProjectionLike, isExternal: boolean, appSettings: Dictionary<string>): LayerBase {\n    switch (defn.type) {\n        case GenericSubjectLayerType.GeoJSON_Inline:\n            {\n                const features = (new GeoJSON()).readFeatures(defn.sourceParams.features ?? EMPTY_GEOJSON);\n                const source = new VectorSource({\n                    features: features,\n                    attributions: defn.sourceParams.attributions\n                });\n                const layer = new VectorLayer({\n                    ...defn.layerOptions,\n                    source: clusterSourceIfRequired(source, defn)\n                });\n                setOLVectorLayerStyle(layer, defn.vectorStyle ?? DEFAULT_VECTOR_LAYER_STYLE, defn.cluster);\n                applyVectorLayerProperties(defn, layer, isExternal);\n                return layer;\n            }\n        case GenericSubjectLayerType.GeoJSON:\n            {\n                const isWebM = sameProjectionAs(mapProjection, \"EPSG:3857\");\n                const asVT = defn.meta?.geojson_as_vt == true;\n                if (asVT && isWebM) {\n                    const lazyTileIndex = new AsyncLazy(async () => {\n                        debug(`Fetching url: ${defn.sourceParams.url}`);\n                        const resp = await fetch(defn.sourceParams.url);\n                        let json = await resp.json();\n                        if (defn.meta?.projection != \"EPSG:4326\") {\n                            const gj = new GeoJSON({\n                                dataProjection: defn.meta?.projection,\n                                featureProjection: \"EPSG:4326\"\n                            });\n                            const features = gj.readFeatures(json);\n                            json = gj.writeFeaturesObject(features, {\n                                dataProjection: \"EPSG:4326\"\n                            });\n                        }\n                        const tileIndex = geojsonvt(json, {\n                            extent: 4096\n                        });\n                        return tileIndex;\n                    });\n                    const format = new GeoJSON({\n                        // Data returned from geojson-vt is in tile pixel units\n                        dataProjection: new Projection({\n                            code: 'TILE_PIXELS',\n                            units: 'tile-pixels',\n                            extent: [0, 0, 4096, 4096],\n                        }),\n                    });\n                    const vectorSource = new VectorTileSource({\n                        projection: mapProjection,\n                        tileUrlFunction: (tileCoord) => {\n                            // Use the tile coordinate as a pseudo URL for caching purposes\n                            return JSON.stringify(tileCoord);\n                        },\n                        tileLoadFunction: (tile: VectorTile, url) => {\n                            const tileCoord = JSON.parse(url);\n                            lazyTileIndex.getValueAsync().then(tileIndex => {\n                                const data = tileIndex.getTile(\n                                    tileCoord[0],\n                                    tileCoord[1],\n                                    tileCoord[2]\n                                );\n                                //console.log(\"Fetching tile\", tileCoord, data);\n                                const geojson = JSON.stringify(\n                                    {\n                                        type: 'FeatureCollection',\n                                        features: data ? data.features : [],\n                                    },\n                                    geoJsonVt2GeoJSON\n                                );\n                                const features = format.readFeatures(geojson, {\n                                    extent: vectorSource.getTileGrid().getTileCoordExtent(tileCoord),\n                                    featureProjection: mapProjection,\n                                });\n                                tile.setFeatures(features);\n                            });\n                        }\n                    });\n                    const vectorLayer = new VectorTileLayer({\n                        source: vectorSource,\n                    });\n                    setOLVectorLayerStyle(vectorLayer, defn.vectorStyle ?? DEFAULT_VECTOR_LAYER_STYLE, defn.cluster);\n                    applyVectorLayerProperties(defn, vectorLayer, isExternal);\n                    return vectorLayer;\n                } else {\n                    if (asVT) {\n                        console.warn(\"The geojson_as_vt meta option only applies if the MapGuide map or Primary Subject Layer is in EPSG:3857. This layer will be loaded as a regular GeoJSON layer\");\n                    }\n                    const source = new VectorSource({\n                        url: defn.sourceParams.url,\n                        format: new GeoJSON(),\n                        attributions: defn.sourceParams.attributions\n                    });\n                    const layer = new VectorLayer({\n                        ...defn.layerOptions,\n                        source: clusterSourceIfRequired(source, defn)\n                    });\n                    setOLVectorLayerStyle(layer, defn.vectorStyle ?? DEFAULT_VECTOR_LAYER_STYLE, defn.cluster);\n                    applyVectorLayerProperties(defn, layer, isExternal);\n                    return layer;\n                }\n            }\n        case GenericSubjectLayerType.MVT:\n            {\n                const mo: MVTOptions = {\n                    idProperty: defn.sourceParams.mvtIdProperty\n                };\n                switch (defn.sourceParams.mvtFeatureClass) {\n                    case \"feature\":\n                        mo.featureClass = Feature;\n                        break;\n                }\n                const source = new VectorTileSource({\n                    url: defn.sourceParams.url,\n                    format: new MVT(mo),\n                    attributions: defn.sourceParams.attributions,\n                    tileLoadFunction: function (tile: VectorTile, url) {\n                        tile.setLoader(function (extent, resolution, projection) {\n                            fetch(url).then(function (response) {\n                                if (response.status == 200) {\n                                    response.arrayBuffer().then(function (data) {\n                                        const format = tile.getFormat() // ol/format/MVT configured as source format\n                                        const features = format.readFeatures(data, {\n                                            extent: extent,\n                                            featureProjection: projection\n                                        }).filter(f => f != null);\n                                        tile.setFeatures(features as any); //Bug: Typing for setFeatures() should be accepting FeatureLike[]\n                                    });\n                                }\n                            });\n                        });\n                    }\n                });\n                const layer = new VectorTileLayer({\n                    ...defn.layerOptions,\n                    source: source\n                });\n                setOLVectorLayerStyle(layer, defn.vectorStyle ?? DEFAULT_VECTOR_LAYER_STYLE, defn.cluster);\n                applyVectorLayerProperties(defn, layer, isExternal);\n                return layer;\n            }\n        case GenericSubjectLayerType.CSV:\n            {\n                const vectorSource = new VectorSource({\n                    loader: (_extent, _resolution, projection) => {\n                        const xhr = new XMLHttpRequest();\n                        xhr.open(\"GET\", defn.sourceParams.url);\n                        const onError = () => vectorSource.clear();\n                        xhr.onerror = onError;\n                        xhr.onload = () => {\n                            if (xhr.status == 200) {\n                                const driver = new CsvFormatDriver(CSV_COLUMN_ALIASES);\n                                driver.tryParse(xhr.responseText.length, xhr.responseText).then(pf => {\n                                    pf.addTo(vectorSource, projection, defn.meta?.projection);\n                                }).catch(e => onError());\n                            } else {\n                                onError();\n                            }\n                        }\n                        xhr.send();\n                    },\n                    attributions: defn.sourceParams.attributions\n                });\n                const layer = new VectorLayer({\n                    ...defn.layerOptions,\n                    source: clusterSourceIfRequired(vectorSource, defn)\n                });\n                setOLVectorLayerStyle(layer, defn.vectorStyle ?? DEFAULT_VECTOR_LAYER_STYLE, defn.cluster);\n                applyVectorLayerProperties(defn, layer, isExternal);\n                return layer;\n            }\n        case GenericSubjectLayerType.KML:\n            {\n                const source = new VectorSource({\n                    url: defn.sourceParams.url,\n                    format: new KML(),\n                    attributions: defn.sourceParams.attributions\n                });\n                const layer = new VectorLayer({\n                    ...defn.layerOptions,\n                    source: clusterSourceIfRequired(source, defn)\n                });\n                applyVectorLayerProperties(defn, layer, isExternal);\n                return layer;\n            }\n        case GenericSubjectLayerType.TileWMS:\n            {\n                const sourceArgs = {\n                    crossOrigin: \"anonymous\",\n                    ...defn.sourceParams\n                };\n                const layer = new TileLayer({\n                    source: new TileWMS(sourceArgs)\n                });\n                layer.set(LayerProperty.LAYER_DESCRIPTION, defn.description);\n                layer.set(LayerProperty.LAYER_TYPE, \"WMS\");\n                layer.set(LayerProperty.IS_SELECTABLE, true); //Let's assume this WMS service is capable of GetFeatureInfo in GeoJSON representation\n                layer.set(LayerProperty.IS_EXTERNAL, isExternal);\n                layer.set(LayerProperty.IS_GROUP, false);\n                layer.set(LayerProperty.SELECTED_POPUP_CONFIGURATION, defn.popupTemplate);\n                layer.set(LayerProperty.LAYER_METADATA, defn.meta);\n                layer.setVisible(defn.initiallyVisible);\n                return layer;\n            }\n        case GenericSubjectLayerType.CustomVector:\n            {\n                if (strIsNullOrEmpty(defn.driverName)) {\n                    throw new Error(\"Missing required driverName\");\n                }\n                const reg = ExternalLayerFactoryRegistry.getInstance();\n                const factory = reg.getExternalVectorLayerCreator(defn.driverName);\n                if (!factory) {\n                    throw new Error(`Could not resolve an approriate factory for the given driver: ${defn.driverName}`);\n                }\n                const layer = factory(defn.sourceParams, defn.meta, defn.layerOptions, appSettings) as OLVectorLayer;\n                const source = clusterSourceIfRequired(layer.getSource(), defn);\n                layer.setSource(source);\n                setOLVectorLayerStyle(layer, defn.vectorStyle ?? DEFAULT_VECTOR_LAYER_STYLE, defn.cluster);\n                applyVectorLayerProperties(defn, layer, isExternal);\n                return layer;\n            }\n        default:\n            throw new Error(`Unknown subject layer type: ${defn.type}`);\n    }\n}\n\ninterface OLSourceCtor {\n    new(options?: any): olSource;\n}\n\n/**\n * Creates an OpenLayers source based on the given external base layer definition\n *\n * @export\n * @param {IExternalBaseLayer} layer\n * @returns\n */\nexport function createExternalSource(layer: IExternalBaseLayer): olSource {\n    let sourceCtor: OLSourceCtor;\n    switch (layer.kind) {\n        case \"XYZ\":\n            sourceCtor = XYZ;\n            break;\n        case \"OSM\":\n            sourceCtor = OSM;\n            break;\n        case \"Stamen\":\n            sourceCtor = Stamen;\n            break;\n        case \"BingMaps\":\n            sourceCtor = BingMaps;\n            break;\n        case \"UTFGrid\":\n            sourceCtor = UTFGrid;\n            break;\n        default:\n            throw new MgError(`Unknown external base layer provider: ${layer.kind}`);\n    }\n    if (typeof (layer.options) != 'undefined')\n        return new sourceCtor({ crossOrigin: \"Anonymous\", ...layer.options });\n    else\n        return new sourceCtor({ crossOrigin: \"Anonymous\" });\n}","import * as React from \"react\";\nimport { getAssetPath } from \"../utils/asset\";\nimport { STD_CSS_SPRITE_RELPATH, ICON_ERROR } from \"../constants/assets\";\nimport { GenericEventHandler } from \"../api/common\";\n\nexport interface IIconProps {\n    style?: React.CSSProperties;\n    onClick?: GenericEventHandler;\n    otherProps?: any;\n    baseSize: number;\n    children: (baseSize: number) => React.ReactElement;\n}\n\nexport const Icon = (props: IIconProps) => {\n    const spStyle = { ...(props.style || {}) };\n    if (!spStyle.display) {\n        spStyle.display = \"inline-block\";\n    }\n    return <div style={spStyle} onClick={props.onClick} {...props.otherProps}>\n        {props.children(props.baseSize)}\n    </div>;\n};\n\nexport interface IImageIconProps {\n    /**\n     * The icon path relative to the standard asset path\n     *\n     * @type {string}\n     * @memberof IIconProps\n     */\n    url?: string;\n    spriteClass?: string;\n    style?: React.CSSProperties;\n    onClick?: GenericEventHandler;\n    otherProps?: any;\n}\n\n/**\n * An image icon component\n * @param props\n * @since 0.13\n */\nexport const ImageIcon = (props: IImageIconProps) => {\n    if (!props.url && !props.spriteClass) {\n        return <noscript />;\n    }\n    let url;\n    let spriteClass = props.spriteClass;\n    if (props.url && props.url != STD_CSS_SPRITE_RELPATH) {\n        url = getAssetPath(props.url);\n        spriteClass = undefined;\n    }\n    if (spriteClass) {\n        const spStyle = { ...(props.style || {}) };\n        if (!spStyle.display) {\n            spStyle.display = \"inline-block\";\n        }\n        return <div style={spStyle} onClick={props.onClick} className={`icon ${spriteClass}`} {...props.otherProps} />;\n    }\n    return <img className=\"icon\" style={props.style} src={url} onClick={props.onClick} {...props.otherProps} onError={e => e.currentTarget.src = ICON_ERROR} />;\n};","import * as React from \"react\";\nimport { tr } from \"../../api/i18n\";\nimport { AddVectorLayerExtraOptions, GenericEvent, ILayerInfo } from \"../../api/common\";\nimport { AddWmsLayer } from \"./add-wms-layer\";\nimport { AddWfsLayer } from \"./add-wfs-layer\";\nimport { HTMLSelect, Label, RadioGroup, Radio, NonIdealState, Button, Intent, EditableText, ButtonGroup, FormGroup, Callout, NumericInput, FileInput, Switch, Spinner, SpinnerSize } from '@blueprintjs/core';\nimport { strIsNullOrEmpty } from \"../../utils/string\";\nimport { ensureProjection } from '../../api/registry/projections';\nimport { IParsedFeatures } from '../../api/layer-manager/parsed-features';\nimport { parseEpsgCodeFromCRS } from './wfs-capabilities-panel';\nimport { getViewer } from '../../api/runtime';\nimport { zoomToLayerExtents } from \"../../containers/add-manage-layers\";\nimport { getColorBrewerRamps, ColorBrewerSwatch } from \"./color-brewer\";\nimport { ClusterClickAction } from \"../../api/ol-style-contracts\";\nimport { assertNever } from \"../../utils/never\";\n\n/**\n * @hidden\n */\nexport interface IAddLayerProps {\n    locale: string;\n    onLayerAdded: (layer: ILayerInfo) => void;\n    onAddLayerBusyWorker: (name: string) => void;\n    onRemoveLayerBusyWorker: (name: string) => void;\n}\n\n/**\n * @hidden\n */\nexport interface IAddLayerState {\n    selectedType: string;\n}\n\n/**\n * @hidden\n */\nexport interface IAddLayerContentProps {\n    locale: string;\n    onLayerAdded: (layer: ILayerInfo) => void;\n    onAddLayerBusyWorker: (name: string) => void;\n    onRemoveLayerBusyWorker: (name: string) => void;\n}\n\ninterface IAddLayerConf {\n    label: string;\n    content: (props: IAddLayerContentProps) => JSX.Element;\n}\n\nconst ADD_URL_LAYER_TYPES: { [key: string]: IAddLayerConf } = {\n    \"WMS\": {\n        label: \"WMS\",\n        content: (props: IAddLayerContentProps) => <AddWmsLayer {...props} />\n    },\n    \"WFS\": {\n        label: \"WFS\",\n        content: (props: IAddLayerContentProps) => <AddWfsLayer {...props} />\n    }\n};\n\nenum AddLayerKind {\n    File,\n    Url\n}\n\ninterface LoadedFile {\n    name: string;\n    size: number;\n    type: string;\n    defaultProjection: string | null;\n}\n\nenum CreateVectorLayerAs {\n    Vector = \"Vector\",\n    Themed = \"Themed\",\n    Clustered = \"Clustered\",\n    Heatmap = \"Heatmap\"\n}\n\ntype GeomTypeList = IParsedFeatures[\"geometryTypes\"];\n\nfunction getCreateVectorLayerOptions(geomTypes: GeomTypeList, locale: string) {\n    const options: { value: CreateVectorLayerAs, label: string, isValid: (geomTypes: GeomTypeList) => boolean }[] = [\n        { value: CreateVectorLayerAs.Vector, label: tr(\"CREATE_VECTOR_LAYER\", locale), isValid: (geomTypes) => true },\n        { value: CreateVectorLayerAs.Themed, label: tr(\"CREATE_VECTOR_THEMED\", locale), isValid: (geomTypes) => true },\n        { value: CreateVectorLayerAs.Clustered, label: tr(\"CREATE_VECTOR_CLUSTERED\", locale), isValid: (geomTypes) => geomTypes.length == 1 && geomTypes.includes(\"Point\") },\n        { value: CreateVectorLayerAs.Heatmap, label: tr(\"CREATE_VECTOR_HEATMAP\", locale), isValid: (geomTypes) => geomTypes.length == 1 && geomTypes.includes(\"Point\") }\n    ];\n    return options.filter(o => o.isValid(geomTypes));\n}\n\nconst AddFileLayer = (props: IAddLayerProps) => {\n    const { locale } = props;\n    const [isProcessingFile, setIsProcessingFile] = React.useState(false);\n    const [isAddingLayer, setIsAddingLayer] = React.useState(false);\n    const [addLayerError, setAddLayerError] = React.useState<any>(undefined);\n    const [loadedFile, setLoadedFile] = React.useState<LoadedFile | undefined>(undefined);\n    const [addLayerName, setAddLayerName] = React.useState<string | undefined>(undefined);\n    const [addProjection, setAddProjection] = React.useState(4326);\n    const [createOptions, setCreateOptions] = React.useState(getCreateVectorLayerOptions([], locale));\n    const [enableLabels, setEnableLabels] = React.useState(false);\n    const [labelOnProperty, setLabelOnProperty] = React.useState<string | undefined>(undefined);\n    const [themeOnProperty, setThemeOnProperty] = React.useState<string | undefined>(undefined);\n    const [themableProperties, setThemableProperties] = React.useState<string[]>([]);\n    const [themeToUse, setThemeToUse] = React.useState(\"Blues\");\n    const [createLayerAs, setCreateLayerAs] = React.useState<CreateVectorLayerAs>(CreateVectorLayerAs.Vector);\n    const [clusterDistance, setClusterDistance] = React.useState(10);\n    const [themableRamps, _] = React.useState(getColorBrewerRamps());\n    const [clusterClickAction, setClusterClickAction] = React.useState(ClusterClickAction.ShowPopup);\n    const parsedFeaturesRef = React.useRef<IParsedFeatures | undefined>(undefined);\n    const setParsedFile = (parsed: IParsedFeatures | undefined) => {\n        setEnableLabels(false);\n        setCreateOptions(getCreateVectorLayerOptions([], locale));\n        parsedFeaturesRef.current = parsed;\n        if (parsed) {\n            setAddLayerName(parsed.name);\n            setLoadedFile({\n                name: parsed.name,\n                size: parsed.size,\n                type: parsed.type,\n                defaultProjection: parsed.projection\n            });\n            setCreateOptions(getCreateVectorLayerOptions(parsed.geometryTypes, locale));\n            setThemableProperties(parsed.propertyNames);\n            if (parsed.propertyNames.length > 0) {\n                setThemeOnProperty(parsed.propertyNames[0]);\n                setLabelOnProperty(parsed.propertyNames[0]);\n            }\n            if (parsed.projection) {\n                const epsg = parseEpsgCodeFromCRS(parsed.projection);\n                if (epsg) {\n                    setAddProjection(epsg);\n                }\n            }\n        } else {\n            setLoadedFile(undefined);\n            parsedFeaturesRef.current = undefined;\n        }\n    };\n    const onFileDropped = async (file: File) => {\n        const viewer = getViewer();\n        if (viewer) {\n            setIsProcessingFile(true);\n            setAddLayerError(undefined);\n            const layerMgr = viewer.getLayerManager();\n            try {\n                const parsed = await layerMgr.parseFeaturesFromFile({\n                    file: file,\n                    name: file.name,\n                    locale: locale\n                });\n                setParsedFile(parsed);\n            } catch (e) {\n                setAddLayerError(e);\n            }\n            setIsProcessingFile(false);\n        }\n    };\n    const onCancelAddFile = () => {\n        setParsedFile(undefined);\n    };\n    const onAddFileLayer = React.useCallback(async (layerProjection: number) => {\n        const viewer = getViewer();\n        if (viewer && parsedFeaturesRef?.current) {\n            setIsAddingLayer(true);\n            setAddLayerError(undefined);\n            try {\n                const [_, layerProj] = await ensureProjection(layerProjection, locale);\n                if (!strIsNullOrEmpty(addLayerName)) {\n                    parsedFeaturesRef.current.name = addLayerName;\n                }\n                const layerMgr = viewer.getLayerManager();\n                if (layerMgr.hasLayer(parsedFeaturesRef.current.name)) {\n                    throw new Error(tr(\"LAYER_NAME_EXISTS\", locale, { name: parsedFeaturesRef.current.name }));\n                }\n                let extraOpts: AddVectorLayerExtraOptions | undefined;\n                switch (createLayerAs) {\n                    case CreateVectorLayerAs.Clustered:\n                        extraOpts = {\n                            kind: \"Cluster\",\n                            clusterDistance: clusterDistance,\n                            onClusterClickAction: clusterClickAction\n                        };\n                        break;\n                    case CreateVectorLayerAs.Themed:\n                        extraOpts = {\n                            kind: \"Theme\",\n                            themeOnProperty: themeOnProperty!,\n                            colorBrewerTheme: themeToUse\n                        };\n                        break;\n                    case CreateVectorLayerAs.Heatmap:\n                        extraOpts = {\n                            kind: \"Heatmap\"\n                        };\n                        break;\n                }\n                let labelProp;\n                if (enableLabels) {\n                    labelProp = labelOnProperty;\n                }\n                const layer = await layerMgr.addLayerFromParsedFeatures({\n                    features: parsedFeaturesRef.current,\n                    projection: layerProj,\n                    extraOptions: extraOpts,\n                    labelOnProperty: labelProp\n                });\n                zoomToLayerExtents(layer.name, viewer);\n                setIsAddingLayer(false);\n                viewer.toastSuccess(\"success\", tr(\"ADDED_LAYER\", props.locale, { name: layer.name }));\n                setAddLayerError(undefined);\n                setLoadedFile(undefined);\n                setAddLayerName(undefined);\n                props.onLayerAdded(layer);\n            } catch (e) {\n                setAddLayerError(e);\n                if (!strIsNullOrEmpty(e?.message)) {\n                    viewer.toastError(\"error\", e.message);\n                }\n            }\n            setIsAddingLayer(false);\n        }\n    }, [clusterDistance, createLayerAs, themeOnProperty, themeToUse, enableLabels, labelOnProperty, clusterClickAction]);\n    if (loadedFile) {\n        let canAdd = true;\n        if (createLayerAs == CreateVectorLayerAs.Themed) {\n            if (strIsNullOrEmpty(themeOnProperty)) {\n                canAdd = false;\n            }\n        }\n        const labelEl = <>\n            <Switch label={tr(\"ENABLE_LABELS\", locale)} checked={enableLabels} onChange={(e: any) => setEnableLabels(e.target.checked)} />\n            {enableLabels && <FormGroup label={tr(\"LABEL_USING_PROPERTY\", locale)}>\n                <HTMLSelect value={labelOnProperty} onChange={e => setLabelOnProperty(e.target.value)}>\n                    {themableProperties.map((th, i) => <option key={th} value={th}>{th}</option>)}\n                </HTMLSelect>\n            </FormGroup>}\n        </>;\n\n        const colorBrewerLabel = <div dangerouslySetInnerHTML={{ __html: tr(\"COLORBREWER_THEME\", locale) }} />;\n        const themeEl = <>\n            <FormGroup label={tr(\"THEME_ON_PROPERTY\", locale)}>\n                <HTMLSelect value={themeOnProperty} onChange={e => setThemeOnProperty(e.target.value)}>\n                    {themableProperties.map((th, i) => <option key={th} value={th}>{th}</option>)}\n                </HTMLSelect>\n            </FormGroup>\n            <FormGroup label={colorBrewerLabel}>\n                <HTMLSelect value={themeToUse} onChange={e => setThemeToUse(e.target.value)}>\n                    {themableRamps.map((th, i) => <option key={th.displayName} value={th.scheme}>{th.displayName}</option>)}\n                </HTMLSelect>\n            </FormGroup>\n            {themeToUse && <ColorBrewerSwatch theme={themeToUse} />}\n        </>;\n\n        const clusterEl = <>\n            <FormGroup label={tr(\"POINT_CLUSTER_DISTANCE\", locale)}>\n                <NumericInput min={1} value={clusterDistance} onValueChange={v => setClusterDistance(v)} />\n            </FormGroup>\n            <FormGroup label={tr(\"CLUSTER_CLICK_ACTION\", locale)}>\n                <HTMLSelect value={clusterClickAction} onChange={(e: any) => setClusterClickAction(e.target.value)}>\n                    <option value={ClusterClickAction.ShowPopup}>{tr(\"CLUSTER_CLICK_ACTION_SHOW_POPUP\", locale)}</option>\n                    <option value={ClusterClickAction.ZoomToClusterExtents}>{tr(\"CLUSTER_CLICK_ACTION_ZOOM_EXTENTS\", locale)}</option>\n                </HTMLSelect>\n            </FormGroup>\n        </>;\n        return <NonIdealState\n            title={<EditableText value={addLayerName} onChange={v => setAddLayerName(v)} />}\n            icon=\"upload\"\n            description={tr(\"FMT_UPLOADED_FILE\", locale, { size: loadedFile.size, type: (strIsNullOrEmpty(loadedFile.type) ? tr(\"UNKNOWN_FILE_TYPE\", locale) : loadedFile.type) })}\n            action={<>\n                {addLayerError && <Callout intent={Intent.DANGER} title={tr(\"ADDING_LAYER_ERROR\", locale)}>\n                    {addLayerError.message}\n                </Callout>}\n                <FormGroup label={tr(\"ADD_LAYER_PROJECTION\", locale)}>\n                    {loadedFile.defaultProjection ? <strong>EPSG:{addProjection}</strong> : <FormGroup label={<a href=\"https://epsg.io\" target=\"_blank\">EPSG:</a>} inline>\n                        <NumericInput style={{ width: 60 }} min={0} value={addProjection} onValueChange={v => setAddProjection(v)} />\n                    </FormGroup>}\n                </FormGroup>\n                <FormGroup label=\"Create Layer As\">\n                    <HTMLSelect value={createLayerAs} onChange={e => setCreateLayerAs(e.target.value as CreateVectorLayerAs)}>\n                        {createOptions.map((kind, i) => <option key={kind.value} value={kind.value}>{kind.label}</option>)}\n                    </HTMLSelect>\n                </FormGroup>\n                {(() => {\n                    switch (createLayerAs) {\n                        case CreateVectorLayerAs.Vector:\n                            return <>{labelEl}</>;\n                        case CreateVectorLayerAs.Themed:\n                            return <>{labelEl}{themeEl}</>;\n                        case CreateVectorLayerAs.Clustered:\n                            return <>{labelEl}{clusterEl}</>;\n                        case CreateVectorLayerAs.Heatmap:\n                            return <></>;\n                        default:\n                            assertNever(createLayerAs);\n                    }\n                })()}\n                <ButtonGroup>\n                    <Button disabled={!canAdd} loading={isAddingLayer} onClick={(e: any) => onAddFileLayer(addProjection)} intent={Intent.PRIMARY}>{tr(\"ADD_LAYER\", locale)}</Button>\n                    <Button loading={isAddingLayer} onClick={(e: any) => onCancelAddFile()} intent={Intent.DANGER}>{tr(\"CANCEL\", locale)}</Button>\n                </ButtonGroup>\n            </>} />\n    } else if (isProcessingFile) {\n        return <NonIdealState\n            icon={<Spinner intent={Intent.NONE} size={SpinnerSize.LARGE} />}\n            title={tr(\"ADD_FILE_PROCESSING\", locale)} />\n    } else {\n        return <>\n            {addLayerError && <Callout intent={Intent.DANGER} title={tr(\"ADDING_LAYER_ERROR\", locale)}>\n                {addLayerError.message}\n            </Callout>}\n            <NonIdealState\n                title={tr(\"ADD_FILE\", locale)}\n                icon=\"upload\"\n                description={tr(\"ADD_FILE_INSTRUCTIONS\", locale)}\n                action={<FileInput fill text={tr(\"CHOOSE_FILE\", locale)} buttonText={tr(\"BROWSE\", locale)} onInputChange={(e: any) => e.target.files && onFileDropped(e.target.files[0])} />} />\n        </>;\n    }\n}\n\nconst AddUrlLayer = (props: IAddLayerProps) => {\n    const { locale } = props;\n    const [selectedUrlType, setSelectedUrlType] = React.useState<string | undefined>(undefined);\n    const onUrlLayerTypeChanged = (e: GenericEvent) => {\n        setSelectedUrlType(e.target.value);\n    };\n    const items = Object.keys(ADD_URL_LAYER_TYPES).map(lt => ({ value: lt, label: ADD_URL_LAYER_TYPES[lt].label }));\n    return <div>\n        <Label>\n            {tr(\"LAYER_TYPE\", locale)}\n            <HTMLSelect value={selectedUrlType || \"\"} onChange={onUrlLayerTypeChanged}>\n                <option>{tr(\"SELECT_LAYER_TYPE\", locale)}</option>\n                {items.map(it => <option key={it.value} value={it.value}>{it.value}</option>)}\n            </HTMLSelect>\n        </Label>\n        {(() => {\n            if (selectedUrlType && ADD_URL_LAYER_TYPES[selectedUrlType]) {\n                const cprops: IAddLayerContentProps = {\n                    locale: locale,\n                    onLayerAdded: props.onLayerAdded,\n                    onAddLayerBusyWorker: props.onAddLayerBusyWorker,\n                    onRemoveLayerBusyWorker: props.onRemoveLayerBusyWorker\n                };\n                return ADD_URL_LAYER_TYPES[selectedUrlType].content(cprops);\n            }\n        })()}\n    </div>;\n}\n\n/**\n * @hidden\n */\nexport const AddLayer = (props: IAddLayerProps) => {\n    const [addLayerKind, setAddLayerKind] = React.useState<AddLayerKind>(AddLayerKind.File);\n    const onAddLayerKindChanged = (e: GenericEvent) => {\n        setAddLayerKind(parseInt(e.target.value, 10));\n    };\n    return <div>\n        <RadioGroup\n            label={tr(\"ADD_LAYER_KIND_PROMPT\", props.locale)}\n            onChange={onAddLayerKindChanged}\n            selectedValue={addLayerKind}>\n            <Radio label={tr(\"LAYER_KIND_FILE\", props.locale)} value={AddLayerKind.File} />\n            <Radio label={tr(\"LAYER_KIND_URL\", props.locale)} value={AddLayerKind.Url} />\n        </RadioGroup>\n        <hr />\n        {(() => {\n            switch (addLayerKind) {\n                case AddLayerKind.File:\n                    return <AddFileLayer {...props} />;\n                case AddLayerKind.Url:\n                    return <AddUrlLayer {...props} />;\n            }\n        })()}\n    </div>;\n}","import * as React from \"react\";\nimport { LayerProperty, GenericEvent, Bounds } from '../../api/common';\nimport { ControlGroup, InputGroup, Button, Intent, NonIdealState, Spinner } from '@blueprintjs/core';\nimport { tr } from \"../../api/i18n\";\nimport { Error } from \"../error\";\nimport { Client } from \"../../api/client\";\nimport { WfsCapabilitiesParser, IWfsServiceCapabilities } from \"./wfs-capabilities-parser\";\nimport { WfsCapabilitiesPanel } from './wfs-capabilities-panel';\nimport olVectorSource, { LoadingStrategy } from \"ol/source/Vector\";\nimport olVectorLayer from \"ol/layer/Vector\";\nimport GeoJSON from \"ol/format/GeoJSON\";\nimport { FeatureUrlFunction } from \"ol/featureloader\";\nimport { parseUrl } from '../../utils/url';\nimport { ensureProjection } from '../../api/registry/projections';\nimport { IAddLayerContentProps } from './add-layer';\nimport { getLayerInfo } from '../../api/layer-manager';\nimport { getViewer } from '../../api/runtime';\nimport { setOLVectorLayerStyle } from '../../api/ol-style-helpers';\nimport { DEFAULT_VECTOR_LAYER_STYLE } from '../../api/ol-style-contracts';\nimport { zoomToLayerExtents } from \"../../containers/add-manage-layers\";\n\n/**\n * @hidden\n */\nexport const AddWfsLayer = (props: IAddLayerContentProps) => {\n    const { locale } = props;\n    const [wfsUrl, setWfsUrl] = React.useState(\"\");\n    const [loadingCapabilities, setLoadingCapabilities] = React.useState(false);\n    const [caps, setCaps] = React.useState<IWfsServiceCapabilities | undefined>(undefined);\n    const [error, setError] = React.useState<Error | string | undefined>(undefined);\n    const onAddLayer = (name: string, version: string, format: string, origCrs: string, epsgCode: number, wfsWgs84Bounds?: Bounds) => {\n        const viewer = getViewer();\n        if (caps && viewer) {\n            ensureProjection(epsgCode, locale, origCrs).then(([, resolvedProj]) => {\n                const sourceProj = viewer.getProjection();\n                //TODO: For correctness, we should be using the URL from the ows:Get element of the\n                //GetFeature operations metadata instead of just re-computing the WFS GetFeature URL\n                //relative to the capabilities URL that was entered\n                const parsed = parseUrl(wfsUrl);\n                let typeNameKey = \"typename\";\n                if (version == \"2.0.0\") { //WFS 2.0.0 want typename(s) over typename\n                    typeNameKey = \"typenames\";\n                }\n                let urlTemplate = `${parsed.url}?service=WFS&version=${version}&request=GetFeature&${typeNameKey}=${encodeURIComponent(name)}&outputFormat=${encodeURIComponent(format)}&srsName=${encodeURIComponent(origCrs)}`;\n                let sourceUrl: string | FeatureUrlFunction;\n                let strategy: LoadingStrategy | undefined;\n                const vectorFmt = new GeoJSON({\n                    dataProjection: resolvedProj,\n                    featureProjection: sourceProj\n                });\n                // FIXME: I can't seem to get bbox strategy working in general :(\n                if (false) {\n                /*if (repsg == 4326 || repsg == 3857) {\n                    urlTemplate += `&bbox={view_extent}`;\n                    sourceUrl = function (extent) {\n                        const xfextent = transformExtent(extent, sourceProj, resolvedProj);\n                        const reqUrl = strReplaceAll(urlTemplate, \"{view_extent}\", xfextent.join(','));\n                        return reqUrl;\n                    }\n                    strategy = bbox;\n                    // We need to \"decorate\" the underlying loadFeaturesXhr loader so that\n                    // we have the means to call busy worker incrementing/decrementing\n                    innerLoader = loadFeaturesXhr(sourceUrl, vectorFmt, () => { //success\n                        viewer.addImageLoaded();\n                        props.onRemoveLayerBusyWorker(name);\n                    }, () => { //failure\n                        viewer.addImageLoaded();\n                        props.onRemoveLayerBusyWorker(name);\n                    });*/\n                } else {\n                    sourceUrl = urlTemplate;\n                }\n                const source = new olVectorSource({\n                    format: vectorFmt,\n                    url: sourceUrl,\n                    strategy: strategy/*,\n                    loader: innerLoader ? (function() {\n                        viewer.addImageLoading();\n                        props.onAddLayerBusyWorker(name);\n                        innerLoader?.apply(source, arguments);\n                    }) : undefined*/\n                });\n                const layer = new olVectorLayer({\n                    source: source,\n                    className: \"external-vector-layer\" //This is to avoid false positives for map.forEachLayerAtPixel\n                });\n                layer.set(LayerProperty.LAYER_TYPE, \"WFS\");\n                layer.set(LayerProperty.IS_EXTERNAL, true);\n                layer.set(LayerProperty.IS_SELECTABLE, true);\n                layer.set(LayerProperty.IS_GROUP, false);\n                if (wfsWgs84Bounds) {\n                    layer.set(LayerProperty.WGS84_BBOX, wfsWgs84Bounds);\n                }\n                setOLVectorLayerStyle(layer, DEFAULT_VECTOR_LAYER_STYLE, undefined);\n                viewer.getLayerManager().addLayer(name, layer);\n                viewer.toastSuccess(\"success\", tr(\"ADDED_LAYER\", locale, { name: name }));\n                const li = getLayerInfo(layer, true);\n                zoomToLayerExtents(li.name, viewer);\n                props.onLayerAdded(li);\n            });\n        }\n    };\n    const onLoadCaps = () => {\n        setCaps(undefined);\n        setLoadingCapabilities(true);\n        const client = new Client(\"\", \"mapagent\");\n        client.getText(wfsUrl).then(s => {\n            const parser = new WfsCapabilitiesParser();\n            const caps = parser.parse(s);\n            setLoadingCapabilities(false);\n            setCaps(caps);\n            setError(undefined);\n        }).catch(err => {\n            setLoadingCapabilities(false);\n            setCaps(undefined);\n            setError(err);\n        });\n    };\n    const onWmsUrlChange = (e: GenericEvent) => {\n        setWfsUrl(e.target.value);\n    };\n    return <div>\n        <ControlGroup fill>\n            <InputGroup leftIcon=\"geosearch\"\n                placeholder={tr(\"ADD_WFS_LAYER_URL\", locale)}\n                value={wfsUrl}\n                onChange={onWmsUrlChange}\n                readOnly={loadingCapabilities}\n                rightElement={<Button intent={Intent.PRIMARY} icon=\"arrow-right\" onClick={onLoadCaps} disabled={loadingCapabilities} />} />\n        </ControlGroup>\n        <br />\n        <div>\n            {(() => {\n                if (loadingCapabilities) {\n                    return <NonIdealState\n                        icon={<Spinner intent={Intent.NONE} size={Spinner.SIZE_LARGE} />}\n                        title={tr(\"ADD_WFS_LAYER_LOADING\", locale)}\n                        description={tr(\"ADD_WFS_LAYER_LOADING_DESC\", locale)} />;\n                } else {\n                    if (caps) {\n                        return <WfsCapabilitiesPanel onAddLayer={onAddLayer} capabilities={caps} locale={locale} />;\n                    } else if (error) {\n                        return <Error error={error} />;\n                    } else {\n                        return <NonIdealState\n                            icon=\"issue\"\n                            title={tr(\"ADD_WFS_LAYER_NO_LAYERS\", locale)}\n                            description={tr(\"WFS_NO_LAYER_DESCRIPTION\", locale)} />;\n                    }\n                }\n            })()}\n        </div>\n    </div>;\n}","import * as React from \"react\";\nimport {\n    GenericEvent,\n    WmsCapabilitiesDocument,\n    WMSLayerStyle,\n    LayerProperty,\n    SourceProperty\n} from \"../../api/common\";\nimport { tr } from \"../../api/i18n\";\nimport { Error } from \"../error\";\nimport { Client } from \"../../api/client\";\nimport { WmsCapabilitiesPanel } from \"./wms-capabilities-panel\";\nimport olWmsParser from \"ol/format/WMSCapabilities\";\nimport olTileLayer from \"ol/layer/Tile\";\nimport olImageLayer from \"ol/layer/Image\";\nimport olWmsSource from \"ol/source/ImageWMS\";\nimport olTiledWmsSource from \"ol/source/TileWMS\";\nimport { Spinner, NonIdealState, Intent, ControlGroup, InputGroup, Button } from '@blueprintjs/core';\nimport { strIsNullOrEmpty } from \"../../utils/string\";\nimport { IAddLayerContentProps } from './add-layer';\nimport { getLayerInfo } from '../../api/layer-manager';\nimport { getViewer } from '../../api/runtime';\n\n/**\n * @hidden\n */\nexport const AddWmsLayer = (props: IAddLayerContentProps) => {\n    const { locale } = props;\n    const [wmsUrl, setWmsUrl] = React.useState(\"\");\n    const [loadingCapabilities, setLoadingCapabilities] = React.useState(false);\n    const [caps, setCaps] = React.useState<WmsCapabilitiesDocument | undefined>(undefined);\n    const [error, setError] = React.useState<Error | string | undefined>(undefined);\n    const onAddLayer = (name: string, selectable: boolean, isTiled: boolean, style: WMSLayerStyle | undefined) => {\n        const viewer = getViewer();\n        if (caps && viewer) {\n            const params: any = {\n                LAYERS: name\n            };\n            if (style) {\n                params.STYLE = style.Name;\n            }\n            if (isTiled) {\n                params.TILED = true;\n            }\n            let layer;\n            let source: olTiledWmsSource | olWmsSource;\n            if (isTiled) {\n                source = new olTiledWmsSource({\n                    url: caps.Capability.Request.GetMap.DCPType[0].HTTP.Get.OnlineResource,\n                    params: params\n                });\n                layer = new olTileLayer({\n                    source: source\n                });\n            } else {\n                source = new olWmsSource({\n                    url: caps.Capability.Request.GetMap.DCPType[0].HTTP.Get.OnlineResource,\n                    params: params\n                });\n                layer = new olImageLayer({\n                    source: source\n                });\n            }\n            layer.set(LayerProperty.LAYER_TYPE, \"WMS\");\n            layer.set(LayerProperty.IS_SELECTABLE, selectable);\n            layer.set(LayerProperty.IS_EXTERNAL, true);\n            layer.set(LayerProperty.IS_GROUP, false);\n            if (style) {\n                const legendUrl = style.LegendURL?.[0]?.OnlineResource;\n                if (!strIsNullOrEmpty(legendUrl)) {\n                    layer.set(LayerProperty.HAS_WMS_LEGEND, true);\n                }\n            }\n            // Suppress automatic load event handling for this as we need our own\n            source.set(SourceProperty.SUPPRESS_LOAD_EVENTS, true);\n            const started = () => {\n                viewer.addImageLoading();\n                props.onAddLayerBusyWorker(name);\n            };\n            const finished = () => {\n                viewer.addImageLoaded();\n                props.onRemoveLayerBusyWorker(name);\n            };\n            if (source instanceof olTiledWmsSource) {  \n                source.on(\"tileloadstart\", started);\n                source.on(\"tileloadend\", finished);\n                source.on(\"tileloaderror\", finished);\n            } else if (source instanceof olWmsSource) {\n                source.on(\"imageloadstart\", started);\n                source.on(\"imageloadend\", finished);\n                source.on(\"imageloaderror\", finished);\n            }\n\n            viewer.getLayerManager().addLayer(name, layer);\n            viewer.toastSuccess(\"success\", tr(\"ADDED_LAYER\", locale, { name: name }));\n            props.onLayerAdded(getLayerInfo(layer, true));\n        }\n    };\n    const onLoadCaps = () => {\n        setCaps(undefined);\n        setLoadingCapabilities(true);\n        const client = new Client(\"\", \"mapagent\");\n        client.getText(wmsUrl).then(s => {\n            const parser = new olWmsParser();\n            const caps: WmsCapabilitiesDocument = parser.read(s);\n            if (caps.version != \"1.3.0\") {\n                setLoadingCapabilities(false);\n                setCaps(undefined);\n                setError(tr(\"WMS_UNSUPPORTED_VERSION\", locale, { version: caps.version }));\n            } else {\n                setLoadingCapabilities(false);\n                setCaps(caps);\n                setError(undefined);\n            }\n        }).catch(err => {\n            setLoadingCapabilities(false);\n            setCaps(undefined);\n            setError(err);\n        });\n    };\n    const onWmsUrlChange = (e: GenericEvent) => {\n        setWmsUrl(e.target.value);\n    };\n    return <div>\n        <ControlGroup fill>\n            <InputGroup leftIcon=\"geosearch\"\n                placeholder={tr(\"ADD_WMS_LAYER_URL\", locale)}\n                value={wmsUrl}\n                onChange={onWmsUrlChange}\n                readOnly={loadingCapabilities}\n                rightElement={<Button intent={Intent.PRIMARY} icon=\"arrow-right\" onClick={onLoadCaps} disabled={loadingCapabilities} />} />\n        </ControlGroup>\n        <br />\n        <div>\n            {(() => {\n                if (loadingCapabilities) {\n                    return <NonIdealState\n                        icon={<Spinner intent={Intent.NONE} size={Spinner.SIZE_LARGE} />}\n                        title={tr(\"ADD_WMS_LAYER_LOADING\", locale)}\n                        description={tr(\"ADD_WMS_LAYER_LOADING_DESC\", locale)} />;\n                } else {\n                    if (caps) {\n                        return <WmsCapabilitiesPanel onAddLayer={onAddLayer} capabilities={caps} locale={locale} />;\n                    } else if (error) {\n                        return <Error error={error} />;\n                    } else {\n                        return <NonIdealState\n                            icon=\"issue\"\n                            title={tr(\"ADD_WMS_LAYER_NO_LAYERS\", locale)}\n                            description={tr(\"WMS_NO_LAYER_DESCRIPTION\", locale)} />;\n                    }\n                }\n            })()}\n        </div>\n    </div>;\n}","import * as React from \"react\";\nimport colorbrewer from \"colorbrewer\";\n\nexport interface IColorBrewerRamp {\n    displayName: string;\n    category: string;\n    scheme: string;\n    ramp: string[];\n}\n\nexport function getColorBrewerRamps(): IColorBrewerRamp[] {\n    const ramps = [] as IColorBrewerRamp[];\n    for (const cat in colorbrewer.schemeGroups) {\n        for (const scheme of colorbrewer.schemeGroups[cat]) {\n            ramps.push({ displayName: `${cat} - ${scheme}`, category: cat, scheme: scheme, ramp: getMaxRamp(scheme) });\n        }\n    }\n    return ramps;\n}\n\nexport function getMaxRamp(scheme: any) {\n    let theScheme;\n    let len = 0;\n    for (const s in scheme) {\n        const arr = scheme[s];\n        if (arr.length > len) {\n            theScheme = arr;\n            len = arr.length;\n        }\n    }\n    return theScheme;\n}\n\nexport const ColorBrewerSwatch: React.FC<{ theme: string }> = props => {\n    const ramp: string[] = getMaxRamp(colorbrewer[props.theme]);\n    if (ramp) {\n        return <table>\n            <colgroup>\n                {ramp.map((r, i) => <col key={`ramp-col-${i}`} span={1} style={{ width: 12 }} />)}\n            </colgroup>\n            <tbody>\n                <tr>\n                    {ramp.map((r, i) => <td key={`ramp-${i}`} style={{ border: \"1px solid black\", backgroundColor: r }}>&nbsp;</td>)}\n                </tr>\n            </tbody>\n        </table>\n    };\n    return <></>;\n};","import { Button, ButtonGroup, Card, Collapse, InputGroup, Intent, NumericInput, Popover, Radio, Slider, Switch } from \"@blueprintjs/core\";\nimport * as React from \"react\";\nimport { tr } from \"../../api/i18n\";\nimport { ExprOr, isEvaluatable } from \"../../api/ol-style-contracts\";\nimport { strIsNullOrEmpty, STR_EMPTY } from \"../../utils/string\";\nimport { ColorPicker } from \"../color-picker\";\n\ninterface RGB {\n    b: number;\n    g: number;\n    r: number;\n}\nfunction rgbToYIQ({ r, g, b }: RGB): number {\n    return ((r * 299) + (g * 587) + (b * 114)) / 1000;\n}\nfunction hexToRgb(hex: string): RGB | undefined {\n    if (!hex || hex === undefined || hex === '') {\n        return undefined;\n    }\n\n    const result: RegExpExecArray | null =\n        /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n\n    return result ? {\n        r: parseInt(result[1], 16),\n        g: parseInt(result[2], 16),\n        b: parseInt(result[3], 16)\n    } : undefined;\n}\nexport function contrast(colorHex: string | undefined,\n    threshold: number = 128): string {\n    if (colorHex === undefined) {\n        return '#000';\n    }\n\n    const rgb: RGB | undefined = hexToRgb(colorHex);\n\n    if (rgb === undefined) {\n        return '#000';\n    }\n\n    return rgbToYIQ(rgb) >= threshold ? '#000' : '#fff';\n}\n\nexport type ExprEditorProps<T> = {\n    locale: string;\n    value?: ExprOr<T>;\n    onChange: (value: ExprOr<T> | undefined) => void;\n}\n\ntype ExprEditorInnerProps<T> = ExprEditorProps<T> & {\n    roStyle?: React.CSSProperties;\n    renderValueEditor: (value: ExprOr<T> | undefined, onChange: (value: ExprOr<T> | undefined) => void, locale: string, disabled: boolean) => React.ReactNode;\n};\n\nfunction stringifyExpr<T>(expr: ExprOr<T> | undefined, locale: string): string {\n    if (!expr) {\n        return tr(\"EXPR_NOT_SET\", locale);\n    }\n    if (isEvaluatable(expr)) {\n        return \"Expr: \" + expr.expr;\n    }\n    return `${expr ?? STR_EMPTY}`;\n}\n\nfunction isStrTrue(s: string) {\n    switch (s?.toLowerCase()) {\n        case \"true\":\n        case \"1\":\n            return true;\n        case \"false\":\n        case \"0\":\n            return false;\n    }\n    return false;\n}\n\ntype EditMode = \"edit-expr\" | \"edit-value\";\n\nfunction stringifyExprIf<T>(expr: ExprOr<T>, mode: EditMode): string {\n    switch (mode) {\n        case \"edit-expr\":\n            return isEvaluatable(expr) ? expr.expr : STR_EMPTY;\n        case \"edit-value\":\n            return isEvaluatable(expr) ? STR_EMPTY : `${expr ?? STR_EMPTY}`;\n    }\n}\n\nfunction useExprEditor<T>(props: ExprEditorProps<T>) {\n    const { value, onChange } = props;\n    const [editMode, setEditMode] = React.useState<EditMode>(isEvaluatable(value) ? \"edit-expr\" : \"edit-value\");\n    const [localValue, setLocalValue] = React.useState(value);\n    const [isEditing, setIsEditing] = React.useState(false);\n    const [isEditValid, setIsEditValid] = React.useState(false);\n    React.useEffect(() => {\n        setLocalValue(value);\n    }, [value]);\n    const onCancelEditing = React.useCallback(() => {\n        setLocalValue(value);\n        setIsEditing(false);\n    }, [value]);\n    const onApplyValue = () => {\n        onChange(localValue);\n        setIsEditing(false);\n    };\n    const onUpdateLocalValue = (val: ExprOr<T>) => {\n        try {\n            setLocalValue(val);\n            setIsEditValid(true);\n        } catch (e) {\n            setIsEditValid(false);\n        }\n    };\n\n    return {\n        editMode,\n        localValue,\n        isEditValid,\n        isEditing,\n        setIsEditing,\n        setEditMode,\n        setLocalValue,\n        onApplyValue,\n        onCancelEditing,\n        onUpdateLocalValue\n    }\n}\n\nfunction ExprEditorInner<T>(props: ExprEditorInnerProps<T>) {\n    const { renderValueEditor, locale, roStyle } = props;\n    const {\n        isEditValid,\n        isEditing,\n        localValue,\n        setIsEditing,\n        editMode,\n        setEditMode,\n        onApplyValue,\n        onCancelEditing,\n        onUpdateLocalValue\n    } = useExprEditor(props);\n    const onEditClick = () => {\n        if (isEditing) {\n            onCancelEditing();\n        } else {\n            setIsEditing(true);\n        }\n    };\n    const editButton = <Button icon=\"edit\" minimal intent={Intent.PRIMARY} style={{ color: \"white\", backgroundColor: \"#137cbd\" }} onClick={(e: any) => onEditClick()} />\n    return <>\n        <InputGroup style={roStyle} readOnly value={stringifyExpr(props.value, locale)} rightElement={editButton} />\n        <Collapse isOpen={isEditing} keepChildrenMounted={false}>\n            <Card>\n                <h5 className=\"bp3-heading\">Edit Value</h5>\n                <Radio name=\"edit-mode\" label=\"Value\" value=\"edit-value\" checked={editMode == \"edit-value\"} onChange={(e: any) => setEditMode(e.target.value)} />\n                {renderValueEditor(localValue, onUpdateLocalValue, locale, editMode != \"edit-value\")}\n                <br />\n                <Radio name=\"edit-mode\" label=\"Expression\" value=\"edit-expr\" checked={editMode == \"edit-expr\"} onChange={(e: any) => setEditMode(e.target.value)} />\n                <input disabled={editMode != \"edit-expr\"} type=\"text\" className=\"bp3-input\" value={stringifyExprIf(localValue, \"edit-expr\")} onChange={e => onUpdateLocalValue({ expr: e.target.value })} />\n                <br /><br />\n                <ButtonGroup>\n                    <Button disabled={!isEditValid} intent={Intent.SUCCESS} onClick={(e: any) => onApplyValue()}>Apply</Button>\n                    <Button intent={Intent.DANGER} onClick={(e: any) => onCancelEditing()}>Cancel</Button>\n                </ButtonGroup>\n            </Card>\n        </Collapse>\n    </>;\n}\n\nexport const NumberExprEditor: React.FC<ExprEditorProps<number> & { min?: number, max?: number }> = props => {\n    const { min, max } = props;\n    return <ExprEditorInner<number>\n        locale={props.locale}\n        value={props.value}\n        onChange={props.onChange}\n        renderValueEditor={(v, oc, loc, disabled) => <NumericInput disabled={disabled} min={min} max={max} value={parseInt(stringifyExprIf(v, \"edit-value\"), 10)} onValueChange={e => oc(e)} />} />;\n}\n\nexport const SliderExprEditor: React.FC<ExprEditorProps<number> & { min?: number, max?: number, labelStepSize?: number }> = props => {\n    const { min, max, labelStepSize } = props;\n    return <ExprEditorInner<number>\n        locale={props.locale}\n        value={props.value}\n        onChange={props.onChange}\n        renderValueEditor={(v, oc, loc, disabled) => <Slider disabled={disabled} min={min} max={max} labelStepSize={labelStepSize} value={parseInt(stringifyExprIf(v, \"edit-value\"), 10)} onChange={e => oc(e)} />} />;\n}\n\nexport const StringExprEditor: React.FC<ExprEditorProps<string>> = props => {\n    return <ExprEditorInner<string>\n        locale={props.locale}\n        value={props.value}\n        onChange={props.onChange}\n        renderValueEditor={(v, oc, loc, disabled) => <input disabled={disabled} type=\"text\" className=\"bp3-input\" value={stringifyExprIf(v, \"edit-value\")} onChange={e => oc(e.target.value)} />} />;\n}\n\nexport const BooleanExprEditor: React.FC<ExprEditorProps<boolean>> = props => {\n    return <ExprEditorInner<boolean>\n        locale={props.locale}\n        value={props.value}\n        onChange={props.onChange}\n        renderValueEditor={(v, oc, loc, disabled) => <Switch disabled={disabled} checked={isStrTrue(stringifyExprIf(v, \"edit-value\"))} onChange={(e: any) => oc(e.target.checked)} />} />;\n}\n\nexport const ColorExprEditor: React.FC<ExprEditorProps<string>> = props => {\n    const { value } = props;\n    let roStyle: React.CSSProperties | undefined;\n    if (!isEvaluatable(value) && !strIsNullOrEmpty(value)) {\n        roStyle = {\n            backgroundColor: value,\n            color: contrast(value)\n        };\n    }\n    return <ExprEditorInner<string>\n        roStyle={roStyle}\n        locale={props.locale}\n        value={value}\n        onChange={props.onChange}\n        renderValueEditor={(v, oc, loc, disabled) => <ColorPicker locale={loc} value={stringifyExprIf(v, \"edit-value\")} onChange={e => oc(e)} />} />;\n}","/*\n\nOriginally copied from: https://github.com/Viglino/ol-ext/blob/master/src/legend/Legend.js\n\nBSD 3-Clause License\n\nCopyright (c) 2016-2021, Jean-Marc Viglino, IGN-France\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this\n   list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright notice,\n   this list of conditions and the following disclaimer in the documentation\n   and/or other materials provided with the distribution.\n\n3. Neither the name of the copyright holder nor the names of its\n   contributors may be used to endorse or promote products derived from\n   this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\nOR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n */\n\nimport { DEVICE_PIXEL_RATIO as ol_has_DEVICE_PIXEL_RATIO } from 'ol/has';\nimport { toContext as ol_render_toContext } from 'ol/render';\nimport ol_Feature from 'ol/Feature';\nimport ol_render_Feature from 'ol/render/Feature';\nimport ol_geom_Point from 'ol/geom/Point';\nimport ol_geom_LineString from 'ol/geom/LineString';\nimport ol_geom_Polygon from 'ol/geom/Polygon';\nimport { extend as ol_extent_extend } from 'ol/extent';\nimport { Size2 } from '../../api/common';\nimport Style, { StyleFunction } from 'ol/style/Style';\nimport { OLFeature } from '../../api/ol-types';\n\n/**\n * @since 0.14\n */\nexport type LegendItemOptions = {\n    onload?: Function;\n    margin?: number;\n    size?: Size2;\n    lineHeight?: number;\n    style?: Style | Style[] | ((feat: ol_render_Feature | OLFeature) => (Style | Style[]));\n    typeGeom?: any; //\"Point\" | \"MultiPoint\" | \"LineString\" | \"MultiLineString\" | \"Polygon\" | \"MultiPolygon\" | typeof ol_geom_Point | typeof ol_geom_LineString | typeof ol_geom_Polygon;\n    feature?: OLFeature;\n    properties?: { [x: string]: any };\n};\n\nconst DEFAULT_SIZE = [16, 16];\n\n/** \n * Get a symbol image for a given legend item\n * @param {LegendItemOptions} item \n * @param {HTMLCanvasElement|undefined} canvas a canvas to draw in, if none create one\n * @param {number|undefined} row row number to draw in canvas, default 0\n * @since 0.14\n */\nexport function getLegendImage(item: LegendItemOptions, canvas: HTMLCanvasElement | undefined = undefined, row: number | undefined = 0) {\n    item = item || {};\n    if (typeof (item.margin) === 'undefined') item.margin = 10;\n    const size = item.size || DEFAULT_SIZE;\n    item.onload = item.onload || function () {\n        setTimeout(function () {\n            getLegendImage(item, canvas, row);\n        }, 100);\n    };\n    const width = size[0] + 2 * item.margin;\n    const height = item.lineHeight || (size[1] + 2 * item.margin);\n    const ratio = ol_has_DEVICE_PIXEL_RATIO;\n    if (!canvas) {\n        row = 0;\n        canvas = document.createElement('canvas');\n        canvas.width = width * ratio;\n        canvas.height = height * ratio;\n    }\n\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n        ctx.save();\n        const vectorContext = ol_render_toContext(ctx, { pixelRatio: ratio });\n\n        let typeGeom = item.typeGeom;\n        let style: any;\n        let feature = item.feature;\n        if (!feature && typeGeom) {\n            if (/Point/.test(typeGeom)) feature = new ol_Feature(new ol_geom_Point([0, 0]));\n            else if (/LineString/.test(typeGeom)) feature = new ol_Feature(new ol_geom_LineString([0, 0]));\n            else feature = new ol_Feature(new ol_geom_Polygon([[[0, 0]]]));\n            if (item.properties) feature.setProperties(item.properties);\n        }\n        if (feature) {\n            style = feature.getStyle();\n            if (typeof (style) === 'function') style = style(feature);\n            if (!style) {\n                style = typeof (item.style) === 'function' ? item.style(feature) : item.style || [];\n            }\n            typeGeom = feature.getGeometry()?.getType();\n        } else {\n            style = [];\n        }\n        if (!(style instanceof Array)) style = [style];\n\n        const styles: Style[] = style;\n        let cx = width / 2;\n        let cy = height / 2;\n        const sx = size[0] / 2;\n        const sy = size[1] / 2;\n        let i;\n        let s: Style;\n        // Get point offset\n        if (typeGeom === 'Point') {\n            let extent = null;\n            for (let i = 0; s = styles[i]; i++) {\n                const img = s.getImage();\n                // Refresh legend on image load\n                if (img) {\n                    const imgElt: any = img.getImage(devicePixelRatio);\n                    // Check image is loaded\n                    if (imgElt && imgElt.complete && !imgElt.naturalWidth) {\n                        if (typeof (item.onload) === 'function') {\n                            imgElt.addEventListener('load', function () {\n                                setTimeout(function () {\n                                    item.onload?.()\n                                }, 100);\n                            });\n                        }\n                        img.load();\n                    }\n                    // Check anchor to center the image\n                    if (img.getAnchor) {\n                        const anchor = img.getAnchor();\n                        if (anchor) {\n                            const si = img.getSize();\n                            const dx = anchor[0] - si[0];\n                            const dy = anchor[1] - si[1];\n                            if (!extent) {\n                                extent = [dx, dy, dx + si[0], dy + si[1]];\n                            } else {\n                                ol_extent_extend(extent, [dx, dy, dx + si[0], dy + si[1]]);\n                            }\n                        }\n                    }\n                }\n            }\n            if (extent) {\n                cx = cx + (extent[2] + extent[0]) / 2;\n                cy = cy + (extent[3] + extent[1]) / 2;\n            }\n        }\n\n        // Draw image\n        cy += (row * height) || 0;\n        for (i = 0; s = style[i]; i++) {\n            vectorContext.setStyle(s);\n            switch (typeGeom) {\n                case ol_geom_Point:\n                case 'Point':\n                case 'MultiPoint':\n                    vectorContext.drawGeometry(new ol_geom_Point([cx, cy]));\n                    break;\n                case ol_geom_LineString:\n                case 'LineString':\n                case 'MultiLineString':\n                    ctx.save();\n                    ctx.rect(item.margin * ratio, 0, size[0] * ratio, canvas.height);\n                    ctx.clip();\n                    vectorContext.drawGeometry(new ol_geom_LineString([[cx - sx, cy], [cx + sx, cy]]));\n                    ctx.restore();\n                    break;\n                case ol_geom_Polygon:\n                case 'Polygon':\n                case 'MultiPolygon':\n                    vectorContext.drawGeometry(new ol_geom_Polygon([[[cx - sx, cy - sy], [cx + sx, cy - sy], [cx + sx, cy + sy], [cx - sx, cy + sy], [cx - sx, cy - sy]]]));\n                    break;\n            }\n        }\n\n        ctx.restore();\n    }\n    return canvas;\n};","import * as React from \"react\";\nimport { tr } from \"../../api/i18n\";\nimport { ILayerInfo } from \"../../api/common\";\nimport { Button, Intent, ButtonGroup, Card, Icon, Switch, NonIdealState, Slider, Collapse, Spinner, FormGroup } from '@blueprintjs/core';\nimport { strIsNullOrEmpty } from \"../../utils/string\";\nimport { IVectorLayerStyle, VectorStyleSource } from '../../api/ol-style-contracts';\nimport { VectorLayerStyleEditor } from '../vector-style-editor';\nimport { BlueprintSvgIconNames } from '../../constants/assets';\n\nfunction isBoundsZoomable(layer: ILayerInfo) {\n    //TODO: See if WGS84_BBOX [is/can be] surfaced to ILayerInfo\n    if (layer.metadata?.geojson_as_vt === true) {\n        return false;\n    }\n    return layer.type != \"WMS\";\n}\n\ninterface IManageLayerItemProps {\n    layer: ILayerInfo;\n    locale: string;\n    currentResolution?: number;\n    canMoveUp: boolean;\n    canMoveDown: boolean;\n    onSetOpacity: (name: string, value: number) => void;\n    onSetHeatmapBlur: (name: string, value: number) => void;\n    onSetHeatmapRadius: (name: string, value: number) => void;\n    onSetVisibility: (name: string, visible: boolean) => void;\n    onZoomToBounds: (name: string) => void;\n    onRemoveLayer: (name: string) => void;\n    onMoveLayerUp: (name: string) => void;\n    onMoveLayerDown: (name: string) => void;\n    onVectorStyleChanged: (name: string, style: IVectorLayerStyle, which: VectorStyleSource) => void;\n}\n\nenum OpenPanel {\n    None,\n    MoreLayerOptions,\n    EditVectorStyle,\n    WmsLegend\n}\n\nconst HEATMAP_SLIDER_RAMP = [0, 10, 20, 30, 40, 50];\n\nconst LAYER_SWITCH_STYLE: React.CSSProperties = { whiteSpace: \"nowrap\", overflow: \"hidden\", textOverflow: \"ellipsis\" };\n\nconst ManageLayerItem = (props: IManageLayerItemProps) => {\n    const {\n        layer,\n        locale,\n        canMoveUp,\n        canMoveDown,\n        currentResolution,\n        onSetOpacity,\n        onSetHeatmapBlur,\n        onSetHeatmapRadius,\n        onRemoveLayer,\n        onMoveLayerUp,\n        onMoveLayerDown,\n        onZoomToBounds,\n        onSetVisibility,\n        onVectorStyleChanged\n    } = props;\n    const [wmsLegendUrl, setWmsLegendUrl] = React.useState<string | undefined>(undefined);\n    const [openPanel, setOpenPanel] = React.useState(OpenPanel.None);\n    const onToggleWmsLegend = (action: (res?: number) => string) => {\n        if (wmsLegendUrl) {\n            setWmsLegendUrl(undefined);\n            setOpenPanel(OpenPanel.None);\n        } else {\n            const url = action(currentResolution);\n            setWmsLegendUrl(url);\n            setOpenPanel(OpenPanel.WmsLegend);\n        }\n    };\n    const toggleOpenPanel = (panel: OpenPanel) => {\n        let p = OpenPanel.None;\n        switch (panel) {\n            case OpenPanel.EditVectorStyle:\n            case OpenPanel.MoreLayerOptions:\n            case OpenPanel.WmsLegend:\n                p = (panel == openPanel) ? OpenPanel.None : panel;\n                break;\n        }\n        setOpenPanel(p);\n    };\n    const isBusy = (layer.busyWorkerCount > 0);\n    if (isBusy) {\n        return <Card>\n            <Spinner size={30} />\n            <p style={{ textAlign: \"center\", marginTop: 5 }}>{tr(\"LOADING_LAYER\", locale, { name: layer.name })}</p>\n        </Card>;\n    }\n    const canZoom = isBoundsZoomable(layer);\n    let iconName: BlueprintSvgIconNames = \"layer\";\n    if (layer.type == \"WMS\") {\n        iconName = \"media\";\n    }\n    const extraActions = [] as JSX.Element[];\n    const { extensions } = layer;\n    let isWms = false;\n    if (extensions) {\n        switch (extensions.type) {\n            case \"WMS\":\n                {\n                    isWms = true;\n                    if (extensions.getLegendUrl) {\n                        extraActions.push(<Button key=\"toggle-wms-legend\" intent={Intent.SUCCESS} icon=\"info-sign\" onClick={() => onToggleWmsLegend(extensions.getLegendUrl as any)} />)\n                    }\n                }\n        }\n    }\n\n    if (layer.vectorStyle) {\n        if (layer.type != \"KML\" && layer.heatmap == null) {\n            extraActions.push(<Button key=\"edit-vector-style\" title={tr(\"LAYER_MANAGER_TT_EDIT_STYLE\", locale)} intent={Intent.PRIMARY} icon=\"edit\" onClick={() => toggleOpenPanel(OpenPanel.EditVectorStyle)} />)\n        }\n    }\n    extraActions.push(<Button key=\"more-layer-options\" title={tr(\"LAYER_MANAGER_TT_MORE_OPTIONS\", locale)} intent={Intent.PRIMARY} icon=\"cog\" onClick={() => toggleOpenPanel(OpenPanel.MoreLayerOptions)} />)\n    const isWmsLegendOpen = !strIsNullOrEmpty(wmsLegendUrl);\n    const layerLabel = layer.displayName ?? layer.name;\n    const theVectorStyle = layer.cluster?.style ?? layer.vectorStyle;\n    let which: VectorStyleSource;\n    if (theVectorStyle == layer.vectorStyle) {\n        which = VectorStyleSource.Base;\n    } else if (theVectorStyle == layer.cluster?.style) {\n        which = VectorStyleSource.Cluster;\n    }\n    let enableLine = false;\n    let enablePoint = false;\n    let enablePolygon = false;\n    for (const k in theVectorStyle) {\n        if (theVectorStyle[k].point) {\n            enablePoint = true;\n        }\n        if (theVectorStyle[k].line) {\n            enableLine = true;\n        }\n        if (theVectorStyle[k].polygon) {\n            enablePolygon = true;\n        }\n    }\n    return <Card key={layer.name}>\n        <Switch style={LAYER_SWITCH_STYLE} checked={layer.visible} onChange={() => onSetVisibility(layer.name, !layer.visible)} labelElement={<span title={layerLabel}><Icon icon={iconName} /> {layerLabel}</span>} />\n        <ButtonGroup>\n            <Button disabled={!canMoveUp} title={tr(\"LAYER_MANAGER_TT_MOVE_UP\", locale)} intent={Intent.PRIMARY} icon=\"caret-up\" onClick={() => onMoveLayerUp(layer.name)} />\n            <Button disabled={!canMoveDown} title={tr(\"LAYER_MANAGER_TT_MOVE_DOWN\", locale)} intent={Intent.PRIMARY} icon=\"caret-down\" onClick={() => onMoveLayerDown(layer.name)} />\n            <Button disabled={!canZoom} title={tr(\"LAYER_MANAGER_TT_ZOOM_EXTENTS\", locale)} intent={Intent.SUCCESS} icon=\"zoom-to-fit\" onClick={() => onZoomToBounds(layer.name)} />\n            <Button title={tr(\"LAYER_MANAGER_TT_REMOVE\", locale)} intent={Intent.DANGER} icon=\"trash\" onClick={() => onRemoveLayer(layer.name)} />\n            {extraActions}\n        </ButtonGroup>\n        <Collapse isOpen={openPanel == OpenPanel.MoreLayerOptions}>\n            <Card>\n                <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"MORE_LAYER_OPTIONS\", locale)}</a></h5>\n                <FormGroup label={tr(\"LAYER_OPACITY\", locale)}>\n                    <Slider min={0} max={1.0} stepSize={0.01} value={layer.opacity} onChange={e => onSetOpacity(layer.name, e)} />\n                </FormGroup>\n                {layer.heatmap && <>\n                    <FormGroup label={tr(\"LAYER_HEATMAP_BLUR\", locale)}>\n                        <Slider min={1} max={50} stepSize={1} labelValues={HEATMAP_SLIDER_RAMP} value={layer.heatmap.blur} onChange={e => onSetHeatmapBlur(layer.name, e)} />\n                    </FormGroup>\n                    <FormGroup label={tr(\"LAYER_HEATMAP_RADIUS\", locale)}>\n                        <Slider min={1} max={50} stepSize={1} labelValues={HEATMAP_SLIDER_RAMP} value={layer.heatmap.radius} onChange={e => onSetHeatmapRadius(layer.name, e)} />\n                    </FormGroup>\n                </>}\n            </Card>\n        </Collapse>\n        {isWms && <Collapse isOpen={isWmsLegendOpen}>\n            <Card>\n                <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WMS_LEGEND\", locale)}</a></h5>\n                <img src={wmsLegendUrl} />\n            </Card>\n        </Collapse>}\n        {theVectorStyle && <Collapse isOpen={openPanel == OpenPanel.EditVectorStyle}>\n            <div style={{ padding: 5 }}>\n                <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"VECTOR_LAYER_STYLE\", locale)}</a></h5>\n                <VectorLayerStyleEditor onChange={st => onVectorStyleChanged(layer.name, st, which)}\n                    locale={locale}\n                    style={theVectorStyle}\n                    enablePoint={enablePoint}\n                    enableLine={enableLine}\n                    enablePolygon={enablePolygon} />\n            </div>\n        </Collapse>}\n    </Card>;\n}\n\n/**\n * @hidden\n */\nexport interface IManageLayersProps {\n    layers: ILayerInfo[];\n    locale: string;\n    currentResolution?: number;\n    onSetOpacity: (name: string, value: number) => void;\n    onSetHeatmapBlur: (name: string, value: number) => void;\n    onSetHeatmapRadius: (name: string, value: number) => void;\n    onSetVisibility: (name: string, visible: boolean) => void;\n    onZoomToBounds: (name: string) => void;\n    onRemoveLayer: (name: string) => void;\n    onMoveLayerUp: (name: string) => void;\n    onMoveLayerDown: (name: string) => void;\n    onVectorStyleChanged: (name: string, style: IVectorLayerStyle, which: VectorStyleSource) => void;\n}\n\n/**\n * @hidden\n */\nexport const ManageLayers = (props: IManageLayersProps) => {\n    const {\n        locale,\n        currentResolution,\n        onSetOpacity,\n        onSetHeatmapBlur,\n        onSetHeatmapRadius,\n        onRemoveLayer,\n        onMoveLayerUp,\n        onMoveLayerDown,\n        onZoomToBounds,\n        onSetVisibility,\n        onVectorStyleChanged\n    } = props;\n    const [layers, setLayers] = React.useState(props.layers);\n    React.useEffect(() => {\n        setLayers(props.layers);\n    }, [props.layers]);\n    if (layers.length) {\n        return <div>\n            {layers.map((lyr, i) => {\n                const cannotMoveUp = (i == 0 || layers.length <= 1);\n                const cannotMoveDown = (i >= layers.length - 1 || layers.length <= 1);\n                return <ManageLayerItem\n                    key={`manage-layer-${i}`}\n                    layer={lyr}\n                    locale={locale}\n                    canMoveUp={!cannotMoveUp}\n                    canMoveDown={!cannotMoveDown}\n                    currentResolution={currentResolution}\n                    onSetOpacity={onSetOpacity}\n                    onSetHeatmapBlur={onSetHeatmapBlur}\n                    onSetHeatmapRadius={onSetHeatmapRadius}\n                    onRemoveLayer={onRemoveLayer}\n                    onMoveLayerUp={onMoveLayerUp}\n                    onMoveLayerDown={onMoveLayerDown}\n                    onZoomToBounds={onZoomToBounds}\n                    onSetVisibility={onSetVisibility}\n                    onVectorStyleChanged={onVectorStyleChanged} />;\n            })}\n        </div>;\n    } else {\n        return <NonIdealState\n            icon=\"layers\"\n            title={tr(\"NO_EXTERNAL_LAYERS\", locale)}\n            description={tr(\"NO_EXTERNAL_LAYERS_DESC\", locale, { tabName: tr(\"ADD_LAYER\", locale) })} />\n    }\n}","import * as React from \"react\";\nimport { IWfsServiceCapabilities, IWfsServiceInfo, IWfsLayerInfo } from './wfs-capabilities-parser';\nimport { tr } from '../../api/i18n';\nimport { Card, Icon, ButtonGroup, Button, Intent } from '@blueprintjs/core';\nimport { Bounds } from '../../api/common';\n\n/**\n * Attempts to extract an EPSG code from the given CRS identifier\n * \n * @export\n * @param {string | undefined} crs\n * @returns {(number | undefined)}\n * @since 0.13\n */\nexport function parseEpsgCodeFromCRS(crs: string | undefined): number | undefined {\n    if (crs == \"urn:ogc:def:crs:OGC:1.3:CRS84\") {\n        return 4326;\n    }\n    let res = crs?.match(/urn:ogc:def:crs:EPSG::(\\d+)/);\n    if (res?.length == 2) {\n        return parseInt(res[1], 10);\n    }\n    res = crs?.match(/EPSG:(\\d+)/);\n    if (res?.length == 2) {\n        return parseInt(res[1], 10);\n    }\n    return undefined;\n}\n\nfunction isGeoJsonMimeType(mimeType: string): boolean {\n    const lmt = mimeType?.toLowerCase() ?? \"\";\n    if (lmt.indexOf(\"application/vnd.geo+json\") >= 0 ||\n        lmt.indexOf(\"application/json\") >= 0) {\n        return true;\n    }\n    return false;\n}\n\nfunction getGeoJsonFormat(serviceInfo: IWfsServiceInfo, layer: IWfsLayerInfo): string | undefined {\n    const lformats = (layer.formats ?? []).filter(f => isGeoJsonMimeType(f))?.[0];\n    // NOTE: Some WFS services advertise GeoJSON support as an allowed outputFormat parameter at the service-level, \n    // but not as an advertised outputFormat for the layer in question. Without fully reading the spec, I don't know\n    // if using GetFeature for a layer with a service-level outputFormat for such layers is formally allowed. Based\n    // on my sample WFS services, this appears to be allowed, so if geojson is supported at the service-level, but\n    // not at the layer level, we'll still consider geojson as being \"supported\"\n    const sformats = (serviceInfo.allowedOutputFormats ?? []).filter(f => isGeoJsonMimeType(f))?.[0];\n    return lformats ?? sformats;\n}\n\nfunction getLayerCrs(layer: IWfsLayerInfo): [number | undefined, string] {\n    let pdc: [number | undefined, string] = [parseEpsgCodeFromCRS(layer.defaultCrs), layer.defaultCrs];\n    // We strongly prefer 4326/3857 projections over others\n    if (!(pdc[0] == 4326 || pdc[0] == 3857)) {\n        if (layer.otherCrs) {\n            const matches = layer.otherCrs.filter(c => {\n                const poc = parseEpsgCodeFromCRS(c);\n                return (poc == 4326 || poc == 3857);\n            });\n            if (matches.length > 0) {\n                pdc = [parseEpsgCodeFromCRS(matches[0]), matches[0]];\n            }\n        }\n    }\n    return pdc;\n}\n\n/**\n * @hidden\n */\nexport interface IWfsCapabilitiesPanelProps {\n    capabilities: IWfsServiceCapabilities;\n    locale: string;\n    onAddLayer: (name: string, version: string, format: string, origCrs: string, epsgCode: number, wfsWgs84Bounds?: Bounds) => void;\n}\n\n/**\n * @hidden\n */\nexport const WfsCapabilitiesPanel = (props: IWfsCapabilitiesPanelProps) => {\n    const { locale, capabilities, onAddLayer } = props;\n    const { layers, info } = capabilities;\n    return <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WFS_SERVICE_INFO\", locale)}</a></h5>\n            <p>{tr(\"WFS_VERSION\", locale, { version: info.version })}</p>\n            <p>{tr(\"OWS_SERVICE_TITLE\", locale, { title: info.title })}</p>\n            <p>{tr(\"OWS_SERVICE_ABSTRACT\", locale, { abstract: info.abstract })}</p>\n        </Card>\n        <Card style={{ marginBottom: 10 }}>\n            <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WFS_AVAILABLE_LAYERS\", locale)}</a></h5>\n            {layers.map(layer => {\n                const geoJsonFmt = getGeoJsonFormat(info, layer);\n                const [epsgCode, origCrs] = getLayerCrs(layer);\n                //Only include layers whose CRS was able to be parsed into an epsg code\n                if (epsgCode && geoJsonFmt) {\n                    const otherActions = <></>;\n                    return <Card key={layer.name} style={{ padding: 15, paddingTop: 5 }}>\n                        <h4><Icon icon=\"layer\" /> {layer.name}</h4>\n                        <p>{tr(\"OWS_LAYER_TITLE\", locale, { title: layer.title })}</p>\n                        <p>{tr(\"OWS_LAYER_CRS\", locale, { crs: `EPSG:${epsgCode}` })}</p>\n                        {/*<p>{tr(\"OWS_LAYER_ABSTRACT\", locale, { abstract: layer.abstract })}</p>*/}\n                        <ButtonGroup fill>\n                            <Button onClick={() => onAddLayer(layer.name, info.version, geoJsonFmt, origCrs, epsgCode, layer.wgs84Bounds)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER\", locale)}</Button>\n                            {otherActions}\n                        </ButtonGroup>\n                    </Card>\n                }\n            }).filter(c => c)}\n        </Card>\n    </>\n}","import { Bounds } from '../../api/common';\nimport { strIsNullOrEmpty } from '../../utils/string';\n\n/**\n * The root WFS service capabilities\n * \n * @export\n * @interface IWfsServiceCapabilities\n * @since 0.13\n */\nexport interface IWfsServiceCapabilities {\n    info: IWfsServiceInfo;\n    layers: IWfsLayerInfo[];\n}\n\n/**\n * WFS service metadata\n * \n * @export\n * @interface IWfsServiceInfo\n * @since 0.13\n */\nexport interface IWfsServiceInfo {\n    title: string;\n    abstract: string;\n    version: string;\n    allowedOutputFormats?: string[];\n}\n\n/**\n * Metadata for a published WFS layer\n * \n * @export\n * @interface IWfsLayerInfo\n * @since 0.13\n */\nexport interface IWfsLayerInfo {\n    name: string;\n    title: string;\n    abstract: string;\n    wgs84Bounds?: Bounds;\n    formats?: string[];\n    defaultCrs: string;\n    otherCrs?: string[];\n}\n\nfunction tryGetElementContent(el?: Element): string | undefined {\n    if (el) {\n        return el.textContent ?? (el as any).text;\n    }\n}\n\nfunction getElements(root: Document | Element, tagName: string, ns?: string): Element[] {\n    let els: HTMLCollectionOf<Element> | NodeListOf<Element>;\n    if (ns) {\n        els = root.getElementsByTagName(`${ns}:${tagName}`);\n        if (els.length == 0) {\n            //Try un-qualified\n            els = root.getElementsByTagName(tagName);\n        }\n    } else {\n        els = root.getElementsByTagName(tagName);\n    }\n    const elements = [] as Element[];\n    if (els) {\n        for (let i = 0; i < els.length; i++) {\n            const el = els.item(i);\n            if (el) {\n                elements.push(el);\n            }\n        }\n    }\n    return elements;\n}\n\nfunction trySetProperty<T>(obj: T, setter: (o: T, v: string) => void, value: string | null | undefined) {\n    if (value) {\n        setter(obj, value);\n    }\n}\n\n/**\n * A basic parser for WFS capabilities XML\n *\n * @export\n * @class WfsCapabilitiesParser\n * @since 0.13\n */\nexport class WfsCapabilitiesParser {\n    private xmlDoc: Document;\n    constructor() {}\n    public parse(xml: string): IWfsServiceCapabilities {\n        const parser = new DOMParser();\n        this.xmlDoc = parser.parseFromString(xml, \"text/xml\");\n        const info = this.getServiceInfo();\n        const layers = this.getLayers();\n        return {\n            info,\n            layers\n        };\n    }\n    private getServiceInfo(): IWfsServiceInfo {\n        const els = getElements(this.xmlDoc, \"ServiceIdentification\", \"ows\");\n        const info: IWfsServiceInfo = {\n            title: \"\",\n            abstract: \"\",\n            version: \"\"\n        };\n        if (els.length == 1) {\n            const t = tryGetElementContent(getElements(els[0], \"Title\", \"ows\")?.[0]);\n            const a = tryGetElementContent(getElements(els[0], \"Abstract\", \"ows\")?.[0]);\n            const ops = getElements(this.xmlDoc, \"Operation\", \"ows\");\n            for (const op of ops) {\n                if (op.getAttribute(\"name\") == \"GetFeature\") {\n                    const parms = getElements(op, \"Parameter\", \"ows\");\n                    for (const parm of parms) {\n                        if (parm.getAttribute(\"name\") == \"outputFormat\") {\n                            const allowedValues = getElements(parm, \"Value\", \"ows\")\n                                .map(av => tryGetElementContent(av))\n                                .filter(s => !strIsNullOrEmpty(s)) as string[];\n                            if (allowedValues.length > 0) {\n                                info.allowedOutputFormats = allowedValues;\n                            }\n                        }\n                    }\n                }\n            }\n            const v: string[] = getElements(els[0], \"ServiceTypeVersion\", \"ows\")\n                .map(el => tryGetElementContent(el))\n                .filter(s => !strIsNullOrEmpty(s)) as string[];\n            v.sort();\n            trySetProperty(info, (i, v) => i.title = v, t);\n            trySetProperty(info, (i, v) => i.abstract = v, a);\n            //Pick the last (highest) version\n            if (v.length > 0) {\n                info.version = v[v.length - 1];\n            }\n        }\n        return info;\n    }\n    private getLayers(): IWfsLayerInfo[] {\n        const els = getElements(this.xmlDoc, \"FeatureType\", \"wfs\");\n        const layers = els.map(el => {\n            const info: IWfsLayerInfo = {\n                name: \"\",\n                title: \"\",\n                abstract: \"\",\n                defaultCrs: \"\"\n            };\n            const n = tryGetElementContent(getElements(el, \"Name\", \"wfs\")?.[0]);\n            const t = tryGetElementContent(getElements(el, \"Title\", \"wfs\")?.[0]);\n            const a = tryGetElementContent(getElements(el, \"Abstract\", \"wfs\")?.[0]);\n            const c = tryGetElementContent(\n                getElements(el, \"DefaultCRS\", \"wfs\")?.[0] ?? // WFS 2.0.0\n                getElements(el, \"DefaultSRS\", \"wfs\")?.[0]    // WFS older versions\n            );\n            const oc = getElements(el, \"OtherCRS\", \"wfs\")\n                .map(fel => tryGetElementContent(fel))\n                .filter(s => !strIsNullOrEmpty(s)) as string[];\n            const os = getElements(el, \"OtherSRS\", \"wfs\")\n                .map(fel => tryGetElementContent(fel))\n                .filter(s => !strIsNullOrEmpty(s)) as string[];\n            info.otherCrs = [...oc, ...os];\n            const fmts = getElements(el, \"Format\", \"wfs\")\n                .map(fel => tryGetElementContent(fel))\n                .filter(s => !strIsNullOrEmpty(s)) as string[];\n            const ll = tryGetElementContent(getElements(el, \"LowerCorner\", \"ows\")?.[0]);\n            const ur = tryGetElementContent(getElements(el, \"UpperCorner\", \"ows\")?.[0]);\n            trySetProperty(info, (i, v) => i.name = v, n);\n            trySetProperty(info, (i, v) => i.title = v, t);\n            trySetProperty(info, (i, v) => i.abstract = v, a);\n            trySetProperty(info, (i, v) => i.defaultCrs = v, c);\n            if (fmts.length > 0) {\n                info.formats = fmts;\n            }\n            const llParts = ll?.split(' ').map(s => parseFloat(s));\n            const urParts = ur?.split(' ').map(s => parseFloat(s));\n            if (llParts?.length == 2 && urParts?.length == 2) {\n                info.wgs84Bounds = [\n                    llParts[0],\n                    llParts[1],\n                    urParts[0],\n                    urParts[1]\n                ];\n            }\n            return info;\n        });\n        return layers;\n    }\n}","import * as React from \"react\";\nimport { tr } from \"../../api/i18n\";\nimport { WmsCapabilitiesDocument, WMSPublishedLayer, WMSLayerStyle } from \"../../api/common\";\nimport { Tooltip, ITreeNode, Card, Button, Intent, ButtonGroup, Icon } from '@blueprintjs/core';\n\ntype WMSLayerStylePair = [WMSPublishedLayer, WMSLayerStyle[]];\n\nfunction extractWmsLayers(caps: WmsCapabilitiesDocument): WMSLayerStylePair[] {\n    const layers = [] as WMSLayerStylePair[];\n    const { Layer, ...rootLayer } = caps.Capability.Layer;\n    if (rootLayer.Name) { //Must have name to be considered\n        layers.push([rootLayer, rootLayer.Style ?? []]);\n    }\n    if (caps.Capability.Layer.Layer) {\n        for (const layer of caps.Capability.Layer.Layer) {\n            layers.push([layer, layer.Style ?? []]);\n        }\n    }\n    return layers;\n}\n\n\nexport interface IWmsCapabilitiesPanelProps {\n    capabilities: WmsCapabilitiesDocument;\n    locale: string;\n    onAddLayer: (name: string, queryable: boolean, isTiled: boolean, style: WMSLayerStyle | undefined, getLegendUrl?: string) => void;\n}\n\nexport const WmsCapabilitiesPanel = (props: IWmsCapabilitiesPanelProps) => {\n    const { locale, onAddLayer } = props;\n    const { capabilities: caps } = props;\n    const layers = extractWmsLayers(caps);\n    return <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WMS_SERVICE_INFO\", locale)}</a></h5>\n            <p>{tr(\"WMS_VERSION\", locale, { version: caps.version })}</p>\n            <p>{tr(\"OWS_SERVICE_NAME\", locale, { name: caps.Service.Name })}</p>\n            <p>{tr(\"OWS_SERVICE_TITLE\", locale, { title: caps.Service.Title })}</p>\n            <p>{tr(\"OWS_SERVICE_ABSTRACT\", locale, { abstract: caps.Service.Abstract })}</p>\n        </Card>\n        <Card style={{ marginBottom: 10 }}>\n            <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"WMS_AVAILABLE_LAYERS\", locale)}</a></h5>\n            {layers.map(([layer, styles]) => {\n                const otherActions = <></>;\n                return <Card key={layer.Name} style={{ padding: 15, paddingTop: 5 }}>\n                    <h4><Icon icon=\"layer\" /> {layer.Name}</h4>\n                    <p>{tr(\"OWS_LAYER_TITLE\", locale, { title: layer.Title })}</p>\n                    {/*<p>{tr(\"OWS_LAYER_ABSTRACT\", locale, { abstract: layer.Abstract })}</p>*/}\n                    {(() => {\n                        if (styles.length) {\n                            return styles.map(st => <ButtonGroup key={st.Name} vertical fill alignText=\"left\">\n                                <Button onClick={() => onAddLayer(layer.Name, layer.queryable, false, st, st.LegendURL?.[0]?.OnlineResource)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER_WITH_WMS_STYLE\", locale, { style: st.Name })}</Button>\n                                <Button onClick={() => onAddLayer(layer.Name, layer.queryable, true, st, st.LegendURL?.[0]?.OnlineResource)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER_WITH_WMS_STYLE_TILED\", locale, { style: st.Name })}</Button>\n                                {otherActions}\n                            </ButtonGroup>);\n                        } else {\n                            return <ButtonGroup vertical fill alignText=\"left\">\n                                <Button onClick={() => onAddLayer(layer.Name, layer.queryable, false, undefined)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER\", locale)}</Button>\n                                <Button onClick={() => onAddLayer(layer.Name, layer.queryable, true, undefined)} intent={Intent.PRIMARY} icon=\"new-layer\">{tr(\"ADD_LAYER_TILED\", locale)}</Button>\n                                {otherActions}\n                            </ButtonGroup>;\n                        }\n                    })()}\n                </Card>\n            })}\n        </Card>\n    </>\n}","import * as React from \"react\";\nimport { IExternalBaseLayer, GenericEvent, ILayerInfo } from \"../api/common\";\nimport { RuntimeMap, MapLayer, MapGroup, RuleInfo } from \"../api/contracts/runtime-map\";\nimport { LegendContext, ILegendContext } from \"./context\";\nimport { BaseLayerSwitcher } from \"./base-layer-switcher\";\nimport { isLayer } from \"../utils/type-guards\";\nimport { Icon, ImageIcon } from \"./icon\";\nimport { Card, Icon as BpIcon, Button, InputGroup, IconName } from \"@blueprintjs/core\";\nimport { scaleRangeBetween } from \"../utils/number\";\nimport { tr } from \"../api/i18n\";\nimport { BlueprintSvgIconNames } from '../constants/assets';\nimport { NBSP } from '../constants';\nimport { strIsNullOrEmpty } from '../utils/string';\nimport { useReduxDispatch } from \"./map-providers/context\";\nimport { setMapLayerVisibility } from \"../actions/map\";\n\nconst ICON_LEGEND_LAYER: BlueprintSvgIconNames = \"layer\";\nconst ICON_SELECT: BlueprintSvgIconNames = \"select\";\nconst ICON_LC_UNSELECT: BlueprintSvgIconNames = \"disable\";\nconst ICON_LEGEND_THEME: BlueprintSvgIconNames = \"multi-select\";\nconst ICON_LEGEND_TOGGLE: BlueprintSvgIconNames = \"chevron-down\";\nconst ICON_LEGEND_TOGGLE_EXPAND: BlueprintSvgIconNames = \"chevron-right\";\nconst ICON_LEGEND_RASTER: BlueprintSvgIconNames = \"media\";\nconst ICON_FOLDER_HORIZONTAL: BlueprintSvgIconNames = \"folder-close\";\nconst ICON_CLEAR: BlueprintSvgIconNames = \"cross\";\nconst ICON_SEARCH: BlueprintSvgIconNames = \"search\";\n\nconst UL_LIST_STYLE = (baseSize: number) => ({ listStyle: \"none\", paddingLeft: baseSize + 4, marginTop: 2, marginBottom: 2 });\nconst LI_LIST_STYLE = { listStyle: \"none\", marginTop: 2, marginBottom: 2 };\nconst ROW_ITEM_ELEMENT_STYLE = { verticalAlign: \"middle\" };\nconst CHK_STYLE = (baseSize: number) => ({ margin: 0, width: `${baseSize - 2}px`, height: `${baseSize - 2}px`, padding: 1, verticalAlign: \"middle\" });\nconst EMPTY_STYLE = (baseSize: number) => ({ display: \"inline-block\", margin: 0, width: `${baseSize}px`, height: `${baseSize}px`, verticalAlign: \"middle\" });\n\nexport type MapElementChangeFunc = (objectId: string, visible: boolean) => void;\n\ninterface ILegendLabelProps {\n    text: string;\n    baseSize: number;\n}\n\nconst LegendLabel = (props: ILegendLabelProps) => {\n    const legendCtx = React.useContext(LegendContext);\n    let inner;\n    const ft = legendCtx.getFilterText()?.toLocaleLowerCase();\n    if (legendCtx.isFiltering() && !strIsNullOrEmpty(ft)) {\n        const idx = props.text.toLocaleLowerCase().indexOf(ft);\n        if (idx >= 0) {\n            inner = props.text.substring(0, idx);\n            inner += `<span class='legend-label-highlight-text'>${props.text.substring(idx, idx + ft.length)}</span>`;\n            inner += props.text.substring(idx + ft.length, props.text.length);\n        } else {\n            inner = props.text;\n        }\n    } else {\n        inner = props.text;\n    }\n    return <span className=\"legend-label\" style={{ lineHeight: `${props.baseSize}px`, verticalAlign: \"middle\" }} dangerouslySetInnerHTML={{ __html: inner }} />;\n};\n\n/**\n * Legend component props\n *\n * @export\n * @interface ILegendProps\n */\nexport interface ILegendProps {\n    baseIconSize?: number;\n    /**\n     * @since 0.14 made optional\n     */\n    map?: RuntimeMap;\n    stateless: boolean;\n    showLayers: string[] | undefined;\n    showGroups: string[] | undefined;\n    hideLayers: string[] | undefined;\n    hideGroups: string[] | undefined;\n    locale: string;\n    externalBaseLayers?: IExternalBaseLayer[] | undefined;\n    onBaseLayerChanged?: (name: string) => void | undefined;\n    onLayerSelectabilityChanged?: (id: string, selectable: boolean) => void | undefined;\n    onGroupExpansionChanged?: (id: string, expanded: boolean) => void | undefined;\n    onLayerVisibilityChanged?: MapElementChangeFunc | undefined;\n    onGroupVisibilityChanged?: MapElementChangeFunc | undefined;\n    currentScale: number;\n    overrideSelectableLayers?: any | undefined;\n    overrideExpandedItems?: any | undefined;\n    maxHeight?: number;\n    inlineBaseLayerSwitcher: boolean;\n    externalLayers?: ILayerInfo[];\n    activeMapName?: string;\n}\n\nfunction getIconUri(iconMimeType: string | undefined, iconBase64: string | undefined): string | undefined {\n    if (iconMimeType && iconBase64) {\n        return `data:${iconMimeType};base64,${iconBase64}`;\n    } else {\n        return undefined;\n    }\n}\n\ninterface IEmptyNodeProps {\n    baseSize: number;\n}\n\nconst EmptyNode: React.StatelessComponent<IEmptyNodeProps> = (props: IEmptyNodeProps) => {\n    return <div style={EMPTY_STYLE(props.baseSize)}>{NBSP}</div>;\n};\n\ninterface IRuleNodeProps {\n    iconMimeType: string | undefined;\n    rule: RuleInfo;\n    baseSize: number;\n}\n\nconst RuleNode = (props: IRuleNodeProps) => {\n    const icon = getIconUri(props.iconMimeType, props.rule.Icon);\n    const label = (props.rule.LegendLabel ? props.rule.LegendLabel : \"\");\n    return <li className=\"layer-rule-node\" style={LI_LIST_STYLE}>\n        <EmptyNode baseSize={props.baseSize} /> <img style={ROW_ITEM_ELEMENT_STYLE} src={icon} /> <LegendLabel baseSize={props.baseSize} text={label} />\n    </li>;\n};\n\nexport interface ILayerNodeProps {\n    layer: MapLayer;\n}\n\nexport const LayerNode = (props: ILayerNodeProps) => {\n    const { layer } = props;\n    const legendCtx = React.useContext(LegendContext);\n    const [layerVisible, setLayerVisible] = React.useState(legendCtx.getLayerVisibility(props.layer));\n    const label = layer.LegendLabel ? layer.LegendLabel : \"\";\n    const iconMimeType = legendCtx.getIconMimeType();\n\n    const onVisibilityChanged = (e: GenericEvent) => {\n        setLayerVisible(e.target.checked);\n        legendCtx.setLayerVisibility(layer.ObjectId, e.target.checked);\n    }\n    const onToggleSelectability = (e: GenericEvent) => {\n        const selectable = getLayerSelectability(layer.ObjectId);\n        legendCtx.setLayerSelectability(layer.ObjectId, !selectable);\n    }\n    const getExpanded = () => {\n        let expanded = legendCtx.getLayerExpanded(layer.ObjectId);\n        if (expanded == null)\n            expanded = layer.ExpandInLegend;\n        return expanded;\n    };\n    const onToggleExpansion = (e: GenericEvent) => {\n        const expanded = getExpanded();\n        legendCtx.setLayerExpanded(layer.ObjectId, !expanded);\n    }\n    const getLayerSelectability = (layerId: string) => {\n        let selectable = legendCtx.getLayerSelectability(layerId);\n        if (selectable == null) {\n            selectable = layer.Selectable;\n        }\n        return selectable;\n    }\n\n    let text = label;\n    let icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n        {bs => <BpIcon icon={ICON_LEGEND_LAYER} iconSize={bs} />}\n    </Icon>;\n    let selectable: JSX.Element | undefined;\n    if (layer.Selectable === true) {\n        //NOTE: As we've intercepted the BP icons package, we've re-appropriated the \"disable\" icon for\n        //disabling selection\n        selectable = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE} onClick={onToggleSelectability}>\n            {bs => <BpIcon icon={getLayerSelectability(layer.ObjectId) ? ICON_SELECT : ICON_LC_UNSELECT} iconSize={bs} />}\n        </Icon>;\n    }\n    let chkbox: JSX.Element | undefined;\n    if (layer.Type == 1) { //Dynamic\n        chkbox = <input type='checkbox'\n            className='layer-checkbox'\n            style={CHK_STYLE(legendCtx.getBaseIconSize())}\n            value={layer.ObjectId}\n            onChange={onVisibilityChanged}\n            checked={(layerVisible)} />;\n    }\n    const tooltip = label;\n    const nodeClassName = \"layer-node\";\n    let nodeStyle: React.CSSProperties = { whiteSpace: \"nowrap\", overflow: \"hidden\", ...LI_LIST_STYLE };\n    if (layer.ScaleRange) {\n        for (const scaleRange of layer.ScaleRange) {\n            if (scaleRange.FeatureStyle && scaleRange.FeatureStyle.length > 0) {\n                const ruleElements = [];\n                //if (debug)\n                //    text = label + \" (\" + scaleRange.MinScale + \" - \" + scaleRange.MaxScale + \")\";\n                let body: JSX.Element | undefined;\n                let isExpanded = getExpanded();\n                let totalRuleCount = 0;\n                for (const fts of scaleRange.FeatureStyle) {\n                    totalRuleCount += fts.Rule.length;\n                }\n                if (isExpanded && totalRuleCount > 1) {\n                    icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n                        {bs => <BpIcon icon={ICON_LEGEND_THEME} iconSize={bs} />}\n                    </Icon>;\n\n                    for (let fi = 0; fi < scaleRange.FeatureStyle.length; fi++) {\n                        const fts = scaleRange.FeatureStyle[fi];\n                        const ftsRuleCount = fts.Rule.length;\n                        //Test compression\n                        let bCompressed = false;\n                        if (ftsRuleCount > 3) {\n                            bCompressed = !(fts.Rule[1].Icon);\n                        }\n                        if (bCompressed) {\n                            ruleElements.push(<RuleNode baseSize={legendCtx.getBaseIconSize()} key={`layer-${layer.ObjectId}-style-${fi}-rule-first`} iconMimeType={iconMimeType} rule={fts.Rule[0]} />);\n                            ruleElements.push(<li style={LI_LIST_STYLE} key={`layer-${layer.ObjectId}-style-${fi}-rule-compressed`}><LegendLabel baseSize={legendCtx.getBaseIconSize()} text={tr(\"OTHER_THEME_RULE_COUNT\", legendCtx.getLocale(), { count: ftsRuleCount - 2 })} /></li>);\n                            ruleElements.push(<RuleNode baseSize={legendCtx.getBaseIconSize()} key={`layer-${layer.ObjectId}-style-${fi}-rule-last`} iconMimeType={iconMimeType} rule={fts.Rule[ftsRuleCount - 1]} />);\n                        } else {\n                            for (let i = 0; i < ftsRuleCount; i++) {\n                                const rule = fts.Rule[i];\n                                ruleElements.push(<RuleNode baseSize={legendCtx.getBaseIconSize()} key={`layer-${layer.ObjectId}-style-${fi}-rule-${i}`} iconMimeType={iconMimeType} rule={rule} />);\n                            }\n                        }\n                    }\n                } else { //Collapsed\n                    if (totalRuleCount > 1) {\n                        icon = <Icon style={ROW_ITEM_ELEMENT_STYLE} baseSize={legendCtx.getBaseIconSize()}>\n                            {bs => <BpIcon icon={ICON_LEGEND_THEME} iconSize={bs} />}\n                        </Icon>;\n                    } else {\n                        const uri = getIconUri(iconMimeType, scaleRange.FeatureStyle[0].Rule[0].Icon);\n                        if (uri) {\n                            icon = <ImageIcon style={ROW_ITEM_ELEMENT_STYLE} url={uri} />;\n                        }\n                    }\n                }\n\n                if (ruleElements.length > 0) {\n                    body = <ul style={UL_LIST_STYLE(legendCtx.getBaseIconSize())}>{ruleElements}</ul>;\n                }\n\n                let expanded: JSX.Element;\n                if (totalRuleCount > 1) {\n                    expanded = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE} onClick={onToggleExpansion}>\n                        {bs => <BpIcon icon={isExpanded ? ICON_LEGEND_TOGGLE : ICON_LEGEND_TOGGLE_EXPAND} iconSize={bs} />}\n                    </Icon>;\n                } else {\n                    expanded = <EmptyNode baseSize={legendCtx.getBaseIconSize()} />;\n                }\n                return <li title={tooltip} style={nodeStyle} className={nodeClassName}>{expanded} {chkbox} {selectable} {icon} <LegendLabel baseSize={legendCtx.getBaseIconSize()} text={text} /> {body}</li>;\n            } else { //This is generally a raster\n                icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n                    {bs => <BpIcon icon={ICON_LEGEND_RASTER} iconSize={bs} />}\n                </Icon>;\n            }\n        }\n    }\n    return <li title={tooltip} style={nodeStyle} className={nodeClassName}><EmptyNode baseSize={legendCtx.getBaseIconSize()} /> {chkbox} {selectable} {icon} {label}</li>;\n};\n\nconst ExternalLayerNode: React.FC<{ layer: ILayerInfo }> = ({ layer }) => {\n    const legendCtx = React.useContext(LegendContext);\n    const nodeClassName = \"layer-node\";\n    const nodeStyle: React.CSSProperties = { whiteSpace: \"nowrap\", overflow: \"hidden\", ...LI_LIST_STYLE };\n    const dispatch = useReduxDispatch();\n    const onVisibilityChanged = (visible: boolean) => {\n        const activeMapName = legendCtx.getMapName();\n        if (activeMapName) {\n            dispatch(setMapLayerVisibility(activeMapName, layer.name, visible));\n        }\n    };\n    const chkbox = <input type='checkbox'\n        className='layer-checkbox'\n        style={CHK_STYLE(legendCtx.getBaseIconSize())}\n        onChange={e => onVisibilityChanged(e.target.checked)}\n        checked={layer.visible} />;\n    let iconToUse: IconName = ICON_LEGEND_LAYER;\n    if (layer.type == \"WMS\") {\n        iconToUse = ICON_LEGEND_RASTER;\n    }\n    const icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n        {bs => <BpIcon icon={iconToUse} iconSize={bs} />}\n    </Icon>;\n    return <li style={nodeStyle} className={nodeClassName}>{chkbox} {icon} {layer.displayName}</li>;\n}\n\nconst ExternalLayersGroupNode: React.FC<{ layers: ILayerInfo[] }> = ({ layers }) => {\n    const legendCtx = React.useContext(LegendContext);\n    if (layers.length == 0) {\n        return <></>;\n    } else {\n        const nodeClassName = \"group-node\";\n        const icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n            {bs => <BpIcon icon={ICON_FOLDER_HORIZONTAL} iconSize={bs} />}\n        </Icon>;\n        const nodeStyle: React.CSSProperties = { whiteSpace: \"nowrap\", overflow: \"hidden\", ...LI_LIST_STYLE };\n        return <li style={nodeStyle} className={nodeClassName}>\n            <span>{icon} <LegendLabel baseSize={legendCtx.getBaseIconSize()} text={tr(\"EXTERNAL_LAYERS\", legendCtx.getLocale())} /></span>\n            <ul style={UL_LIST_STYLE(legendCtx.getBaseIconSize())}>\n                {layers.map((layer, i) => <ExternalLayerNode key={`external-layer=${layer.name}`} layer={layer} />)}\n            </ul>\n        </li>;\n    }\n}\n\nexport interface IGroupNodeProps {\n    group: MapGroup;\n    childItems: (MapLayer | MapGroup)[];\n}\n\nexport const GroupNode = (props: IGroupNodeProps) => {\n    const { group } = props;\n    const legendCtx = React.useContext(LegendContext);\n    const [groupVisible, setGroupVisible] = React.useState(legendCtx.getGroupVisibility(group));\n    const getExpanded = () => {\n        let expanded = legendCtx.getGroupExpanded(group.ObjectId);\n        if (expanded == null)\n            expanded = group.ExpandInLegend;\n        return expanded;\n    };\n    const onToggleExpansion = (e: GenericEvent) => {\n        const expanded = getExpanded();\n        legendCtx.setGroupExpanded(group.ObjectId, !expanded);\n    };\n    const onVisibilityChanged = (e: GenericEvent) => {\n        setGroupVisible(e.target.checked);\n        legendCtx.setGroupVisibility(group.ObjectId, e.target.checked);\n    };\n    const currentScale = legendCtx.getCurrentScale();\n    const tree = legendCtx.getTree();\n    const icon = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE}>\n        {bs => <BpIcon icon={ICON_FOLDER_HORIZONTAL} iconSize={bs} />}\n    </Icon>;\n    const isExpanded = getExpanded();\n    const expanded = <Icon baseSize={legendCtx.getBaseIconSize()} style={ROW_ITEM_ELEMENT_STYLE} onClick={onToggleExpansion}>\n        {bs => <BpIcon icon={isExpanded ? ICON_LEGEND_TOGGLE : ICON_LEGEND_TOGGLE_EXPAND} iconSize={bs} />}\n    </Icon>;\n    const chkbox = <input type='checkbox' className='group-checkbox' style={CHK_STYLE(legendCtx.getBaseIconSize())} value={group.ObjectId} onChange={onVisibilityChanged} checked={(groupVisible)} />;\n    const tooltip = group.LegendLabel;\n    const nodeClassName = \"group-node\";\n    let nodeStyle: React.CSSProperties = { whiteSpace: \"nowrap\", overflow: \"hidden\", ...LI_LIST_STYLE };\n    return <li title={tooltip} style={nodeStyle} className={nodeClassName}>\n        <span>{expanded} {chkbox} {icon} <LegendLabel baseSize={legendCtx.getBaseIconSize()} text={group.LegendLabel} /></span>\n        {(() => {\n            if (isExpanded && props.childItems.length > 0) {\n                return <ul style={UL_LIST_STYLE(legendCtx.getBaseIconSize())}>{props.childItems.map(item => {\n                    if (item.DisplayInLegend === true) {\n                        if (isLayer(item)) {\n                            if (isLayerVisibleAtScale(item, currentScale, legendCtx.stateless)) {\n                                //console.debug(`isLayerVisibleAtScale(${item.Name}, ${currentScale}) = true`);\n                                return <LayerNode key={item.ObjectId} layer={item} />;\n                            }\n                        } else {\n                            if (isGroupVisibleAtScale(item, tree, currentScale, legendCtx.stateless)) {\n                                //console.debug(`isGroupVisibleAtScale(${item.Name}, ${currentScale}) = true`);\n                                const children = tree.groupChildren[item.ObjectId] || [];\n                                return <GroupNode key={item.ObjectId} group={item} childItems={children} />;\n                            }\n                        }\n                    }\n                })}</ul>;\n            }\n        })()}\n    </li>;\n};\n\nfunction isLayerVisibleAtScale(layer: MapLayer, scale: number, stateless: boolean): boolean {\n    if (layer.ScaleRange) {\n        for (const sr of layer.ScaleRange) {\n            if (scaleRangeBetween(scale, sr.MinScale, sr.MaxScale)) {\n                return true;\n            }\n        }\n    } else {\n        // In stateless mode, it is potentially expensive to fetch all the required layer defs to get the scale range information,\n        // so we must operate under the assumption that such information just doesn't exist, so in such cases assume the layer is\n        // visible (in the legend), even if it is not visible (in the map)\n        if (stateless) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction isGroupVisibleAtScale(group: MapGroup, tree: any, scale: number, stateless: boolean): boolean {\n    const children: (MapLayer | MapGroup)[] = tree.groupChildren[group.ObjectId] || [];\n    for (const child of children) {\n        if (isLayer(child)) {\n            if (isLayerVisibleAtScale(child, scale, stateless)) {\n                return true;\n            }\n        } else {\n            if (isGroupVisibleAtScale(child, tree, scale, stateless)) {\n                return true;\n            }\n        }\n    }\n    if (stateless) {\n        return true;\n    }\n    return false;\n}\n\ninterface TreeState {\n    root: (MapLayer | MapGroup)[],\n    groupChildren: { [objectId: string]: (MapLayer | MapGroup)[] }\n}\n\nfunction itemTextFilter(items: (MapLayer | MapGroup)[], text: string) {\n    const filtered = items.map(i => {\n        if (isLayer(i)) {\n            if (i.LegendLabel.toLocaleLowerCase().indexOf(text) < 0) {\n                return null;\n            }\n            return i;\n        } else {\n            return i;\n        }\n    }).filter(i => i != null) as (MapLayer | MapGroup)[];\n    return filtered;\n}\n\nfunction buildFilteredTree(tree: TreeState, text: string): TreeState {\n    const filtered: TreeState = {\n        root: itemTextFilter(tree.root, text),\n        groupChildren: {}\n    };\n    const keys = Object.keys(tree.groupChildren);\n    for (const oid of keys) {\n        filtered.groupChildren[oid] = itemTextFilter(tree.groupChildren[oid], text);\n    }\n    return filtered;\n}\n\nfunction setupTree(map: RuntimeMap | undefined) {\n    const state = {\n        Layers: map?.Layer ?? [],\n        Groups: map?.Group ?? [],\n        LayerMap: {} as { [objectId: string]: MapLayer },\n        GroupMap: {} as { [objectId: string]: MapGroup },\n        tree: {\n            root: [] as (MapLayer | MapGroup)[],\n            groupChildren: {} as { [objectId: string]: (MapLayer | MapGroup)[] }\n        } as TreeState\n    };\n    if (map?.Layer) {\n        for (const layer of map.Layer) {\n            state.LayerMap[layer.ObjectId] = layer;\n        }\n    }\n    if (map?.Group) {\n        for (const group of map.Group) {\n            state.GroupMap[group.ObjectId] = group;\n        }\n    }\n    const { Layers, Groups, LayerMap, GroupMap } = state;\n    const { root, groupChildren } = state.tree;\n    if (Groups) {\n        const remainingGroups: any = {};\n        //1st pass, un-parented groups\n        for (const group of Groups) {\n            groupChildren[group.ObjectId] = [];\n            if (group.ParentId) {\n                remainingGroups[group.ObjectId] = group;\n                continue;\n            }\n            root.push(group);\n        }\n        //2nd pass, parented groups\n        var itemCount = 0;\n        for (const objId in remainingGroups) {\n            itemCount++;\n        }\n        //Whittle down\n        while (itemCount > 0) {\n            var removeIds = [] as string[];\n            for (const objId in remainingGroups) {\n                var group = remainingGroups[objId];\n                //Do we have a parent?\n                if (typeof (groupChildren[group.ParentId]) != 'undefined') {\n                    if (typeof (groupChildren[group.ObjectId]) != 'undefined') {\n                        groupChildren[group.ObjectId] = [];\n                    }\n                    groupChildren[group.ParentId].push(group);\n                    removeIds.push(group.ObjectId);\n                }\n            }\n            for (const id of removeIds) {\n                delete remainingGroups[id];\n            }\n\n            itemCount = 0;\n            for (const objId in remainingGroups) {\n                itemCount++;\n            }\n        }\n    }\n    if (Layers) {\n        for (const layer of Layers) {\n            if (layer.ParentId) {\n                //Do we have a parent?\n                if (typeof (groupChildren[layer.ParentId]) === 'undefined') {\n                    groupChildren[layer.ParentId] = [];\n                }\n                groupChildren[layer.ParentId].push(layer);\n            } else {\n                root.push(layer);\n            }\n        }\n    }\n    return state;\n}\n\nconst DEFAULT_ICON_SIZE = 16;\n\n/**\n * The Legend component provides a component to view the layer structure, its styles and thematics and\n * the ability to toggle the group/layer visibility of the current map\n * @param props \n */\nexport const Legend = (props: ILegendProps) => {\n    const [state, setState] = React.useState(setupTree(props.map));\n    const { tree: _tree } = state;\n    const { currentScale, externalBaseLayers, onBaseLayerChanged, maxHeight } = props;\n    const [isFiltering, setIsFiltering] = React.useState(false);\n    const [filterText, setFilterText] = React.useState(\"\");\n    const [filteredTree, setFilteredTree] = React.useState<TreeState | undefined>(undefined);\n    React.useEffect(() => {\n        onExitFilterMode();\n        const tree: any = setupTree(props.map);\n        setState(tree);\n    }, [props.map]);\n    const onEnterFilterMode = () => {\n        setIsFiltering(true);\n        setFilterText(\"\");\n        setFilteredTree(_tree);\n    };\n    const onExitFilterMode = () => {\n        setIsFiltering(false);\n        setFilterText(\"\");\n        setFilteredTree(undefined);\n    };\n    const onFilterUpdate = (text: string) => {\n        setFilterText(text);\n        if (strIsNullOrEmpty(text)) {\n            setFilteredTree(_tree);\n        } else {\n            setFilteredTree(buildFilteredTree(_tree, text.toLocaleLowerCase()));\n        }\n    }\n    const getLayerSelectability = (layerId: string): boolean => {\n        const items: any = props.overrideSelectableLayers || {};\n        return items[layerId];\n    };\n    const setLayerSelectability = (layerId: string, selectable: boolean): void => {\n        props.onLayerSelectabilityChanged?.(layerId, selectable);\n    };\n    const getGroupExpanded = (groupId: string): boolean => {\n        const items: any = props.overrideExpandedItems || {};\n        return items[groupId];\n    };\n    const setGroupExpanded = (groupId: string, expanded: boolean): void => {\n        props.onGroupExpansionChanged?.(groupId, expanded);\n    };\n    const getLayerExpanded = (layerId: string): boolean => {\n        const items: any = props.overrideExpandedItems || {};\n        return items[layerId];\n    };\n    const setLayerExpanded = (layerId: string, expanded: boolean): void => {\n        props.onGroupExpansionChanged?.(layerId, expanded);\n    };\n    const getGroupVisibility = (group: MapGroup): boolean => {\n        const { showGroups, hideGroups } = props;\n        let visible = group.Visible;\n        if (showGroups && showGroups.indexOf(group.ObjectId) >= 0) {\n            visible = true;\n        } else if (hideGroups && hideGroups.indexOf(group.ObjectId) >= 0) {\n            visible = false;\n        }\n        return visible;\n    };\n    const getLayerVisibility = (layer: MapLayer): boolean => {\n        const { showLayers, hideLayers } = props;\n        let visible = layer.Visible;\n        if (showLayers && showLayers.indexOf(layer.ObjectId) >= 0) {\n            visible = true;\n        } else if (hideLayers && hideLayers.indexOf(layer.ObjectId) >= 0) {\n            visible = false;\n        }\n        return visible;\n    };\n    const setGroupVisibility = (groupId: string, visible: boolean) => {\n        props.onGroupVisibilityChanged?.(groupId, visible);\n    };\n    const setLayerVisibility = (layerId: string, visible: boolean) => {\n        props.onLayerVisibilityChanged?.(layerId, visible);\n    };\n    const getIconMimeType = (): string | undefined => {\n        return props.map?.IconMimeType\n            ? `${props.map.IconMimeType}`\n            : undefined;\n    };\n    const getChildren = (objectId: string): (MapLayer | MapGroup)[] => {\n        return state.tree.groupChildren[objectId] || [];\n    };\n    const rootStyle: React.CSSProperties = {\n        position: \"relative\"\n    };\n    if (maxHeight) {\n        rootStyle.maxHeight = maxHeight;\n    }\n    const providerImpl: ILegendContext = {\n        stateless: props.stateless,\n        isFiltering: () => isFiltering,\n        getFilterText: () => filterText,\n        getLocale: () => props.locale,\n        getMapName: () => props.activeMapName,\n        getBaseIconSize: () => props.baseIconSize ?? DEFAULT_ICON_SIZE,\n        getIconMimeType: getIconMimeType,\n        getChildren: getChildren,\n        getCurrentScale: () => props.currentScale,\n        getTree: () => isFiltering && filteredTree ? filteredTree : state.tree,\n        getGroupVisibility: getGroupVisibility,\n        getLayerVisibility: getLayerVisibility,\n        setGroupVisibility: setGroupVisibility,\n        setLayerVisibility: setLayerVisibility,\n        getLayerSelectability: getLayerSelectability,\n        setLayerSelectability: setLayerSelectability,\n        getGroupExpanded: getGroupExpanded,\n        setGroupExpanded: setGroupExpanded,\n        getLayerExpanded: getLayerExpanded,\n        setLayerExpanded: setLayerExpanded\n    };\n    const daTree = providerImpl.getTree();\n    const rootItems: (MapLayer | MapGroup)[] = daTree.root;\n    return <LegendContext.Provider value={providerImpl}>\n        <div style={rootStyle}>\n            {(() => {\n                if (externalBaseLayers != null &&\n                    externalBaseLayers.length > 0 &&\n                    props.inlineBaseLayerSwitcher) {\n                    return <Card style={{ marginBottom: 10 }}>\n                        <h5 className=\"bp3-heading\"><a href=\"#\">{tr(\"EXTERNAL_BASE_LAYERS\", props.locale)}</a></h5>\n                        <BaseLayerSwitcher locale={props.locale} externalBaseLayers={externalBaseLayers} onBaseLayerChanged={onBaseLayerChanged} />\n                    </Card>;\n                }\n            })()}\n            {(() => {\n                if (isFiltering) {\n                    return <InputGroup round\n                        autoFocus\n                        leftIcon={ICON_SEARCH}\n                        placeholder={tr(\"LEGEND_FILTER_LAYERS\", props.locale)}\n                        onChange={(e: any) => onFilterUpdate(e.target.value)}\n                        rightElement={<Button minimal icon={ICON_CLEAR}\n                            onClick={() => onExitFilterMode()} />} />;\n                } else {\n                    return <Button onClick={() => onEnterFilterMode()} title={tr(\"LEGEND_FILTER_LAYERS\", props.locale)} icon={ICON_SEARCH} style={{ position: \"absolute\", right: 0, top: 0 }} />\n                }\n            })()}\n            <ul style={UL_LIST_STYLE(props.baseIconSize ?? DEFAULT_ICON_SIZE)}>\n                {rootItems.map(item => {\n                    if (item.DisplayInLegend === true) {\n                        if (isLayer(item)) {\n                            if (isLayerVisibleAtScale(item, currentScale, props.stateless)) {\n                                //console.debug(`isLayerVisibleAtScale(${item.Name}, ${currentScale}) = true`);\n                                return <LayerNode key={item.ObjectId} layer={item} />;\n                            }\n                        } else {\n                            const bGroupVisAtScale = isGroupVisibleAtScale(item, daTree, currentScale, props.stateless);\n                            let bGroupVisFilter = false;\n                            if (providerImpl.isFiltering()) {\n                                const bInFilter = item.LegendLabel.toLocaleLowerCase().indexOf(providerImpl.getFilterText().toLocaleLowerCase()) >= 0;\n                                //console.log(`'${item.LegendLabel}' - '${providerImpl.getFilterText()}': ${bInFilter ? \"true\" : \"false\"}`);\n                                if (bInFilter) {\n                                    bGroupVisFilter = true;\n                                }\n                            }\n                            if (bGroupVisAtScale || bGroupVisFilter) {\n                                //console.debug(`isGroupVisibleAtScale(${item.Name}, ${currentScale}) = true`);\n                                const children = daTree.groupChildren[item.ObjectId] || [];\n                                return <GroupNode key={item.ObjectId} group={item} childItems={children} />;\n                            }\n                        }\n                    }\n                })}\n                {props.externalLayers && <ExternalLayersGroupNode layers={props.externalLayers} />}\n            </ul>\n        </div>\n    </LegendContext.Provider>;\n}","import * as React from \"react\";\nimport { MapLoadIndicatorPositioning } from '../api/common';\n\nexport interface IMapLoadIndicatorProps {\n    loading: number;\n    loaded: number;\n    color: string;\n    position: MapLoadIndicatorPositioning;\n}\n\nexport const MapLoadIndicator = (props: IMapLoadIndicatorProps) => {\n    const { loaded, loading, color, position } = props;\n    let visibility: \"visible\" | \"hidden\" = \"visible\";\n    const pc = Math.min(100, (loaded / loading * 100));\n    let width = pc.toFixed(1) + \"%\";\n    if (loaded === loading || pc >= 100) {\n        visibility = \"hidden\";\n        width = \"0\";\n    }\n    const style: React.CSSProperties = {\n        position: \"absolute\",\n        zIndex: 10,\n        visibility: visibility,\n        left: 0,\n        height: 5,\n        width: width,\n        background: color,\n        transition: \"width 250ms\"\n    };\n    if (position == \"top\") {\n        style.top = 0;\n    } else {\n        style.bottom = 0;\n    }\n    return <div style={style} />;\n}","import * as React from \"react\";\nimport { IMapMenuEntry } from \"../api/common\";\n\n/**\n * MapMenu component props\n *\n * @export\n * @interface IMapMenuProps\n */\nexport interface IMapMenuProps {\n    locale: string | undefined;\n    selectedMap: string;\n    maps: IMapMenuEntry[];\n    onActiveMapChanged?: (name: string) => void;\n}\n\n/**\n * The MapMenu component provides the ability to switch between active maps\n * @param props \n */\nexport const MapMenu = (props: IMapMenuProps) => {\n    const [selected, setSelected] = React.useState(undefined);\n    const onActiveMapChanged = (e: any) => {\n        const value = e.currentTarget.value;\n        setSelected(value);\n        props.onActiveMapChanged?.(value);\n    };\n    return <div>\n        {props.maps.map(layer => {\n            return <div className=\"map-menu-item-container\" key={`base-layer-${layer.mapName}`}>\n                <label className=\"bp3-control bp3-radio\">\n                    <input className=\"map-menu-option\" type=\"radio\" value={layer.mapName} checked={layer.mapName === props.selectedMap} onChange={onActiveMapChanged} />\n                    <span className=\"bp3-control-indicator\" />\n                    {layer.label}\n                </label>\n            </div>;\n        })}\n    </div>;\n}","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { IMapView, IExternalBaseLayer, Dictionary, ReduxDispatch, Bounds, GenericEvent, ActiveMapTool, DigitizerCallback, LayerProperty, Size2, RefreshMode, KC_U, ILayerManager, Coordinate2D, KC_ESCAPE, IMapViewer, IMapGuideViewerSupport, ILayerInfo, ClientKind, IMapImageExportOptions } from '../../api/common';\nimport { MouseTrackingTooltip } from '../tooltips/mouse';\nimport Map from \"ol/Map\";\nimport OverviewMap from 'ol/control/OverviewMap';\nimport DragBox from 'ol/interaction/DragBox';\nimport Select from 'ol/interaction/Select';\nimport Draw, { GeometryFunction } from 'ol/interaction/Draw';\nimport { SelectedFeaturesTooltip, ISelectionPopupContentOverrideProvider, SelectionPopupContentRenderer } from '../tooltips/selected-features';\nimport Feature from 'ol/Feature';\nimport Polygon from 'ol/geom/Polygon';\nimport Geometry from 'ol/geom/Geometry';\nimport { MapOptions } from 'ol/PluggableMap';\nimport Attribution from 'ol/control/Attribution';\nimport Rotate from 'ol/control/Rotate';\nimport DragRotate from 'ol/interaction/DragRotate';\nimport DragPan from 'ol/interaction/DragPan';\nimport PinchRotate from 'ol/interaction/PinchRotate';\nimport PinchZoom from 'ol/interaction/PinchZoom';\nimport KeyboardPan from 'ol/interaction/KeyboardPan';\nimport KeyboardZoom from 'ol/interaction/KeyboardZoom';\nimport MouseWheelZoom from 'ol/interaction/MouseWheelZoom';\nimport View from 'ol/View';\nimport Point from 'ol/geom/Point';\nimport GeometryType from 'ol/geom/GeometryType';\nimport LineString from 'ol/geom/LineString';\nimport Circle from 'ol/geom/Circle';\nimport Interaction from 'ol/interaction/Interaction';\nimport Overlay from 'ol/Overlay';\nimport { transformExtent, ProjectionLike } from 'ol/proj';\nimport { LayerManager } from '../../api/layer-manager';\nimport Collection from 'ol/Collection';\nimport * as olExtent from \"ol/extent\";\nimport * as olEasing from \"ol/easing\";\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport { tr, DEFAULT_LOCALE } from '../../api/i18n';\nimport { LayerSetGroupBase } from '../../api/layer-set-group-base';\nimport { assertIsDefined } from '../../utils/assert';\nimport { info, debug } from '../../utils/logger';\nimport { setCurrentView, setViewRotation, mapResized, setMouseCoordinates, setBusyCount, setViewRotationEnabled, setActiveTool, mapLayerAdded, externalLayersReady, addClientSelectedFeature, clearClientSelection } from '../../actions/map';\nimport { Toaster, Intent } from '@blueprintjs/core';\nimport { IOLFactory, OLFactory } from '../../api/ol-factory';\nimport { ISubscriberProps } from '../../containers/subscriber';\nimport isMobile from \"ismobilejs\";\nimport { IInitialExternalLayer } from '../../actions/defs';\nimport { MapGuideMockMode } from '../mapguide-debug-context';\nimport Layer from 'ol/layer/Layer';\nimport LayerBase from 'ol/layer/Base';\nimport LayerGroup from 'ol/layer/Group';\nimport Source from 'ol/source/Source';\nimport { LoadFunction as TileLoadFunction } from 'ol/Tile';\nimport { LoadFunction as ImageLoadFunction } from 'ol/Image';\nimport { IBasicPointCircleStyle, DEFAULT_POINT_CIRCLE_STYLE, IPointIconStyle, DEFAULT_POINT_ICON_STYLE, IBasicVectorLineStyle, DEFAULT_LINE_STYLE, IBasicVectorPolygonStyle, DEFAULT_POLY_STYLE, ClusterClickAction } from '../../api/ol-style-contracts';\nimport { isClusteredFeature, getClusterSubFeatures } from '../../api/ol-style-helpers';\nimport { OLStyleMapSet } from '../../api/ol-style-map-set';\nimport { QueryMapFeaturesResponse } from '../../api/contracts/query';\nimport { setViewer, getViewer } from '../../api/runtime';\nimport { Client } from '../../api/client';\nimport { useReduxDispatch } from \"./context\";\nimport { ClientSelectionFeature } from \"../../api/contracts/common\";\n\nexport function inflateBoundsByMeters(thisProj: ProjectionLike, extent: Bounds, meters: number) {\n    // We need to inflate this bbox by a known unit of measure (meters), so re-project this extent to a meter's based coordinate system (EPSG:3857)\n    const webmBounds = transformExtent(extent, thisProj, \"EPSG:3857\");\n    // Inflate the box by specified amount\n    const webmBounds2 = olExtent.buffer(webmBounds, meters);\n    // Re-project this extent back to the original projection\n    const inflatedBounds = transformExtent(webmBounds2, \"EPSG:3857\", thisProj) as Bounds;\n    return inflatedBounds;\n}\n\nexport function recursiveFindLayer(layers: Collection<LayerBase>, predicate: (layer: LayerBase) => boolean): LayerBase | undefined {\n    for (let i = 0; i < layers.getLength(); i++) {\n        const layer = layers.item(i);\n        if (layer instanceof LayerGroup) {\n            const match = recursiveFindLayer(layer.getLayers(), predicate);\n            if (match) {\n                return match;\n            }\n        } else {\n            if (predicate(layer)) {\n                return layer;\n            }\n        }\n    }\n    return undefined;\n}\n\nexport function isMiddleMouseDownEvent(e: MouseEvent): boolean {\n    return (e && (e.which == 2 || e.button == 4));\n}\n\nexport function useViewerSideEffects(context: IMapProviderContext,\n    appSettings: Dictionary<string>,\n    isReady: boolean,\n    mapName: string | undefined,\n    layers: ILayerInfo[] | undefined,\n    initialExternalLayers: IInitialExternalLayer[] | undefined,\n    agentUri: string | undefined = undefined,\n    agentKind: ClientKind | undefined = undefined,\n    selection: QueryMapFeaturesResponse | null = null) {\n    const dispatch = useReduxDispatch();\n    // Side-effect to pre-load external layers. Should only happen once per map name\n    React.useEffect(() => {\n        if (isReady) {\n            if (mapName && !layers) {\n                debug(`React.useEffect - Change of initial external layers for [${mapName}] (change should only happen once per mapName!)`);\n                if (initialExternalLayers && initialExternalLayers.length > 0) {\n                    debug(`React.useEffect - First-time loading of external layers for [${mapName}]`);\n                    const layerManager = context.getLayerManager(mapName) as LayerManager;\n                    for (const extLayer of initialExternalLayers) {\n                        const added = layerManager.addExternalLayer(extLayer, true, appSettings);\n                        if (added) {\n                            dispatch(mapLayerAdded(mapName, added));\n                        }\n                    }\n                } else {\n                    //Even if no initial external layers were loaded, the layers state still needs to be set\n                    //otherwise components that depend on this state (eg. External Layer Manager) will assume\n                    //this is still not ready yet\n                    debug(`React.useEffect - Signal that external layers are ready for [${mapName}]`);\n                    dispatch(externalLayersReady(mapName));\n                }\n            }\n        }\n    }, [context, mapName, initialExternalLayers, layers, isReady]);\n    // Side-effect to apply the current external layer list\n    React.useEffect(() => {\n        debug(`React.useEffect - Change of external layers`);\n        if (context.isReady() && layers) {\n            const layerManager = context.getLayerManager(mapName);\n            layerManager.apply(layers);\n        }\n    }, [context, mapName, layers]);\n    // Side-effect to set the viewer \"instance\" once the MapViewerBase component has been mounted.\n    // Should only happen once.\n    React.useEffect(() => {\n        debug(`React.useEffect - Change of context and/or agent URI/kind`);\n        setViewer(context);\n        const browserWindow: any = window;\n        browserWindow.getViewer = browserWindow.getViewer || getViewer;\n        if (agentUri && agentKind) {\n            browserWindow.getClient = browserWindow.getClient || (() => new Client(agentUri, agentKind));\n        }\n        debug(`React.useEffect - Attached runtime viewer instance and installed browser global APIs`);\n    }, [context, agentUri, agentKind]);\n    // Side-effect to imperatively refresh the map upon selection change\n    React.useEffect(() => {\n        debug(`React.useEffect - Change of selection`);\n        context.refreshMap(RefreshMode.SelectionOnly);\n    }, [context, selection]);\n}\n\nexport interface IViewerComponent {\n    isContextMenuOpen: () => boolean;\n    setDigitizingType: (digitizingType: string | undefined) => void;\n    onDispatch: ReduxDispatch;\n    onHideContextMenu: () => void;\n    addImageLoading(): void;\n    addImageLoaded(): void;\n    addSubscribers(props: ISubscriberProps[]): string[];\n    removeSubscribers(names: string[]): boolean;\n    getSubscribers(): string[];\n}\n\nexport interface IMapProviderState {\n    activeTool: ActiveMapTool;\n    view: IMapView | undefined;\n    viewRotation: number;\n    viewRotationEnabled: boolean;\n    mapName: string | undefined;\n    locale: string;\n    externalBaseLayers: IExternalBaseLayer[] | undefined;\n    cancelDigitizationKey: number;\n    undoLastPointKey: number;\n    overviewMapElementSelector?: () => Element | null;\n    initialExternalLayers: IInitialExternalLayer[];\n}\n\nexport interface IMapProviderStateExtras {\n    isReady: boolean;\n    bgColor?: string;\n    layers: ILayerInfo[] | undefined;\n}\n\n/**\n * Defines a mapping provider\n * \n * @since 0.14\n */\nexport interface IMapProviderContext extends IMapViewer, ISelectionPopupContentOverrideProvider {\n    isReady(): boolean;\n    getProviderName(): string;\n    isDigitizing(): boolean;\n    getActiveTool(): ActiveMapTool;\n    isMouseOverTooltip(): boolean;\n    incrementBusyWorker(): void;\n    decrementBusyWorker(): void;\n    attachToComponent(el: HTMLElement, comp: IViewerComponent): void;\n    detachFromComponent(): void;\n    setToasterRef(ref: React.RefObject<Toaster>): void;\n    setProviderState(nextState: IMapProviderState): void;\n    onKeyDown(e: GenericEvent): void;\n    hideAllPopups(): void;\n    getHookFunction(): () => IMapProviderState & IMapProviderStateExtras;\n    addCustomSelectionPopupRenderer(mapName: string | undefined, layerName: string | undefined, renderer: SelectionPopupContentRenderer): void;\n}\n\nexport type WmsQueryAugmentation = (getFeatureInfoUrl: string) => string;\n\nexport abstract class BaseMapProviderContext<TState extends IMapProviderState, TLayerSetGroup extends LayerSetGroupBase> implements IMapProviderContext {\n    private _toasterRef: React.RefObject<Toaster> | undefined;\n    private _baseTileSourceLoaders: Dictionary<Dictionary<TileLoadFunction>>;\n    private _tileSourceLoaders: Dictionary<Dictionary<TileLoadFunction>>;\n    private _imageSourceLoaders: Dictionary<Dictionary<ImageLoadFunction>>;\n    private _wmsQueryAugmentations: Dictionary<Dictionary<WmsQueryAugmentation>>;\n    private _globalCustomSelectionPopupRenderer: SelectionPopupContentRenderer | undefined;\n    private _customSelectionPopupRenderers: Dictionary<Dictionary<SelectionPopupContentRenderer>>;\n    protected _state: TState;\n    /**\n     * Indicates if touch events are supported.\n     */\n    protected _supportsTouch: boolean;\n    /**\n     * The internal OpenLayers map instance\n     *\n     * @private\n     * @type {Map}\n     */\n    protected _map: Map | undefined;\n    protected _ovMap: OverviewMap | undefined;\n\n    protected _layerSetGroups: Dictionary<TLayerSetGroup>;\n    protected _mouseTooltip: MouseTrackingTooltip | undefined;\n    protected _selectTooltip: SelectedFeaturesTooltip | undefined;\n\n    protected _comp: IViewerComponent | undefined;\n    protected _zoomSelectBox: DragBox | undefined;\n\n    protected _busyWorkers: number;\n    protected _triggerZoomRequestOnMoveEnd: boolean;\n    protected _select: Select | undefined;\n    protected _activeDrawInteraction: Draw | null;\n\n    constructor(private olFactory: OLFactory = new OLFactory()) {\n        this._busyWorkers = 0;\n        this._layerSetGroups = {};\n        this._tileSourceLoaders = {};\n        this._imageSourceLoaders = {};\n        this._wmsQueryAugmentations = {};\n        this._triggerZoomRequestOnMoveEnd = true;\n        const ism = isMobile(navigator.userAgent);\n        this._supportsTouch = ism.phone || ism.tablet;\n        const baseInitialState: IMapProviderState = {\n            activeTool: ActiveMapTool.None,\n            view: undefined,\n            viewRotation: 0,\n            viewRotationEnabled: true,\n            locale: DEFAULT_LOCALE,\n            cancelDigitizationKey: KC_ESCAPE,\n            undoLastPointKey: KC_U,\n            mapName: undefined,\n            externalBaseLayers: undefined,\n            initialExternalLayers: []\n        };\n        this._state = {\n            ...baseInitialState,\n            ...this.getInitialProviderState()\n        } as TState;\n    }\n\n    /**\n     * Exports an image of the current map view\n     *\n     * @param {IMapImageExportOptions} options\n     * @memberof IMapViewer\n     * @since 0.14\n     */\n    public exportImage(options: IMapImageExportOptions): void {\n        if (this._map) {\n            const map = this._map;\n            map.once('rendercomplete', function () {\n                const mapCanvas = document.createElement('canvas');\n                if (options.size) {\n                    const [w, h] = options.size;\n                    mapCanvas.width = w;\n                    mapCanvas.height = h;\n                } else {\n                    const size = map.getSize();\n                    if (size) {\n                        mapCanvas.width = size[0];\n                        mapCanvas.height = size[1];\n                    }\n                }\n                const mapContext = mapCanvas.getContext('2d');\n                if (mapContext) {\n                    const canvasSelector = '.ol-layer canvas, .external-vector-layer canvas';\n                    Array.prototype.forEach.call(document.querySelectorAll(canvasSelector), function (canvas: HTMLCanvasElement) {\n                        if (canvas.width > 0) {\n                            const parentNode = canvas.parentNode;\n                            const opacity = (parentNode as any)?.style?.opacity ?? \"\";\n                            mapContext.globalAlpha = opacity === '' ? 1 : Number(opacity);\n                            const transform = canvas.style.transform;\n                            // Get the transform parameters from the style's transform matrix\n                            const matrix = transform.match(/^matrix\\(([^\\(]*)\\)$/)?.[1]?.split(',')?.map(Number);\n                            if (matrix) {\n                                // Apply the transform to the export map context\n                                CanvasRenderingContext2D.prototype.setTransform.apply(mapContext, matrix);\n                                mapContext.drawImage(canvas, 0, 0);\n                            }\n                        }\n                    });\n                    options.callback(mapCanvas.toDataURL(options.exportMimeType));\n                }\n            });\n            map.renderSync();\n        }\n    }\n\n    /**\n     * Adds a custom tile load function for a given base image tile layer.\n     * \n     * NOTE: Unlike other load function registrations this must be done before the viewer is mounted. New load functions added at runtime will not be recognized\n     * @param mapName\n     * @param layerName The base layer this function should apply for\n     * @param func The custom tile load function\n     * @since 0.14\n     */\n    addBaseTileLoadFunction(mapName: string, layerName: string, func: TileLoadFunction) {\n        if (!this._baseTileSourceLoaders) {\n            this._baseTileSourceLoaders = {};\n        }\n        if (!this._baseTileSourceLoaders[mapName]) {\n            this._baseTileSourceLoaders[mapName] = {};\n        }\n        this._baseTileSourceLoaders[mapName][layerName] = func;\n    }\n\n    /**\n     * Adds a custom tile load function for a given overlay image tile layer\n     * @param mapName\n     * @param layerName The layer this function should apply for\n     * @param func The custom tile load function\n     * @since 0.14\n     */\n    addTileLoadFunction(mapName: string, layerName: string, func: TileLoadFunction) {\n        if (!this._tileSourceLoaders) {\n            this._tileSourceLoaders = {};\n        }\n        if (!this._tileSourceLoaders[mapName]) {\n            this._tileSourceLoaders[mapName] = {};\n        }\n        this._tileSourceLoaders[mapName][layerName] = func;\n    }\n\n    /**\n     * Adds a custom image load function for a given overlay image layer\n     * @param mapName\n     * @param layerName The layer this function should apply for\n     * @param func The custom tile load function\n     * @since 0.14\n     */\n    addImageLoadFunction(mapName: string, layerName: string, func: ImageLoadFunction) {\n        if (!this._imageSourceLoaders) {\n            this._imageSourceLoaders = {};\n        }\n        if (!this._imageSourceLoaders[mapName]) {\n            this._imageSourceLoaders[mapName] = {};\n        }\n        this._imageSourceLoaders[mapName][layerName] = func;\n    }\n\n    /**\n     * Adds a WMS query augmentation for the given WMS overlay layer\n     * @param mapName\n     * @param layerName The layer this function should apply for\n     * @param func The WMS query augmentation\n     * @since 0.14\n     */\n    addWmsQueryAugmentation(mapName: string, layerName: string, func: WmsQueryAugmentation) {\n        if (!this._wmsQueryAugmentations) {\n            this._wmsQueryAugmentations = {};\n        }\n        if (!this._wmsQueryAugmentations[mapName]) {\n            this._wmsQueryAugmentations[mapName] = {};\n        }\n        this._wmsQueryAugmentations[mapName][layerName] = func;\n    }\n\n    public addCustomSelectionPopupRenderer(mapName: string | undefined, layerName: string | undefined, renderer: SelectionPopupContentRenderer) {\n        if (mapName && layerName) {\n            if (!this._customSelectionPopupRenderers) {\n                this._customSelectionPopupRenderers = {};\n            }\n            if (!this._customSelectionPopupRenderers[mapName]) {\n                this._customSelectionPopupRenderers[mapName] = {};\n            }\n            this._customSelectionPopupRenderers[mapName][layerName] = renderer;\n        } else {\n            this._globalCustomSelectionPopupRenderer = renderer;\n        }\n    }\n\n    public getSelectionPopupRenderer(layerName: string): SelectionPopupContentRenderer | undefined {\n        if (!this._customSelectionPopupRenderers) {\n            this._customSelectionPopupRenderers = {};\n        }\n        const { mapName } = this._state;\n        if (mapName) {\n            if (!this._customSelectionPopupRenderers[mapName]) {\n                this._customSelectionPopupRenderers[mapName] = {};\n            }\n            const r = this._customSelectionPopupRenderers[mapName][layerName];\n            if (r) {\n                return r;\n            }\n        }\n\n        if (this._globalCustomSelectionPopupRenderer) {\n            return this._globalCustomSelectionPopupRenderer;\n        }\n\n        return undefined;\n    }\n\n    /**\n     * @virtual\n     */\n    public hideAllPopups() {\n        this._mouseTooltip?.clear();\n        this._selectTooltip?.hide();\n    }\n\n    public isReady(): boolean { return !!(this._map && this._comp); }\n\n    //#region IMapViewer\n    /**\n     * @virtual\n     * @returns {(IMapGuideViewerSupport | undefined)}\n     * @memberof BaseMapProviderContext\n     */\n    mapguideSupport(): IMapGuideViewerSupport | undefined {\n        return undefined;\n    }\n    setActiveTool(tool: ActiveMapTool): void {\n        this._comp?.onDispatch(setActiveTool(tool));\n    }\n    getOLFactory(): IOLFactory {\n        return this.olFactory;\n    }\n    getMapName(): string {\n        return this._state.mapName!;\n    }\n    setViewRotation(rotation: number): void {\n        this._comp?.onDispatch(setViewRotation(rotation));\n    }\n    getViewRotation(): number {\n        return this._state.viewRotation;\n    }\n    isViewRotationEnabled(): boolean {\n        return this._state.viewRotationEnabled;\n    }\n    setViewRotationEnabled(enabled: boolean): void {\n        this._comp?.onDispatch(setViewRotationEnabled(enabled));\n    }\n    toastSuccess(iconName: string, message: string | JSX.Element): string | undefined {\n        return this._toasterRef?.current?.show({ icon: (iconName as any), message: message, intent: Intent.SUCCESS });\n    }\n    toastWarning(iconName: string, message: string | JSX.Element): string | undefined {\n        return this._toasterRef?.current?.show({ icon: (iconName as any), message: message, intent: Intent.WARNING });\n    }\n    toastError(iconName: string, message: string | JSX.Element): string | undefined {\n        return this._toasterRef?.current?.show({ icon: (iconName as any), message: message, intent: Intent.DANGER });\n    }\n    toastPrimary(iconName: string, message: string | JSX.Element): string | undefined {\n        return this._toasterRef?.current?.show({ icon: (iconName as any), message: message, intent: Intent.PRIMARY });\n    }\n    dismissToast(key: string): void {\n        this._toasterRef?.current?.dismiss(key);\n    }\n    addImageLoading(): void {\n        this._comp?.addImageLoading();\n    }\n    addImageLoaded(): void {\n        this._comp?.addImageLoaded();\n    }\n    addSubscribers(props: ISubscriberProps[]): string[] {\n        return this._comp?.addSubscribers(props) ?? [];\n    }\n    removeSubscribers(names: string[]): boolean {\n        return this._comp?.removeSubscribers(names) ?? false;\n    }\n    getSubscribers(): string[] {\n        return this._comp?.getSubscribers() ?? [];\n    }\n    dispatch(action: any): void {\n        this._comp?.onDispatch(action);\n    }\n    getDefaultPointCircleStyle(): IBasicPointCircleStyle {\n        return { ...DEFAULT_POINT_CIRCLE_STYLE };\n    }\n    getDefaultPointIconStyle(): IPointIconStyle {\n        return { ...DEFAULT_POINT_ICON_STYLE };\n    }\n    getDefaultLineStyle(): IBasicVectorLineStyle {\n        return { ...DEFAULT_LINE_STYLE };\n    }\n    getDefaultPolygonStyle(): IBasicVectorPolygonStyle {\n        return { ...DEFAULT_POLY_STYLE };\n    }\n    //#endregion\n\n    public abstract getHookFunction(): () => IMapProviderState & IMapProviderStateExtras;\n    protected getBaseTileSourceLoaders(mapName: string): Dictionary<TileLoadFunction> {\n        return this._baseTileSourceLoaders?.[mapName] ?? {};\n    }\n    protected getTileSourceLoaders(mapName: string): Dictionary<TileLoadFunction> {\n        return this._tileSourceLoaders?.[mapName] ?? {};\n    }\n    protected getImageSourceLoaders(mapName: string): Dictionary<ImageLoadFunction> {\n        return this._imageSourceLoaders?.[mapName] ?? {};\n    }\n\n    protected abstract getInitialProviderState(): Omit<TState, keyof IMapProviderState>;\n    //#region IMapViewerContextCallback\n    protected getMockMode(): MapGuideMockMode | undefined { return undefined; }\n    protected addFeatureToHighlight(feat: Feature<Geometry> | undefined, bAppend: boolean): void {\n        if (this._state.mapName) {\n            // Features have to belong to layer in order to be visible and have the highlight style, \n            // so in addition to adding this new feature to the OL select observable collection, we \n            // need to also add the feature to a scratch vector layer dedicated for this purpose\n            const layerSet = this.getLayerSetGroup(this._state.mapName);\n            if (layerSet) {\n                const sf = this._select?.getFeatures();\n                if (sf) {\n                    if (!bAppend) {\n                        sf.clear();\n                    }\n\n                    if (feat) {\n                        sf.push(feat);\n                    }\n                }\n            }\n        }\n    }\n    //#endregion\n\n    //#region Map Context\n    protected getScaleForExtent(bounds: Bounds): number {\n        assertIsDefined(this._map);\n        assertIsDefined(this._state.mapName);\n        const activeLayerSet = this.getLayerSetGroup(this._state.mapName);\n        assertIsDefined(activeLayerSet);\n        const size = this._map.getSize();\n        assertIsDefined(size);\n        const mcsW = olExtent.getWidth(bounds);\n        const mcsH = olExtent.getHeight(bounds);\n        const devW = size[0];\n        const devH = size[1];\n        const metersPerPixel = 0.0254 / activeLayerSet.getDpi();\n        const metersPerUnit = activeLayerSet.getMetersPerUnit();\n        //Scale calculation code from AJAX viewer\n        let mapScale: number;\n        if (devH * mcsW > devW * mcsH)\n            mapScale = mcsW * metersPerUnit / (devW * metersPerPixel); // width-limited\n        else\n            mapScale = mcsH * metersPerUnit / (devH * metersPerPixel); // height-limited\n        return mapScale;\n    }\n    public getViewForExtent(extent: Bounds): IMapView {\n        assertIsDefined(this._map);\n\n        let scale, center;\n        // If this is a zero-width/height extent, we need to \"inflate\" it to something small\n        // so that we do not enter an infinite loop due to attempting to get a x/y/scale from\n        // a zero-width/height extent.\n        //\n        // This generally happens if we want to zoom to the bounds of a selected point\n        if (olExtent.getWidth(extent) == 0 || olExtent.getHeight(extent) == 0) {\n            const thisProj = this.getProjection();\n            // Inflate the box by 20 meters\n            const inflatedBounds = inflateBoundsByMeters(thisProj, extent, 20);\n            // Now we can safely extract the scale/center\n            scale = this.getScaleForExtent(inflatedBounds);\n            center = olExtent.getCenter(inflatedBounds);\n        } else {\n            scale = this.getScaleForExtent(extent);\n            center = olExtent.getCenter(extent);\n        }\n\n        return {\n            x: center[0],\n            y: center[1],\n            scale: scale,\n            resolution: this._map.getView().getResolution()\n        };\n    }\n    protected onZoomSelectBox(e: GenericEvent) {\n        if (this._comp) {\n            const extent = this._zoomSelectBox?.getGeometry();\n            if (!extent) {\n                return;\n            }\n            switch (this._state.activeTool) {\n                case ActiveMapTool.Zoom:\n                    {\n                        const ext: any = extent.getExtent();\n                        this._comp.onDispatch(setCurrentView(this.getViewForExtent(ext)));\n                    }\n                    break;\n                case ActiveMapTool.Select:\n                    {\n                        this.selectFeaturesByExtent(extent);\n                    }\n                    break;\n            }\n        }\n    }\n    /**\n     * @virtual\n     * @protected\n     * @param {GenericEvent} e\n     * @returns\n     * @memberof BaseMapProviderContext\n     */\n    protected onMouseMove(e: GenericEvent) {\n        if (this._comp) {\n            this.handleMouseTooltipMouseMove(e);\n            this.handleHighlightHover(e);\n            if (this._comp.isContextMenuOpen()) {\n                return;\n            }\n            if (this._state.mapName) {\n                this._comp.onDispatch(setMouseCoordinates(this._state.mapName, e.coord));\n            }\n        }\n    }\n    public incrementBusyWorker() {\n        this._busyWorkers++;\n        this._comp?.onDispatch(setBusyCount(this._busyWorkers));\n    }\n    public decrementBusyWorker() {\n        this._busyWorkers--;\n        this._comp?.onDispatch(setBusyCount(this._busyWorkers));\n    }\n    protected applyView(layerSet: LayerSetGroupBase, vw: IMapView) {\n        this._triggerZoomRequestOnMoveEnd = false;\n        layerSet.getView().setCenter([vw.x, vw.y]);\n        //Don't use this.scaleToResolution() as that uses this.props to determine\n        //applicable layer set, but we already have that here\n        const res = layerSet.scaleToResolution(vw.scale);\n        layerSet.getView().setResolution(res);\n        this._triggerZoomRequestOnMoveEnd = true;\n    }\n    protected removeActiveDrawInteraction() {\n        if (this._activeDrawInteraction && this._map && this._comp) {\n            this._map.removeInteraction(this._activeDrawInteraction);\n            this._activeDrawInteraction = null;\n            this._comp.setDigitizingType(undefined);\n        }\n    }\n\n    public getActiveTool(): ActiveMapTool { return this._state.activeTool; }\n\n    public cancelDigitization(): void {\n        if (this.isDigitizing()) {\n            this.removeActiveDrawInteraction();\n            this.clearMouseTooltip();\n            //this._mouseTooltip.clear();\n        }\n    }\n    private onBeginDigitization = (callback: (cancelled: boolean) => void) => {\n        this._comp?.onDispatch(setActiveTool(ActiveMapTool.None));\n        //Could be a small timing issue here, but the active tool should generally\n        //be \"None\" before the user clicks their first digitizing vertex/point\n        callback(false);\n    };\n    protected pushDrawInteraction<T extends Geometry>(digitizingType: string, draw: Draw, handler: DigitizerCallback<T>, prompt?: string): void {\n        assertIsDefined(this._comp);\n        this.onBeginDigitization(cancel => {\n            if (!cancel) {\n                assertIsDefined(this._map);\n                assertIsDefined(this._comp);\n                this.removeActiveDrawInteraction();\n                //this._mouseTooltip.clear();\n                this.clearMouseTooltip();\n                if (prompt) {\n                    //this._mouseTooltip.setText(prompt);\n                    this.setMouseTooltip(prompt);\n                }\n                this._activeDrawInteraction = draw;\n                this._activeDrawInteraction.once(\"drawend\", (e: GenericEvent) => {\n                    const drawnFeature: Feature<Geometry> = e.feature;\n                    const geom: T = drawnFeature.getGeometry() as T;\n                    this.cancelDigitization();\n                    handler(geom);\n                })\n                this._map.addInteraction(this._activeDrawInteraction);\n                this._comp.setDigitizingType(digitizingType);\n            }\n        });\n    }\n    /**\n     * @virtual\n     * @protected\n     * @param {Polygon} geom\n     * @memberof BaseMapProviderContext\n     */\n    protected selectFeaturesByExtent(geom: Polygon) { }\n\n    protected zoomByDelta(delta: number) {\n        assertIsDefined(this._map);\n        const view = this._map.getView();\n        if (!view) {\n            return;\n        }\n        const currentZoom = view.getZoom();\n        if (currentZoom !== undefined) {\n            const newZoom = view.getConstrainedZoom(currentZoom + delta);\n            if (view.getAnimating()) {\n                view.cancelAnimations();\n            }\n            view.animate({\n                zoom: newZoom,\n                duration: 250,\n                easing: olEasing.easeOut\n            });\n        }\n    }\n    protected ensureAndGetLayerSetGroup(nextState: TState) {\n        assertIsDefined(nextState.mapName);\n        let layerSet = this._layerSetGroups[nextState.mapName];\n        if (!layerSet) {\n            layerSet = this.initLayerSet(nextState);\n            this._layerSetGroups[nextState.mapName] = layerSet;\n        }\n        return layerSet;\n    }\n    //public getLayerSet(name: string, bCreate: boolean = false, props?: IMapViewerContextProps): MgLayerSet {\n    public getLayerSetGroup(name: string | undefined): TLayerSetGroup | undefined {\n        let layerSet: TLayerSetGroup | undefined;\n        if (name) {\n            layerSet = this._layerSetGroups[name];\n            /*\n            if (!layerSet && props && bCreate) {\n                layerSet = this.initLayerSet(props);\n                this._layerSets[props.map.Name] = layerSet;\n                this._activeMapName = props.map.Name;\n            }\n            */\n        }\n        return layerSet;\n    }\n    /**\n     * @virtual\n     * @readonly\n     * @memberof BaseMapProviderContext\n     */\n    public isMouseOverTooltip() { return this._selectTooltip?.isMouseOver ?? false; }\n    protected clearMouseTooltip(): void {\n        this._mouseTooltip?.clear();\n    }\n    protected setMouseTooltip(text: string) {\n        this._mouseTooltip?.setText(text);\n    }\n    protected handleMouseTooltipMouseMove(e: GenericEvent) {\n        this._mouseTooltip?.onMouseMove?.(e);\n    }\n    private _highlightedFeature: Feature<Geometry> | undefined;\n    private isLayerHoverable(layer: Layer<Source>) {\n        return !(layer?.get(LayerProperty.IS_HOVER_HIGHLIGHT) == true)\n            && !(layer?.get(LayerProperty.IS_WMS_SELECTION_OVERLAY) == true)\n            && !(layer?.get(LayerProperty.IS_HEATMAP) == true)\n            && !(layer?.get(LayerProperty.IS_MEASURE) == true);\n    }\n    protected handleHighlightHover(e: GenericEvent) {\n        if (e.dragging) {\n            return;\n        }\n        if (this._state.mapName && this._map) {\n            const activeLayerSet = this.getLayerSetGroup(this._state.mapName);\n            if (activeLayerSet) {\n                const pixel = this._map.getEventPixel(e.originalEvent);\n                if (pixel) {\n                    const featureToLayerMap = [] as [Feature<Geometry>, Layer<Source>][];\n                    this._map.forEachFeatureAtPixel(pixel, (feature, layer) => {\n                        if (this.isLayerHoverable(layer) && feature instanceof Feature) {\n                            featureToLayerMap.push([feature, layer]);\n                        }\n                    });\n                    const feature = featureToLayerMap.length ? featureToLayerMap[0][0] : undefined;\n\n                    //const featuresAtPixel = this._map?.getFeaturesAtPixel(pixel);\n                    //const feature = featuresAtPixel?.length ? featuresAtPixel[0] : undefined;\n                    if (feature != this._highlightedFeature && feature instanceof Feature) {\n                        if (this._highlightedFeature) {\n                            activeLayerSet.removeHighlightedFeature(this._highlightedFeature);\n                        }\n                        if (feature) {\n                            activeLayerSet.addHighlightedFeature(feature);\n                        }\n                        this._highlightedFeature = feature;\n                    }\n                }\n            }\n        }\n    }\n    protected hideSelectedVectorFeaturesTooltip() {\n        this._selectTooltip?.hide();\n    }\n    protected showSelectedVectorFeatures(features: Collection<Feature<Geometry>>, pixel: [number, number], featureToLayerMap: [Feature<Geometry>, Layer<Source>][], locale?: string) {\n        this._selectTooltip?.showSelectedVectorFeatures(features, pixel, featureToLayerMap, locale);\n    }\n    protected async queryWmsFeatures(mapName: string | undefined, coord: Coordinate2D, bAppendMode: boolean) {\n        if (mapName && this._map) {\n            const activeLayerSet = this.getLayerSetGroup(mapName);\n            const layerMgr = this.getLayerManager(mapName);\n            const res = this._map.getView().getResolution();\n            if (res && this._selectTooltip) {\n                return await this._selectTooltip.queryWmsFeatures(activeLayerSet, layerMgr, coord, res, bAppendMode, {\n                    getLocale: () => this._state.locale,\n                    addClientSelectedFeature: (feat, layer) => this.addClientSelectedFeature(feat, layer),\n                    addFeatureToHighlight: (feat, bAppend) => this.addFeatureToHighlight(feat, bAppend),\n                    getWmsRequestAugmentations: () => this._wmsQueryAugmentations[mapName] ?? {}\n                });\n            }\n        }\n        return false;\n    }\n    /**\n     * @virtual\n     * @protected\n     * @param {GenericEvent} e\n     * @memberof BaseMapProviderContext\n     */\n    protected onImageError(e: GenericEvent) { }\n\n    private addClientSelectedFeature(f: Feature<Geometry>, l: LayerBase) {\n        if (this._select)\n            this._select.getFeatures().push(f);\n        if (this._state.mapName) {\n            const features = f.get(\"features\");\n            let theFeature: Feature<Geometry>;\n            //Are we clustered?\n            if (Array.isArray(features)) {\n                // Only proceeed with dispatch if single item array\n                if (features.length == 1) {\n                    theFeature = features[0];\n                } else {\n                    return;\n                }\n            } else {\n                theFeature = f;\n            }\n            const p = { ...theFeature.getProperties() };\n            delete p[theFeature.getGeometryName()];\n            const feat: ClientSelectionFeature = {\n                bounds: theFeature.getGeometry()?.getExtent() as Bounds,\n                properties: p\n            };\n            this.dispatch(addClientSelectedFeature(this._state.mapName, l.get(LayerProperty.LAYER_NAME), feat));\n        }\n    }\n\n    private clearClientSelectedFeatures() {\n        if (this._select)\n            this._select.getFeatures().clear();\n        if (this._state.mapName) {\n            this.dispatch(clearClientSelection(this._state.mapName));\n        }\n    }\n\n    protected onMapClick(e: MapBrowserEvent<any>) {\n        if (!this._comp || !this._map) {\n            return;\n        }\n\n        if (this._comp.isContextMenuOpen()) {\n            // We're going on the assumption that due to element placement\n            // if this event is fired, it meant that the user clicked outside\n            // the context menu, otherwise the context menu itself would've handled\n            // the event\n            this._comp.onHideContextMenu?.();\n        }\n        if (this.isDigitizing()) {\n            return;\n        }\n\n        //TODO: Our selected feature tooltip only shows properties of a single feature\n        //and displays upon said feature being selected. As a result, although we can\n        //(and should) allow for multiple features to be selected, we need to figure\n        //out the proper UI for such a case before we enable multiple selection.\n        const bAppendMode = false;\n\n        const featureToLayerMap = [] as [Feature<Geometry>, Layer<Source>][];\n        if ((this._state.activeTool == ActiveMapTool.Select) && this._select) {\n            if (!bAppendMode) {\n                this.clearClientSelectedFeatures();\n            }\n            this._map.forEachFeatureAtPixel(e.pixel, (feature, layer) => {\n                if (featureToLayerMap.length == 0) { //See TODO above\n                    if (layer.get(LayerProperty.IS_SELECTABLE) == true && feature instanceof Feature) {\n                        featureToLayerMap.push([feature, layer]);\n                    }\n                }\n            });\n            if (this._select && featureToLayerMap.length == 1) {\n                const [f, l] = featureToLayerMap[0];\n                if (isClusteredFeature(f) && getClusterSubFeatures(f).length > 1 && (l.get(LayerProperty.VECTOR_STYLE) as OLStyleMapSet)?.getClusterClickAction() == ClusterClickAction.ZoomToClusterExtents) {\n                    const zoomBounds = getClusterSubFeatures(f).reduce((bounds, currentFeatures) => {\n                        const g = currentFeatures.getGeometry();\n                        if (g) {\n                            return olExtent.extend(bounds, g.getExtent());\n                        } else {\n                            return bounds;\n                        }\n                    }, olExtent.createEmpty()) as Bounds;\n\n                    // Inflate the bounds by 20 meters so that the new view has some \"breathing space\" and you don't see points\n                    // of the cluster on the edge of the view\n                    const inflatedBounds = inflateBoundsByMeters(this.getProjection(), zoomBounds, 20);\n                    this.zoomToExtent(inflatedBounds);\n                } else {\n                    this.addClientSelectedFeature(f, l);\n                }\n            }\n        }\n        // We'll only fall through the normal map selection query route if no \n        // vector features were selected as part of this click\n        const px = e.pixel as [number, number];\n        if (featureToLayerMap.length == 0) {\n            this.hideSelectedVectorFeaturesTooltip();\n            if (this._state.activeTool == ActiveMapTool.Select) {\n                this.queryWmsFeatures(this._state.mapName, e.coordinate as Coordinate2D, bAppendMode).then(madeSelection => {\n                    if (!madeSelection) {\n                        this.onProviderMapClick(px);\n                    } else {\n                        console.log(\"Made WMS selection. Skipping provider click event\");\n                    }\n                })\n            } else {\n                this.onProviderMapClick(px);\n            }\n        } else {\n            if (this._select) {\n                if (!bAppendMode) {\n                    if (this._state.mapName) {\n                        const activeLayerSet = this.getLayerSetGroup(this._state.mapName);\n                        activeLayerSet?.clearWmsSelectionOverlay();\n                    }\n                }\n                this.showSelectedVectorFeatures(this._select.getFeatures(), px, featureToLayerMap, this._state.locale);\n            }\n        }\n    }\n    protected abstract onProviderMapClick(px: [number, number]): void;\n    protected abstract initLayerSet(nextState: TState): TLayerSetGroup;\n    public abstract getProviderName(): string;\n\n    protected initContext(layerSet: TLayerSetGroup, locale?: string, overviewMapElementSelector?: () => (Element | null)) {\n        if (this._map) {\n            // HACK: className property not documented. This needs to be fixed in OL api doc.\n            const overviewMapOpts: any = {\n                className: 'ol-overviewmap ol-custom-overviewmap',\n                layers: layerSet.getLayersForOverviewMap(),\n                view: new View({\n                    projection: layerSet.getProjection()\n                }),\n                tipLabel: tr(\"OL_OVERVIEWMAP_TIP\", locale),\n                collapseLabel: String.fromCharCode(187), //'\\u00BB',\n                label: String.fromCharCode(171) //'\\u00AB'\n            };\n\n            if (overviewMapElementSelector) {\n                const el = overviewMapElementSelector();\n                if (el) {\n                    overviewMapOpts.target = ReactDOM.findDOMNode(el);\n                    overviewMapOpts.collapsed = false;\n                    overviewMapOpts.collapsible = false;\n                }\n            }\n            this._ovMap = new OverviewMap(overviewMapOpts);\n            this._map.addControl(this._ovMap);\n            this.onBeforeAttachingLayerSetGroup(layerSet);\n            layerSet.attach(this._map, this._ovMap, false);\n        }\n    }\n    //#endregion\n\n    /**\n     * @virtual\n     * @protected\n     * @param {TLayerSetGroup} layerSetGroup\n     * @memberof BaseMapProviderContext\n     */\n    protected onBeforeAttachingLayerSetGroup(layerSetGroup: TLayerSetGroup): void { }\n    public setToasterRef(ref: React.RefObject<Toaster>) {\n        this._toasterRef = ref;\n    }\n    public abstract setProviderState(nextState: TState): void;\n\n    public onKeyDown(e: GenericEvent) {\n        const cancelKey = this._state.cancelDigitizationKey ?? KC_ESCAPE;\n        const undoKey = this._state.undoLastPointKey ?? KC_U;\n        if (e.keyCode == cancelKey) {\n            this.cancelDigitization();\n        } else if (e.keyCode == undoKey && this._activeDrawInteraction) {\n            this._activeDrawInteraction.removeLastPoint();\n        }\n    }\n\n    public isDigitizing(): boolean {\n        if (!this._map)\n            return false;\n        const activeDraw = this._map.getInteractions().getArray().filter(inter => inter instanceof Draw)[0];\n        return activeDraw != null;\n    }\n\n    public detachFromComponent(): void {\n        this._comp = undefined;\n        this._select?.dispose();\n        this._select = undefined;\n\n        if (this._boundZoomSelectBox) {\n            this._zoomSelectBox?.un(\"boxend\", this._boundZoomSelectBox as any);\n            this._boundZoomSelectBox = undefined;\n        }\n        if (this._boundClick) {\n            this._map?.un(\"click\", this._boundClick as any);\n            this._boundClick = undefined;\n        }\n        if (this._boundMouseMove) {\n            this._map?.un(\"pointermove\", this._boundMouseMove as any);\n            this._boundMouseMove = undefined;\n        }\n        if (this._boundResize) {\n            this._map?.un(\"change:size\", this._boundResize as any);\n            this._boundResize = undefined;\n        }\n        if (this._boundMoveEnd) {\n            this._map?.un(\"moveend\", this._boundMoveEnd as any);\n            this._boundMoveEnd = undefined;\n        }\n\n        this._zoomSelectBox?.dispose();\n        this._zoomSelectBox = undefined;\n        this._activeDrawInteraction?.dispose();\n        this._activeDrawInteraction = null;\n        this._selectTooltip?.dispose();\n        this._selectTooltip = undefined;\n        this._mouseTooltip?.dispose()\n        this._mouseTooltip = undefined;\n        this._map?.setTarget(undefined);\n        this._ovMap?.setMap(undefined as any); //HACK: Typings workaround\n        this._map = undefined;\n        this._ovMap = undefined;\n        debug(`Map provider context detached from component and reset to initial state`);\n    }\n\n    private onMoveEnd(e: GenericEvent) {\n        //HACK:\n        //\n        //What we're hoping here is that when the view has been broadcasted back up\n        //and flowed back in through new view props, that the resulting zoom/pan\n        //operation in componentDidUpdate() is effectively a no-op as the intended\n        //zoom/pan location has already been reached by this event right here\n        //\n        //If we look at this through Redux DevTools, we see 2 entries for Map/SET_VIEW\n        //for the initial view (un-desirable), but we still only get one map image request\n        //for the initial view (good!). Everything is fine after that.\n        if (this._triggerZoomRequestOnMoveEnd) {\n            this._comp?.onDispatch(setCurrentView(this.getCurrentView()));\n        } else {\n            info(\"Triggering zoom request on moveend suppresseed\");\n        }\n        if (e.frameState.viewState.rotation != this._state.viewRotation) {\n            this._comp?.onDispatch(setViewRotation(e.frameState.viewState.rotation));\n        }\n    }\n\n    private _boundZoomSelectBox: Function | undefined;\n    private _boundMouseMove: Function | undefined;\n    private _boundResize: Function | undefined;\n    private _boundClick: Function | undefined;\n    private _boundMoveEnd: Function | undefined;\n\n    /**\n     * @virtual\n     * @param {HTMLElement} el\n     * @param {IViewerComponent} comp\n     * @memberof BaseMapProviderContext\n     */\n    public attachToComponent(el: HTMLElement, comp: IViewerComponent): void {\n        this._comp = comp;\n        this._select = new Select({\n            condition: (e) => false,\n            layers: (layer) => layer.get(LayerProperty.IS_SELECTABLE) == true || layer.get(LayerProperty.IS_SCRATCH) == true\n        });\n        this._zoomSelectBox = new DragBox({\n            condition: (e) => {\n                const startingMiddleMouseDrag = e.type == \"pointerdown\" && isMiddleMouseDownEvent((e as any).originalEvent);\n                return !this.isDigitizing() && !startingMiddleMouseDrag && (this._state.activeTool === ActiveMapTool.Select || this._state.activeTool === ActiveMapTool.Zoom)\n            }\n        });\n\n        this._boundZoomSelectBox = this.onZoomSelectBox.bind(this);\n        this._boundMouseMove = this.onMouseMove.bind(this);\n        this._boundResize = this.onResize.bind(this);\n        this._boundClick = this.onMapClick.bind(this);\n        this._boundMoveEnd = this.onMoveEnd.bind(this);\n\n        this._zoomSelectBox.on(\"boxend\", this._boundZoomSelectBox as any);\n        const mapOptions: MapOptions = {\n            target: el as any,\n            //layers: layers,\n            //view: view,\n            controls: [\n                new Attribution({\n                    tipLabel: tr(\"OL_ATTRIBUTION_TIP\", this._state.locale)\n                }),\n                new Rotate({\n                    tipLabel: tr(\"OL_RESET_ROTATION_TIP\", this._state.locale)\n                })\n            ],\n            interactions: [\n                this._select,\n                new DragRotate(),\n                new DragPan({\n                    condition: (e) => {\n                        const startingMiddleMouseDrag = e.type == \"pointerdown\" && isMiddleMouseDownEvent((e as any).originalEvent);\n                        const enabled = (startingMiddleMouseDrag || this._supportsTouch || this._state.activeTool === ActiveMapTool.Pan);\n                        //console.log(e);\n                        //console.log(`Allow Pan - ${enabled} (middle mouse: ${startingMiddleMouseDrag})`);\n                        return enabled;\n                    }\n                }),\n                new PinchRotate(),\n                new PinchZoom(),\n                new KeyboardPan(),\n                new KeyboardZoom(),\n                new MouseWheelZoom(),\n                this._zoomSelectBox\n            ]\n        };\n        this._map = new Map(mapOptions);\n        const activeLayerSet = this.ensureAndGetLayerSetGroup(this._state);\n        this.initContext(activeLayerSet, this._state.locale, this._state.overviewMapElementSelector);\n        this._mouseTooltip = new MouseTrackingTooltip(this._map, this._comp.isContextMenuOpen);\n        this._selectTooltip = new SelectedFeaturesTooltip(this._map, this);\n        this._map.on(\"pointermove\", this._boundMouseMove as any);\n        this._map.on(\"change:size\", this._boundResize as any);\n        this._map.on(\"click\", this._boundClick as any);\n        this._map.on(\"moveend\", this._boundMoveEnd as any);\n\n        if (this._state.view) {\n            const { x, y, scale } = this._state.view;\n            this.zoomToView(x, y, scale);\n        } else {\n            const extents = activeLayerSet.getExtent();\n            this._map.getView().fit(extents);\n        }\n        this.onResize(this._map.getSize());\n    }\n    private onResize = (e: GenericEvent) => {\n        if (this._map) {\n            const size = this._map.getSize();\n            if (size) {\n                const [w, h] = size;\n                this._comp?.onDispatch(mapResized(w, h));\n            }\n        }\n    }\n    public scaleToResolution(scale: number): number {\n        assertIsDefined(this._state.mapName);\n        const activeLayerSet = this.getLayerSetGroup(this._state.mapName);\n        assertIsDefined(activeLayerSet);\n        return activeLayerSet.scaleToResolution(scale);\n    }\n\n    public resolutionToScale(resolution: number): number {\n        assertIsDefined(this._state.mapName);\n        const activeLayerSet = this.getLayerSetGroup(this._state.mapName);\n        assertIsDefined(activeLayerSet);\n        return activeLayerSet.resolutionToScale(resolution);\n    }\n\n    public getCurrentView(): IMapView {\n        const ov = this.getOLView();\n        const center = ov.getCenter();\n        const resolution = ov.getResolution();\n        const scale = this.resolutionToScale(resolution!);\n        return {\n            x: center![0],\n            y: center![1],\n            scale: scale,\n            resolution: resolution\n        };\n    }\n    public getCurrentExtent(): Bounds {\n        assertIsDefined(this._map);\n        return this._map.getView().calculateExtent(this._map.getSize()) as Bounds;\n    }\n    public getSize(): Size2 {\n        assertIsDefined(this._map);\n        return this._map.getSize() as Size2;\n    }\n    public getOLView(): View {\n        assertIsDefined(this._map);\n        return this._map.getView();\n    }\n    public zoomToView(x: number, y: number, scale: number): void {\n        if (this._map) {\n            const view = this._map.getView();\n            view.setCenter([x, y]);\n            view.setResolution(this.scaleToResolution(scale));\n        }\n    }\n    /**\n     * @virtual\n     * @param {RefreshMode} [mode=RefreshMode.LayersOnly | RefreshMode.SelectionOnly]\n     * @memberof BaseMapProviderContext\n     */\n    public refreshMap(mode: RefreshMode = RefreshMode.LayersOnly | RefreshMode.SelectionOnly): void { }\n    public getMetersPerUnit(): number {\n        assertIsDefined(this._state.mapName);\n        const activeLayerSet = this.getLayerSetGroup(this._state.mapName);\n        assertIsDefined(activeLayerSet);\n        return activeLayerSet.getMetersPerUnit();\n    }\n    public initialView(): void {\n        assertIsDefined(this._comp);\n        assertIsDefined(this._state.mapName);\n        const activeLayerSet = this.getLayerSetGroup(this._state.mapName);\n        assertIsDefined(activeLayerSet);\n        this._comp.onDispatch(setCurrentView(this.getViewForExtent(activeLayerSet.getExtent())));\n    }\n\n    public zoomDelta(delta: number): void {\n        //TODO: To conform to redux uni-directional data flow, this should\n        //broadcast the new desired view back up and flow it back through to this\n        //component as new props\n        this.zoomByDelta(delta);\n    }\n    public zoomToExtent(extent: Bounds): void {\n        this._comp?.onDispatch(setCurrentView(this.getViewForExtent(extent)));\n    }\n    public digitizePoint(handler: DigitizerCallback<Point>, prompt?: string): void {\n        assertIsDefined(this._comp);\n        const draw = new Draw({\n            type: GeometryType.POINT\n        });\n        this.pushDrawInteraction(\"Point\", draw, handler, prompt || tr(\"DIGITIZE_POINT_PROMPT\", this._state.locale));\n    }\n    public digitizeLine(handler: DigitizerCallback<LineString>, prompt?: string): void {\n        assertIsDefined(this._comp);\n        const draw = new Draw({\n            type: GeometryType.LINE_STRING,\n            minPoints: 2,\n            maxPoints: 2\n        });\n        this.pushDrawInteraction(\"Line\", draw, handler, prompt || tr(\"DIGITIZE_LINE_PROMPT\", this._state.locale));\n    }\n    public digitizeLineString(handler: DigitizerCallback<LineString>, prompt?: string): void {\n        assertIsDefined(this._comp);\n        const draw = new Draw({\n            type: GeometryType.LINE_STRING,\n            minPoints: 2\n        });\n        this.pushDrawInteraction(\"LineString\", draw, handler, prompt || tr(\"DIGITIZE_LINESTRING_PROMPT\", this._state.locale, {\n            key: String.fromCharCode(this._state.undoLastPointKey ?? KC_U) //Pray that a sane (printable) key was bound\n        }));\n    }\n    public digitizeCircle(handler: DigitizerCallback<Circle>, prompt?: string): void {\n        assertIsDefined(this._comp);\n        const draw = new Draw({\n            type: GeometryType.CIRCLE\n        });\n        this.pushDrawInteraction(\"Circle\", draw, handler, prompt || tr(\"DIGITIZE_CIRCLE_PROMPT\", this._state.locale));\n    }\n    public digitizeRectangle(handler: DigitizerCallback<Polygon>, prompt?: string): void {\n        assertIsDefined(this._comp);\n        const geomFunc: GeometryFunction = (coordinates, geometry) => {\n            if (!geometry) {\n                geometry = new Polygon([]);\n            }\n            const start: any = coordinates[0];\n            const end: any = coordinates[1];\n            (geometry as any).setCoordinates([\n                [start, [start[0], end[1]], end, [end[0], start[1]], start]\n            ]);\n            return geometry;\n        };\n        const draw = new Draw({\n            type: GeometryType.LINE_STRING,\n            maxPoints: 2,\n            geometryFunction: geomFunc\n        });\n        this.pushDrawInteraction(\"Rectangle\", draw, handler, prompt || tr(\"DIGITIZE_RECT_PROMPT\", this._state.locale));\n    }\n    public digitizePolygon(handler: DigitizerCallback<Polygon>, prompt?: string): void {\n        assertIsDefined(this._comp);\n        const draw = new Draw({\n            type: GeometryType.POLYGON\n        });\n        this.pushDrawInteraction(\"Polygon\", draw, handler, prompt || tr(\"DIGITIZE_POLYGON_PROMPT\", this._state.locale, {\n            key: String.fromCharCode(this._state.undoLastPointKey ?? KC_U) //Pray that a sane (printable) key was bound\n        }));\n    }\n\n    public addInteraction<T extends Interaction>(interaction: T): T {\n        assertIsDefined(this._map);\n        this._map.addInteraction(interaction);\n        return interaction;\n    }\n    public removeInteraction<T extends Interaction>(interaction: T): void {\n        this._map?.removeInteraction(interaction);\n    }\n    public addOverlay(overlay: Overlay): void {\n        this._map?.addOverlay(overlay);\n    }\n    public removeOverlay(overlay: Overlay): void {\n        this._map?.removeOverlay(overlay);\n    }\n    public getProjection(): ProjectionLike {\n        assertIsDefined(this._map);\n        return this._map.getView().getProjection();\n    }\n    public addHandler(eventName: string, handler: Function) {\n        this._map?.on(eventName as any, handler as any);\n    }\n    public removeHandler(eventName: string, handler: Function) {\n        this._map?.un(eventName as any, handler as any);\n    }\n    public updateSize() {\n        this._map?.updateSize();\n    }\n    protected getLayerManagerForLayerSet(layerSet: TLayerSetGroup) {\n        assertIsDefined(this._map);\n        return new LayerManager(this._map, layerSet);\n    }\n    public getLayerManager(mapName?: string): ILayerManager {\n        assertIsDefined(this._map);\n        assertIsDefined(this._state.mapName);\n        const layerSet = this.ensureAndGetLayerSetGroup(this._state); // this.getLayerSet(mapName ?? this._state.mapName, true, this._comp as any);\n        return this.getLayerManagerForLayerSet(layerSet);\n    }\n    public screenToMapUnits(x: number, y: number): [number, number] {\n        let bAllowOutsideWindow = false;\n        const [mapDevW, mapDevH] = this.getSize();\n        const [extX1, extY1, extX2, extY2] = this.getCurrentExtent();\n        if (!bAllowOutsideWindow) {\n            if (x > mapDevW - 1) x = mapDevW - 1;\n            else if (x < 0) x = 0;\n\n            if (y > mapDevH - 1) y = mapDevH - 1;\n            else if (y < 0) y = 0;\n        }\n        x = extX1 + (extX2 - extX1) * (x / mapDevW);\n        y = extY1 - (extY1 - extY2) * (y / mapDevH);\n        return [x, y];\n    }\n    public getSelectedFeatures() {\n        return this._select?.getFeatures();\n    }\n    public getPointSelectionBox(point: Coordinate2D, ptBuffer: number): Bounds {\n        assertIsDefined(this._map);\n        const ll = this._map.getCoordinateFromPixel([point[0] - ptBuffer, point[1] - ptBuffer]);\n        const ur = this._map.getCoordinateFromPixel([point[0] + ptBuffer, point[1] + ptBuffer]);\n        return [ll[0], ll[1], ur[0], ur[1]];\n    }\n    public getResolution(): number | undefined {\n        assertIsDefined(this._map)\n        return this._map.getView().getResolution();\n    }\n    public updateOverviewMapElement(overviewMapElementSelector: () => (Element | null)) {\n        if (this._ovMap) {\n            const el = overviewMapElementSelector();\n            if (el) {\n                this._ovMap.setCollapsed(false);\n                this._ovMap.setCollapsible(false);\n                this._ovMap.setTarget(ReactDOM.findDOMNode(el) as any);\n            } else {\n                this._ovMap.setCollapsed(true);\n                this._ovMap.setCollapsible(true);\n                this._ovMap.setTarget(null as any);\n            }\n        }\n    }\n}","import * as React from \"react\";\nimport type { IMapProviderContext } from './base';\nimport { Provider, useDispatch, useSelector } from \"react-redux\";\nimport type { IApplicationState } from \"../../api/common\";\n\nconst MapProviderContext = React.createContext<IMapProviderContext>({} as any);\n\n/**\n * Wraps the provider component of react-redux\n * \n * @since 0.14\n */\nexport const ReduxProvider: React.FC<{ store: ReduxStoreImpl }> = ({ store, children }) => <Provider store={store}>{children}</Provider>\n\n/**\n * Wraps useDispatch from react-redux\n * \n * @since 0.14\n */\nexport function useReduxDispatch() {\n    return useDispatch();\n}\n\n/**\n * Fetches the requested sub-section of the application state\n * \n * @since 0.14\n */\nexport function useAppState<TState>(selector: (state: IApplicationState) => TState, equalityFn?: (left: TState, right: TState) => boolean) {\n    return useSelector<IApplicationState, TState>(selector, equalityFn);\n}\n\n/**\n * @since 0.14\n */\nexport const MapProviderContextProvider: React.FC<{ value: IMapProviderContext }> = ({ value, children }) => {\n    return <MapProviderContext.Provider value={value}>\n        {children}\n    </MapProviderContext.Provider>\n}\n\n/**\n * Obtains the current map provider context, which provides imperative access to the current map\n * \n * @since 0.14\n */\nexport function useMapProviderContext() {\n    return React.useContext(MapProviderContext);\n}\n\n/**\n * @since 0.14\n */\nexport type ReduxStoreImpl = any;\n\n/**\n * @since 0.14\n */\nexport const MapContextProvider: React.FC<{ value: IMapProviderContext, store?: ReduxStoreImpl }> = ({ value, store, children }) => {\n    let inner = children;\n    if (store) {\n        inner = <ReduxProvider store={store}>\n            {children}\n        </ReduxProvider>;\n    }\n    return <MapProviderContextProvider value={value}>\n        {inner}\n    </MapProviderContextProvider>\n};","\nimport { Client } from '../../api/client';\nimport { SessionKeepAlive } from '../session-keep-alive';\nimport { Bounds, GenericEvent, ActiveMapTool, ImageFormat, RefreshMode, SelectionVariant, ClientKind, LayerTransparencySet, Size, BLANK_SIZE, IMapGuideViewerSupport, Dictionary } from '../../api/common';\nimport { IQueryMapFeaturesOptions } from '../../api/request-builder';\nimport { QueryMapFeaturesResponse, FeatureSet } from '../../api/contracts/query';\n\nimport WKTFormat from \"ol/format/WKT\";\n\nimport Polygon, { fromExtent } from 'ol/geom/Polygon';\n\nimport Geometry from 'ol/geom/Geometry';\nimport { queryMapFeatures, setMouseCoordinates, setFeatureTooltipsEnabled } from '../../actions/map';\nimport View from 'ol/View';\nimport debounce from 'lodash.debounce';\nimport { layerTransparencyChanged, areViewsCloseToEqual } from '../../utils/viewer-state';\nimport { areArraysDifferent } from '../../utils/array';\nimport { MgLayerSetGroup } from \"../../api/mg-layer-set-group\";\nimport { FeatureQueryTooltip } from '../tooltips/feature';\nimport { RuntimeMap } from '../../api/contracts/runtime-map';\nimport { debug, warn } from '../../utils/logger';\nimport { getSiteVersion, canUseQueryMapFeaturesV4 } from '../../utils/site-version';\nimport { BLANK_GIF_DATA_URI } from '../../constants';\nimport { isSessionExpiredError } from '../../api/error';\nimport { BaseMapProviderContext, IMapProviderState, IViewerComponent, IMapProviderStateExtras, recursiveFindLayer } from './base';\nimport { assertIsDefined } from '../../utils/assert';\nimport { strIsNullOrEmpty, STR_EMPTY } from '../../utils/string';\nimport { ensureParameters } from '../../utils/url';\nimport { ActionType } from '../../constants/actions';\nimport { buildSelectionXml, getActiveSelectedFeatureXml } from '../../api/builders/deArrayify';\nimport { MapGuideMockMode } from '../mapguide-debug-context';\nimport { useViewerImageFormat, useConfiguredAgentUri, useConfiguredAgentKind, useViewerPointSelectionBuffer, useViewerFeatureTooltipsEnabled, useConfiguredManualFeatureTooltips, useViewerSelectionColor, useViewerSelectionImageFormat, useViewerActiveFeatureSelectionColor, useActiveMapSelectionSet, useConfiguredLoadIndicatorPositioning, useConfiguredLoadIndicatorColor, useViewerActiveTool, useActiveMapView, useViewerViewRotation, useViewerViewRotationEnabled, useActiveMapName, useViewerLocale, useActiveMapExternalBaseLayers, useConfiguredCancelDigitizationKey, useConfiguredUndoLastPointKey, useActiveMapLayers, useActiveMapInitialExternalLayers, useViewerIsStateless, useCustomAppSettings } from '../../containers/hooks';\nimport { useActiveMapState, useActiveMapSessionId, useActiveMapSelectableLayerNames, useActiveMapLayerTransparency, useActiveMapShowGroups, useActiveMapHideGroups, useActiveMapShowLayers, useActiveMapHideLayers, useActiveMapActiveSelectedFeature } from '../../containers/hooks-mapguide';\nimport { useReduxDispatch } from './context';\nimport { UTFGridTrackingTooltip } from '../tooltips/utfgrid';\nimport olTileLayer from \"ol/layer/Tile\";\nimport olUtfGridSource from \"ol/source/UTFGrid\";\nimport TileSource from 'ol/source/Tile';\nimport { useActiveMapSubjectLayer } from '../../containers/hooks-generic';\nimport { IGenericSubjectMapLayer } from '../../actions/defs';\nimport { isRuntimeMap } from '../../utils/type-guards';\n\nexport function isMapGuideProviderState(arg: any): arg is IMapGuideProviderState {\n    return typeof (arg.agentUri) == 'string'\n        && typeof (arg.agentKind) == 'string';\n}\n\nfunction useMapGuideViewerState() {\n    const activeTool = useViewerActiveTool();\n    const view = useActiveMapView();\n    const viewRotation = useViewerViewRotation();\n    const viewRotationEnabled = useViewerViewRotationEnabled();\n    const mapName = useActiveMapName();\n    const locale = useViewerLocale();\n    const externalBaseLayers = useActiveMapExternalBaseLayers(true);\n    const cancelDigitizationKey = useConfiguredCancelDigitizationKey();\n    const undoLastPointKey = useConfiguredUndoLastPointKey();\n    const layers = useActiveMapLayers();\n    const initialExternalLayers = useActiveMapInitialExternalLayers();\n    const dispatch = useReduxDispatch();\n    const appSettings = useCustomAppSettings();\n    // ============== Generic ============== //\n    const subject = useActiveMapSubjectLayer();\n    // ============== MapGuide-specific ================== //\n    const stateless = useViewerIsStateless();\n    const imageFormat = useViewerImageFormat();\n    const agentUri = useConfiguredAgentUri();\n    const agentKind = useConfiguredAgentKind();\n    const map = useActiveMapState();\n    const pointSelectionBuffer = useViewerPointSelectionBuffer();\n    const featureTooltipsEnabled = useViewerFeatureTooltipsEnabled();\n    const manualFeatureTooltips = useConfiguredManualFeatureTooltips();\n    const sessionId = useActiveMapSessionId();\n    const selectionColor = useViewerSelectionColor();\n    const selectionImageFormat = useViewerSelectionImageFormat();\n    const selectableLayerNames = useActiveMapSelectableLayerNames();\n    const layerTransparency = useActiveMapLayerTransparency();\n    const showGroups = useActiveMapShowGroups();\n    const hideGroups = useActiveMapHideGroups();\n    const showLayers = useActiveMapShowLayers();\n    const hideLayers = useActiveMapHideLayers();\n    const activeSelectedFeature = useActiveMapActiveSelectedFeature();\n    const activeSelectedFeatureColor = useViewerActiveFeatureSelectionColor();\n    const selection = useActiveMapSelectionSet();\n\n    let bgColor: string | undefined;\n    if (map) {\n        bgColor = `#${map.BackgroundColor.substring(2)}`;\n    }\n    let activeSelectedFeatureXml;\n    if (activeSelectedFeature && selection && selection.FeatureSet) {\n        activeSelectedFeatureXml = getActiveSelectedFeatureXml(selection.FeatureSet, activeSelectedFeature);\n    }\n\n    let theMap = map ?? subject;\n    let isReady = false;\n    // Regardless of inferred readiness, the map/subject must be set\n    if (!theMap) {\n        isReady = false;\n        theMap = {} as IGenericSubjectMapLayer;\n    } else {\n        if (subject && layerTransparency) {\n            isReady = true;\n        } else if (agentUri && theMap && layerTransparency) {\n            if (!stateless) {\n                if (isRuntimeMap(theMap) && sessionId) {\n                    isReady = true;\n                }\n            } else {\n                isReady = true;\n            }\n        }\n    }\n\n    const nextState: IMapGuideProviderState & IMapProviderStateExtras = {\n        stateless,\n        activeTool,\n        view,\n        viewRotation,\n        viewRotationEnabled,\n        mapName,\n        locale,\n        externalBaseLayers,\n        cancelDigitizationKey,\n        undoLastPointKey,\n        initialExternalLayers,\n        appSettings: appSettings ?? {},\n        // ========== IMapProviderStateExtras ========== //\n        isReady,\n        bgColor,\n        layers,\n        // =========== MapGuide-specific ============== //\n        imageFormat,\n        agentUri,\n        agentKind,\n        map: theMap,\n        pointSelectionBuffer,\n        featureTooltipsEnabled,\n        manualFeatureTooltips,\n        sessionId,\n        selectionColor,\n        selectionImageFormat,\n        selectableLayerNames,\n        layerTransparency,\n        showGroups: showGroups ?? [],\n        hideGroups: hideGroups ?? [],\n        showLayers: showLayers ?? [],\n        hideLayers: hideLayers ?? [],\n        activeSelectedFeatureXml: activeSelectedFeatureXml ?? STR_EMPTY,\n        activeSelectedFeatureColor,\n        selection\n    };\n    return nextState;\n}\n\nexport interface IMapGuideProviderState extends IMapProviderState {\n    /**\n     * @since 0.14\n     */\n    stateless: boolean;\n    imageFormat: ImageFormat;\n    /**\n     * @since 0.14\n     */\n    appSettings: Dictionary<string>;\n    agentUri: string | undefined;\n    agentKind: ClientKind;\n    map: RuntimeMap | IGenericSubjectMapLayer;\n    pointSelectionBuffer: number;\n    manualFeatureTooltips: boolean;\n    featureTooltipsEnabled: boolean;\n    sessionId: string | undefined;\n    selectionColor: string;\n    selectionImageFormat: ImageFormat;\n    selectableLayerNames: string[];\n    layerTransparency: LayerTransparencySet | undefined;\n    showGroups: string[];\n    hideGroups: string[];\n    showLayers: string[];\n    hideLayers: string[];\n    activeSelectedFeatureXml: string;\n    activeSelectedFeatureColor: string;\n    selection: QueryMapFeaturesResponse | null;\n}\n\nexport class MapGuideMapProviderContext extends BaseMapProviderContext<IMapGuideProviderState, MgLayerSetGroup> implements IMapGuideViewerSupport {\n    /**\n     * This is a throttled version of _refreshOnStateChange(). Call this on any\n     * modifications to pendingStateChanges\n     *\n     * @private\n     */\n    private refreshOnStateChange: (mapName: string,\n        showGroups: string[] | undefined,\n        showLayers: string[] | undefined,\n        hideGroups: string[] | undefined,\n        hideLayers: string[] | undefined) => void;\n\n\n\n    // ============= MapGuide-specific private state ============== //\n    private _client: Client;\n    private _keepAlive: SessionKeepAlive | undefined;\n    private _featureTooltip: FeatureQueryTooltip | undefined;\n    private _utfGridTooltip: UTFGridTrackingTooltip | undefined;\n    private _wktFormat: WKTFormat;\n    // ============================================================= //\n\n    constructor(public mockMode: MapGuideMockMode | undefined = undefined) {\n        super();\n        this._wktFormat = new WKTFormat();\n        this.refreshOnStateChange = debounce(this._refreshOnStateChange.bind(this), 500);\n    }\n\n    /**\n     * @override\n     */\n    public getHookFunction(): () => IMapProviderState & IMapProviderStateExtras {\n        return useMapGuideViewerState;\n    }\n\n    public setMockMode(mode: MapGuideMockMode | undefined): void {\n        this.mockMode = mode;\n    }\n\n    /**\n     * @override\n     */\n    public hideAllPopups() {\n        super.hideAllPopups();\n        this._featureTooltip?.setEnabled(false);\n    }\n\n    /**\n     *\n     * @override\n     * @protected\n     * @returns {(MapGuideMockMode | undefined)}\n     * @memberof MapGuideMapProviderContext\n     */\n    protected getMockMode(): MapGuideMockMode | undefined { return this.mockMode; }\n\n    protected getInitialProviderState(): Omit<IMapGuideProviderState, keyof IMapProviderState> {\n        return {\n            stateless: false,\n            imageFormat: \"PNG8\",\n            agentUri: undefined,\n            agentKind: \"mapagent\",\n            map: {} as IGenericSubjectMapLayer,\n            pointSelectionBuffer: 2,\n            featureTooltipsEnabled: true,\n            manualFeatureTooltips: false,\n            sessionId: undefined,\n            selectionColor: \"0000FF\",\n            selectionImageFormat: \"PNG8\",\n            selectableLayerNames: [],\n            layerTransparency: {},\n            appSettings: {},\n            showGroups: [],\n            hideGroups: [],\n            showLayers: [],\n            hideLayers: [],\n            activeSelectedFeatureXml: STR_EMPTY,\n            activeSelectedFeatureColor: \"FF0000\",\n            selection: null\n        }\n    }\n\n    public getProviderName(): string { return \"MapGuide\"; }\n\n    /**\n     * @override\n     * @returns {(IMapGuideViewerSupport | undefined)}\n     * @memberof MapGuideMapProviderContext\n     */\n    mapguideSupport(): IMapGuideViewerSupport | undefined {\n        return this;\n    }\n\n    //#region IMapGuideViewerSupport\n    getSelection(): QueryMapFeaturesResponse | null {\n        return this._state.selection;\n    }\n    getSelectionXml(selection: FeatureSet, layerIds?: string[] | undefined): string {\n        return buildSelectionXml(selection, layerIds);\n    }\n    getSessionId(): string {\n        return this._state.sessionId!;\n    }\n    setFeatureTooltipEnabled(enabled: boolean): void {\n        this._comp?.onDispatch(setFeatureTooltipsEnabled(enabled));\n    }\n    //#endregion\n\n    //#region IMapViewerContextCallback\n    private onSessionExpired() {\n\n    }\n    protected onProviderMapClick(px: [number, number]): void {\n        if (this._state.mapName && this._state.sessionId) {\n            if (this._state.manualFeatureTooltips && this._state.featureTooltipsEnabled) {\n                this.queryFeatureTooltip(px);\n            } else if (this._state.activeTool === ActiveMapTool.Select) {\n                const ptBuffer = this._state.pointSelectionBuffer ?? 2;\n                const box = this.getPointSelectionBox(px, ptBuffer);\n                const geom = fromExtent(box);\n                const options = this.buildDefaultQueryOptions(geom);\n                options.maxfeatures = 1;\n                this.sendSelectionQuery(options);\n            }\n        }\n    }\n    //#endregion\n\n    //#region Map Context\n    /**\n     * @override\n     * @protected\n     * @param {GenericEvent} e\n     * @returns\n     * @memberof BaseMapProviderContext\n     */\n    protected onMouseMove(e: GenericEvent) {\n        if (this._comp) {\n            this.handleMouseTooltipMouseMove(e);\n            this.handleHighlightHover(e);\n            if (this._comp.isContextMenuOpen()) {\n                return;\n            }\n            if (!this._state.manualFeatureTooltips) {\n                this.handleFeatureTooltipMouseMove(e);\n            }\n            if (this._utfGridTooltip) {\n                this._utfGridTooltip.onMouseMove(e);\n            }\n            if (this._state.mapName) {\n                this._comp.onDispatch?.(setMouseCoordinates(this._state.mapName, e.coordinate));\n            }\n        }\n    }\n    private queryFeatureTooltip(pixel: [number, number]) {\n        if (!this._state.stateless && this._featureTooltip && this._featureTooltip.isEnabled()) {\n            this._featureTooltip.raiseQueryFromPoint(pixel);\n        }\n    }\n    private handleFeatureTooltipMouseMove(e: GenericEvent) {\n        if (!this._state.stateless && this._featureTooltip && this._featureTooltip.isEnabled()) {\n            this._featureTooltip.onMouseMove(e);\n        }\n    }\n    private enableFeatureTooltips(enabled: boolean): void {\n        this._featureTooltip?.setEnabled(enabled);\n    }\n    private refreshMapInternal(name: string, mode: RefreshMode = RefreshMode.LayersOnly | RefreshMode.SelectionOnly): void {\n        const layerSet = this.getLayerSetGroup(name);\n        layerSet?.refreshMap(mode);\n    }\n    private async showSelectedFeature(mapExtent: Bounds, size: Size, map: RuntimeMap, selectionColor: string, featureXml: string | undefined) {\n        const sv = getSiteVersion(map);\n        // This operation requires v4.0.0 QUERYMAPFEATURES, so bail if this ain't the right version\n        if (!canUseQueryMapFeaturesV4(sv)) {\n            return;\n        }\n        const layerSet = this.getLayerSetGroup(map.Name);\n        try {\n            if (featureXml) {\n                const r = await this._client.queryMapFeatures_v4({\n                    mapname: map.Name,\n                    session: map.SessionId,\n                    selectionformat: \"PNG\",\n                    featurefilter: featureXml,\n                    selectioncolor: selectionColor,\n                    requestdata: 2, //Inline selection\n                    layerattributefilter: 0,\n                    persist: 0 //IMPORTANT: This is a transient selection\n                });\n                if (r.InlineSelectionImage) {\n                    const dataUri = `data:${r.InlineSelectionImage.MimeType};base64,${r.InlineSelectionImage.Content}`;\n                    layerSet?.showActiveSelectedFeature(mapExtent, size, dataUri);\n                } else {\n                    layerSet?.showActiveSelectedFeature(mapExtent, BLANK_SIZE, BLANK_GIF_DATA_URI);\n                }\n            } else {\n                layerSet?.showActiveSelectedFeature(mapExtent, BLANK_SIZE, BLANK_GIF_DATA_URI);\n            }\n        } catch (e) {\n            layerSet?.showActiveSelectedFeature(mapExtent, BLANK_SIZE, BLANK_GIF_DATA_URI);\n        }\n    }\n    //#endregion\n\n    /**\n     * DO NOT CALL DIRECTLY, call this.refreshOnStateChange() instead, which is a throttled version\n     * of this method\n     * @private\n     */\n    private _refreshOnStateChange(mapName: string,\n        showGroups: string[] | undefined,\n        showLayers: string[] | undefined,\n        hideGroups: string[] | undefined,\n        hideLayers: string[] | undefined) {\n        if (showGroups || showLayers || hideGroups || hideLayers) {\n            //this.refreshOnStateChange(map, showGroups, showLayers, hideGroups, hideLayers);\n            const layerSet = this.getLayerSetGroup(mapName);\n            if (layerSet instanceof MgLayerSetGroup) {\n                layerSet.setMapGuideMocking(this.getMockMode());\n                layerSet.update(showGroups, showLayers, hideGroups, hideLayers);\n            }\n        }\n    }\n    /**\n     * @override\n     * @protected\n     * @param {GenericEvent} e\n     * @memberof MapGuideMapProviderContext\n     */\n    protected onImageError(e: GenericEvent) {\n        this._keepAlive?.lastTry().catch(err => {\n            if (isSessionExpiredError(err)) {\n                this.onSessionExpired();\n            }\n        });\n    }\n\n\n    private getSelectableLayers(): string[] {\n        return this._state.selectableLayerNames ?? [];\n    }\n    private buildDefaultQueryOptions(geom: Geometry | string, reqQueryFeatures: number = 1 /* Attributes */): IQueryMapFeaturesOptions {\n        assertIsDefined(this._state.sessionId);\n        assertIsDefined(this._state.mapName);\n        const names = this.getSelectableLayers();\n        let wkt: string;\n        if (typeof geom === 'string') {\n            wkt = geom;\n        } else {\n            wkt = this._wktFormat.writeGeometry(geom);\n        }\n        return {\n            mapname: this._state.mapName,\n            session: this._state.sessionId,\n            geometry: wkt,\n            requestdata: reqQueryFeatures,\n            layernames: names.length > 0 ? names.join(\",\") : undefined,\n            persist: 1\n        };\n    }\n\n    /**\n     * @virtual\n     * @protected\n     * @param {Polygon} geom\n     * @memberof MapGuideMapProviderContext\n     */\n    protected selectFeaturesByExtent(geom: Polygon) {\n        if (!this._state.mapName || !this._comp || !this._state.sessionId || !this._state.selectionColor) {\n            return;\n        }\n        this.sendSelectionQuery(this.buildDefaultQueryOptions(geom));\n    }\n\n    private onOpenTooltipLink = (url: string) => {\n        let fixedUrl = url;\n        if (this._state.mapName && this._state.sessionId) {\n            fixedUrl = ensureParameters(url, this._state.mapName, this._state.sessionId, this._state.locale);\n        }\n        this._comp?.onDispatch({\n            type: ActionType.TASK_INVOKE_URL,\n            payload: {\n                url: fixedUrl\n            }\n        });\n    };\n\n    /**\n     * @override\n     * @protected\n     */\n    protected initLayerSet(nextState: IMapGuideProviderState): MgLayerSetGroup {\n        const { mapName } = nextState;\n        assertIsDefined(mapName);\n        assertIsDefined(this._state.map);\n        const layerSet = new MgLayerSetGroup(nextState, {\n            getImageLoaders: () => super.getImageSourceLoaders(mapName),\n            getTileLoaders: () => super.getTileSourceLoaders(mapName),\n            getBaseTileLoaders: () => super.getBaseTileSourceLoaders(mapName),\n            getMockMode: () => this.getMockMode(),\n            incrementBusyWorker: () => this.incrementBusyWorker(),\n            decrementBusyWorker: () => this.decrementBusyWorker(),\n            addImageLoading: () => this._comp?.addImageLoading(),\n            addImageLoaded: () => this._comp?.addImageLoaded(),\n            onImageError: (e) => this.onImageError(e),\n            onSessionExpired: () => this.onSessionExpired(),\n            getSelectableLayers: () => this.getSelectableLayers(),\n            getClient: () => this._client,\n            isContextMenuOpen: () => this._comp?.isContextMenuOpen() ?? false,\n            getAgentUri: () => this._state.agentUri!,\n            getAgentKind: () => this._state.agentKind,\n            getMapName: () => this._state.mapName!,\n            getSessionId: () => this._state.sessionId!,\n            getLocale: () => this._state.locale,\n            isFeatureTooltipEnabled: () => this.isFeatureTooltipEnabled(),\n            getPointSelectionBox: (pt) => this.getPointSelectionBox(pt, this._state.pointSelectionBuffer),\n            openTooltipLink: (url) => this.onOpenTooltipLink(url),\n            addFeatureToHighlight: (feat, bAppend) => this.addFeatureToHighlight(feat, bAppend)\n        });\n        this._layerSetGroups[mapName] = layerSet;\n        layerSet.update(nextState.showGroups, nextState.showLayers, nextState.hideGroups, nextState.hideLayers);\n        return layerSet;\n    }\n\n    /**\n     * @override\n     * @readonly\n     * @memberof MapGuideMapProviderContext\n     */\n    public isMouseOverTooltip() { return this._featureTooltip?.isMouseOver == true || this._selectTooltip?.isMouseOver == true; }\n\n    /**\n     * @override\n     */\n    public detachFromComponent(): void {\n        this._keepAlive?.dispose();\n        this._keepAlive = undefined;\n        this._featureTooltip?.dispose();\n        this._featureTooltip = undefined;\n        super.detachFromComponent();\n    }\n\n    /**\n     * @override\n     * @param {HTMLElement} el\n     * @param {IViewerComponent} comp\n     * @memberof MapGuideMapProviderContext\n     */\n    public attachToComponent(el: HTMLElement, comp: IViewerComponent): void {\n        super.attachToComponent(el, comp);\n        const bCheckSession = (this._state.map && isRuntimeMap(this._state.map)) ?? false;\n        this._keepAlive = new SessionKeepAlive(() => this._state.sessionId!, this._client, this.onSessionExpired.bind(this), bCheckSession);\n\n        const utfGridLayer = recursiveFindLayer(this._map!.getLayers(), oll => {\n            if (oll instanceof olTileLayer) {\n                const source = oll.getSource();\n                if (source instanceof olUtfGridSource) {\n                    return true;\n                }\n            }\n            return false;\n        });\n        if (utfGridLayer) {\n            const source = (utfGridLayer as olTileLayer<TileSource>).getSource() as olUtfGridSource;\n            this._utfGridTooltip = new UTFGridTrackingTooltip(this._map!, source, this._comp?.isContextMenuOpen ?? (() => false));\n        }\n\n        const bEnable = (this._state.map && isRuntimeMap(this._state.map)) ?? false;\n        if (bEnable) {\n            this._featureTooltip = new FeatureQueryTooltip(this._map!, {\n                incrementBusyWorker: () => this.incrementBusyWorker(),\n                decrementBusyWorker: () => this.decrementBusyWorker(),\n                onSessionExpired: () => this.onSessionExpired(),\n                getAgentUri: () => this._state.agentUri!,\n                getAgentKind: () => this._state.agentKind,\n                getMapName: () => this._state.mapName!,\n                getSessionId: () => this._state.sessionId!,\n                getLocale: () => this._state.locale,\n                getPointSelectionBox: (pt) => this.getPointSelectionBox(pt, this._state.pointSelectionBuffer),\n                openTooltipLink: (url) => this.onOpenTooltipLink(url)\n            });\n            this._featureTooltip.setEnabled(this._state.featureTooltipsEnabled);\n        }\n    }\n    /**\n     * @override\n     * @param {RefreshMode} [mode=RefreshMode.LayersOnly | RefreshMode.SelectionOnly]\n     * @memberof MapGuideMapProviderContext\n     */\n    public refreshMap(mode: RefreshMode = RefreshMode.LayersOnly | RefreshMode.SelectionOnly): void {\n        assertIsDefined(this._state.mapName);\n        this.refreshMapInternal(this._state.mapName, mode);\n    }\n\n    /**\n     * @override\n     * @protected\n     * @param {MgLayerSetGroup} layerSetGroup\n     * @memberof MapGuideMapProviderContext\n     */\n    protected onBeforeAttachingLayerSetGroup(layerSetGroup: MgLayerSetGroup): void {\n        layerSetGroup.setMapGuideMocking(this.getMockMode());\n    }\n\n    /**\n     *\n     * @virtual\n     * @param {IMapGuideProviderState} nextState\n     * @memberof MapGuideMapProviderContext\n     */\n    public setProviderState(nextState: IMapGuideProviderState): void {\n        // If viewer not mounted yet, just accept the next state and bail\n        if (!this._comp || !this._map) {\n            if (nextState.agentUri) {\n                this._client = new Client(nextState.agentUri, nextState.agentKind);\n            }\n            this._state = nextState;\n            return;\n        }\n        //\n        // React (no pun intended) to prop changes\n        //\n        if (nextState.imageFormat != this._state.imageFormat) {\n            warn(`Unsupported change of props: imageFormat`);\n        }\n        if (nextState.agentUri && nextState.agentUri != this._state.agentUri) {\n            warn(`Unsupported change of props: agentUri`);\n            this._client = new Client(nextState.agentUri, nextState.agentKind);\n        }\n        if (nextState.agentUri && nextState.agentKind != this._state.agentKind) {\n            warn(`Unsupported change of props: agentKind`);\n            this._client = new Client(nextState.agentUri, nextState.agentKind);\n        }\n        let bChangedView = false;\n        //map\n        if (nextState.mapName != this._state.mapName && this._map && this._ovMap) {\n            this.hideAllPopups();\n            const oldLayerSet = this.getLayerSetGroup(this._state.mapName);\n            const newLayerSet = this.ensureAndGetLayerSetGroup(nextState);\n\n            //Clear any stray hover highlighted features as part of switch\n            oldLayerSet?.clearHighlightedFeatures();\n            newLayerSet.clearHighlightedFeatures();\n\n            oldLayerSet?.detach(this._map, this._ovMap);\n            newLayerSet.setMapGuideMocking(this.getMockMode());\n            newLayerSet.attach(this._map, this._ovMap);\n            //This would happen if we switch to a map we haven't visited yet\n            if (!nextState.view) {\n                newLayerSet.fitViewToExtent();\n                bChangedView = true;\n            } else {\n                const layerSet = this.getLayerSetGroup(nextState.mapName);\n                if (layerSet) {\n                    this.applyView(layerSet, nextState.view);\n                }\n            }\n        }\n        //selectionColor\n        if (nextState.selectionColor && nextState.selectionColor != this._state.selectionColor) {\n            const layerSet = this.getLayerSetGroup(nextState.mapName);\n            layerSet?.updateSelectionColor(nextState.selectionColor);\n        }\n        //featureTooltipsEnabled\n        if (nextState.featureTooltipsEnabled != this._state.featureTooltipsEnabled) {\n            this.enableFeatureTooltips(nextState.featureTooltipsEnabled);\n        }\n        //externalBaseLayers\n        if (nextState.externalBaseLayers != null &&\n            nextState.externalBaseLayers.length > 0) {\n            const layerSet = this.getLayerSetGroup(nextState.mapName);\n            layerSet?.updateExternalBaseLayers(nextState.externalBaseLayers);\n        }\n        //Layer transparency\n        if (nextState.layerTransparency && layerTransparencyChanged(nextState.layerTransparency, this._state.layerTransparency)) {\n            const layerSet = this.getLayerSetGroup(nextState.mapName);\n            layerSet?.updateTransparency(nextState.layerTransparency);\n        }\n        //Layer/Group visibility\n        if (nextState.mapName && (areArraysDifferent(nextState.showGroups, this._state.showGroups) ||\n            areArraysDifferent(nextState.hideGroups, this._state.hideGroups) ||\n            areArraysDifferent(nextState.showLayers, this._state.showLayers) ||\n            areArraysDifferent(nextState.hideLayers, this._state.hideLayers))) {\n            this.refreshOnStateChange(nextState.mapName, nextState.showGroups, nextState.showLayers, nextState.hideGroups, nextState.hideLayers);\n        }\n        //view\n        let bViewChanged = false;\n        if (!areViewsCloseToEqual(nextState.view, this._state.view)) {\n            const vw = nextState.view;\n            if (vw != null && !bChangedView) {\n                const layerSet = this.ensureAndGetLayerSetGroup(nextState);\n                this.applyView(layerSet, vw);\n                bViewChanged = true;\n            } else {\n                debug(`Skipping zoomToView as next/current views are close enough or target view is null`);\n            }\n        }\n        //overviewMapElement\n        if (nextState.overviewMapElementSelector) {\n            this.updateOverviewMapElement(nextState.overviewMapElementSelector);\n        }\n        //viewRotation\n        if (this._state.viewRotation != nextState.viewRotation) {\n            this.getOLView().setRotation(nextState.viewRotation);\n        }\n        //viewRotationEnabled\n        if (this._state.viewRotationEnabled != nextState.viewRotationEnabled) {\n            if (this._map) {\n                const view = this.getOLView();\n                const newView = new View({\n                    enableRotation: nextState.viewRotationEnabled,\n                    rotation: nextState.viewRotation,\n                    center: view.getCenter(),\n                    resolution: view.getResolution(),\n                    resolutions: view.getResolutions(),\n                    minResolution: view.getMinResolution(),\n                    maxResolution: view.getMaxResolution(),\n                    maxZoom: view.getMaxZoom(),\n                    minZoom: view.getMinZoom(),\n                    //constrainRotation: view.constrainRotation(),\n                    projection: view.getProjection(),\n                    zoom: view.getZoom()\n                });\n                this._map.setView(newView);\n            }\n        }\n        //activeSelectedFeatureXml\n        const bDiffSelectionXml = this._state.activeSelectedFeatureXml != nextState.activeSelectedFeatureXml;\n        const bRefreshActiveFeatureSelection = !strIsNullOrEmpty(nextState.activeSelectedFeatureXml) && bViewChanged;\n        if (bDiffSelectionXml || bRefreshActiveFeatureSelection) {\n            if (this._map && nextState.map) {\n                const ms = this._map.getSize();\n                if (ms && isRuntimeMap(nextState.map)) {\n                    const nmap = nextState.map;\n                    // We don't want to request for an updated feature selection while there are still rendering operations in progress\n                    // otherwise we may request a feature selection for a map whose internal view has been changed by the in-progress rendering\n                    // operation\n                    const checkReady = () => {\n                        if (this._busyWorkers == 0) {\n                            //console.log(\"Ready to request updated feature selection\");\n                            const view = this.getOLView();\n                            const me: any = view.calculateExtent(ms);\n                            const size = { w: ms[0], h: ms[1] };\n                            this.showSelectedFeature(me, size, nmap, nextState.activeSelectedFeatureColor, nextState.activeSelectedFeatureXml);\n                        } else {\n                            //console.log(\"Still busy. Hold off on request for updated feature selection\");\n                            window.setTimeout(checkReady, 100);\n                        }\n                    };\n                    checkReady();\n                }\n            }\n        }\n\n        this._state = nextState;\n    }\n\n    public setSelectionXml(xml: string, queryOpts?: Partial<IQueryMapFeaturesOptions>, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void): void {\n        if (!this._state.mapName || !this._comp || !this._state.sessionId || !this._state.selectionColor) {\n            return;\n        }\n        //NOTE: A quirk of QUERYMAPFEATURES is that when passing in selection XML (instead of geometry),\n        //you must set the layerattributefilter to the full bit mask otherwise certain features in the\n        //selection XML will not be rendered because they may not pass the layer attribute filter\n        const reqQueryFeatures = 1; //Attributes\n        this.incrementBusyWorker();\n        const mapName = this._state.mapName;\n        const qOrig = {\n            mapname: mapName,\n            session: this._state.sessionId,\n            persist: 1,\n            featurefilter: xml,\n            selectioncolor: this._state.selectionColor,\n            selectionformat: this._state.selectionImageFormat ?? \"PNG8\",\n            maxfeatures: -1,\n            requestdata: reqQueryFeatures\n        };\n        const queryOptions = { ...qOrig, ...queryOpts };\n        const action = queryMapFeatures(mapName, {\n            options: queryOptions,\n            callback: res => {\n                this.decrementBusyWorker();\n                if (success) {\n                    success(res);\n                }\n            },\n            errBack: err => {\n                this.decrementBusyWorker();\n                if (failure) {\n                    failure(err);\n                }\n            }\n        });\n        this._comp.onDispatch(action);\n    }\n\n    public clearSelection(): void {\n        this.setSelectionXml(\"\");\n    }\n\n    public selectByGeometry(geom: Geometry, selectionMethod?: SelectionVariant): void {\n        const options = this.buildDefaultQueryOptions(geom);\n        if (selectionMethod) {\n            options.selectionvariant = selectionMethod;\n        }\n        this.sendSelectionQuery(options);\n    }\n    public queryMapFeatures(options: IQueryMapFeaturesOptions, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void): void {\n        this.sendSelectionQuery(options, success, failure);\n    }\n    public isFeatureTooltipEnabled(): boolean {\n        return this._featureTooltip?.isEnabled() == true;\n    }\n\n    // ================= MapGuide-specific =================== //\n\n\n\n    private sendSelectionQuery(queryOpts?: IQueryMapFeaturesOptions, success?: (res: QueryMapFeaturesResponse) => void, failure?: (err: Error) => void) {\n        if (!this._state.mapName || !this._comp || !this._state.sessionId || !this._state.selectionColor || (queryOpts != null && (queryOpts.layernames ?? []).length == 0)) {\n            return;\n        }\n        this.incrementBusyWorker();\n        const mapName = this._state.mapName;\n        const qOrig: Partial<IQueryMapFeaturesOptions> = {\n            mapname: mapName,\n            session: this._state.sessionId,\n            persist: 1,\n            selectionvariant: \"INTERSECTS\",\n            selectioncolor: this._state.selectionColor,\n            selectionformat: this._state.selectionImageFormat ?? \"PNG8\",\n            maxfeatures: -1\n        };\n        const queryOptions: IQueryMapFeaturesOptions = { ...qOrig, ...queryOpts } as IQueryMapFeaturesOptions;\n        const action = queryMapFeatures(mapName, {\n            options: queryOptions,\n            callback: res => {\n                this.decrementBusyWorker();\n                if (success) {\n                    success(res);\n                }\n            },\n            errBack: err => {\n                this.decrementBusyWorker();\n                if (failure) {\n                    failure(err);\n                }\n            }\n        });\n        this._comp.onDispatch(action);\n    }\n}","import * as React from \"react\";\n\n/**\n * @since 0.13\n */\nexport enum MapGuideMockMode {\n    /**\n     * Render a placeholder image showing the key mapagent parameters\n     */\n    RenderPlaceholder,\n    /**\n     * Do not render anything\n     */\n    DoNotRender\n}\n\n/**\n * The map debug context, used to check if request mocking should be enabled or not\n * @since 0.13\n */\nexport interface IMapDebugContext {\n    mock?: MapGuideMockMode;\n}\n\nexport const MapDebugContext = React.createContext<IMapDebugContext>({});","import * as React from \"react\";\nimport { fmt } from \"../api/i18n\";\nimport { strTrim } from '../utils/string';\n\n/**\n * MouseCoordinates component props\n *\n * @export\n * @interface IMouseCoordinatesProps\n * @extends {React.Props<any>}\n */\nexport interface IMouseCoordinatesProps extends React.Props<any> {\n    format?: string;\n    coords?: [number, number];\n    style?: React.CSSProperties;\n    decimals?: number;\n    units?: string;\n}\n\nfunction formatCoordinates(props: IMouseCoordinatesProps) {\n    const { coords, decimals, format, units } = props;\n    if (coords == null) {\n        return null; //TODO: Use value indicated by EmptyText extension property\n    }\n    const [x, y] = coords;\n    const sfmt = format || \"X: {x}, Y: {y} {units}\";\n    const str = fmt(sfmt, {\n        x: `${decimals != null ? x.toFixed(decimals) : x}`,\n        y: `${decimals != null ? y.toFixed(decimals) : y}`,\n        units: units || \"\"\n    });\n    return <span dangerouslySetInnerHTML={{ __html: strTrim(str) }} />;\n}\n\n/**\n * Displays tracked mouse coordinates\n * @param props\n */\nexport const MouseCoordinates = (props: IMouseCoordinatesProps) => {\n    return <div className=\"status-bar-component component-mouse-coordinates\" style={props.style}>{formatCoordinates(props)}</div>;\n};","import * as React from \"react\";\nimport { tr } from \"../api/i18n\";\n// According to this (https://github.com/mzabriskie/react-draggable/issues/246#issuecomment-299698481), typings\n// only works if module type is \"es6\". This is not the case for us, so just use untyped require()\nimport Draggable from \"react-draggable\";\nimport { getFiniteScaleIndexForScale } from \"../utils/number\";\nimport {\n    IMG_SLIDER,\n    IMG_SLIDER_SCALE,\n    GIF_SPINNER\n} from \"../constants/assets\";\n\nexport enum ZoomDirection {\n    In,\n    Out\n}\n\nexport enum PanDirection {\n    East,\n    West,\n    South,\n    North\n}\n\ninterface DraggableData {\n    node: HTMLElement;\n    // lastX + deltaX === x\n    x: number;\n    y: number;\n    deltaX: number;\n    deltaY: number;\n    lastX: number;\n    lastY: number;\n};\n\nconst VERT_START = 10;\nconst VERT_SPAN = 81;  //This is the pixel height of the maximum draggable scale range\n\nconst LN9 = Math.log(9);\n\n/**\n * Navigator component props\n *\n * @export\n * @interface INavigatorProps\n * @extends {React.Props<any>}\n */\nexport interface INavigatorProps extends React.Props<any> {\n    style?: React.CSSProperties;\n    busy: boolean;\n    scale: number;\n    /**\n     * A list of finite scales. Set when the map contains base (tiled) layers. When set, slider drags will snap to the values\n     * in this list. Zooming in and out will move to the next/previous finite scale instead of the default logarithmic calculation\n     *\n     * @type {number[]}\n     * @memberOf INavigatorProps\n     */\n    finiteScaleList?: number[];\n    locale?: string;\n    onZoom: (direction: ZoomDirection) => void;\n    onPan: (direction: PanDirection) => void;\n    onRequestZoomToScale: (scale: number) => void;\n}\n\nfunction calculatePosForScale(scale: number, finiteScaleList?: number[]): number {\n    if (finiteScaleList) {\n        const index = getFiniteScaleIndexForScale(finiteScaleList, scale);\n        const pos = (VERT_SPAN / finiteScaleList.length) * (index + 1);\n        //console.log(`Scale: ${scale} @ ${index} / ${finiteScaleList.length} -> ${Math.floor(pos)}`);\n        return Math.floor(pos);\n    } else {\n        const pos = 9 * Math.log(scale) / LN9;\n        return Math.floor(pos);\n    }\n}\n\nfunction calculateScaleForPos(pos: number, finiteScaleList?: number[]): number {\n    const scale = Math.pow(9, pos / 9);\n    if (finiteScaleList) {\n        const index = getFiniteScaleIndexForScale(finiteScaleList, scale);\n        return finiteScaleList[index];\n    } else {\n        return scale;\n    }\n}\n\n/**\n * The Navigator component provides an interactive zoom slider for the map viewer\n * @param props \n */\nexport const Navigator = (props: INavigatorProps) => {\n    const { busy, locale } = props;\n    const onPanEast = () => {\n        props.onPan(PanDirection.East);\n    };\n    const onPanWest = () => {\n        props.onPan(PanDirection.West);\n    };\n    const onPanSouth = () => {\n        props.onPan(PanDirection.South);\n    };\n    const onPanNorth = () => {\n        props.onPan(PanDirection.North);\n    };\n    const onZoomOut = () => {\n        props.onZoom(ZoomDirection.Out);\n    };\n    const onZoomIn = () => {\n        props.onZoom(ZoomDirection.In);\n    };\n    const onStart = (e: MouseEvent) => {\n        e.preventDefault();\n        //console.log(`Drag start (dy: ${data.deltaY})`);\n        setIsDragging(true);\n        setPreviewPos(pos);\n    };\n    const onDrag = (e: MouseEvent, data: DraggableData) => {\n        e.preventDefault();\n        //console.log(`Dragging (dy: ${data.deltaY})`);\n        const pos = previewPos;\n        setPreviewPos(pos + data.deltaY);\n    };\n    const onStop = (e: MouseEvent) => {\n        e.preventDefault();\n        const newScale = calculateScaleForPos(previewPos);\n        //console.log(`posDelta: ${posDelta}`);\n        setIsDragging(false);\n        setPos(previewPos);\n        props.onRequestZoomToScale(newScale);\n    };\n    //Used to specify the preview destination scale \"position\"\n    const [previewPos, setPreviewPos] = React.useState(calculatePosForScale(props.scale, props.finiteScaleList));\n    //Used to specify the current scale \"position\"\n    const [pos, setPos] = React.useState(calculatePosForScale(props.scale, props.finiteScaleList));\n    const [isDragging, setIsDragging] = React.useState(false);\n    React.useEffect(() => {\n        const pos = calculatePosForScale(props.scale, props.finiteScaleList);\n        setPos(pos);\n        setPreviewPos(pos);\n    }, [props.scale, props.finiteScaleList]);\n    return <div id=\"Navigator\" style={props.style} className=\"component-navigator noselect\">\n        <map name=\"Navigator_ImageMap\" id=\"Navigator_ImageMap\">\n            <area onClick={onPanEast} shape=\"poly\" alt={tr(\"NAVIGATOR_PAN_EAST\", locale)} title={tr(\"NAVIGATOR_PAN_EAST\", locale)} coords=\"27,176, 27,177, 40,190, 44,182, 44,159\" />\n            <area onClick={onPanWest} shape=\"poly\" alt={tr(\"NAVIGATOR_PAN_WEST\", locale)} title={tr(\"NAVIGATOR_PAN_WEST\", locale)} coords=\"24,177, 24,176, 7,159, 7,182, 11,190\" />\n            <area onClick={onPanSouth} shape=\"poly\" alt={tr(\"NAVIGATOR_PAN_SOUTH\", locale)} title={tr(\"NAVIGATOR_PAN_SOUTH\", locale)} coords=\"25,178, 12,191, 21,197, 30,197, 39,191, 26,178\" />\n            <area onClick={onPanNorth} shape=\"poly\" alt={tr(\"NAVIGATOR_PAN_NORTH\", locale)} title={tr(\"NAVIGATOR_PAN_NORTH\", locale)} coords=\"26,175, 43,158, 8,158, 25,175\" />\n            <area onClick={onZoomOut} shape=\"circle\" alt={tr(\"NAVIGATOR_ZOOM_OUT\", locale)} title={tr(\"NAVIGATOR_ZOOM_OUT\", locale)} coords=\"25,142,8\" />\n            <area onClick={onZoomIn} shape=\"circle\" alt={tr(\"NAVIGATOR_ZOOM_IN\", locale)} title={tr(\"NAVIGATOR_ZOOM_IN\", locale)} coords=\"25,34,8\" />\n        </map>\n        <img src={IMG_SLIDER_SCALE} className=\"png24\" width=\"51\" height=\"201\" useMap=\"#Navigator_ImageMap\" style={{ position: \"absolute\", left: 0, top: 0 }} />\n        <div style={{ position: \"absolute\", top: 6, left: 6, width: 39, height: 16 }}>\n            <img src={GIF_SPINNER} className=\"navigator-spinner\" width=\"18\" height=\"6\" style={{ position: \"absolute\", top: 3, right: 4, visibility: busy ? \"visible\" : \"hidden\" }} />\n        </div>\n        {/*\n            NOTE: pos is the displacement from VERT_START instead of 0. This ensures\n            at the lowest possible scale, the slider doesn't \"cross over\" the (+) button\n        */}\n        <Draggable axis=\"y\"\n            handle=\"img.navigator-drag-handle\"\n            position={{ x: 0, y: (VERT_START + pos) }}\n            bounds={{ top: VERT_START, bottom: (VERT_START + VERT_SPAN), left: 0, right: 0 }}\n            onStart={onStart}\n            onDrag={onDrag}\n            onStop={onStop}>\n            <div>\n                <img src={IMG_SLIDER} className=\"png24 navigator-drag-handle\" width=\"29\" height=\"12\" style={{ position: \"relative\", left: 11, top: 28 }} />\n                {(() => {\n                    if (isDragging === true) {\n                        const dragLabel = tr(\"FMT_NAVIGATOR_ZOOM_TO_SCALE\", props.locale, { scale: calculateScaleForPos(previewPos).toFixed(2) });\n                        return <div className=\"tooltip\" style={{ position: \"relative\", width: 170, right: 190, top: 28, textAlign: \"right\" }}>{dragLabel}</div>;\n                    }\n                })()}\n            </div>\n        </Draggable>\n    </div>;\n}","import * as React from \"react\";\nimport {\n    GenericEvent,\n    IMapView\n} from \"../api/common\";\nimport { tr } from \"../api/i18n\";\nimport { getFiniteScaleIndexForScale } from \"../utils/number\";\n\n/**\n * ScaleDisplay component props\n *\n * @export\n * @interface IScaleDisplayProps\n */\nexport interface IScaleDisplayProps {\n    style?: React.CSSProperties;\n    view: IMapView;\n    finiteScales?: number[] | null;\n    locale: string;\n    onScaleChanged: (scale: number) => void;\n}\n\n/**\n * A component that displays the map scale\n * @param props \n */\nexport const ScaleDisplay = (props: IScaleDisplayProps) => {\n    const { view, style, locale, finiteScales, onScaleChanged } = props;\n    const [localScale, setLocalScale] = React.useState<number | undefined>(undefined);\n    const onFiniteScaleChanged = (e: GenericEvent) => onScaleChanged?.(parseFloat(e.target.value));\n    const onScaleKeyPressed = (e: GenericEvent) => {\n        if (e.key == 'Enter' && localScale) {\n            onScaleChanged?.(localScale);\n        }\n    };\n    const onScaleInputChanged = (e: GenericEvent) => setLocalScale(parseFloat(e.target.value));\n    React.useEffect(() => {\n        if (!finiteScales && view && view.scale != localScale) {\n            setLocalScale(view.scale);\n        }\n    }, [finiteScales, view]);\n    const label = tr(\"FMT_SCALE_DISPLAY\", locale, {\n        scale: \"\"\n    });\n    if (finiteScales) {\n        const fi = getFiniteScaleIndexForScale(finiteScales, view.scale);\n        const fiScale = finiteScales[fi];\n        //NOTE: Not using BP styled HTML select as the size imposed is not acceptable\n        return <div className=\"status-bar-component component-scale-display\" style={style}>\n            {label} <select className=\"scale-input\" value={fiScale} onChange={onFiniteScaleChanged}>\n                {finiteScales.map(s => {\n                    return <option key={s} value={s}>{s}</option>;\n                })}\n            </select>\n        </div>;\n    } else {\n        return <div className=\"status-bar-component component-scale-display\" style={style}>\n            {label} <input className=\"scale-input\" type=\"number\" value={localScale || \"\"} onChange={onScaleInputChanged} onKeyPress={onScaleKeyPressed} />\n        </div>;\n    }\n}","import * as React from \"react\";\nimport { tr, fmt } from \"../api/i18n\";\n\n/**\n * SelectedFeatureCount component props\n *\n * @export\n * @interface ISelectedFeatureCountProps\n */\nexport interface ISelectedFeatureCountProps {\n    summary?: {\n        total: number;\n        layerCount: number;\n    },\n    locale?: string;\n    format?: string;\n    style?: React.CSSProperties;\n}\n\n/**\n * Displays the number of selected features on the map\n */\nexport const SelectedFeatureCount = (props: ISelectedFeatureCountProps) => {\n    const format = props.format || tr(\"FMT_SELECTION_COUNT\", props.locale);\n    let label: string | undefined;\n    if (props.summary) {\n        label = fmt(format, props.summary);\n    }\n    return <div className=\"status-bar-component component-selected-feature-count\" style={props.style}>{label}</div>;\n};","import * as React from \"react\";\nimport { SelectedFeatureSet, SelectedFeature, LayerMetadata, SelectedLayer, FeatureProperty } from \"../api/contracts/query\";\nimport { Toolbar, IItem, DEFAULT_TOOLBAR_SIZE, TOOLBAR_BACKGROUND_COLOR } from \"./toolbar\";\nimport { tr as xlate, DEFAULT_LOCALE } from \"../api/i18n\";\nimport { GenericEvent, ICompositeSelection } from \"../api/common\";\nimport { Callout, Intent, HTMLSelect } from '@blueprintjs/core';\nimport { strIsNullOrEmpty } from \"../utils/string\";\n\nexport interface ISelectedFeatureProps {\n    selectedFeature: SelectedFeature;\n    selectedLayer?: LayerMetadata;\n    locale: string;\n    allowHtmlValues: boolean;\n    cleanHTML?: (html: string) => string;\n}\n\nconst DefaultSelectedFeature = (props: ISelectedFeatureProps) => {\n    const { selectedFeature, selectedLayer, locale, allowHtmlValues, cleanHTML } = props;\n    const featureProps = [] as FeatureProperty[];\n    if (selectedLayer?.Property) {\n        for (const lp of selectedLayer.Property) {\n            const matches = selectedFeature.Property.filter(fp => fp.Name === lp.DisplayName);\n            if (matches.length === 1) {\n                featureProps.push(matches[0]);\n            }\n        }\n    } else {\n        for (const fp of selectedFeature.Property) {\n            featureProps.push(fp);\n        }\n    }\n    return <table className=\"selection-panel-property-grid bp3-html-table bp3-html-table-condensed bp3-html-table-bordered\">\n        <thead>\n            <tr>\n                <th>{xlate(\"SELECTION_PROPERTY\", locale)}</th>\n                <th>{xlate(\"SELECTION_VALUE\", locale)}</th>\n            </tr>\n        </thead>\n        <tbody>\n            {featureProps.map(prop => {\n                return <tr key={prop.Name}>\n                    <td className=\"property-name-cell\" data-property-name={prop.Name}>{prop.Name}</td>\n                    {(() => {\n                        let value = prop.Value;\n                        if (allowHtmlValues && !strIsNullOrEmpty(value)) {\n                            if (cleanHTML) {\n                                value = cleanHTML(value);\n                            }\n                            return <td className=\"property-value-cell\" data-property-value-for={prop.Name} dangerouslySetInnerHTML={{ __html: value }} />\n                        } else {\n                            return <td className=\"property-value-cell\" data-property-value-for={prop.Name}>{prop.Value}</td>;\n                        }\n                    })()}\n                </tr>;\n            })}\n        </tbody>\n    </table>;\n};\n\n/**\n * SelectionPanel component props\n *\n * @export\n * @interface ISelectionPanelProps\n */\nexport interface ISelectionPanelProps {\n    locale?: string;\n    /**\n     * @since 0.14\n     */\n    selection: ICompositeSelection;\n    onResolveLayerLabel?: (layerId: string, layerName: string) => string | undefined;\n    onRequestZoomToFeature: (feat: SelectedFeature) => void;\n    onShowSelectedFeature: (layerId: string, selectionKey: string) => void;\n    maxHeight?: number;\n    selectedFeatureRenderer?: (props: ISelectedFeatureProps) => JSX.Element;\n    /**\n     * Controls whether HTML values are allowed be rendered in property values\n     * \n     * @since 0.11\n     * @type {boolean}\n     * @memberof ISelectionPanelProps\n     */\n    allowHtmlValues: boolean;\n    /**\n     * If allowHtmlValues = true, defines a custom function for sanitizing the given HTML string\n     * to guard against cross-site scripting attacks. You are strongly recommended to provide\n     * a santitization function if your HTML property values come from an un-trusted source\n     * \n     * @since 0.11\n     * @memberof ISelectionPanelProps\n     */\n    cleanHTML?: (html: string) => string;\n}\n\ninterface ISelectionPanel {\n    locale: string;\n    canGoPrev(): boolean;\n    canGoNext(): boolean;\n    prevFeature(): void;\n    nextFeature(): void;\n    canZoomSelectedFeature(): boolean;\n    zoomSelectedFeature(): void;\n}\n\nfunction buildToolbarItems(selPanel: ISelectionPanel): IItem[] {\n    return [\n        {\n            bpIconName: \"arrow-left\",\n            tooltip: xlate(\"SELECTION_PREV_FEATURE\", selPanel.locale),\n            enabled: () => selPanel.canGoPrev(),\n            invoke: () => selPanel.prevFeature()\n        },\n        {\n            bpIconName: \"arrow-right\",\n            tooltip: xlate(\"SELECTION_NEXT_FEATURE\", selPanel.locale),\n            enabled: () => selPanel.canGoNext(),\n            invoke: () => selPanel.nextFeature()\n        },\n        { isSeparator: true },\n        {\n            bpIconName: \"path-search\",\n            tooltip: xlate(\"SELECTION_ZOOMTO_FEATURE\", selPanel.locale),\n            enabled: () => selPanel.canZoomSelectedFeature(),\n            invoke: () => selPanel.zoomSelectedFeature()\n        }\n    ];\n}\n\nconst SELECTION_TOOLBAR_STYLE: React.CSSProperties = { float: \"right\", height: DEFAULT_TOOLBAR_SIZE };\nconst SELECTION_PANEL_TOOLBAR_STYLE: React.CSSProperties = { height: DEFAULT_TOOLBAR_SIZE, backgroundColor: TOOLBAR_BACKGROUND_COLOR };\nconst LAYER_COMBO_STYLE: React.CSSProperties = { float: \"left\", height: DEFAULT_TOOLBAR_SIZE };\nconst FloatClear = () => <div style={{ clear: \"both\" }} />;\n\n\n\n/**\n * Displays attributes of selected features with the ability to zoom in on selected features\n * @param props \n */\nexport const SelectionPanel = (props: ISelectionPanelProps) => {\n    const {\n        maxHeight,\n        selection,\n        selectedFeatureRenderer,\n        allowHtmlValues,\n        cleanHTML,\n        onShowSelectedFeature,\n        onRequestZoomToFeature\n    } = props;\n    const [selectedLayerIndex, setSelectedLayerIndex] = React.useState(-1);\n    const [featureIndex, setFeatureIndex] = React.useState(-1);\n    React.useEffect(() => {\n        if (selection.getLayerCount() > 0) {\n            if (selectedLayerIndex < 0) {\n                setSelectedLayerIndex(0);\n                setFeatureIndex(0);\n            } else {\n                const sl = selection.getLayerAt(selectedLayerIndex);\n                if (!sl) {\n                    setSelectedLayerIndex(0);\n                    setFeatureIndex(0);\n                } else {\n                    if (featureIndex < 0 && sl.getFeatureCount() > 0) {\n                        setFeatureIndex(0);\n                    }\n                }\n            }\n        }\n    }, [selection]);\n    const getCurrentLayer = () => {\n        return selection.getLayerAt(selectedLayerIndex);\n    };\n    const getFeatureAt = (index: number) => {\n        return selection.getFeatureAt(selectedLayerIndex, index);\n    };\n    const getCurrentFeature = () => {\n        return getFeatureAt(featureIndex);\n    };\n    const canGoPrev = (): boolean => {\n        return featureIndex > 0;\n    };\n    const canGoNext = (): boolean => {\n        const layer = getCurrentLayer();\n        if (layer != null) {\n            return featureIndex + 1 < layer.getFeatureCount();\n        }\n        return false;\n    };\n    const canZoomSelectedFeature = (): boolean => {\n        const feat = getCurrentFeature();\n        return feat?.Bounds != null;\n    };\n    const prevFeature = () => {\n        const newIndex = featureIndex - 1;\n        setFeatureIndex(newIndex);\n        const layer = getCurrentLayer();\n        if (layer) {\n            const layerId = layer.getLayerId();\n            const sKey = getFeatureAt(newIndex)?.SelectionKey;\n            if (sKey && layerId) {\n                onShowSelectedFeature?.(layerId, sKey);\n            }\n        }\n    };\n    const nextFeature = () => {\n        const newIndex = featureIndex + 1;\n        setFeatureIndex(newIndex);\n        const layer = getCurrentLayer();\n        if (layer) {\n            const layerId = layer.getLayerId();\n            const sKey = getFeatureAt(newIndex)?.SelectionKey;\n            if (sKey && layerId) {\n                onShowSelectedFeature?.(layerId, sKey);\n            }\n        }\n    };\n    const zoomSelectedFeature = () => {\n        const feat = getCurrentFeature();\n        if (feat) {\n            onRequestZoomToFeature(feat);\n        }\n    };\n    const onSelectedLayerChanged = (e: GenericEvent) => {\n        setSelectedLayerIndex(e.target.value);\n        setFeatureIndex(0);\n    };\n    const locale = props.locale || DEFAULT_LOCALE;\n    let feat: SelectedFeature | undefined;\n    let meta: LayerMetadata | undefined;\n    if (selection != null && selectedLayerIndex >= 0 && featureIndex >= 0) {\n        const selLayer = selection.getLayerAt(selectedLayerIndex);\n        feat = selLayer?.getFeatureAt(featureIndex);\n        meta = selLayer?.getLayerMetadata();\n    }\n    let selBodyStyle: React.CSSProperties | undefined;\n    if (maxHeight) {\n        selBodyStyle = {\n            overflowY: \"auto\",\n            maxHeight: maxHeight - DEFAULT_TOOLBAR_SIZE\n        };\n    } else {\n        selBodyStyle = {\n            overflow: \"auto\",\n            position: \"absolute\",\n            top: DEFAULT_TOOLBAR_SIZE,\n            bottom: 0,\n            right: 0,\n            left: 0\n        }\n    }\n    return <div>\n        {(() => {\n            if (selection?.getLayerCount() > 0) {\n                const selectionToolbarItems = buildToolbarItems({\n                    locale,\n                    canGoPrev,\n                    canGoNext,\n                    prevFeature,\n                    nextFeature,\n                    canZoomSelectedFeature,\n                    zoomSelectedFeature\n                });\n                return <div className=\"selection-panel-toolbar\" style={SELECTION_PANEL_TOOLBAR_STYLE}>\n                    <div className=\"bp3-select selection-panel-layer-selector\">\n                        <HTMLSelect value={selectedLayerIndex} style={LAYER_COMBO_STYLE} onChange={onSelectedLayerChanged}>\n                            {selection.getLayers().map((layer, index) => {\n                                const lid = layer.getLayerId();\n                                const lname = layer.getName();\n                                const lkey = lid ?? index;\n                                const label = lid ? (props?.onResolveLayerLabel?.(lid, lname) ?? lname)\n                                    : lname;\n                                return <option key={`selected-layer-${lkey}`} value={`${index}`}>{label}</option>\n                            })}\n                        </HTMLSelect>\n                    </div>\n                    <Toolbar childItems={selectionToolbarItems} containerStyle={SELECTION_TOOLBAR_STYLE} />\n                    <FloatClear />\n                </div>;\n            }\n        })()}\n        <div className=\"selection-panel-body\" style={selBodyStyle}>\n            {(() => {\n                if (feat) {\n                    if (selectedFeatureRenderer) {\n                        return selectedFeatureRenderer({ selectedFeature: feat, cleanHTML: cleanHTML, allowHtmlValues: allowHtmlValues, selectedLayer: meta, locale: locale });\n                    } else {\n                        return <DefaultSelectedFeature selectedFeature={feat} cleanHTML={cleanHTML} allowHtmlValues={allowHtmlValues} selectedLayer={meta} locale={locale} />;\n                    }\n                } else if (!(selection?.getLayerCount() > 0)) {\n                    return <Callout intent={Intent.PRIMARY} icon=\"info-sign\">\n                        <p className=\"selection-panel-no-selection\">{xlate(\"NO_SELECTED_FEATURES\", locale)}</p>\n                    </Callout>;\n                }\n            })()}\n        </div>\n    </div>;\n}","import { Client } from '../api/client';\nexport class SessionKeepAlive {\n    private getSession: () => string;\n    private client: Client;\n    private interval: number;\n    private timeoutID: any;\n    constructor(getSession: () => string, client: Client, onSessionExpired: () => void, private check: boolean) {\n        this.getSession = getSession;\n        this.client = client;\n        if (this.check) {\n            this.client.getServerSessionTimeout(this.getSession()).then(tm => {\n                this.interval = tm / 5 * 1000; //Ping server 5 times each period. Timeout is returned in seconds.\n                this.timeoutID = setTimeout(this.tick.bind(this), this.interval);\n            });\n        }\n    }\n    public dispose() {\n        clearTimeout(this.timeoutID);\n    }\n    private tick(): void {\n        this.client.getServerSessionTimeout(this.getSession()).then(tm => {\n            this.timeoutID = setTimeout(this.tick.bind(this), this.interval);\n        });\n    }\n    public lastTry(): Promise<number> {\n        if (this.check) {\n            return this.client.getServerSessionTimeout(this.getSession());\n        } else {\n            return Promise.resolve(-1);\n        }\n    }\n}\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport {\n    Toolbar,\n    IItem,\n    IFlyoutMenu,\n    DEFAULT_TOOLBAR_SIZE,\n    TOOLBAR_BACKGROUND_COLOR\n} from \"./toolbar\";\nimport { PlaceholderComponent } from \"../api/registry/component\";\nimport { tr } from \"../api/i18n\";\nimport {\n    GenericEvent,\n    IDOMElementMetrics,\n    FlyoutVisibilitySet\n} from \"../api/common\";\nimport { parseComponentUri } from \"../utils/url\";\nimport { Intent, NonIdealState, Spinner } from '@blueprintjs/core';\nimport { FUSION_TASKPANE_NAME, WEBLAYOUT_TASKMENU } from '../constants';\n\nexport const TASK_PANE_OVERLAY_BGCOLOR = \"#dee8f9\";\n\nfunction currentUrlDoesNotMatchMapName(currentUrl: string, mapName: string | undefined): boolean {\n    const normUrl = currentUrl.toLowerCase();\n    //Only invalidate if url has mapname and it doesn't match our current one\n    if (normUrl.indexOf(\"mapname=\") >= 0 && mapName) {\n        return normUrl.indexOf(`mapname=${mapName.toLowerCase()}`) < 0;\n    } else {\n        return false;\n    }\n}\n\n/**\n * TaskPane component props\n *\n * @export\n * @interface ITaskPaneProps\n */\nexport interface ITaskPaneProps {\n    currentUrl?: string;\n    mapName?: string;\n    session?: string;\n    locale: string;\n    homeAction: IItem;\n    backAction: IItem;\n    forwardAction: IItem;\n    onUrlLoaded: (url: string) => void;\n    lastUrlPushed?: boolean;\n    showTaskBar: boolean;\n    maxHeight?: number;\n    flyoutStates?: FlyoutVisibilitySet;\n    onOpenFlyout: (id: string, metrics: IDOMElementMetrics) => void;\n    onCloseFlyout: (id: string) => void;\n}\n\n// HACK:\n//\n// Having the lastUrlPushed props sounds extremely hacky, but we need a way to signal that\n// the url its about to receive was pushed and should not be reloaded into the internal iframe\n//\n// This is because we want internal url transitions (eg. Clicking a link, submitting a form) to\n// be recorded in the navigation stack so we can properly go back/forward just like a web browser.\n// But we don't want these recorded URLs to accidentally trigger a re-load of the same url.\n\n/**\n * A component that serves as a generic container for content or User Interface for custom functionality\n *\n * @export\n * @class TaskPane\n * @extends {React.Component<ITaskPaneProps, any>}\n */\nexport class TaskPane extends React.Component<ITaskPaneProps, any> {\n    private _iframe: HTMLIFrameElement;\n    private taskButtons: IItem[];\n    constructor(props: ITaskPaneProps) {\n        super(props);\n        this.taskButtons = [\n            props.homeAction,\n            { isSeparator: true },\n            props.backAction,\n            props.forwardAction\n        ];\n        this.state = {\n            activeComponent: null,\n            invalidated: false,\n            frameContentLoaded: false\n        };\n    }\n    private onCloseFlyout = (id: string) => this.props.onCloseFlyout?.(id);\n    private onOpenFlyout = (id: string, metrics: IDOMElementMetrics) => this.props.onOpenFlyout?.(id, metrics);\n    private onFrameMounted = (iframe: HTMLIFrameElement) => {\n        this._iframe = iframe;\n        if (this._iframe) {\n            const el = ReactDOM.findDOMNode(this._iframe);\n            //This is needed for backcompat with certain fusion widgets\n            (el as any).taskPaneId = FUSION_TASKPANE_NAME;\n        }\n    }\n    private onFrameLoaded = (e: GenericEvent) => {\n        const frame = e.currentTarget;\n        if (frame.contentWindow) {\n            this.setState({ frameContentLoaded: true });\n            this.props.onUrlLoaded(frame.contentWindow.location.href);\n        }\n    }\n    componentDidUpdate(prevProps: ITaskPaneProps) {\n        const nextProps = this.props;\n        if (prevProps.currentUrl != nextProps.currentUrl) {\n            if (nextProps.currentUrl && nextProps.lastUrlPushed === false) {\n                this.loadUrl(nextProps.currentUrl);\n            }\n        }\n        if (!this.state.invalidated && nextProps.currentUrl && nextProps.currentUrl.indexOf(\"component://\") != 0 && currentUrlDoesNotMatchMapName(nextProps.currentUrl, nextProps.mapName)) {\n            //TODO: If we want to be smart, we could have the TaskPane amend the currentUrl with the new map name\n            this.setState({ invalidated: true });\n        } else if (this.state.invalidated && nextProps.currentUrl && (nextProps.currentUrl.indexOf(\"component://\") == 0 || !currentUrlDoesNotMatchMapName(nextProps.currentUrl, nextProps.mapName))) {\n            this.setState({ invalidated: false });\n        }\n    }\n    componentDidMount() {\n        if (this.props.currentUrl) {\n            this.loadUrl(this.props.currentUrl);\n        }\n    }\n    loadUrl(url: string) {\n        //TODO: Can't convert this to functional component with hooks, until this type\n        //of pattern is possible\n        const compUri = parseComponentUri(url);\n        if (compUri) {\n            this.setState({ activeComponent: compUri.name, activeComponentProps: compUri.props });\n        } else {\n            this.setState({ activeComponent: null, frameContentLoaded: false }, () => {\n                if (this._iframe) {\n                    this._iframe.contentWindow?.location.replace(url);\n                }\n            });\n        }\n    }\n    render(): JSX.Element {\n        const { invalidated, activeComponent } = this.state;\n        const { locale, maxHeight, showTaskBar } = this.props;\n        const taskMenu: IFlyoutMenu = {\n            label: tr(\"MENU_TASKS\", locale),\n            flyoutAlign: \"bottom left\",\n            flyoutId: WEBLAYOUT_TASKMENU\n        };\n        const rootStyle: React.CSSProperties = {};\n        const taskBarStyle: React.CSSProperties = {\n            height: DEFAULT_TOOLBAR_SIZE,\n            backgroundColor: TOOLBAR_BACKGROUND_COLOR\n        };\n        const taskBodyStyle: React.CSSProperties = {};\n        const taskFrameStyle: React.CSSProperties = {\n            border: \"none\"\n        };\n        const taskComponentContainerStyle: React.CSSProperties = {\n            border: \"none\"\n        };\n        if (!maxHeight) {\n            rootStyle.width = \"100%\";\n            rootStyle.height = \"100%\";\n\n            taskBarStyle.position = \"absolute\";\n            taskBarStyle.top = 0;\n            taskBarStyle.left = 0;\n            taskBarStyle.right = 0;\n\n            taskBodyStyle.position = \"absolute\";\n            taskBodyStyle.top = (showTaskBar === true ? DEFAULT_TOOLBAR_SIZE : 0);\n            taskBodyStyle.left = 0;\n            taskBodyStyle.right = 0;\n            taskBodyStyle.bottom = 0;\n            taskBodyStyle.overflow = \"hidden\";\n\n            taskFrameStyle.width = \"100%\";\n            taskFrameStyle.height = \"100%\";\n\n            taskComponentContainerStyle.width = \"100%\";\n            taskComponentContainerStyle.height = \"100%\";\n        } else {\n            taskFrameStyle.width = \"100%\";\n            taskFrameStyle.height = (showTaskBar === true ? (maxHeight - DEFAULT_TOOLBAR_SIZE) : maxHeight);\n\n            taskComponentContainerStyle.width = \"100%\";\n            taskComponentContainerStyle.maxHeight = (showTaskBar === true ? (maxHeight - DEFAULT_TOOLBAR_SIZE) : maxHeight);\n            taskComponentContainerStyle.overflowY = \"auto\";\n        }\n        return <div style={rootStyle}>\n            {(() => {\n                if (showTaskBar === true) {\n                    return <div style={taskBarStyle}>\n                        <Toolbar childItems={this.taskButtons} containerStyle={{ float: \"left\", height: DEFAULT_TOOLBAR_SIZE }} onCloseFlyout={this.onCloseFlyout} onOpenFlyout={this.onOpenFlyout} flyoutStates={this.props.flyoutStates} />\n                        <Toolbar childItems={[taskMenu]} containerStyle={{ float: \"right\", height: DEFAULT_TOOLBAR_SIZE }} onCloseFlyout={this.onCloseFlyout} onOpenFlyout={this.onOpenFlyout} flyoutStates={this.props.flyoutStates} />\n                        <div style={{ clear: \"both\" }} />\n                    </div>;\n                }\n            })()}\n            <div style={taskBodyStyle}>\n                {(() => {\n                    if (activeComponent != null) {\n                        const cpp = this.state.activeComponentProps;\n                        taskComponentContainerStyle.overflowY = \"auto\";\n                        return <div style={taskComponentContainerStyle}>\n                            <PlaceholderComponent id={activeComponent} componentProps={cpp} locale={this.props.locale} />\n                        </div>\n                    } else {\n                        const { frameContentLoaded } = this.state;\n                        const components = [\n                            <iframe key=\"taskPaneFrame\" name=\"taskPaneFrame\" ref={this.onFrameMounted} onLoad={this.onFrameLoaded} style={taskFrameStyle}>\n                            </iframe>\n                        ];\n                        if (frameContentLoaded == false) {\n                            components.push(<div key=\"taskPaneFrameLoadingOverlay\" style={{ position: \"absolute\", left: 0, right: 0, top: 0, bottom: 0, backgroundColor: TASK_PANE_OVERLAY_BGCOLOR }}>\n                                <NonIdealState \n                                    icon={<Spinner intent={Intent.NONE} size={Spinner.SIZE_LARGE} />}\n                                    title={tr(\"TASK_PANE_LOADING\", locale)}\n                                    description={tr(\"TASK_PANE_LOADING_DESC\", locale)} />\n                            </div>);\n                        }\n                        return components;\n                    }\n                })()}\n                <iframe name=\"scriptFrame\" style={{ width: 0, height: 0, visibility: \"hidden\" }}></iframe>\n            </div>\n        </div>;\n    }\n}","import * as React from \"react\";\nimport { isMenuRef, isComponentFlyout } from \"../utils/type-guards\";\nimport { IDOMElementMetrics, FlyoutVisibilitySet, GenericEvent } from \"../api/common\";\nimport { ToolbarContext } from \"./context\";\nimport { STR_EMPTY } from \"../utils/string\";\nimport { ImageIcon } from \"./icon\";\nimport {\n    BlueprintSvgIconNames\n} from \"../constants/assets\";\nimport { Icon } from '@blueprintjs/core';\nimport { NBSP } from '../constants';\n\nexport const DEFAULT_TOOLBAR_SIZE = 29;\nexport const TOOLBAR_BACKGROUND_COLOR = \"#f0f0f0\";\n\n// Custom type guard to workaround: https://github.com/microsoft/TypeScript/issues/39879\nfunction isNumeric(arg: any): arg is number {\n    return typeof(arg) == 'number';\n}\n\n// Size is based on the default toolbar height of 29 (with base image icon size of 16x16)\n// This ratio will help \"scale\" SVG icons to match\nconst SVG_SIZE_RATIO = 16 / DEFAULT_TOOLBAR_SIZE;\n\nfunction getSelected(item: IItem): boolean {\n    const sel = item.selected;\n    if (sel != null) {\n        if (typeof sel === 'function') {\n            return sel();\n        } else {\n            return sel;\n        }\n    }\n    return false;\n}\n\nexport function getEnabled(item: IItem): boolean {\n    const en = item.enabled;\n    if (en != null) {\n        if (typeof en === 'function') {\n            return en();\n        } else {\n            return en;\n        }\n    }\n    return true;\n}\n\nfunction getIconElement(item: IItem, enabled: boolean, size: number): React.ReactNode {\n    const iconStyle = getIconStyle(enabled, size);\n    if (item.iconClass || item.icon) {\n        return <ImageIcon style={iconStyle} url={item.icon} spriteClass={item.iconClass} />\n    } else if (item.bpIconName) {\n        const { opacity } = iconStyle; //For SVG, we only care about opacity\n        return <Icon style={{ opacity }} icon={item.bpIconName} iconSize={size * SVG_SIZE_RATIO} />\n    } else {\n        return <></>;\n    }\n}\n\nfunction getFlyoutIconElement(isFlownOut: boolean | undefined, size: number) {\n    return <Icon icon={isFlownOut ? \"chevron-up\" : \"chevron-down\"} iconSize={size * SVG_SIZE_RATIO} />\n}\n\nfunction getTooltip(item: IItem): string {\n    const tt = item.tooltip;\n    if (tt != null) {\n        if (typeof tt === 'function') {\n            return tt();\n        } else {\n            return tt;\n        }\n    }\n    return STR_EMPTY;\n}\n\nexport function getIconStyle(enabled: boolean, height: number): React.CSSProperties {\n    const imgStyle: React.CSSProperties = {\n        verticalAlign: \"middle\",\n        lineHeight: height\n    };\n    return imgStyle;\n}\n\nfunction getItemStyle(enabled: boolean, selected: boolean, size: number, isMouseOver: boolean, vertical?: boolean): React.CSSProperties {\n    const pad = ((size - 16) / 2);\n    const vertPad = 6;\n    const style: React.CSSProperties = {\n        display: vertical === true ? \"block\" : \"inline-block\",\n        //height: height,\n        paddingLeft: pad,\n        paddingRight: pad,\n        paddingTop: vertPad,\n        paddingBottom: vertPad\n    };\n    if ((isMouseOver === true && enabled === true) || selected) {\n        style.borderWidth = 1;\n        style.paddingLeft = pad - 1; //To compensate for border\n        style.paddingRight = pad - 1; //To compensate for border\n        style.paddingTop = vertPad - 1; //To compensate for border\n        style.paddingBottom = vertPad - 1; //To compensate for border\n    }\n    return style;\n}\n\nfunction getToolbarSeparatorItemStyle(vertical?: boolean): React.CSSProperties {\n    const style: React.CSSProperties = {\n        display: vertical === true ? \"block\" : \"inline-block\"\n    };\n    if (vertical === true) {\n        style.paddingTop = 2;\n        style.paddingBottom = -2;\n        style.marginLeft = 0;\n        style.marginRight = 0;\n    } else {\n        style.paddingTop = 0;\n        style.paddingBottom = 0;\n        style.marginLeft = 2;\n        style.marginRight = -2;\n    }\n    return style;\n}\n\nfunction getMenuItemStyle(enabled: boolean, selected: boolean, height: number, isMouseOver: boolean): React.CSSProperties {\n    const pad = ((height - 16) / 2);\n    const vertPad = 6;\n    const style: React.CSSProperties = {\n        //height: height,\n        paddingLeft: pad,\n        paddingRight: pad,\n        paddingTop: vertPad,\n        paddingBottom: vertPad\n    };\n    if (enabled && (isMouseOver === true || selected)) {\n        style.cursor = \"pointer\";\n        style.border = \"1px solid rgb(153, 181, 202)\";\n        style.paddingLeft = pad - 1; //To compensate for border\n        style.paddingRight = pad - 1; //To compensate for border\n        style.paddingTop = vertPad - 1; //To compensate for border\n        style.paddingBottom = vertPad - 1; //To compensate for border\n    }\n    return style;\n}\n\nexport interface IFlyoutMenuChildItemProps {\n    item: IItem | IInlineMenu;\n    onInvoked?: () => void;\n}\n\nexport const FlyoutMenuChildItem = (props: IFlyoutMenuChildItemProps) => {\n    const { item } = props;\n    const [isMouseOver, setIsMouseOver] = React.useState(false);\n    const onClick = () => {\n        if (getEnabled(item)) {\n            item.invoke?.();\n            props.onInvoked?.();\n        }\n    };\n    const onMouseLeave = () => {\n        setIsMouseOver(false);\n    };\n    const onMouseEnter = () => {\n        setIsMouseOver(true);\n    };\n    const height = DEFAULT_TOOLBAR_SIZE;\n    const selected = getSelected(item);\n    const enabled = getEnabled(item);\n    const tt = getTooltip(item);\n    const style = getMenuItemStyle(enabled, selected, height, isMouseOver);\n    const iconEl = getIconElement(item, enabled, height);\n    return <li className=\"noselect flyout-menu-child-item\" title={tt} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} onClick={onClick}>\n        <div style={style}>\n            {iconEl} {item.label}\n        </div>\n    </li>;\n}\n\n\n\ninterface IComponentFlyoutItemProps {\n    size: number;\n    item: IComponentFlyoutItem;\n    vertical?: boolean;\n    isFlownOut?: boolean;\n}\n\nconst ComponentFlyoutItem = (props: IComponentFlyoutItemProps) => {\n    const { size, item, vertical, isFlownOut } = props;\n    const toolbarCtx = React.useContext(ToolbarContext);\n    const [isMouseOver, setIsMouseOver] = React.useState(false);\n    const onClick = (e: GenericEvent) => {\n        e.preventDefault();\n        const { flyoutId, componentName, componentProps } = item;\n        const newState = !!!isFlownOut;\n        if (newState) {\n            const rect = e.currentTarget.getBoundingClientRect();\n            const metrics: IDOMElementMetrics = {\n                posX: rect.left, // e.clientX,\n                posY: rect.top, // e.clientY,\n                width: rect.width, // e.currentTarget.offsetWidth,\n                height: rect.height, // e.currentTarget.offsetHeight\n                vertical: vertical\n            };\n            toolbarCtx.openComponent(flyoutId, metrics, componentName, componentProps);\n        } else {\n            toolbarCtx.closeComponent(flyoutId);\n        }\n        return false;\n    };\n    const onMouseLeave = () => {\n        setIsMouseOver(false);\n    };\n    const onMouseEnter = () => {\n        setIsMouseOver(true);\n    };\n    const selected = getSelected(item);\n    const enabled = getEnabled(item);\n    const style = getItemStyle(enabled, selected, size, isMouseOver, vertical);\n    let label: any = item.label;\n    if (vertical === true) {\n        label = <div className=\"rotated-text\"><span className=\"rotated-text__inner rotated-text-ccw\">{item.label}</span></div>;\n    }\n    const ttip = getTooltip(item);\n    const iconEl = getIconElement(item, enabled, size);\n    return <div className={`noselect toolbar-flyout-btn ${selected ? \"selected-item\" : \"\"} ${isMouseOver ? \"mouse-over\" : \"\"}`} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} onClick={onClick} style={style} title={ttip}>\n        <div data-flyout-id={`flyout-${item.flyoutId}`}>\n            {iconEl} {label} {getFlyoutIconElement(isFlownOut, size)}\n        </div>\n    </div>;\n};\n\ninterface IFlyoutMenuReferenceItemProps {\n    size: number;\n    menu: IFlyoutMenu;\n    vertical?: boolean;\n    isFlownOut?: boolean;\n}\n\nconst FlyoutMenuReferenceItem = (props: IFlyoutMenuReferenceItemProps) => {\n    const { size, menu, vertical, isFlownOut } = props;\n    const toolbarCtx = React.useContext(ToolbarContext);\n    const [isMouseOver, setIsMouseOver] = React.useState(false);\n    const onClick = (e: GenericEvent) => {\n        e.preventDefault();\n        const newState = !!!isFlownOut;\n        if (newState) {\n            const rect = e.currentTarget.getBoundingClientRect();\n            const metrics: IDOMElementMetrics = {\n                posX: rect.left, // e.clientX,\n                posY: rect.top, // e.clientY,\n                width: rect.width, // e.currentTarget.offsetWidth,\n                height: rect.height, // e.currentTarget.offsetHeight\n                vertical: vertical\n            };\n            toolbarCtx.openFlyout(menu.flyoutId, metrics);\n        } else {\n            toolbarCtx.closeFlyout(menu.flyoutId);\n        }\n        return false;\n    }\n    const onMouseLeave = () => {\n        setIsMouseOver(false);\n    };\n    const onMouseEnter = () => {\n        setIsMouseOver(true);\n    };\n    const selected = getSelected(menu);\n    const enabled = getEnabled(menu);\n    const style = getItemStyle(enabled, selected, size, isMouseOver, vertical);\n    let label: any = menu.label;\n    if (vertical === true) {\n        label = <div className=\"rotated-text\"><span className=\"rotated-text__inner rotated-text-ccw\">{menu.label}</span></div>;\n    }\n    let align = menu.flyoutAlign;\n    if (!align) {\n        align = (vertical === true) ? \"right bottom\" : \"bottom right\";\n    }\n    const ttip = getTooltip(menu);\n    const iconEl = getIconElement(menu, enabled, size);\n    return <div className={`noselect toolbar-flyout-btn ${selected ? \"selected-item\" : \"\"} ${isMouseOver ? \"mouse-over\" : \"\"}`} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} onClick={onClick} style={style} title={ttip}>\n        <div data-flyout-id={`flyout-${menu.flyoutId}`}>\n            {iconEl} {label} {getFlyoutIconElement(isFlownOut, size)}\n        </div>\n    </div>;\n};\n\ninterface IToolbarSeparatorProps {\n    size: number;\n    vertical?: boolean;\n}\n\nconst ToolbarSeparator = (props: IToolbarSeparatorProps) => {\n    const style = getToolbarSeparatorItemStyle(props.vertical);\n    if (props.vertical === true) {\n        return <div className=\"noselect toolbar-separator-vertical\" style={style} />;\n    } else {\n        return <div className=\"noselect toolbar-separator-horizontal\" style={style}>{NBSP}</div>;\n    }\n}\n\ninterface IToolbarButtonProps {\n    height: number;\n    item: IItem;\n    vertical?: boolean;\n    hideVerticalLabels?: boolean;\n}\n\nconst ToolbarButton = (props: IToolbarButtonProps) => {\n    const { height, item, vertical, hideVerticalLabels } = props;\n    const [isMouseOver, setIsMouseOver] = React.useState(false);\n    const onMouseLeave = () => {\n        setIsMouseOver(false);\n    }\n    const onMouseEnter = () => {\n        setIsMouseOver(true);\n    }\n    const onClick = (e: any) => {\n        e.preventDefault();\n        const { item } = props;\n        const enabled = getEnabled(item);\n        if (enabled && item.invoke) {\n            item.invoke();\n        }\n        return false;\n    }\n    const selected = getSelected(item);\n    const enabled = getEnabled(item);\n    const style = getItemStyle(enabled, selected, height, isMouseOver, vertical);\n    let ttip = null;\n    if (typeof (item.tooltip) == 'function') {\n        ttip = item.tooltip();\n    } else {\n        ttip = item.tooltip;\n    }\n    if (!enabled) {\n        style.opacity = 0.3;\n    }\n    const iconEl = getIconElement(item, enabled, height);\n    return <div className={`noselect toolbar-btn ${selected ? \"selected-item\" : \"\"} ${(isMouseOver && enabled) ? \"mouse-over\" : \"\"}`} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} style={style} title={ttip} onClick={onClick}>\n        {iconEl} {(vertical == true && hideVerticalLabels == true) ? null : item.label}\n    </div>;\n}\n\nexport interface IItem {\n    label?: string | (() => string);\n    tooltip?: string | (() => string);\n    icon?: string;\n    iconClass?: string;\n    bpIconName?: BlueprintSvgIconNames;\n    invoke?: () => void;\n    enabled?: boolean | (() => boolean);\n    selected?: boolean | (() => boolean);\n    isSeparator?: boolean;\n}\n\nexport interface IInlineMenu extends IItem {\n    childItems: IItem[];\n    flyoutAlign?: string;\n}\n\nexport interface IFlyoutMenu extends IItem {\n    flyoutId: string;\n    flyoutAlign?: string;\n}\n\nexport interface IComponentFlyoutItem extends IItem {\n    flyoutId: string;\n    componentName: string;\n    componentProps?: any;\n}\n\nexport interface IContainerItem extends IItem {\n    renderContainerContent: () => JSX.Element;\n}\n\n/**\n * Toolbar component props\n *\n * @export\n * @interface IToolbarProps\n */\nexport interface IToolbarProps {\n    childItems: IItem[];\n    containerClass?: string;\n    containerStyle?: React.CSSProperties;\n    vertical?: boolean;\n    hideVerticalLabels?: boolean;\n    onOpenFlyout?: (id: string, metrics: IDOMElementMetrics) => void;\n    onCloseFlyout?: (id: string) => void;\n    onOpenComponent?: (id: string, metrics: IDOMElementMetrics, name: string, props?: any) => void;\n    onCloseComponent?: (id: string) => void;\n    flyoutStates?: FlyoutVisibilitySet;\n}\n\n/**\n * A generic toolbar component\n * @param props \n */\nexport const Toolbar = (props: IToolbarProps) => {\n    const {\n        containerStyle,\n        containerClass,\n        childItems,\n        vertical,\n        hideVerticalLabels,\n        flyoutStates,\n        onOpenFlyout,\n        onCloseFlyout,\n        onOpenComponent,\n        onCloseComponent\n    } = props;\n    const openFlyout = (id: string, metrics: IDOMElementMetrics) => onOpenFlyout?.(id, metrics);\n    const closeFlyout = (id: string) => onCloseFlyout?.(id);\n    const openComponent = (id: string, metrics: IDOMElementMetrics, name: string, props?: any) => onOpenComponent?.(id, metrics, name, props);\n    const closeComponent = (id: string) => onCloseComponent?.(id);\n    let height = DEFAULT_TOOLBAR_SIZE;\n    if (containerStyle) {\n        const ch = containerStyle.height;\n        if (isNumeric(ch)) {\n            height = ch;\n        }\n    }\n    const providerImpl = {\n        openFlyout: openFlyout,\n        closeFlyout: closeFlyout,\n        openComponent: openComponent,\n        closeComponent: closeComponent\n    };\n    return <ToolbarContext.Provider value={providerImpl}>\n        <div style={containerStyle} className={`has-flyout noselect ${containerClass}`}>\n            {childItems.map((item, index) => {\n                if (isComponentFlyout(item)) {\n                    const isFlownOut = flyoutStates && !!flyoutStates[item.flyoutId];\n                    return <ComponentFlyoutItem key={index} size={height} item={item} vertical={vertical} isFlownOut={isFlownOut} />;\n                } else if (isMenuRef(item)) {\n                    const isFlownOut = flyoutStates && !!flyoutStates[item.flyoutId];\n                    return <FlyoutMenuReferenceItem key={index} size={height} menu={item} vertical={vertical} isFlownOut={isFlownOut} />;\n                } else if (item.isSeparator === true) {\n                    return <ToolbarSeparator key={index} size={height} vertical={vertical} />;\n                } else {\n                    return <ToolbarButton key={index} height={height} item={item} vertical={vertical} hideVerticalLabels={hideVerticalLabels} />;\n                }\n            })}\n        </div>\n    </ToolbarContext.Provider>;\n}","import OverlayPositioning from 'ol/OverlayPositioning';\nimport debounce from 'lodash.debounce';\nimport olOverlay from \"ol/Overlay\";\nimport olWKTFormat from \"ol/format/WKT\";\nimport olPolygon, { fromExtent } from \"ol/geom/Polygon\";\nimport olMap from \"ol/Map\";\nimport { GenericEvent, GenericEventHandler, ClientKind, Coordinate2D, Bounds } from '../../api/common';\nimport { Client } from '../../api/client';\nimport * as olExtent from \"ol/extent\";\nimport { isSessionExpiredError } from '../../api/error';\nimport { tr } from '../../api/i18n';\nimport { debug } from '../../utils/logger';\nimport Feature from 'ol/Feature';\n\nexport interface IFeatureQueryCallback {\n    incrementBusyWorker(): void;\n    decrementBusyWorker(): void;\n    onSessionExpired(): void;\n    getAgentUri(): string;\n    getAgentKind(): ClientKind;\n    getMapName(): string;\n    getSessionId(): string;\n    getLocale(): string | undefined;\n    getPointSelectionBox(point: Coordinate2D): Bounds;\n    openTooltipLink(url: string): void;\n}\n\nexport class FeatureQueryTooltip {\n    private wktFormat: olWKTFormat;\n    private map: olMap;\n    private throttledMouseMove: GenericEventHandler;\n    private featureTooltipElement: HTMLElement;\n    private featureTooltip: olOverlay;\n    private linkElement: HTMLElement | null;\n    private enabled: boolean;\n    private isMouseOverTooltip: boolean;\n    private callback: IFeatureQueryCallback;\n    constructor(map: olMap, callback: IFeatureQueryCallback) {\n        this.callback = callback;\n        this.wktFormat = new olWKTFormat();\n        this.featureTooltipElement = document.createElement(\"div\");\n        this.featureTooltipElement.addEventListener(\"mouseover\", () => this.isMouseOverTooltip = true);\n        this.featureTooltipElement.addEventListener(\"mouseout\", () => this.isMouseOverTooltip = false);\n        this.featureTooltipElement.className = 'feature-tooltip';\n        this.featureTooltip = new olOverlay({\n            element: this.featureTooltipElement,\n            offset: [15, 0],\n            positioning: OverlayPositioning.CENTER_LEFT\n        })\n        this.map = map;\n        this.map.addOverlay(this.featureTooltip);\n        this.throttledMouseMove = debounce((e: GenericEvent) => {\n            this.raiseQueryFromPoint(e.pixel);\n        }, 1000);\n        this.enabled = true;\n        this.isMouseOverTooltip = false;\n    }\n    public dispose() {\n        this.featureTooltip.dispose();\n    }\n    public get isMouseOver() { return this.isMouseOverTooltip; }\n    public raiseQueryFromPoint(pixel: [number, number]) {\n        const box = this.callback.getPointSelectionBox(pixel);\n        const geom = fromExtent(box);\n        debug(`[${new Date()}] FeatureTooltip - onMouseMove (${box[0]}, ${box[1]}) (${box[2]}, ${box[3]})`);\n        this.sendTooltipQuery(geom);\n    }\n    public onMouseMove(e: GenericEvent) {\n        this.throttledMouseMove(e);\n    }\n    public isEnabled(): boolean {\n        return this.enabled;\n    }\n    public setEnabled(enabled: boolean): void {\n        this.enabled = enabled;\n        if (!this.enabled) {\n            this.featureTooltipElement.innerHTML = \"\";\n            this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n            if (this.linkElement) {\n                this.linkElement.onclick = null;\n            }\n        }\n    }\n    private sendTooltipQuery(geom: olPolygon): void {\n        if (!this.enabled) {\n            return;\n        }\n        if (this.isMouseOverTooltip) {\n            debug(`Mouse over tooltip. Doing nothing`);\n            return;\n        }\n        //const selectedLayerNames = this.onRequestSelectableLayers();\n        //if (selectedLayerNames != null && selectedLayerNames.length == 0) {\n        //    return;\n        //}\n        const reqQueryFeatures = 4 | 8; //Tooltips and hyperlinks\n        const wkt = this.wktFormat.writeGeometry(geom);\n        const client = new Client(this.callback.getAgentUri(), this.callback.getAgentKind());\n\n        //This is probably a case of blink and you'll miss\n        //\n        //this.featureTooltipElement.innerHTML = \"Querying tooltip data ...\";\n        //this.featureTooltipElement.classList.remove(\"tooltip-hidden\");\n        const coords = olExtent.getCenter(geom.getExtent());\n        this.featureTooltip.setPosition(coords);\n        this.callback.incrementBusyWorker();\n        client.queryMapFeatures({\n            mapname: this.callback.getMapName(),\n            session: this.callback.getSessionId(),\n            //layernames: selectedLayerNames != null ? selectedLayerNames.join(\",\") : null,\n            geometry: wkt,\n            persist: 0,\n            selectionvariant: \"INTERSECTS\",\n            maxfeatures: 1,\n            requestdata: reqQueryFeatures,\n            layerattributefilter: 5\n        }).then(res => {\n            let html = \"\";\n            if (res.Tooltip) {\n                html += `<div class='feature-tooltip-body'>${res.Tooltip.replace(/\\\\n/g, \"<br/>\")}</div>`;\n            }\n            if (res.Hyperlink) {\n                html += `<div><a id='feature-tooltip-link' href='${res.Hyperlink}'>${tr(\"FEATURE_TOOLTIP_URL_HELP_TEXT\", this.callback.getLocale())}</a></div>`;\n            }\n            this.featureTooltipElement.innerHTML = html;\n            this.linkElement = document.getElementById(\"feature-tooltip-link\");\n            this.setLinkClickHandler();\n            if (html == \"\") {\n                this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n                if (this.linkElement) {\n                    this.linkElement.onclick = null;\n                }\n            } else {\n                this.featureTooltipElement.classList.remove(\"tooltip-hidden\");\n            }\n        }).then(() => {\n            this.callback.decrementBusyWorker();\n        }).catch(err => {\n            this.callback.decrementBusyWorker();\n            if (isSessionExpiredError(err)) {\n                this.callback.onSessionExpired();\n            }\n        });\n    }\n    private setLinkClickHandler = () => {\n        if (this.linkElement) {\n            this.linkElement.onclick = this.handleLinkClick;\n        }\n    }\n    private handleLinkClick = (e: any) => {\n        e.preventDefault();\n        this.callback.openTooltipLink(e.target.href);\n        return false;\n    }\n}","import olOverlay from \"ol/Overlay\";\nimport olMap from \"ol/Map\";\nimport OverlayPositioning from 'ol/OverlayPositioning';\nimport { GenericEvent } from '../../api/common';\n\nconst HIDDEN_CLASS_NAME = \"tooltip-hidden\";\n\nexport class MouseTrackingTooltip {\n    private tooltip: olOverlay;\n    private tooltipElement: HTMLElement;\n    private map: olMap;\n    private text: string | null;\n    private isContextMenuOpen: () => boolean;\n    constructor(map: olMap, contextMenuTest: () => boolean) {\n        this.map = map;\n        this.isContextMenuOpen = contextMenuTest;\n        this.map.getViewport().addEventListener(\"mouseout\", this.onMouseOut.bind(this));\n        this.tooltipElement = document.createElement(\"div\");\n        this.tooltipElement.className = 'tooltip';\n        this.tooltip = new olOverlay({\n            element: this.tooltipElement,\n            offset: [15, 0],\n            positioning: OverlayPositioning.CENTER_LEFT\n        })\n        this.map.addOverlay(this.tooltip);\n        this.text = null;\n        this.tooltipElement.classList.add(HIDDEN_CLASS_NAME);\n    }\n    public dispose() {\n        this.tooltip.dispose();\n    }\n    public onMouseMove(e: GenericEvent) {\n        if (this.isContextMenuOpen())\n            return;\n        this.tooltip.setPosition(e.coordinate);\n        if (this.text)\n            this.tooltipElement.classList.remove(HIDDEN_CLASS_NAME);\n        else\n            this.tooltipElement.classList.add(HIDDEN_CLASS_NAME);\n    }\n    private onMouseOut() {\n        this.tooltipElement.classList.add(HIDDEN_CLASS_NAME);\n    }\n    public setText(prompt: string) {\n        this.text = prompt;\n        this.tooltipElement.innerHTML = this.text;\n    }\n    public clear() {\n        this.text = null;\n        this.tooltipElement.innerHTML = \"\";\n    }\n    public destroy() {\n        if (this.tooltipElement && this.tooltipElement.parentNode) {\n            this.tooltipElement.parentNode.removeChild(this.tooltipElement);\n        }\n    }\n}","import olMap from \"ol/Map\";\nimport olOverlay from \"ol/Overlay\";\nimport olImageLayer from \"ol/layer/Image\";\nimport olTileLayer from \"ol/layer/Tile\";\nimport olSourceWMS from \"ol/source/ImageWMS\";\nimport olSourceTileWMS from \"ol/source/TileWMS\";\nimport GeoJSON from \"ol/format/GeoJSON\";\nimport OverlayPositioning from 'ol/OverlayPositioning';\nimport Collection from 'ol/Collection';\nimport Feature from 'ol/Feature';\nimport { tr } from '../../api/i18n';\nimport { ILayerManager, Coordinate2D, LayerProperty, Dictionary } from '../../api/common';\nimport { Client } from '../../api/client';\nimport { parseEpsgCodeFromCRS } from '../layer-manager/wfs-capabilities-panel';\nimport { ProjectionLike } from 'ol/proj';\nimport { LayerSetGroupBase } from '../../api/layer-set-group-base';\nimport Geometry from 'ol/geom/Geometry';\nimport { ISelectedFeaturePopupTemplateConfiguration } from '../../actions/defs';\nimport { strIsNullOrEmpty, extractPlaceholderTokens, strReplaceAll } from '../../utils/string';\nimport Layer from 'ol/layer/Layer';\nimport LayerBase from \"ol/layer/Base\";\nimport Source from 'ol/source/Source';\nimport { WmsQueryAugmentation } from '../map-providers/base';\nimport { isClusteredFeature, getClusterSubFeatures } from '../../api/ol-style-helpers';\nimport stickybits from 'stickybits';\nimport { OLFeature } from \"../../api/ol-types\";\n\nexport interface IQueryWmsFeaturesCallback {\n    getLocale(): string | undefined;\n    /**\n     * \n     * @param feat \n     * @param l \n     * @since 0.14\n     */\n    addClientSelectedFeature(feat: Feature<Geometry>, l: LayerBase): void;\n    addFeatureToHighlight(feat: Feature<Geometry> | undefined, bAppend: boolean): void;\n    getWmsRequestAugmentations(): Dictionary<WmsQueryAugmentation>;\n}\n\n/**\n * @since 0.14\n */\nexport type SelectionPopupContentRenderer = (feat: Feature<Geometry>, locale?: string, popupConfig?: ISelectedFeaturePopupTemplateConfiguration) => string;\n\n/**\n * @since 0.14\n */\nexport interface ISelectionPopupContentOverrideProvider {\n    getSelectionPopupRenderer(layerName: string): SelectionPopupContentRenderer | undefined;\n}\n\nfunction defaultPopupContentRenderer(feat: OLFeature, locale?: string, popupConfig?: ISelectedFeaturePopupTemplateConfiguration) {\n    let html = \"\";\n    const bClustered = isClusteredFeature(feat);\n\n    let title = popupConfig?.title ?? tr(\"SEL_FEATURE_PROPERTIES\", locale);\n    const size = getClusterSubFeatures(feat)?.length;;\n    if (bClustered && size > 1) {\n        title = popupConfig?.clusteredTitle?.(size) ?? tr(\"SEL_CLUSTER_PROPERTIES\", locale, { size });\n    }\n    html += \"<div class='selected-popup-header'><div>\" + title + \"</div><a id='feat-popup-closer' class='closer' href='#'>[x]</a><div class='clearit'></div></div>\";\n\n    const renderForMultiple = (subFeatures: OLFeature[]) => {\n        let table = \"<table class='selected-popup-cluster-table'>\";\n        const fheadings = popupConfig?.propertyMappings\n            ? popupConfig.propertyMappings.filter(pm => pm.name != subFeatures[0].getGeometryName()).map(pm => pm.value)\n            : Object.keys(subFeatures[0].getProperties()).filter(pn => pn != subFeatures[0].getGeometryName());\n        const fprops = popupConfig?.propertyMappings\n            ? popupConfig.propertyMappings.map(pm => pm.value)\n            : Object.keys(subFeatures[0].getProperties()).filter(pn => pn != subFeatures[0].getGeometryName());\n        table += \"<thead><tr>\";\n        for (const heading of fheadings) {\n            table += `<th>${heading}</th>`;\n        }\n        table += \"</tr></thead>\";\n        table += \"<tbody>\"\n        for (const f of subFeatures) {\n            table += \"<tr>\";\n            for (const property of fprops) {\n                table += `<td>${f.get(property)}</td>`;\n            }\n            table += \"</tr>\";\n        }\n        table += \"</tbody>\";\n        table += \"</table>\";\n        return table\n    };\n    const renderForSingle = (feature: OLFeature): [string, number, string | undefined] => {\n        let linkFragment: string | undefined;\n        let table = \"<table class='selected-popup-single-properties-table'>\";\n        table += \"<tbody>\";\n        const f = feature.getProperties();\n        let pc = 0;\n        if (popupConfig?.propertyMappings) {\n            for (const pm of popupConfig.propertyMappings) {\n                if (pm.name == feat.getGeometryName()) {\n                    continue;\n                }\n                table += \"<tr>\";\n                table += \"<td class='property-name-cell'>\" + pm.value + \"</td>\";\n                table += \"<td class='property-value-cell'>\" + f[pm.name] + \"</td>\";\n                table += \"</tr>\";\n                pc++;\n            }\n        } else {\n            for (const key in f) {\n                if (key == feat.getGeometryName()) {\n                    continue;\n                }\n                table += \"<tr>\";\n                table += \"<td class='property-name-cell'>\" + key + \"</td>\";\n                table += \"<td class='property-value-cell'>\" + f[key] + \"</td>\";\n                table += \"</tr>\";\n                pc++;\n            }\n        }\n        table += \"</tbody>\";\n        table += \"</table>\";\n\n        if (popupConfig?.linkProperty) {\n            const { name, label, linkTarget } = popupConfig.linkProperty;\n            let linkHref: string | undefined;\n            if (typeof (name) == 'string') {\n                linkHref = encodeURI(f[name]);\n            } else {\n                const expr = name.expression;\n                let url = expr;\n                const pBegin = name.placeholderBegin ?? \"{\";\n                const pEnd = name.placeholderEnd ?? \"}\";\n                const tokens = extractPlaceholderTokens(expr, pBegin, pEnd);\n                for (const t of tokens) {\n                    const al = encodeURIComponent(f[t] ?? \"\");\n                    url = strReplaceAll(url, `${pBegin}${t}${pEnd}`, al);\n                }\n                linkHref = url;\n            }\n            if (!strIsNullOrEmpty(linkHref)) {\n                linkFragment = `<div class='select-popup-single-link-wrapper'><a href=\"${linkHref}\" target='${linkTarget}'>${label}</a></div>`;\n            }\n        }\n        return [table, pc, linkFragment];\n    };\n    const singlePopupContentRender = (feature: OLFeature, appendHtml: (h: string) => void) => {\n        const [table, pc, linkFragment] = renderForSingle(feature);\n        if (pc > 0) {\n            appendHtml(`<div class='selected-popup-content-wrapper'>${table}</div>`);\n        } else {\n            appendHtml(\"<div class='selected-popup-content-none'>\" + tr(\"SEL_FEATURE_PROPERTIES_NONE\", locale) + \"</div>\");\n        }\n        if (!strIsNullOrEmpty(linkFragment)) {\n            appendHtml(linkFragment);\n        }\n    }\n\n    if (bClustered) {\n        const subFeatures = getClusterSubFeatures(feat);\n        if (subFeatures.length == 1) {\n            singlePopupContentRender(subFeatures[0], h => html += h);\n        } else {\n            const table = renderForMultiple(subFeatures);\n            html += `<div class='selected-popup-content-wrapper'>${table}</div>`;\n        }\n    } else {\n        singlePopupContentRender(feat, h => html += h);\n    }\n    return html;\n}\n\nexport class SelectedFeaturesTooltip {\n    private map: olMap;\n    private featureTooltipElement: HTMLElement;\n    private featureTooltip: olOverlay;\n    private enabled: boolean;\n    private isMouseOverTooltip: boolean;\n    private closerEl: HTMLElement | null;\n    constructor(map: olMap, private parent: ISelectionPopupContentOverrideProvider) {\n        this.featureTooltipElement = document.createElement(\"div\");\n        this.featureTooltipElement.addEventListener(\"mouseover\", () => this.isMouseOverTooltip = true);\n        this.featureTooltipElement.addEventListener(\"mouseout\", () => this.isMouseOverTooltip = false);\n        this.featureTooltipElement.className = 'selected-tooltip';\n        this.featureTooltip = new olOverlay({\n            element: this.featureTooltipElement,\n            offset: [15, 0],\n            positioning: OverlayPositioning.CENTER_LEFT\n        })\n        this.map = map;\n        this.map.addOverlay(this.featureTooltip);\n        this.enabled = true;\n        this.isMouseOverTooltip = false;\n    }\n    public dispose() {\n        this.featureTooltip.dispose();\n    }\n    public get isMouseOver() { return this.isMouseOverTooltip; }\n    public isEnabled(): boolean {\n        return this.enabled;\n    }\n    public setEnabled(enabled: boolean): void {\n        this.enabled = enabled;\n        if (!this.enabled) {\n            this.featureTooltipElement.innerHTML = \"\";\n            this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n        }\n    }\n    public hide() {\n        this.featureTooltipElement.innerHTML = \"\";\n        this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n    }\n    public async queryWmsFeatures(currentLayerSet: LayerSetGroupBase | undefined, layerMgr: ILayerManager, coord: Coordinate2D, resolution: number, bAppendMode: boolean, callback: IQueryWmsFeaturesCallback) {\n        let selected = 0;\n        //See what WMS layers we have\n        const client = new Client(\"\", \"mapagent\");\n        const format = new GeoJSON();\n        const wmsSources: [LayerBase, (olSourceWMS | olSourceTileWMS)][] = [];\n        //The active layer set may have a WMS layer\n        const currentWmsSource = currentLayerSet?.tryGetWmsSource();\n        if (currentWmsSource) {\n            wmsSources.push(currentWmsSource);\n        }\n        const layers = layerMgr.getLayers().filter(l => l.visible && l.selectable && l.type == \"WMS\");\n        for (const layer of layers) {\n            const wmsLayer = layerMgr.getLayer(layer.name);\n            if (wmsLayer instanceof olImageLayer || wmsLayer instanceof olTileLayer) {\n                const source = wmsLayer.getSource();\n                if (source instanceof olSourceWMS || source instanceof olSourceTileWMS) {\n                    wmsSources.push([wmsLayer, source]);\n                }\n            }\n        }\n        for (const pair of wmsSources) {\n            const [layer, source] = pair;\n            let url = source.getFeatureInfoUrl(coord, resolution, this.map.getView().getProjection(), {\n                'INFO_FORMAT': \"application/json\"\n            });\n            if (url) {\n                const layerName = layer.get(LayerProperty.LAYER_NAME);\n                //Check if we have an augmentation for this\n                const augs = callback.getWmsRequestAugmentations();\n                if (augs[layerName]) {\n                    url = augs[layerName](url);\n                }\n                const resp = await client.getText(url);\n                const json = JSON.parse(resp);\n                if (json.features?.length > 0) {\n                    let srcProj: ProjectionLike = source.getProjection();\n                    if (!srcProj) {\n                        const epsg = parseEpsgCodeFromCRS(json.crs?.properties?.name);\n                        if (epsg) {\n                            srcProj = `EPSG:${epsg}`;\n                        }\n                    }\n                    const features = format.readFeatures(resp, {\n                        dataProjection: srcProj,\n                        featureProjection: this.map.getView().getProjection()\n                    });\n                    this.featureTooltip.setPosition(coord);\n                    const popupConf: ISelectedFeaturePopupTemplateConfiguration | undefined = layer.get(LayerProperty.SELECTED_POPUP_CONFIGURATION);\n                    const html = this.generateFeatureHtml(layerName, features[0], callback.getLocale(), popupConf);\n                    callback.addClientSelectedFeature(features[0], layer);\n                    currentLayerSet?.clearWmsSelectionOverlay();\n                    currentLayerSet?.addWmsSelectionOverlay(features[0]);\n                    callback.addFeatureToHighlight(features[0], bAppendMode);\n                    selected++;\n                    this.featureTooltipElement.innerHTML = html;\n                    stickybits(\".selected-popup-cluster-table th\");\n                    this.closerEl = document.getElementById(\"feat-popup-closer\");\n                    this.setPopupCloseHandler();\n                    if (html == \"\") {\n                        this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n                    } else {\n                        this.featureTooltipElement.classList.remove(\"tooltip-hidden\");\n                    }\n                    return true;\n                }\n            }\n        }\n        // Clear if there was no selection made\n        if (selected == 0) {\n            callback.addFeatureToHighlight(undefined, false);\n            this.hide();\n        }\n        return false;\n    }\n    private generateFeatureHtml(layerName: string | undefined, feat: Feature<Geometry>, locale?: string, popupConfig?: ISelectedFeaturePopupTemplateConfiguration) {\n        if (layerName) {\n            const customRenderer = this.parent.getSelectionPopupRenderer(layerName);\n            if (customRenderer) {\n                return customRenderer(feat, locale, popupConfig);\n            } else {\n                return defaultPopupContentRenderer(feat, locale, popupConfig);\n            }\n        }\n        return defaultPopupContentRenderer(feat, locale, popupConfig);\n    }\n    private setPopupCloseHandler = () => {\n        if (this.closerEl) {\n            this.closerEl.onclick = this.closePopup;\n        }\n    }\n    private closePopup = (e: any) => {\n        e.preventDefault();\n        this.hide();\n        if (this.closerEl) {\n            this.closerEl.onclick = null;\n        }\n        return false;\n    };\n    public showSelectedVectorFeatures(features: Collection<Feature<Geometry>>, pixel: [number, number], featureToLayerMap: [Feature<Geometry>, Layer<Source>][], locale?: string) {\n        const coords = this.map.getCoordinateFromPixel(pixel);\n        if (features.getLength() > 0) {\n            this.featureTooltip.setPosition(coords);\n            const f = features.item(0);\n            let popupConf: ISelectedFeaturePopupTemplateConfiguration | undefined;\n            const pair = featureToLayerMap.find(([feat, _]) => feat == f);\n            let layerName;\n            if (pair) {\n                const layer = pair[1];\n                popupConf = layer.get(LayerProperty.SELECTED_POPUP_CONFIGURATION);\n                layerName = layer.get(LayerProperty.LAYER_NAME);\n            }\n            const html = this.generateFeatureHtml(layerName, f, locale, popupConf);\n            this.featureTooltipElement.innerHTML = html;\n            stickybits(\".selected-popup-cluster-table th\");\n            this.closerEl = document.getElementById(\"feat-popup-closer\");\n            this.setPopupCloseHandler();\n            if (html == \"\") {\n                this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n            } else {\n                this.featureTooltipElement.classList.remove(\"tooltip-hidden\");\n            }\n        } else {\n            this.featureTooltipElement.innerHTML = \"\";\n            this.featureTooltipElement.classList.add(\"tooltip-hidden\");\n        }\n    }\n}","import olOverlay from \"ol/Overlay\";\nimport olMap from \"ol/Map\";\nimport OverlayPositioning from 'ol/OverlayPositioning';\nimport UTFGridSource from \"ol/source/UTFGrid\";\nimport { GenericEvent } from '../../api/common';\n\nexport class UTFGridTrackingTooltip {\n    private tooltip: olOverlay;\n    private tooltipElement: HTMLElement;\n    private text: string | null;\n    constructor(private map: olMap,\n        private gridSource: UTFGridSource,\n        private isContextMenuOpen: () => boolean) {\n        this.map.getViewport().addEventListener(\"mouseout\", this.onMouseOut.bind(this));\n        this.tooltipElement = document.createElement(\"div\");\n        this.tooltipElement.className = 'feature-tooltip';\n        this.tooltip = new olOverlay({\n            element: this.tooltipElement,\n            offset: [15, 0],\n            positioning: OverlayPositioning.CENTER_LEFT\n        })\n        this.map.addOverlay(this.tooltip);\n        this.text = null;\n    }\n    public dispose() {\n        this.tooltip.dispose();\n    }\n    public onMouseMove(e: GenericEvent) {\n        if (this.isContextMenuOpen())\n            return;\n        //this.tooltip.setPosition(e.coordinate);\n        const viewResolution = /** @type {number} */ (this.map.getView().getResolution());\n        if (viewResolution) {\n            this.gridSource.forDataAtCoordinateAndResolution(e.coordinate, viewResolution, (data) => {\n                // If you want to use the template from the TileJSON,\n                //  load the mustache.js library separately and call\n                //\n                //mapElement.style.cursor = data ? 'pointer' : '';\n                if (data) {\n                    /*\n                    var html = \"<table>\";\n                    for (var key in data) {\n                        html += \"<tr><td>\" + key + \"</td><td>\" + data[key] + \"</td></tr>\";\n                    }\n                    html += \"</table>\";\n                    */\n                    var html = \"\";\n                    if (data.MG_TOOLTIP)\n                        html += data.MG_TOOLTIP.replace(/(\\\\n)+/g, '<br />');\n                    if (data.MG_URL) {\n                        html += \"<br/><br/>\";\n                        html += \"<strong>CTRL + Click for more information</strong>\";\n                    }\n                    this.tooltipElement.innerHTML = html\n                }\n                this.tooltip.setPosition(data ? e.coordinate : undefined);\n            });\n        }\n    }\n    private onMouseOut() {\n\n    }\n    public setText(prompt: string) {\n        this.text = prompt;\n        this.tooltipElement.innerHTML = this.text;\n    }\n    public clear() {\n        this.text = null;\n        this.tooltipElement.innerHTML = \"\";\n    }\n    public destroy() {\n        if (this.tooltipElement && this.tooltipElement.parentNode) {\n            this.tooltipElement.parentNode.removeChild(this.tooltipElement);\n        }\n    }\n}","import * as React from \"react\";\nimport { NonIdealState, Tabs, Tab, FormGroup, NumericInput, RadioGroup, Radio, InputGroup, Switch, Button, Intent, ButtonGroup, SwitchProps } from '@blueprintjs/core';\nimport { tr } from \"../api/i18n\";\nimport { ExprOr, isEvaluatable, IPointIconStyle, IBasicPointCircleStyle, IBasicVectorPointStyle, DEFAULT_POINT_CIRCLE_STYLE, DEFAULT_POINT_ICON_STYLE, IBasicVectorLineStyle, IBasicVectorPolygonStyle, IVectorFeatureStyle, DEFAULT_LINE_STYLE, DEFAULT_POLY_STYLE, IVectorLayerStyle, IVectorLabelSettings, IBasicStroke, IBasicFill } from '../api/ol-style-contracts';\nimport { DEFAULT_STYLE_KEY } from '../api/ol-style-helpers';\nimport { Parser } from \"expr-eval\";\nimport { ColorExprEditor, NumberExprEditor, SliderExprEditor, StringExprEditor } from \"./layer-manager/common\";\nimport { STR_EMPTY } from \"../utils/string\";\nimport { getLegendImage } from \"./layer-manager/legend\";\nimport { vectorStyleToStyleMap } from \"../api/ol-style-map-set\";\n\ninterface IExprEditorProps<T> {\n    converter: (value: string) => ExprOr<T>;\n    expr: ExprOr<T>;\n    onExprChanged: (value: ExprOr<T>) => void;\n}\n\nfunction assertValue<T>(val: ExprOr<T>): asserts val is T {\n    if (isEvaluatable(val))\n        throw new Error(\"Value is expression instead of a raw value\");\n}\n\nfunction ExprEditor<T>(props: IExprEditorProps<T>) {\n    assertValue(props.expr);\n    return <>Expr: <input type=\"text\" value={`${props.expr}`} onChange={e => props.onExprChanged(props.converter(e.target.value))} /></>;\n}\n\nconst DynamicSwitch = (props: Omit<Omit<SwitchProps, \"checked\">, \"onChange\"> & Omit<IExprEditorProps<boolean>, \"converter\">) => {\n    if (isEvaluatable(props.expr)) {\n        return <ExprEditor<boolean> {...props} converter={v => v?.toLowerCase() == \"true\"} />\n    } else {\n        const { expr, onExprChanged, ...rest } = props;\n        const innerProps = {\n            ...rest,\n            checked: props.expr,\n            onChange: (e: any) => props.onExprChanged(e.target.checked)\n        };\n        return <Switch {...innerProps} />;\n    }\n}\n\ninterface ILabelStyleEditor {\n    isLine?: boolean;\n    style: IVectorLabelSettings;\n    locale: string;\n    onChange: (style: IVectorLabelSettings) => void;\n}\n\n//TODO: Either surface the font as another editable property or offload to configuration\nconst buildFont = (size: number, bold: boolean, italic: boolean, font = \"sans-serif\") =>\n    `${bold ? \"bold\" : STR_EMPTY} ${italic ? \"italic\" : STR_EMPTY} ${size}px ${font}`;\n\nfunction coalesceExpr<T>(expr: ExprOr<T> | undefined, defaultVal: T): T {\n    if (isEvaluatable(expr)) {\n        return defaultVal;\n    }\n    return expr ?? defaultVal;\n}\n\nconst DEFAULT_FONT_SIZE = 14;\n\nconst LabelStyleEditor: React.FC<ILabelStyleEditor> = props => {\n    const { style, locale, onChange, isLine } = props;\n    const [bold, setBold] = React.useState(false);\n    const [italic, setItalic] = React.useState(false);\n    const [localBgColor, setLocalBgColor] = React.useState<ExprOr<string>>(style.label?.fill?.color ?? \"#000000\");\n    const [localBgColorAlpha, setLocalColorAlpha] = React.useState<ExprOr<number>>(style.label?.fill?.alpha ?? 255);\n    const [localStrokeColor, setLocalStrokeColor] = React.useState<ExprOr<string>>(style.label?.stroke?.color ?? \"#ffffff\");\n    const [localStrokeWidth, setLocalStrokeWidth] = React.useState<ExprOr<number>>(style.label?.stroke?.width ?? 1);\n    const [localFontSize, setLocalFontSize] = React.useState(DEFAULT_FONT_SIZE);\n    const [localLabel, setLocalLabel] = React.useState({ font: buildFont(localFontSize, bold, italic), ...style.label });\n    const [hasLabel, setHasLabel] = React.useState(style.label != null);\n    const onToggleLinePlacement = React.useCallback(() => {\n        if (localLabel.placement == \"line\") {\n            const { placement, ...rest } = localLabel;\n            setLocalLabel(rest);\n        } else {\n            setLocalLabel({ ...localLabel, placement: \"line\" });\n        }\n    }, [localLabel]);\n    React.useEffect(() => {\n        if (hasLabel) {\n            onChange({ ...style, label: localLabel });\n        } else {\n            const { label, ...rest } = style;\n            onChange(rest);\n        }\n    }, [localLabel, hasLabel]);\n    React.useEffect(() => {\n        setLocalLabel({ ...localLabel, font: buildFont(localFontSize, bold, italic) });\n    }, [localFontSize, bold, italic]);\n    React.useEffect(() => {\n        setLocalLabel({\n            ...localLabel,\n            fill: {\n                ...localLabel.fill,\n                color: localBgColor,\n                alpha: localBgColorAlpha\n            } as IBasicFill,\n            stroke: {\n                ...localLabel.stroke,\n                color: localStrokeColor,\n                width: localStrokeWidth\n            } as IBasicStroke\n        })\n    }, [localStrokeColor, localStrokeWidth, localBgColorAlpha, localBgColor]);\n    return <>\n        <Switch checked={hasLabel} onChange={(e: any) => setHasLabel(e.target.checked)} label={tr(\"ENABLE_LABELS\", locale)} />\n        {hasLabel && <FormGroup label={tr(\"LABEL_TEXT\", locale)}>\n            <StringExprEditor locale={locale} value={localLabel.text} onChange={t => setLocalLabel({ ...localLabel, text: t })} />\n        </FormGroup>}\n        {hasLabel && <FormGroup label={tr(\"LABEL_SIZE\", locale)}>\n            <NumberExprEditor locale={locale} value={localFontSize} onChange={t => setLocalFontSize(coalesceExpr(t, DEFAULT_FONT_SIZE))} />\n        </FormGroup>}\n        {hasLabel && <ButtonGroup>\n            <Button intent={Intent.PRIMARY} active={bold} onClick={(e: any) => setBold(!bold)}>{tr(\"LABEL_BOLD\", locale)}</Button>\n            <Button intent={Intent.PRIMARY} active={italic} onClick={(e: any) => setItalic(!italic)}>{tr(\"LABEL_ITALIC\", locale)}</Button>\n            {isLine && <Button intent={Intent.PRIMARY} active={localLabel.placement == \"line\"} onClick={(e: any) => onToggleLinePlacement()}>{tr(\"LABEL_LINE_PLACEMENT\", locale)}</Button>}\n        </ButtonGroup>}\n        {hasLabel && <FormGroup label={tr(\"LABEL_COLOR\", locale)}>\n            <ColorExprEditor locale={locale} value={localBgColor} onChange={(c: any) => setLocalBgColor(c)} />\n        </FormGroup>}\n        {hasLabel && <FormGroup label={tr(\"LABEL_OUTLINE_COLOR\", locale)}>\n            <ColorExprEditor locale={locale} value={localStrokeColor} onChange={(c: any) => setLocalStrokeColor(c)} />\n        </FormGroup>}\n        {hasLabel && <FormGroup label={tr(\"LABEL_OUTLINE_THICKNESS\", locale)}>\n            <NumberExprEditor locale={locale} value={localStrokeWidth} onChange={t => setLocalStrokeWidth(t!)} />\n        </FormGroup>}\n    </>;\n}\n\ninterface ISubStyleEditorProps<TStyle> {\n    style: TStyle;\n    locale: string;\n    onChange: (style: TStyle) => void;\n}\n\nconst PointIconStyleEditor = ({ style, onChange, locale }: ISubStyleEditorProps<IPointIconStyle>) => {\n    const [localSrc, setLocalSrc] = React.useState(style.src);\n    React.useEffect(() => {\n        setLocalSrc(style.src);\n    }, [style.src]);\n    const onSrcChange = (e: any) => {\n        onChange({\n            ...style,\n            src: localSrc\n        });\n    };\n    return <div>\n        <FormGroup label={tr(\"VSED_PT_ICON_SRC\", locale)}>\n            <StringExprEditor value={localSrc} onChange={e => setLocalSrc(e!)} locale={locale} />\n            {!isEvaluatable(style.src) && <img src={style.src} />}\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_ICON_ANCHOR\", locale)}>\n            {tr(\"VSED_PT_ICON_ANCHOR_H\", locale)} <NumericInput value={style.anchor[0]} min={0} onValueChange={e => onChange({ ...style, anchor: [e, style.anchor[1]] })} />\n            {tr(\"VSED_PT_ICON_ANCHOR_V\", locale)} <NumericInput value={style.anchor[1]} min={0} onValueChange={e => onChange({ ...style, anchor: [style.anchor[0], e] })} />\n        </FormGroup>\n        <DynamicSwitch label={tr(\"VSED_PT_ICON_ROTATE_WITH_VIEW\", locale)} expr={style.rotateWithView} onExprChanged={(e: any) => onChange({ ...style, rotateWithView: e })} />\n        <FormGroup label={tr(\"VSED_PT_ICON_ROTATION\", locale)}>\n            <SliderExprEditor locale={locale} min={0} max={360} labelStepSize={360} value={style.rotation} onChange={(n: any) => onChange({ ...style, rotation: n })} />\n        </FormGroup>\n        {/*<FormGroup label={tr(\"VSED_PT_ICON_OPACITY\", locale)}>\n            <DynamicSlider min={0} max={255} labelStepSize={255} expr={style.opacity} onExprChanged={(n: any) => onChange({ ...style, opacity: n })} />\n        </FormGroup>*/}\n        <FormGroup label={tr(\"VSED_PT_ICON_SCALE\", locale)}>\n            <NumberExprEditor value={style.scale} onChange={n => onChange({ ...style, scale: n! })} locale={locale} />\n        </FormGroup>\n    </div>;\n};\n\nconst PointCircleStyleEditor = ({ style, onChange, locale }: ISubStyleEditorProps<IBasicPointCircleStyle>) => {\n    return <div>\n        <FormGroup label={tr(\"VSED_PT_FILL_COLOR\", locale)}>\n            <ColorExprEditor locale={locale} value={style.fill.color} onChange={(c: any) => onChange({ ...style, fill: { color: c, alpha: style.fill.alpha } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_FILL_COLOR_ALPHA\", locale)}>\n            <SliderExprEditor locale={locale} min={0} max={255} labelStepSize={255} value={style.fill.alpha} onChange={(n: any) => onChange({ ...style, fill: { color: style.fill.color, alpha: n } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_RADIUS\", locale)}>\n            <NumberExprEditor locale={locale} value={style.radius} min={1} onChange={(n: any) => onChange({ ...style, radius: n })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_OUTLINE_COLOR\", locale)}>\n            <ColorExprEditor locale={locale} value={style.stroke.color} onChange={(c: any) => onChange({ ...style, stroke: { color: c, width: style.stroke.width, alpha: style.stroke.alpha } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_OUTLINE_COLOR_ALPHA\", locale)}>\n            <SliderExprEditor locale={locale} min={0} max={255} labelStepSize={255} value={style.stroke.alpha} onChange={(n: any) => onChange({ ...style, stroke: { color: style.stroke.color, width: style.stroke.width, alpha: n } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PT_OUTLINE_WIDTH\", locale)}>\n            <NumberExprEditor locale={locale} value={style.stroke.width} min={1} onChange={(n: any) => onChange({ ...style, stroke: { color: style.stroke.color, width: n, alpha: style.stroke.alpha } })} />\n        </FormGroup>\n    </div>;\n};\n\nconst PointStyleEditor = ({ style, onChange, locale }: ISubStyleEditorProps<IBasicVectorPointStyle>) => {\n    const [iconStyle, setIconStyle] = React.useState<IPointIconStyle | undefined>(undefined);\n    const [circleStyle, setCircleStyle] = React.useState<IBasicPointCircleStyle | undefined>(undefined);\n    const [currentStyle, setCurrentStyle] = React.useState(style);\n    const applyCurrentStyle = (s: IBasicVectorPointStyle) => {\n        setCurrentStyle(s);\n        switch (s.type) {\n            case \"Circle\":\n                setCircleStyle(s);\n                break;\n            case \"Icon\":\n                setIconStyle(s);\n                break;\n        }\n    }\n    const onStyleTypeChange = (type: \"Icon\" | \"Circle\") => {\n        switch (type) {\n            case \"Circle\":\n                if (circleStyle) {\n                    setCurrentStyle(circleStyle);\n                    onChange(circleStyle);\n                } else {\n                    const s = { ...DEFAULT_POINT_CIRCLE_STYLE };\n                    setCircleStyle(s);\n                    setCurrentStyle(s);\n                    onChange(s);\n                }\n                break;\n            case \"Icon\":\n                if (iconStyle) {\n                    setCurrentStyle(iconStyle);\n                    onChange(iconStyle);\n                } else {\n                    const s = { ...DEFAULT_POINT_ICON_STYLE };\n                    setIconStyle(s);\n                    setCurrentStyle(s);\n                    onChange(s);\n                }\n                break;\n        }\n    }\n    React.useEffect(() => {\n        applyCurrentStyle(style);\n    }, [style]);\n    return <div>\n        <RadioGroup inline\n            label={tr(\"VSED_PT_TYPE\", locale)}\n            onChange={(e: any) => onStyleTypeChange(e.target.value)}\n            selectedValue={currentStyle.type}>\n            <Radio label={tr(\"VSED_PT_TYPE_CIRCLE\", locale)} value=\"Circle\" />\n            <Radio label={tr(\"VSED_PT_TYPE_ICON\", locale)} value=\"Icon\" />\n        </RadioGroup>\n        {currentStyle.type == \"Icon\" && <PointIconStyleEditor style={currentStyle} onChange={onChange} locale={locale} />}\n        {currentStyle.type == \"Circle\" && <PointCircleStyleEditor style={currentStyle} onChange={onChange} locale={locale} />}\n        <LabelStyleEditor style={currentStyle} locale={locale} onChange={onChange} />\n    </div>\n}\n\nconst LineStyleEditor = ({ style, onChange, locale }: ISubStyleEditorProps<IBasicVectorLineStyle>) => {\n    return <div>\n        <FormGroup label={tr(\"VSED_LN_OUTLINE_COLOR\", locale)}>\n            <ColorExprEditor locale={locale} value={style.color} onChange={(c: any) => onChange({ ...style, color: c, width: style.width, alpha: style.alpha })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_LN_OUTLINE_COLOR_ALPHA\", locale)}>\n            <SliderExprEditor locale={locale} min={0} max={255} labelStepSize={255} value={style.alpha} onChange={(n: any) => onChange({ ...style, color: style.color, width: style.width, alpha: n })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_LN_OUTLINE_THICKNESS\", locale)}>\n            <NumberExprEditor locale={locale} min={1} value={style.width} onChange={(n: any) => onChange({ ...style, color: style.color, width: n, alpha: style.alpha })} />\n        </FormGroup>\n        <LabelStyleEditor style={style} locale={locale} onChange={onChange} isLine />\n    </div>;\n}\n\nconst PolygonStyleEditor = ({ style, onChange, locale }: ISubStyleEditorProps<IBasicVectorPolygonStyle>) => {\n    return <div>\n        <FormGroup label={tr(\"VSED_PL_FILL_COLOR\", locale)}>\n            <ColorExprEditor locale={locale} value={style.fill.color} onChange={(c: any) => onChange({ ...style, fill: { color: c, alpha: style.fill.alpha } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PL_FILL_COLOR_ALPHA\", locale)}>\n            <SliderExprEditor locale={locale} min={0} max={255} labelStepSize={255} value={style.fill.alpha} onChange={(n: any) => onChange({ ...style, fill: { color: style.fill.color, alpha: n } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PL_OUTLINE_COLOR\", locale)}>\n            <ColorExprEditor locale={locale} value={style.stroke.color} onChange={(c: any) => onChange({ ...style, stroke: { color: c, width: style.stroke.width, alpha: style.stroke.alpha } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PL_OUTLINE_COLOR_ALPHA\", locale)}>\n            <SliderExprEditor locale={locale} min={0} max={255} labelStepSize={255} value={style.stroke.alpha} onChange={(n: any) => onChange({ ...style, stroke: { color: style.stroke.color, width: style.stroke.width, alpha: n } })} />\n        </FormGroup>\n        <FormGroup label={tr(\"VSED_PL_OUTLINE_THICKNESS\", locale)}>\n            <NumberExprEditor locale={locale} value={style.stroke.width} min={1} onChange={(n: any) => onChange({ ...style, stroke: { color: style.stroke.color, width: n, alpha: style.stroke.alpha } })} />\n        </FormGroup>\n        <LabelStyleEditor style={style} locale={locale} onChange={onChange} />\n    </div>;\n}\n\n/**\n * Vector style editor props\n * @since 0.13\n */\nexport interface IVectorStyleEditorProps {\n    style?: IVectorFeatureStyle;\n    onChange?: (style: IVectorFeatureStyle) => void;\n    enablePoint: boolean;\n    enableLine: boolean;\n    enablePolygon: boolean;\n    locale: string;\n}\n\ntype TabId = \"pointStyle\" | \"lineStyle\" | \"polyStyle\";\n\n/**\n * A vector style editor component\n * \n * @since 0.13\n */\nexport const VectorStyleEditor = (props: IVectorStyleEditorProps) => {\n    const { locale, style, onChange, enableLine, enablePoint, enablePolygon } = props;\n    const [selectedTab, setSelectedTab] = React.useState<TabId | undefined>(undefined);\n    const [pointStyle, setPointStyle] = React.useState(style?.point ?? DEFAULT_POINT_CIRCLE_STYLE);\n    const [lineStyle, setLineStyle] = React.useState(style?.line ?? DEFAULT_LINE_STYLE);\n    const [polyStyle, setPolyStyle] = React.useState(style?.polygon ?? DEFAULT_POLY_STYLE);\n    React.useEffect(() => {\n        setPointStyle(style?.point ?? DEFAULT_POINT_CIRCLE_STYLE);\n        setLineStyle(style?.line ?? DEFAULT_LINE_STYLE);\n        setPolyStyle(style?.polygon ?? DEFAULT_POLY_STYLE);\n    }, [style]);\n    const onStyleChanged = (point: IBasicVectorPointStyle, line: IBasicVectorLineStyle, poly: IBasicVectorPolygonStyle) => {\n        const newStyle: IVectorFeatureStyle = {\n            label: style?.label\n        };\n        if (enablePoint) {\n            newStyle.point = point;\n        }\n        if (enableLine) {\n            newStyle.line = line;\n        }\n        if (enablePolygon) {\n            newStyle.polygon = poly;\n        }\n        onChange?.(newStyle);\n        if (newStyle.point) {\n            setPointStyle(newStyle.point);\n        }\n        if (newStyle.line) {\n            setLineStyle(newStyle.line);\n        }\n        if (newStyle.polygon) {\n            setPolyStyle(newStyle.polygon);\n        }\n    };\n    if (!enableLine && !enablePoint && !enablePolygon) {\n        return <NonIdealState icon=\"warning-sign\" title={tr(\"VSED_NO_STYLES_TITLE\", locale)} description={tr(\"VSED_NO_STYLES_DESC\", locale)} />\n    } else {\n        const onPointStyleChanged = (st: IBasicPointCircleStyle) => {\n            onStyleChanged(st, lineStyle, polyStyle);\n        };\n        const onLineStyleChanged = (st: IBasicVectorLineStyle) => {\n            onStyleChanged(pointStyle, st, polyStyle);\n        };\n        const onPolygonStyleChanged = (st: IBasicVectorPolygonStyle) => {\n            onStyleChanged(pointStyle, lineStyle, st);\n        };\n        return <Tabs onChange={(t: any) => setSelectedTab(t)} selectedTabId={selectedTab}>\n            {enablePoint && <Tab id=\"pointStyle\" title={tr(\"VSED_TAB_POINT\", locale)} panel={<PointStyleEditor style={pointStyle} locale={locale} onChange={onPointStyleChanged} />} />}\n            {enableLine && <Tab id=\"lineStyle\" title={tr(\"VSED_TAB_LINE\", locale)} panel={<LineStyleEditor style={lineStyle} locale={locale} onChange={onLineStyleChanged} />} />}\n            {enablePolygon && <Tab id=\"polyStyle\" title={tr(\"VSED_TAB_POLY\", locale)} panel={<PolygonStyleEditor style={polyStyle} locale={locale} onChange={onPolygonStyleChanged} />} />}\n        </Tabs>\n    }\n}\n\n/**\n * Vector layer style editor props\n * @since 0.14\n */\nexport interface IVectorLayerStyleEditorProps {\n    style: IVectorLayerStyle;\n    onChange?: (style: IVectorLayerStyle) => void;\n    enablePoint: boolean;\n    enableLine: boolean;\n    enablePolygon: boolean;\n    locale: string;\n}\n\ninterface IFilterItemProps extends Omit<IVectorLayerStyleEditorProps, \"onChange\" | \"style\"> {\n    onChange: (filter: string, style: IVectorFeatureStyle) => void;\n    featureStyle: IVectorFeatureStyle;\n    filter?: string;\n    isDefault: boolean;\n    isStyleEditorOpen: boolean;\n    onToggleStyleEditor: (visible: boolean) => void;\n}\n\nconst parser = new Parser();\n\nconst FilterItem = (props: IFilterItemProps) => {\n    const { filter, isDefault, isStyleEditorOpen, featureStyle, onChange } = props;\n    const [localFilter, setLocalFilter] = React.useState(filter ?? \"\");\n    const [isLocalFilterValid, setIsLocalFilterValid] = React.useState(true);\n    const [pointStyleUrl, setPointStyleUrl] = React.useState<string | undefined>(undefined);\n    const [lineStyleUrl, setLineStyleUrl] = React.useState<string | undefined>(undefined);\n    const [polyStyleUrl, setPolyStyleUrl] = React.useState<string | undefined>(undefined);\n    React.useEffect(() => {\n        setLocalFilter(localFilter);\n    }, [filter]);\n    React.useEffect(() => {\n        try {\n            const expr: any = parser.parse(localFilter);\n            let bHaveVar = false;\n            let bHaveOperator = false;\n            for (const t of expr.tokens) {\n                switch (t.type) {\n                    case \"IVAR\":\n                        bHaveVar = true;\n                        break;\n                    case \"IOP2\":\n                        bHaveOperator = true;\n                        break;\n                }\n            }\n            setIsLocalFilterValid(bHaveVar && bHaveOperator && expr.tokens.length == 3);\n        } catch (e) {\n            setIsLocalFilterValid(false);\n        }\n    }, [localFilter]);\n    React.useEffect(() => {\n        let fs = featureStyle;\n        // A default clustered style will have a dynamic expression for the radius, the legend preview isn't\n        // smart enough to know what this should be since we don't (and can't) pass an \"example\" feature to\n        // know what this value should be. So in the event we find a clustered point style, we'll replace\n        // the dynamic radius expression with a constant value\n        if (featureStyle?.point?.type == \"Circle\" && isEvaluatable(featureStyle.point.radius)) {\n            fs = JSON.parse(JSON.stringify(featureStyle));\n            if (fs.point?.type == \"Circle\") {\n                fs.point.radius = 5;\n            }\n        }\n        const olstyle = vectorStyleToStyleMap(fs);\n\n        let pos: any;\n        let ls: any;\n        let pls: any;\n        if (typeof(olstyle) == 'function') {\n            pos = (feat: any) => olstyle(feat, undefined)[\"Point\"];\n            ls = (feat: any) => olstyle(feat, undefined)[\"LineString\"];\n            pls = (feat: any) => olstyle(feat, undefined)[\"Polygon\"];\n        } else {\n            pos = olstyle.Point;\n            ls = olstyle.LineString;\n            pls = olstyle.Polygon;\n        }\n\n        const cPoint = getLegendImage({\n            typeGeom: \"Point\",\n            style: pos\n        });\n        const cLineString = getLegendImage({\n            typeGeom: \"LineString\",\n            style: ls\n        });\n        const cPolygon = getLegendImage({\n            typeGeom: \"Polygon\",\n            style: pls\n        });\n        setPointStyleUrl(cPoint.toDataURL());\n        setLineStyleUrl(cLineString.toDataURL());\n        setPolyStyleUrl(cPolygon.toDataURL());\n    }, [featureStyle]);\n    const onToggle = () => {\n        props.onToggleStyleEditor(!isStyleEditorOpen);\n    };\n    const onInnerStyleChanged = (style: IVectorFeatureStyle) => {\n        onChange?.(isDefault ? DEFAULT_STYLE_KEY : localFilter, style);\n    }\n    let outerModifier;\n    if (!isLocalFilterValid) {\n        outerModifier = Intent.DANGER;\n    }\n    let colSpan = 5;\n    if (!props.enableLine)\n        colSpan--;\n    if (!props.enablePoint)\n        colSpan--;\n    if (!props.enablePolygon)\n        colSpan--;\n    const filterExprEd = <span>{featureStyle.label}</span> //<InputGroup intent={outerModifier} fill leftIcon={(isLocalFilterValid ? \"tick\" : \"warning-sign\")} title={localFilter} value={localFilter} onChange={e => setLocalFilter(e.target.value)} />;\n    return <>\n        <tr>\n            {props.enablePoint && <td>{pointStyleUrl && <img src={pointStyleUrl} />}</td>}\n            {props.enableLine && <td>{lineStyleUrl && <img src={lineStyleUrl} />}</td>}\n            {props.enablePolygon && <td>{polyStyleUrl && <img src={polyStyleUrl} />}</td>}\n            <td>{isDefault ? <strong>Default Style</strong> : filterExprEd}</td>\n            <td><Button intent={isStyleEditorOpen ? Intent.DANGER : Intent.PRIMARY} onClick={onToggle} icon={isStyleEditorOpen ? \"cross\" : \"edit\"} /></td>\n        </tr>\n        {isStyleEditorOpen && <tr>\n            <td colSpan={colSpan}>\n                <VectorStyleEditor style={featureStyle}\n                    onChange={onInnerStyleChanged}\n                    enableLine={props.enableLine}\n                    enablePoint={props.enablePoint}\n                    enablePolygon={props.enablePolygon}\n                    locale={props.locale} />\n            </td>\n        </tr>}\n    </>\n}\n\nexport const VectorLayerStyleEditor = (props: IVectorLayerStyleEditorProps) => {\n    const filters = Object.keys(props.style).filter(k => k != DEFAULT_STYLE_KEY);\n    const [openStyleEditors, setOpenStyleEditors] = React.useState<{ [filter: string]: boolean }>({});\n    const onFeatureStyleChanged = (filter: string, style: IVectorFeatureStyle) => {\n        const updatedStyle = {\n            ...props.style\n        };\n        updatedStyle[filter] = style;\n        props.onChange?.(updatedStyle);\n    };\n    const onToggleStyleEditor = (index: number | string, visible: boolean) => {\n        const opEds = { ...openStyleEditors };\n        if (!visible) {\n            delete opEds[index];\n        } else {\n            opEds[index] = true;\n        }\n        setOpenStyleEditors(opEds);\n    };\n    return <table style={{ width: \"100%\" }}>\n        <colgroup>\n            {props.enablePoint && <col span={1} style={{ width: 24 }} />}\n            {props.enableLine && <col span={1} style={{ width: 24 }} />}\n            {props.enablePolygon && <col span={1} style={{ width: 24 }} />}\n            <col span={1} />\n            <col span={1} style={{ width: 32 }} />\n        </colgroup>\n        <tbody>\n            {filters.map((f, i) => <FilterItem\n                key={`filter-${i}`}\n                filter={f}\n                isDefault={false}\n                onChange={(f, s) => onFeatureStyleChanged( f, s)}\n                featureStyle={props.style[filters[i]]}\n                isStyleEditorOpen={openStyleEditors[f] === true}\n                onToggleStyleEditor={(isVisible) => onToggleStyleEditor(f, isVisible)}\n                locale={props.locale}\n                enableLine={props.enableLine}\n                enablePoint={props.enablePoint}\n                enablePolygon={props.enablePolygon} />)}\n            <FilterItem\n                isDefault\n                onChange={(f, s) => onFeatureStyleChanged(DEFAULT_STYLE_KEY, s)}\n                featureStyle={props.style.default}\n                isStyleEditorOpen={openStyleEditors[DEFAULT_STYLE_KEY] === true}\n                onToggleStyleEditor={(isVisible) => onToggleStyleEditor(DEFAULT_STYLE_KEY, isVisible)}\n                locale={props.locale}\n                enableLine={props.enableLine}\n                enablePoint={props.enablePoint}\n                enablePolygon={props.enablePolygon} />\n        </tbody>\n    </table>;\n}","import * as React from \"react\";\nimport { IMapView, UnitOfMeasure } from \"../api/common\";\nimport { getUnitOfMeasure, getMapSize } from \"../utils/units\";\nimport { fmt } from '../api/i18n';\n\nexport interface IViewSizeProps {\n    /**\n     * Width in pixels\n     * \n     * @type {number}\n     * @memberof IViewSizeProps\n     */\n    width: number;\n    /**\n     * Height in pixels\n     * \n     * @type {number}\n     * @memberof IViewSizeProps\n     */\n    height: number;\n    /**\n     * Meters per unit\n     * \n     * @type {number}\n     * @memberof IViewSizeProps\n     */\n    metersPerUnit: number;\n    /**\n     * Decimal precision to display\n     * \n     * @type {number}\n     * @memberof IViewSizeProps\n     */\n    precision?: number;\n    /**\n     * The map view\n     * \n     * @type {IMapView}\n     * @memberof IViewSizeProps\n     */\n    view: IMapView;\n    /**\n     * The desired unit of measure to display the size in\n     * \n     * @type {UnitOfMeasure}\n     * @memberof IViewSizeProps\n     */\n    units: UnitOfMeasure;\n    /**\n     * @since 0.12.2\n     */\n    locale?: string;\n}\n\nconst ViewSizeContent = ({ gw, gh, unit }: { gw: number, gh: number, unit: string }) => {\n    const str = fmt(\"{gw} x {gh} ({unit})\", { gw, gh, unit });\n    return <span dangerouslySetInnerHTML={{ __html: str }} />;\n}\n\nexport const ViewSize = (props: IViewSizeProps) => {\n    const { width, height, view, metersPerUnit, units, precision, locale } = props;\n    const uom = getUnitOfMeasure(units);\n    const [gw, gh] = getMapSize([width, height], metersPerUnit, units, view.resolution, precision);\n    //TODO: Support format string extension parameter from fusion widget\n    return <div className=\"status-bar-component component-view-size\"><ViewSizeContent gw={gw} gh={gh} unit={uom.abbreviation(locale)} /></div>;\n};","/**\n * Non-breaking space\n */\nexport const NBSP = String.fromCharCode(160);\n\nexport const DEG = String.fromCharCode(176);\n\nexport const EMPTY_OBJECT = {};\n\nexport const MDF_INFINITY = 1000000000000.0;\n\nexport const WEBLAYOUT_TOOLBAR = \"Toolbar\";\nexport const WEBLAYOUT_TASKMENU = \"TaskMenu\";\nexport const WEBLAYOUT_CONTEXTMENU = \"MapContextMenu\";\n\nexport const FUSION_TASKPANE_NAME = \"TaskPane\";\nexport const FUSION_MAP_NAME = \"Map\";\nexport const FUSION_REDLINE_NAME = \"Redline\";\n\nexport const LAYER_ID_BASE = \"LAYER_ID_BASE\";\nexport const LAYER_ID_MG_BASE = \"LAYER_ID_MG_BASE\";\nexport const LAYER_ID_MG_SEL_OVERLAY = \"LAYER_ID_MG_SEL_OVERLAY\";\n\nexport const BLANK_GIF_DATA_URI = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";","/**\n * All valid action types\n * \n * @since 0.12\n */\nexport enum ActionType {\n    SET_LOCALE = 'MapGuide/SET_LOCALE',\n    \n    INIT_APP = 'MapGuide/INIT_APP',\n    INIT_ERROR = 'MapGuide/INIT_ERROR',\n    INIT_ACKNOWLEDGE_WARNINGS = 'MapGuide/INIT_ACKNOWLEDGE_WARNINGS',\n\n    LEGEND_SET_GROUP_VISIBILITY = 'Legend/SET_GROUP_VISIBILITY',\n    LEGEND_SET_LAYER_VISIBILITY = 'Legend/SET_LAYER_VISIBILITY',\n    LEGEND_SET_LAYER_SELECTABLE = 'Legend/SET_LAYER_SELECTABLE',\n    LEGEND_SET_GROUP_EXPANDABLE = 'Legend/SET_GROUP_EXPANDABLE',\n\n    MAP_SET_ACTIVE_MAP = 'Map/SET_ACTIVE_MAP',\n    MAP_REFRESH = 'Map/REFRESH',\n    MAP_SET_VIEW = 'Map/SET_VIEW',\n    MAP_SET_SCALE = 'Map/SET_SCALE',\n    MAP_SET_ACTIVE_TOOL = 'Map/SET_ACTIVE_TOOL',\n    MAP_SET_MAPTIP = 'Map/SET_MAPTIP',\n    MAP_SET_MANUAL_MAPTIP = 'Map/MAP_SET_MANUAL_MAPTIP',\n    MAP_SET_SELECTION = 'Map/SET_SELECTION',\n    /**\n     * @since 0.14\n     */\n    MAP_ADD_CLIENT_SELECTED_FEATURE = 'Map/ADD_CLIENT_SELECTED_FEATURE',\n    /**\n     * @since 0.14\n     */\n    MAP_CLEAR_CLIENT_SELECTION = 'Map/CLEAR_CLIENT_SELECTION',\n    MAP_SET_BUSY_COUNT = 'Map/SET_BUSY_COUNT',\n    MAP_SET_BASE_LAYER = 'Map/SET_BASE_LAYER',\n    MAP_ZOOM_IN = 'Map/ZOOM_IN',\n    MAP_ZOOM_OUT = 'Map/ZOOM_OUT',\n    MAP_PREVIOUS_VIEW = 'Map/PREVIOUS_VIEW',\n    MAP_NEXT_VIEW = 'Map/NEXT_VIEW',\n    MAP_SET_LAYER_TRANSPARENCY = 'Map/SET_LAYER_TRANSPARENCY',\n    MAP_SET_VIEW_SIZE_UNITS = 'Map/SET_VIEW_SIZE_UNITS',\n    MAP_SET_VIEW_ROTATION = 'Map/SET_VIEW_ROTATION',\n    MAP_SET_VIEW_ROTATION_ENABLED = 'Map/SET_VIEW_ROTATION_ENABLED',\n    MAP_RESIZED = 'Map/RESIZED',\n    MAP_SHOW_SELECTED_FEATURE = 'Map/SHOW_SELECTED_FEATURE',\n\n    TASK_INVOKE_URL = 'TaskPane/INVOKE_URL',\n    TASK_PANE_HOME = 'TaskPane/HOME',\n    TASK_PANE_FORWARD = 'TaskPane/FORWARD',\n    TASK_PANE_BACK = 'TaskPane/BACK',\n    TASK_PANE_PUSH_URL = 'TaskPane/PUSH_URL',\n\n    FUSION_SET_ELEMENT_STATE = 'Fusion/SET_ELEMENT_STATE',\n    FUSION_SET_TASK_PANE_VISIBILITY = 'Fusion/SET_TASK_PANE_VISIBILITY',\n    FUSION_SET_LEGEND_VISIBILITY = 'Fusion/SET_LEGEND_VISIBILITY',\n    FUSION_SET_SELECTION_PANEL_VISIBILITY = 'Fusion/SET_SELECTION_PANEL_VISIBILITY',\n    //FUSION_SET_OVERVIEW_MAP_VISIBILITY = 'Fusion/SET_OVERVIEW_MAP_VISIBILITY',\n    FLYOUT_OPEN = 'Flyout/OPEN',\n    FLYOUT_CLOSE = 'Flyout/CLOSE',\n    CONTEXT_MENU_OPEN  = 'ContextMenu/OPEN',\n    CONTEXT_MENU_CLOSE = 'ContextMenu/CLOSE',\n    COMPONENT_OPEN = 'Flyout/COMPONENT_OPEN',\n    COMPONENT_CLOSE = 'Flyout/COMPONENT_CLOSE',\n    UPDATE_MOUSE_COORDINATES = 'Status/UPDATE_MOUSE_COORDINATES',\n    MODAL_SHOW_COMPONENT = 'Modal/SHOW_COMPONENT',\n    MODAL_SHOW_URL = 'Modal/SHOW_URL',\n    MODAL_CLOSE = 'Modal/CLOSE',\n\n    /**\n     * @since 0.13\n     */\n    LAYER_ADDED = 'Map/LAYER_ADDED',\n    /**\n     * @since 0.14\n     */\n    EXTERNAL_LAYERS_READY = 'Map/EXTERNAL_LAYERS_READY',\n    /**\n     * @since 0.13\n     */\n    REMOVE_LAYER = 'Map/REMOVE_LAYER',\n    /**\n     * @since 0.13\n     */\n    SET_LAYER_INDEX = 'Map/SET_LAYER_INDEX',\n    /**\n     * @since 0.13\n     */\n    SET_LAYER_OPACITY = 'Map/SET_LAYER_OPACITY',\n    /**\n     * @since 0.13\n     */\n    SET_LAYER_VISIBILITY = 'Map/SET_LAYER_VISIBILITY',\n    /**\n     * @since 0.13\n     */\n    SET_LAYER_VECTOR_STYLE = 'Map/SET_LAYER_VECTOR_STYLE',\n    /**\n     * @since 0.13\n     */\n    ADD_LAYER_BUSY_WORKER = 'Map/ADD_LAYER_BUSY_WORKER',\n    /**\n     * @since 0.13\n     */\n    REMOVE_LAYER_BUSY_WORKER = 'Map/REMOVE_LAYER_BUSY_WORKER',\n    /**\n     * @since 0.14\n     */\n    SET_HEATMAP_LAYER_BLUR = 'Map/SET_HEATMAP_LAYER_BLUR',\n    /**\n     * @since 0.14\n     */\n    SET_HEATMAP_LAYER_RADIUS = 'Map/SET_HEATMAP_LAYER_RADIUS'\n}","export const STD_CSS_SPRITE_RELPATH = \"images/icons.png\";\n\nexport { default as CURSOR_DIGITIZE_POINT } from \"../../stdassets/cursors/digitizePoint.cur\";\nexport { default as CURSOR_DIGITIZE_LINE } from \"../../stdassets/cursors/digitizeLine.cur\";\nexport { default as CURSOR_DIGITIZE_LINESTRING } from \"../../stdassets/cursors/digitizeLineString.cur\";\nexport { default as CURSOR_DIGITIZE_RECT } from \"../../stdassets/cursors/digitizeRectangle.cur\";\nexport { default as CURSOR_DIGITIZE_POLYGON } from \"../../stdassets/cursors/digitizePolygon.cur\";\nexport { default as CURSOR_DIGITIZE_CIRCLE } from \"../../stdassets/cursors/digitizeCircle.cur\";\nexport { default as CURSOR_GRABBING } from \"../../stdassets/cursors/grabbing.cur\";\nexport { default as CURSOR_GRAB } from \"../../stdassets/cursors/grab.cur\";\nexport { default as CURSOR_ZOOM_IN } from \"../../stdassets/cursors/zoomin.cur\";\n\nexport { default as IMG_SLIDER_SCALE } from \"../../stdassets/images/res/sliderscale.png\";\nexport { default as GIF_SPINNER } from \"../../stdassets/images/res/spinner.gif\";\nexport { default as IMG_SLIDER } from \"../../stdassets/images/res/slider.png\";\n\nexport { default as IMG_PBMG } from \"../../stdassets/images/icons/PoweredBy_en.png\";\n\nexport { default as ICON_ABOUT } from \"../../stdassets/images/icons/about.png\";\nexport { default as ICON_APPLICATION_BROWSER } from \"../../stdassets/images/icons/application-browser.png\";\nexport { default as ICON_BACK } from \"../../stdassets/images/icons/back.png\";\nexport { default as ICON_BUFFER } from \"../../stdassets/images/icons/buffer.png\";\nexport { default as ICON_CONTROL_180 } from \"../../stdassets/images/icons/control-180.png\";\nexport { default as ICON_CONTROL_STOP_180 } from \"../../stdassets/images/icons/control-stop-180.png\";\nexport { default as ICON_CONTROL_STOP } from \"../../stdassets/images/icons/control-stop.png\";\nexport { default as ICON_CONTROL } from \"../../stdassets/images/icons/control.png\";\nexport { default as ICON_COORDINATE_TRACKER } from \"../../stdassets/images/icons/coordinate-tracker.png\";\nexport { default as ICON_EDIT_COPY } from \"../../stdassets/images/icons/edit-copy.png\";\nexport { default as ICON_EDIT_CUT } from \"../../stdassets/images/icons/edit-cut.png\";\nexport { default as ICON_EDIT_DUPLICATE } from \"../../stdassets/images/icons/edit-duplicate.png\";\nexport { default as ICON_EDIT_PASTE } from \"../../stdassets/images/icons/edit-paste.png\";\nexport { default as ICON_EDIT_XML } from \"../../stdassets/images/icons/edit-xml.png\";\nexport const ICON_ERROR = \"data:image/png;base64,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\"; //require(\"../../stdassets/images/icons/icon_error.png\");\nexport { default as ICON_FEATURE_INFO } from \"../../stdassets/images/icons/feature-info.png\";\nexport { default as ICON_FILE_PRINT } from \"../../stdassets/images/icons/file-print.png\";\nexport { default as ICON_FILE_SAVE } from \"../../stdassets/images/icons/file-save.png\";\nexport { default as ICON_FOLDER_HORIZONTAL_OPEN } from \"../../stdassets/images/icons/folder-horizontal-open.png\";\nexport { default as ICON_FOLDER_HORIZONTAL } from \"../../stdassets/images/icons/folder-horizontal.png\";\nexport { default as ICON_FORWARD } from \"../../stdassets/images/icons/forward.png\";\nexport { default as ICON_GEOLOCATION } from \"../../stdassets/images/icons/geolocation.png\";\nexport { default as ICON_HELP } from \"../../stdassets/images/icons/help.png\";\nexport { default as ICON_HOME } from \"../../stdassets/images/icons/icon_home.png\";\nexport { default as ICON_MENUARROW_DISABLED } from \"../../stdassets/images/icons/icon_menuarrow_disabled.png\";\nexport { default as ICON_MENUARROW } from \"../../stdassets/images/icons/icon_menuarrow.png\";\nexport { default as ICON_MENUARROWUP_DISABLED } from \"../../stdassets/images/icons/icon_menuarrowup_disabled.png\";\nexport { default as ICON_MENUARROWUP } from \"../../stdassets/images/icons/icon_menuarrowup.png\";\nexport { default as ICON_REFRESHMAP } from \"../../stdassets/images/icons/icon_refreshmap.png\";\nexport { default as ICON_SELECT } from \"../../stdassets/images/icons/select.png\";\nexport { default as ICON_ZOOMSELECT } from \"../../stdassets/images/icons/icon_zoomselect.png\";\nexport { default as ICON_NAVIGATOR } from \"../../stdassets/images/icons/iconNavigator.png\";\nexport { default as ICON_INFO } from \"../../stdassets/images/icons/info.png\";\nexport { default as ICON_INITIAL_CENTER } from \"../../stdassets/images/icons/initial-center.png\";\nexport { default as ICON_INVOKE_SCRIPT } from \"../../stdassets/images/icons/invoke-script.png\";\nexport { default as ICON_INVOKE_URL } from \"../../stdassets/images/icons/invoke-url.png\";\nexport { default as ICON_UNSELECT } from \"../../stdassets/images/icons/lc_unselect.png\";\nexport { default as ICON_LEGEND_DWF } from \"../../stdassets/images/icons/legend-DWF.png\";\nexport { default as ICON_LEGEND_LAYER } from \"../../stdassets/images/icons/legend-layer.png\";\nexport { default as ICON_LEGEND_MAP } from \"../../stdassets/images/icons/legend-map.png\";\nexport { default as ICON_LEGEND_RASTER } from \"../../stdassets/images/icons/legend-raster.png\";\nexport { default as ICON_LEGEND_THEME } from \"../../stdassets/images/icons/legend-theme.png\";\nexport { default as ICON_MAPTIP } from \"../../stdassets/images/icons/maptip.png\";\nexport { default as ICON_MEASURE } from \"../../stdassets/images/icons/measure.png\";\nexport { default as ICON_OPTIONS } from \"../../stdassets/images/icons/options.png\";\nexport { default as ICON_OUT_OF_RANGE } from \"../../stdassets/images/icons/out-of-range.png\";\nexport { default as ICON_OVERVIEW_MAP } from \"../../stdassets/images/icons/overview-map.png\";\nexport { default as ICON_PAN_EAST } from \"../../stdassets/images/icons/pan-east.png\";\nexport { default as ICON_PAN_NORTH } from \"../../stdassets/images/icons/pan-north.png\";\nexport { default as ICON_PAN_SOUTH } from \"../../stdassets/images/icons/pan-south.png\";\nexport { default as ICON_PAN_WEST } from \"../../stdassets/images/icons/pan-west.png\";\nexport { default as ICON_PAN } from \"../../stdassets/images/icons/pan.png\";\nexport { default as ICON_PREVIEW } from \"../../stdassets/images/icons/preview.png\";\nexport { default as ICON_PRINT } from \"../../stdassets/images/icons/print.png\";\nexport { default as ICON_PROPERTY } from \"../../stdassets/images/icons/property.png\";\nexport { default as ICON_QUERY } from \"../../stdassets/images/icons/query.png\";\nexport { default as ICON_REDLINE } from \"../../stdassets/images/icons/redline.png\";\nexport { default as ICON_SEARCH } from \"../../stdassets/images/icons/search.png\";\nexport { default as ICON_SELECT_CENTRE } from \"../../stdassets/images/icons/select-centre.png\";\nexport { default as ICON_SELECT_CLEAR } from \"../../stdassets/images/icons/select-clear.png\";\nexport { default as ICON_SELECT_FEATURES } from \"../../stdassets/images/icons/select-features.png\";\nexport { default as ICON_SELECT_POLYGON } from \"../../stdassets/images/icons/select-polygon.png\";\nexport { default as ICON_SELECT_RADIUS } from \"../../stdassets/images/icons/select-radius.png\";\nexport { default as ICON_SELECT_ZOOM } from \"../../stdassets/images/icons/select-zoom.png\";\nexport { default as ICON_THEME } from \"../../stdassets/images/icons/theme.png\";\nexport { default as ICON_TOGGLE_EXPAND } from \"../../stdassets/images/icons/toggle-expand.png\";\nexport { default as ICON_TOGGLE } from \"../../stdassets/images/icons/toggle.png\";\nexport { default as ICON_UI_MENU } from \"../../stdassets/images/icons/ui-menu.png\";\nexport { default as ICON_VIEW_BACK } from \"../../stdassets/images/icons/view-back.png\";\nexport { default as ICON_VIEW_FORWARD } from \"../../stdassets/images/icons/view-forward.png\";\nexport { default as ICON_VIEW_REFRESH } from \"../../stdassets/images/icons/view-refresh.png\";\nexport { default as ICON_WARNING } from \"../../stdassets/images/icons/icon_warning.png\";\nexport { default as ICON_ZOOM_DYNAMIC } from \"../../stdassets/images/icons/zoom-dynamic.png\";\nexport { default as ICON_ZOOM_FULL } from \"../../stdassets/images/icons/zoom-full.png\";\nexport { default as ICON_ZOOM_IN_FIXED } from \"../../stdassets/images/icons/zoom-in-fixed.png\";\nexport { default as ICON_ZOOM_IN } from \"../../stdassets/images/icons/zoom-in.png\";\nexport { default as ICON_ZOOM_OUT_FIXED } from \"../../stdassets/images/icons/zoom-out-fixed.png\";\nexport { default as ICON_LAYER_ADD } from \"../../stdassets/images/icons/layer_add.png\";\nexport { default as ICON_GLOBE_ADD } from \"../../stdassets/images/icons/globe_add.png\";\n/** \n * @since 0.11\n */\nexport { default as ICON_GLOBE_SHARE } from \"../../stdassets/images/icons/globe-share.png\";\n\nexport const SPRITE_GLOBE_ADD = \"globe_add\";\nexport const SPRITE_LAYER_ADD = \"layer_add\";\nexport const SPRITE_COORDINATE_TRACKER = \"coordinate-tracker\";\nexport const SPRITE_CONTROL_180 = \"control-180\";\nexport const SPRITE_CONTROL = \"control\";\nexport const SPRITE_ICON_ZOOMSELECT = \"icon_zoomselect\";\nexport const SPRITE_LEGEND_LAYER = \"legend-layer\";\nexport const SPRITE_ICON_SELECT = \"icon_select\";\nexport const SPRITE_LC_UNSELECT = \"lc_unselect\";\nexport const SPRITE_LEGEND_THEME = \"legend-theme\";\nexport const SPRITE_LEGEND_RASTER = \"legend-raster\";\nexport const SPRITE_LEGEND_TOGGLE = \"toggle\";\nexport const SPRITE_LEGEND_TOGGLE_EXPAND = \"toggle-expand\";\nexport const SPRITE_FOLDER_HORIZONTAL = \"folder-horizontal\";\nexport const SPRITE_ICON_ERROR = \"icon_error\";\nexport const SPRITE_ICON_HOME = \"icon_home\";\nexport const SPRITE_BACK = \"back\";\nexport const SPRITE_FORWARD = \"forward\";\nexport const SPRITE_ICON_MENUARROWUP = \"icon_menuarrowup\";\nexport const SPRITE_ICON_MENUARROW = \"icon_menuarrow\";\nexport const SPRITE_SELECT = \"select\";\nexport const SPRITE_PAN = \"pan\";\nexport const SPRITE_ZOOM_IN = \"zoom-in\";\nexport const SPRITE_ZOOM_IN_FIXED = \"zoom-in-fixed\";\nexport const SPRITE_ZOOM_OUT_FIXED = \"zoom-out-fixed\";\nexport const SPRITE_ZOOM_FULL = \"zoom-full\";\nexport const SPRITE_MAPTIP = \"maptip\";\nexport const SPRITE_PAN_WEST = \"pan-west\";\nexport const SPRITE_PAN_EAST = \"pan-east\";\nexport const SPRITE_PAN_NORTH = \"pan-north\";\nexport const SPRITE_PAN_SOUTH = \"pan-south\";\nexport const SPRITE_ABOUT = \"about\";\nexport const SPRITE_HELP = \"help\";\nexport const SPRITE_MEASURE = \"measure\";\nexport const SPRITE_PRINT = \"print\";\nexport const SPRITE_OPTIONS = \"options\";\nexport const SPRITE_SELECT_RADIUS = \"select-radius\";\nexport const SPRITE_SELECT_POLYGON = \"select-polygon\";\nexport const SPRITE_INITIAL_CENTER = \"initial-center\";\nexport const SPRITE_SELECT_CLEAR = \"select-clear\";\nexport const SPRITE_ICON_REFRESHMAP = \"icon_refreshmap\";\nexport const SPRITE_VIEW_BACK = \"view-back\";\nexport const SPRITE_VIEW_FORWARD = \"view-forward\";\nexport const SPRITE_GEOLOCATION = \"geolocation\";\nexport const SPRITE_BUFFER = \"buffer\";\nexport const SPRITE_SELECT_FEATURES = \"select-features\";\nexport const SPRITE_REDLINE = \"redline\";\nexport const SPRITE_FEATURE_INFO = \"feature-info\";\nexport const SPRITE_QUERY = \"query\";\nexport const SPRITE_THEME = \"theme\";\nexport const SPRITE_INVOKE_SCRIPT = \"invoke-script\";\nexport const SPRITE_INVOKE_URL = \"invoke-url\";\nexport const SPRITE_SELECT_CENTRE = \"select-centre\";\n/** \n * @since 0.11\n */\nexport const SPRITE_GLOBE_SHARE = \"globe-share\";\n\n/**\n * Default map marker icon \n * \n * source: https://www.iconfinder.com/paomedia\n * used under CC-BY 3.0\n * @since 0.13\n */\nexport const MAP_MARKER_ICON = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEZUlEQVRYR8WWXUxbZRjHn/ecnlLaHqBkyIeAwIaTUuIH4GiB9Yxo5sZIZiLGJSYu8YY74wW7cIksLplxIXq5mF1o9Ga6GNTAFqKGImsLMrwYBYeOBWSUUeWjPf047fl4zWEhnrK2p6ebsbfP+///f+d53/fpi+B//iGt+XO9Vr0lUtyFELYDQpUgAUII/EDAJCvQP9Rfvx7X4pk1AG5upu5XGN4BjM8AECVpQjYxwCfxsG6w1uXisgHJCuCvo53lAgnfAYFbszGVAGaRJPVUXPMsq61XBfD3MPsQTrgBiKfVzJR1jOEeReJDJd+7/Zl0qgBrJ9pHANBxLeH/rsUTZcNuJwLA6fQZAda6O7sB4eFUYlHCEBOFHWuDjgQdQaTMQBidKhuZuJITwOorHW5CB46k1gKG9UgMQlwcMEjrEhASCVBeYMiDUlM+IEj+JhGwr3LY3aQZINDLmPkoHyQQSvo0PxsBlk98ThLE+c4bs3dl47G2Z2oQQQ6YKer0k7T5oSxESaVlQ55AKoi0W3C/h2nDWPAqRVFegJUQO8B45z5IZTbmsJ2rok0DJopKKou8dKJy1DOiCeD3l1/so/P0l5Siv8PRVZvr16p0hwoDELNHnr9XYjKVK3URXnz/wKj3vCaA+Zda+i0Gw0WlaDPCfdU4dvONTDdirqvl62KjoVe5ZpuLDzb8ON2vCWCGeeHNCrPxS6UozMe/qR+dfi0TwOLRQ0NGijqpXBMIx/qfdc0MagIYb7M11BQXzOsV14sX8UZVgCtHMzN8KrM/jh3Ly8fba6SOtOzWRYzhztaGg/HcTjpPu/W0h1DeTx/THNpnzjcpwxDA5dKWG33oHEjJ1xPQWnfHZYTg7aRt46JCQNikj7iWUv43ZBxEP9utl2otRX0PDRlJGscEXKAI5OUxJ5LI0C4J+CwQhFMZLmEMy1uhbx2e2Vc1zwFZMNFuraYp/Z1Sszn5XmU6BIpaIMbhjXC8tWtqdiYnAFnksjd9XFtEv6snU4/adMaCJMHidvAK45k7lYlX9c/IY28spkjdn5VFdNJZUGuCn40kwlH+gHPat/JIADtdaGs8U11Ef5Sv06nl7tTjgghLweCHjHf+PTWBagdkgzGmxmCUCperC+gn1Azl+grLbiUE7qkO9wKrtj4rgB2INuvpykL6M/OeOb83IMLzsBpi+5ze+U/VwuV61gDyXPA4bLfrLEX16VTyq2M5GFpcKTt48PWrV8XHCiCbjbc3HC8z0iMFefqU3kEuAesxttvp/u1aNuGaOrBr6Om0emoKLfa9Dw956CxtsxPt7luHsw3PCcDlaGwtMeb/UmwwJOUEojEcjMSfOzzlu/WfAuxMSIdtqM5SeJJAD46QIGG4uxX8wun1vaUlPKcOyKKfHLb9hTpioZymSYwB/OFwPCFydR3uhYxP8FRwWd+CvWKX3XoRAD14ZGB0lpn0XdD69Tl3YDfI5WiyS5IodU3OT+US/sgAuYYqdTlvweMIlz3+AXmLlDDLPM0mAAAAAElFTkSuQmCC\";\n\n/**\n * Blueprint SVG icon names used by this viewer\n * @since 0.13\n */\nexport type BlueprintSvgIconNames =\n    \"arrow-left\" |\n    \"arrow-right\" |\n    \"arrows-horizontal\" |\n    \"application\" |\n    \"caret-down\" |\n    \"caret-up\" |\n    \"chevron-down\" |\n    \"chevron-right\" |\n    \"chevron-up\" |\n    \"cross\" |\n    \"delete\" |\n    \"disable\" |\n    \"double-caret-vertical\" |\n    \"error\" |\n    \"folder-close\" |\n    \"geosearch\" |\n    \"home\" |\n    \"info-sign\" |\n    \"issue\" |\n    \"layer\" |\n    \"layers\" |\n    \"media\" |\n    \"menu-closed\" |\n    \"menu-open\" |\n    \"multi-select\" |\n    \"new-layer\" |\n    \"path-search\" |\n    \"play\" |\n    \"print\" |\n    \"search\" |\n    \"select\" |\n    \"small-cross\" |\n    \"stop\" |\n    \"tag\" |\n    \"th\" |\n    \"warning-sign\";","import * as React from \"react\";\nimport { tr } from \"../api/i18n\";\nimport { ILayerInfo, Bounds, LayerProperty, IMapViewer } from \"../api/common\";\nimport { ManageLayers } from \"../components/layer-manager/manage-layers\";\nimport { AddLayer } from \"../components/layer-manager/add-layer\";\nimport { Tabs, Tab, Icon } from '@blueprintjs/core';\nimport { useViewerLocale, useActiveMapName, useActiveMapLayers, useActiveMapView } from './hooks';\nimport olVectorLayer from \"ol/layer/Vector\";\nimport olClusterSource from \"ol/source/Cluster\";\nimport { transformExtent } from \"ol/proj\";\nimport { mapLayerAdded, addMapLayerBusyWorker, removeMapLayerBusyWorker, removeMapLayer, setMapLayerIndex, setMapLayerVisibility, setMapLayerOpacity, setMapLayerVectorStyle, setHeatmapLayerBlur, setHeatmapLayerRadius } from '../actions/map';\nimport { getViewer } from '../api/runtime';\nimport { IVectorLayerStyle, VectorStyleSource } from '../api/ol-style-contracts';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\n\nexport function zoomToLayerExtents(layerName: string, viewer: IMapViewer) {\n    const layer = viewer.getLayerManager().getLayer(layerName);\n    // If the layer has a WGS84 bbox, we'll use that\n    const ll_bbox = layer?.get(LayerProperty.WGS84_BBOX);\n    if (ll_bbox) {\n        const zoomBounds = transformExtent(ll_bbox, \"EPSG:4326\", viewer.getProjection());\n        viewer.zoomToExtent(zoomBounds as Bounds);\n    } else if (layer instanceof olVectorLayer) {\n        const source = layer.getSource();\n        let bounds;\n        if (source instanceof olClusterSource) {\n            bounds = source.getSource().getExtent();\n        } else {\n            bounds = source.getExtent();\n        }\n        const sp = source.getProjection();\n        const dp = viewer.getProjection();\n        if (sp && dp) {\n            bounds = transformExtent(bounds, sp, dp);\n        }\n        if (Number.isFinite(bounds[0]) &&\n            Number.isFinite(bounds[1]) &&\n            Number.isFinite(bounds[2]) &&\n            Number.isFinite(bounds[3])) {\n            viewer.zoomToExtent(bounds as Bounds);\n        } else {\n            console.warn(`Attempted to zoom to invalid bounds for layer: ${layerName}`);\n        }\n    }\n}\n\n/**\n * \n * @since 0.11\n * @export\n * @interface IAddManageLayersContainerProps\n */\nexport interface IAddManageLayersContainerProps {\n\n}\n\nexport const AddManageLayersContainer = () => {\n    const dispatch = useReduxDispatch();\n    const locale = useViewerLocale();\n    const activeMapName = useActiveMapName();\n    const layers = useActiveMapLayers();\n    const view = useActiveMapView();\n    const getLayerIndex = (layerName: string) => {\n        if (layers) {\n            for (let i = 0; i < layers.length; i++) {\n                if (layers[i].name == layerName) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    };\n    const onLayerAdded = (layer: ILayerInfo) => {\n        if (activeMapName) {\n            dispatch(mapLayerAdded(activeMapName, layer));\n        }\n    };\n    const onAddLayerBusyWorker = (name: string) => {\n        if (activeMapName) {\n            dispatch(addMapLayerBusyWorker(activeMapName, name));\n        }\n    }\n    const onRemoveLayerBusyWorker = (name: string) => {\n        if (activeMapName) {\n            dispatch(removeMapLayerBusyWorker(activeMapName, name));\n        }\n    };\n    const removeHandler = (layerName: string) => {\n        if (activeMapName) {\n            dispatch(removeMapLayer(activeMapName, layerName));\n        }\n    };\n    const upHandler = (layerName: string) => {\n        const newIndex = getLayerIndex(layerName);\n        if (activeMapName && newIndex >= 0) {\n            dispatch(setMapLayerIndex(activeMapName, layerName, newIndex - 1));\n        }\n    };\n    const downHandler = (layerName: string) => {\n        const newIndex = getLayerIndex(layerName);\n        if (layers && activeMapName && newIndex < layers.length - 1) {\n            dispatch(setMapLayerIndex(activeMapName, layerName, newIndex + 1));\n        }\n    };\n    const zoomToBounds = (layerName: string) => {\n        const viewer = getViewer();\n        if (viewer) {\n            zoomToLayerExtents(layerName, viewer);\n        }\n    };\n    const setVisibility = (layerName: string, visible: boolean) => {\n        if (activeMapName) {\n            dispatch(setMapLayerVisibility(activeMapName, layerName, visible));\n        }\n    };\n    const setOpacity = (layerName: string, value: number) => {\n        if (activeMapName) {\n            dispatch(setMapLayerOpacity(activeMapName, layerName, value));\n        }\n    };\n    const setHeatmapBlur = (layerName: string, value: number) => {\n        if (activeMapName) {\n            dispatch(setHeatmapLayerBlur(activeMapName, layerName, value));\n        }\n    };\n    const setHeatmapRadius = (layerName: string, value: number) => {\n        if (activeMapName) {\n            dispatch(setHeatmapLayerRadius(activeMapName, layerName, value));\n        }\n    };\n    const updateVectorStyle = (layerName: string, value: IVectorLayerStyle, which: VectorStyleSource) => {\n        if (activeMapName) {\n            dispatch(setMapLayerVectorStyle(activeMapName, layerName, value, which));\n        }\n    }\n    if (layers) {\n        return <div style={{ padding: 8 }}>\n            <Tabs id=\"tabs\" renderActiveTabPanelOnly={true}>\n                <Tab id=\"add_layer\" title={<span><Icon icon=\"new-layer\" iconSize={Icon.SIZE_STANDARD} /> {tr(\"ADD_LAYER\", locale)}</span>} panel={<AddLayer onLayerAdded={onLayerAdded} onAddLayerBusyWorker={onAddLayerBusyWorker} onRemoveLayerBusyWorker={onRemoveLayerBusyWorker} locale={locale} />} />\n                <Tab id=\"manage_layers\" title={<span><Icon icon=\"layers\" iconSize={Icon.SIZE_STANDARD} /> {tr(\"MANAGE_LAYERS\", locale)}</span>} panel={<ManageLayers layers={layers}\n                    locale={locale}\n                    currentResolution={view?.resolution}\n                    onSetOpacity={setOpacity}\n                    onSetHeatmapBlur={setHeatmapBlur}\n                    onSetHeatmapRadius={setHeatmapRadius}\n                    onSetVisibility={setVisibility}\n                    onZoomToBounds={zoomToBounds}\n                    onMoveLayerDown={downHandler}\n                    onMoveLayerUp={upHandler}\n                    onRemoveLayer={removeHandler}\n                    onVectorStyleChanged={updateVectorStyle} />} />\n            </Tabs>\n        </div>;\n    } else {\n        return <></>;\n    }\n};\n","import * as React from \"react\";\nimport { getLayout, LayoutCapabilities } from \"../api/registry/layout\";\nimport {\n    IExternalBaseLayer,\n    IBranchedMapSubState,\n    ClientKind,\n    InitError,\n    IMapViewer\n} from \"../api/common\";\nimport { IInitAppLayout, initLayout } from \"../actions/init\";\nimport { Error, normalizeStack } from \"../components/error\";\nimport { tr, DEFAULT_LOCALE } from \"../api/i18n\";\nimport { getAssetRoot } from \"../utils/asset\";\nimport { setFusionRoot } from \"../api/runtime\";\nimport { AppContext } from \"../components/context\";\nimport { IElementState } from '../actions/defs';\nimport { NonIdealState, Spinner, Intent, Callout } from '@blueprintjs/core';\nimport { useInitError, useInitErrorStack, useInitErrorOptions, useViewerLocale, useActiveMapBranch, useActiveMapName, useViewerFeatureTooltipsEnabled } from './hooks';\nimport { getStateFromUrl, IAppUrlState, updateUrl } from './url-state';\nimport { debug } from '../utils/logger';\nimport { setElementStates } from '../actions/template';\nimport { IViewerInitCommand } from '../actions/init-command';\nimport { ApplicationDefinition } from '../api/contracts/fusion';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\n\nexport interface SelectionOptions {\n    allowHtmlValues?: boolean;\n    cleanHtml?: (value: string) => string;\n}\n\n/**\n * MapGuide-specific application options\n *\n * @export\n * @interface IMapGuideAppProps\n * @since 0.14\n */\nexport interface IMapGuideAppProps {\n    /**\n     * A session id to init this viewer with\n     */\n    session?: string;\n    /**\n     * The mapagent URI\n     *\n     * @type {string}\n     * @memberof IMapGuideAppProps\n     */\n    agentUri: string;\n    /**\n     * The agent kind\n     *\n     * @type {ClientKind}\n     * @memberof IMapGuideAppProps\n     */\n    agentKind?: ClientKind;\n    /**\n     * The base URL for fusion. Used to determine the paths to the PHP backends for servicing tools like buffer/theme/featureinfo/redline/theme/etc\n     */\n    fusionRoot: string;\n    /**\n     * Settings that control the selection panel (if provided by the template)\n     */\n    selectionSettings?: SelectionOptions;\n    /**\n     * Defines initial element visibility\n     *\n     * @type {{\n        *         taskpane: boolean;\n        *         legend: boolean;\n        *         selection: boolean;\n        *     }}\n        */\n       initialElementVisibility: {\n           taskpane: boolean;\n           legend: boolean;\n           selection: boolean;\n       }\n}\n\n/**\n * Describes an ad-hoc layout template\n * \n * @since 0.14\n */\nexport type AdHocLayoutTemplate = {\n    factory: (() => React.ReactNode);\n    capabilities: LayoutCapabilities;\n}\n\n/**\n * App component properties\n *\n * @export\n * @interface IAppProps\n */\nexport interface IAppProps {\n    /**\n     * The command that will carry out viewer initialization\n     *\n     * @type {IViewerInitCommand}\n     * @memberof IAppProps\n     * @since 0.14\n     */\n    initCommand: IViewerInitCommand;\n    /**\n     * The layout to use\n     * @since 0.14 type changed to include AdHocLayoutTemplate\n     */\n    layout: string | AdHocLayoutTemplate;\n    /**\n     * A resource id to a Web Layout or Application Definition or a function that will fetch the required Application Definition. \n     *\n     * @memberof IAppProps\n     */\n    resourceId: string | (() => Promise<ApplicationDefinition>);\n    /**\n     * The list of external base layers\n     *\n     * @type {IExternalBaseLayer[]}\n     * @memberof IAppProps\n     * \n     * @remarks This option is for when you are passing in a Web Layout to the viewer, but you still want to provide external \n     * base layers. If passing in an Application Definition, this option is redundant as the Application Definition itself can\n     * define the set of external base layers\n     */\n    externalBaseLayers?: IExternalBaseLayer[];\n    /**\n     * If specified, tells the application to not sync the following URL params to the URL, and to skip\n     * reading these params when initializing/refreshing.\n     *\n     * @type {string[]}\n     * @memberof IAppProps\n     * @since 0.14\n     */\n    urlPropsIgnore?: string[];\n    /**\n     * A callback function that will be called when the viewer has finished initializing\n     */\n    onInit?: (viewer: IMapViewer) => void;\n    /**\n     * The locale to use\n     */\n    locale?: string;\n    /**\n     * MapGuide-specific options\n     *\n     * @type {IMapGuideAppProps}\n     * @memberof IAppProps\n     * @since 0.14\n     */\n    mapguide?: IMapGuideAppProps;\n}\n\n/**\n * App component state\n *\n * @export\n * @interface IAppState\n */\nexport interface IAppState {\n    error: InitError | undefined;\n    includeStack: boolean;\n    initOptions: any;\n    //config: IConfigurationReducerState;\n    configuredLocale: string;\n    map: IBranchedMapSubState | undefined;\n    activeMapName: string | undefined;\n    featureTooltipsEnabled: boolean;\n}\n\n/**\n * App component action dispatchers\n *\n * @export\n * @interface IAppDispatch\n */\nexport interface IAppDispatch {\n    initLayout: (cmd: IViewerInitCommand, args: IInitAppLayout) => void;\n    setElementVisibility: (states: IElementState) => void;\n}\n\ntype AppInnerProps = IAppProps & IAppState & IAppDispatch;\n\nclass AppInner extends React.Component<AppInnerProps, any> {\n    constructor(props: AppInnerProps) {\n        super(props);\n        this.state = {\n            isLoading: true\n        };\n    }\n    private allowHtmlValuesInSelection(): boolean {\n        return this.props.mapguide?.selectionSettings?.allowHtmlValues ?? false;\n    }\n    private getHtmlCleaner(): (value: string) => string {\n        return this.props.mapguide?.selectionSettings?.cleanHtml ?? (v => v);\n    }\n    componentDidMount() {\n        const {\n            onInit,\n            setElementVisibility,\n            mapguide,\n            initLayout,\n            locale,\n            resourceId,\n            externalBaseLayers,\n            initCommand\n        } = this.props;\n        const {\n            locale: urlLocale,\n            resource: urlResource,\n            session: urlSession,\n            x: urlX,\n            y: urlY,\n            ft: urlFeatureTooltip,\n            scale: urlScale,\n            map: urlMap,\n            sl: urlShowLayers,\n            hl: urlHideLayers,\n            sg: urlShowGroups,\n            hg: urlHideGroups\n        } = getStateFromUrl(this.props.urlPropsIgnore);\n        if (setElementVisibility && mapguide?.initialElementVisibility) {\n            const { taskpane, legend, selection } = mapguide.initialElementVisibility;\n            const states: IElementState = {\n                taskPaneVisible: typeof (taskpane) != 'undefined' ? taskpane : true,\n                legendVisible: typeof (legend) != 'undefined' ? legend : true,\n                selectionPanelVisible: typeof (selection) != 'undefined' ? selection : true\n            };\n            setElementVisibility(states);\n        }\n        debug(`Asset root is: ${getAssetRoot()}`);\n        if (mapguide?.fusionRoot) {\n            setFusionRoot(mapguide.fusionRoot);\n        }\n        if (initLayout) {\n            let ftArgs: Partial<IInitAppLayout> | undefined;\n            if (typeof (urlFeatureTooltip) != 'undefined') {\n                ftArgs = {\n                    featureTooltipsEnabled: urlFeatureTooltip\n                }\n            }\n            let amArgs: Partial<IInitAppLayout> | undefined;\n            if (urlMap) {\n                amArgs = {\n                    initialActiveMap: urlMap\n                };\n            }\n            let ivArgs: Partial<IInitAppLayout> | undefined;\n            if (urlX && urlY && urlScale) {\n                ivArgs = {\n                    initialView: {\n                        x: urlX,\n                        y: urlY,\n                        scale: urlScale\n                    }\n                };\n            }\n            let slArgs: Partial<IInitAppLayout> | undefined;\n            if (urlShowLayers) {\n                slArgs = {\n                    initialShowLayers: [...urlShowLayers]\n                };\n            }\n            let hlArgs: Partial<IInitAppLayout> | undefined;\n            if (urlHideLayers) {\n                hlArgs = {\n                    initialHideLayers: [...urlHideLayers]\n                };\n            }\n            let sgArgs: Partial<IInitAppLayout> | undefined;\n            if (urlShowGroups) {\n                sgArgs = {\n                    initialShowGroups: [...urlShowGroups]\n                };\n            }\n            let hgArgs: Partial<IInitAppLayout> | undefined;\n            if (urlHideGroups) {\n                hgArgs = {\n                    initialHideGroups: [...urlHideGroups]\n                };\n            }\n            const args: IInitAppLayout = {\n                ...{\n                    resourceId: urlResource ?? resourceId,\n                    locale: urlLocale ?? locale ?? DEFAULT_LOCALE,\n                    externalBaseLayers: externalBaseLayers,\n                    session: urlSession ?? mapguide?.session,\n                    onInit: onInit,\n                    layout: typeof(this.props.layout) == 'string' ? this.props.layout : undefined\n                },\n                ...(ftArgs ?? {}),\n                ...(amArgs ?? {}),\n                ...(ivArgs ?? {}),\n                ...(slArgs ?? {}),\n                ...(hlArgs ?? {}),\n                ...(sgArgs ?? {}),\n                ...(hgArgs ?? {})\n            };\n            initLayout(initCommand, args);\n        }\n    }\n    componentDidUpdate(prevProps: AppInnerProps) {\n        const nextProps = this.props;\n        const curUrlState = getStateFromUrl();\n        //Preserve locale/resources/session if already present in url\n        const nextUrlState: IAppUrlState = {\n            locale: curUrlState.locale ?? this.props.locale,\n            session: curUrlState.session ?? this.props.mapguide?.session\n        };\n        if (typeof(this.props.resourceId) == 'string') {\n            nextUrlState.resource = curUrlState.resource ?? this.props.resourceId\n        }\n        if (nextProps.featureTooltipsEnabled != prevProps.featureTooltipsEnabled) {\n            nextUrlState.ft = nextProps.featureTooltipsEnabled;\n        }\n        if (nextProps.map != null && prevProps.map != nextProps.map) {\n            this.setState({ isLoading: false });\n        }\n        if (nextProps.activeMapName) {\n            const am = nextProps.activeMapName;\n            nextUrlState.map = am;\n        }\n        if (nextProps.map) {\n            if (nextProps.map.currentView) {\n                const { x, y, scale } = nextProps.map.currentView;\n                nextUrlState.x = x;\n                nextUrlState.y = y;\n                nextUrlState.scale = scale;\n            }\n            const mgs = nextProps.map.mapguide;\n            if (mgs) {\n                const rtm = mgs.runtimeMap;\n                const { showGroups, showLayers, hideGroups, hideLayers } = mgs;\n                const sg = [] as string[];\n                const hg = [] as string[];\n                const sl = [] as string[];\n                const hl = [] as string[];\n                if (rtm?.Group) {\n                    for (const g of rtm.Group) {\n                        if (showGroups.indexOf(g.ObjectId) >= 0) {\n                            sg.push(g.Name);\n                        } else if (hideGroups.indexOf(g.ObjectId) >= 0) {\n                            hg.push(g.Name);\n                        }\n                    }\n                }\n                if (rtm?.Layer) {\n                    for (const l of rtm.Layer) {\n                        if (showLayers.indexOf(l.ObjectId) >= 0) {\n                            sl.push(l.Name);\n                        } else if (hideLayers.indexOf(l.ObjectId) >= 0) {\n                            hl.push(l.Name);\n                        }\n                    }\n                }\n                if (sg.length > 0)\n                    nextUrlState.sg = sg;\n                if (hg.length > 0)\n                    nextUrlState.hg = hg;\n                if (sl.length > 0)\n                    nextUrlState.sl = sl;\n                if (hl.length > 0)\n                    nextUrlState.hl = hl;\n                if (rtm) {\n                    const { SessionId } = rtm;\n                    nextUrlState.session = SessionId;\n                }\n            }\n        }\n        updateUrl(nextUrlState);\n    }\n    private renderErrorMessage(err: Error | InitError, locale: string, args: any): JSX.Element {\n        const msg = err.message;\n        switch (msg) {\n            case \"MgConnectionFailedException\":\n                {\n                    const arg = { __html: tr(\"INIT_ERROR_NO_CONNECTION\", locale) };\n                    return <div dangerouslySetInnerHTML={arg} />;\n                }\n            case \"MgResourceNotFoundException\":\n                {\n                    const arg = { __html: tr(\"INIT_ERROR_RESOURCE_NOT_FOUND\", locale, { resourceId: args.resourceId }) };\n                    return <div dangerouslySetInnerHTML={arg} />;\n                }\n            case \"MgSessionExpiredException\":\n                {\n                    const arg = { __html: tr(\"INIT_ERROR_EXPIRED_SESSION\", locale, { sessionId: args.session }) };\n                    return <div dangerouslySetInnerHTML={arg} />;\n                }\n            default:\n                {\n                    const arg = { __html: msg };\n                    const stack = normalizeStack(err);\n                    return <div>\n                        <div dangerouslySetInnerHTML={arg} />\n                        {(() => {\n                            if (this.props.includeStack === true && stack.length > 0) {\n                                return <div>\n                                    <p>Stack Trace</p>\n                                    <ul>\n                                        {stack.map((ln, i) => <li key={`stack-line-${i}`}>{ln}</li>)}\n                                    </ul>\n                                </div>;\n                            }\n                        })()}\n                    </div>;\n                }\n        }\n    }\n    private initErrorRenderer = (err: Error | InitError) => {\n        const { configuredLocale, initOptions } = this.props;\n        let locale = configuredLocale;\n        if (initOptions && initOptions.locale) {\n            locale = initOptions.locale;\n        }\n        //Not showing stack as the error cases are well-defined here and we know where they\n        //originate from\n        return <Callout intent={Intent.DANGER} title={tr(\"INIT_ERROR_TITLE\", locale)} icon=\"error\">\n            {this.renderErrorMessage(err, locale, initOptions || {})}\n        </Callout>;\n    }\n    render(): JSX.Element {\n        const { layout, configuredLocale, error } = this.props;\n        const { isLoading } = this.state;\n        if (error) {\n            return <Error error={error} errorRenderer={this.initErrorRenderer} />\n        } else {\n            //NOTE: Locale may not have been set at this point, so use default\n            const locale = configuredLocale;\n            if (isLoading) {\n                return <NonIdealState\n                    icon={<Spinner intent={Intent.NONE} size={Spinner.SIZE_LARGE} />}\n                    title={tr(\"INIT\", locale)}\n                    description={tr(\"INIT_DESC\", locale)} />;\n            } else {\n                const layoutEl = typeof (layout) == 'string' ? getLayout(layout) : layout.factory;\n                if (layoutEl) {\n                    const providerImpl = {\n                        allowHtmlValuesInSelection: () => this.allowHtmlValuesInSelection(),\n                        getHTMLCleaner: () => this.getHtmlCleaner()\n                    };\n                    return <AppContext.Provider value={providerImpl}>\n                        {layoutEl()}\n                    </AppContext.Provider>\n                } else {\n                    return <Error error={tr(\"ERR_UNREGISTERED_LAYOUT\", locale, { layout: layout })} />;\n                }\n            }\n        }\n    }\n}\n\nexport const App = (props: IAppProps) => {\n    const error = useInitError();\n    const includeStack = useInitErrorStack();\n    const initOptions = useInitErrorOptions();\n    const configuredLocale = useViewerLocale();\n    const map = useActiveMapBranch();\n    const activeMapName = useActiveMapName();\n    const ftEnabled = useViewerFeatureTooltipsEnabled();\n\n    const dispatch = useReduxDispatch();\n    const initLayoutAction = (cmd: IViewerInitCommand, args: IInitAppLayout) => dispatch(initLayout(cmd, args));\n    const setElementVisibility = (state: IElementState) => dispatch(setElementStates(state));\n    return <AppInner error={error}\n        includeStack={includeStack}\n        initOptions={initOptions}\n        featureTooltipsEnabled={ftEnabled}\n        configuredLocale={configuredLocale}\n        map={map}\n        activeMapName={activeMapName}\n        initLayout={initLayoutAction}\n        setElementVisibility={setElementVisibility}\n        {...props} />;\n}","import * as React from \"react\";\nimport { BaseLayerSwitcher } from \"../components/base-layer-switcher\";\nimport { useActiveMapName, useViewerLocale, useActiveMapExternalBaseLayers } from './hooks';\nimport { setBaseLayer } from '../actions/map';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\n\nexport interface IBaseLayerSwitcherContainerProps {\n\n}\n\nexport const BaseLayerSwitcherContainer = () => {\n    const mapName = useActiveMapName();\n    const locale = useViewerLocale();\n    const externalBaseLayers = useActiveMapExternalBaseLayers(false);\n    const dispatch = useReduxDispatch();\n    const setBaseLayerAction = (mapName: string, layerName: string) => dispatch(setBaseLayer(mapName, layerName));\n    const onBaseLayerChanged = (layerName: string) => {\n        if (mapName) {\n            setBaseLayerAction?.(mapName, layerName);\n        }\n    }\n    if (locale && externalBaseLayers) {\n        return <BaseLayerSwitcher onBaseLayerChanged={onBaseLayerChanged} externalBaseLayers={externalBaseLayers} locale={locale} />;\n    } else {\n        return <noscript />;\n    }\n}","import * as React from \"react\";\nimport { tr } from \"../api/i18n\";\nimport * as olProj from \"ol/proj\";\nimport { Callout, Intent, Card } from '@blueprintjs/core';\nimport { useViewerLocale, useCurrentMouseCoordinates } from './hooks';\nimport { useActiveMapProjection } from './hooks-mapguide';\n\nexport interface ICoordinateTrackerContainerProps {\n    projections: string[];\n}\n\n\nexport const CoordinateTrackerContainer = (props: ICoordinateTrackerContainerProps) => {\n    const { projections } = props;\n    const locale = useViewerLocale();\n    const mouse = useCurrentMouseCoordinates();\n    const proj = useActiveMapProjection();\n    if (projections && projections.length) {\n        return <div style={{ margin: 8 }}>\n            <h4 className=\"bp3-heading\">{tr(\"COORDTRACKER\", locale)}</h4>\n            {projections.map(p => {\n                let x = NaN;\n                let y = NaN;\n                if (mouse && proj) {\n                    try {\n                        [x, y] = olProj.transform(mouse, proj, p);\n                    } catch (e) {\n\n                    }\n                }\n                return <Card key={p} style={{ marginBottom: 10 }}>\n                    <h5 className=\"bp3-heading\"><a href=\"#\">{p}</a></h5>\n                    <p><strong>X:</strong> {x}</p>\n                    <p><strong>Y:</strong> {y}</p>\n                </Card>;\n            })}\n        </div>;\n    } else {\n        return <Callout intent={Intent.DANGER} title={tr(\"ERROR\", locale)} icon=\"error\">\n            {tr(\"COORDTRACKER_NO_PROJECTIONS\", locale)}\n        </Callout>;\n    }\n}","import { IGenericSubjectMapLayer } from '../actions/defs';\nimport { useAppState } from '../components/map-providers/context';\n\nexport function useActiveMapSubjectLayer() {\n    return useAppState<IGenericSubjectMapLayer | undefined>(state => {\n        if (state.config.activeMapName) {\n            return state.mapState[state.config.activeMapName].generic?.subject;\n        }\n        return undefined;\n    });\n}\n","import { ActiveSelectedFeature, LayerTransparencySet, getRuntimeMap } from '../api/common';\nimport { getActiveMapBranch } from './hooks';\nimport { RuntimeMap } from '../api/contracts/runtime-map';\nimport { useAppState } from '../components/map-providers/context';\n\nexport function useActiveMapMetersPerUnit() {\n    return useAppState<number | undefined>(state => {\n        let mpu = 1.0;\n        if (state.config.activeMapName) {\n            const ms = state.mapState[state.config.activeMapName];\n            if (ms.mapguide?.runtimeMap) {\n                mpu = ms.mapguide.runtimeMap.CoordinateSystem.MetersPerUnit;\n            }\n        }\n        return mpu;\n    });\n}\n\nexport function useActiveMapProjection() {\n    return useAppState<string | undefined>(state => {\n        let proj;\n        if (state.config.activeMapName) {\n            const map = state.mapState[state.config.activeMapName].mapguide?.runtimeMap;\n            const subject = state.mapState[state.config.activeMapName].generic?.subject;\n            if (map) {\n                proj = `EPSG:${map.CoordinateSystem.EpsgCode}`;\n            } else if (subject) {\n                proj = subject.meta?.projection;\n            }\n        }\n        return proj;\n    });\n}\n\nexport function useActiveMapExpandedGroups() {\n    return useAppState<string[]>(state => getActiveMapBranch(state)?.mapguide?.expandedGroups);\n}\n\nexport function useActiveMapSelectableLayers() {\n    return useAppState<any>(state => getActiveMapBranch(state)?.mapguide?.selectableLayers);\n}\n\nexport function useActiveMapShowGroups() {\n    return useAppState<string[] | undefined>(state => getActiveMapBranch(state)?.mapguide?.showGroups);\n}\n\nexport function useActiveMapShowLayers() {\n    return useAppState<string[] | undefined>(state => getActiveMapBranch(state)?.mapguide?.showLayers);\n}\n\nexport function useActiveMapHideGroups() {\n    return useAppState<string[] | undefined>(state => getActiveMapBranch(state)?.mapguide?.hideGroups);\n}\n\nexport function useActiveMapHideLayers() {\n    return useAppState<string[] | undefined>(state => getActiveMapBranch(state)?.mapguide?.hideLayers);\n}\n\nexport function useActiveMapLayerTransparency() {\n    return useAppState<LayerTransparencySet | undefined>(state => getActiveMapBranch(state)?.mapguide?.layerTransparency);\n}\n\nexport function useActiveMapActiveSelectedFeature() {\n    return useAppState<ActiveSelectedFeature | undefined>(state => getActiveMapBranch(state)?.mapguide?.activeSelectedFeature);\n}\n\nexport function useActiveMapSelectableLayerNames() {\n    const map = useActiveMapState();\n    const selectableLayers = useActiveMapSelectableLayers();\n    if (map) {\n        const selectableLayerNames = (map.Layer ?? [])\n            .filter(layer => layer.Selectable && selectableLayers[layer.ObjectId] !== false)\n            .map(layer => layer.Name);\n        return selectableLayerNames;\n    }\n    return [];\n}\n\nexport function useActiveMapSessionId() {\n    return useAppState<string | undefined>(state => getRuntimeMap(state)?.SessionId);\n}\n\nexport function useActiveMapFiniteScales() {\n    return useAppState<number[] | undefined>(state => {\n        const map = getRuntimeMap(state);\n        return map != null ? map.FiniteDisplayScale : undefined;\n    });\n}\n\nexport function useActiveMapState() {\n    return useAppState<RuntimeMap | undefined>(state => getRuntimeMap(state));\n}\n","import { IApplicationState, IMapView, UnitOfMeasure, getCurrentView, IExternalBaseLayer, Coordinate2D, ILayerInfo, getExternalBaseLayers, InitError, IBranchedMapSubState, getSelectionSet, INameValuePair, ActiveMapTool, ClientKind, ImageFormat, MapLoadIndicatorPositioning, IViewerCapabilities } from '../api/common';\nimport { WEBLAYOUT_CONTEXTMENU } from '../constants';\nimport { useRef, useEffect } from \"react\";\nimport { areArraysDifferent } from \"../utils/array\";\nimport { IInitialExternalLayer } from '../actions/defs';\nimport { QueryMapFeaturesResponse } from '../api/contracts/query';\nimport { IToolbarAppState, reduceAppToToolbarState } from '../api/registry/command';\nimport { useAppState } from '../components/map-providers/context';\nimport { ClientSelectionSet } from '../api/contracts/common';\nimport { IHeatmapSettings } from '../api/ol-style-contracts';\n\n// From: https://usehooks.com/usePrevious/\n\nexport function usePrevious<T>(value: T) {\n    // The ref object is a generic container whose current property is mutable ...\n    // ... and can hold any value, similar to an instance property on a class\n    const ref = useRef<T>();\n\n    // Store current value in ref\n    useEffect(() => {\n        ref.current = value;\n    }, [value]); // Only re-run if value changes\n\n    // Return previous value (happens before update in useEffect above)\n    return ref.current;\n}\n\nexport function useActiveMapName() {\n    return useAppState<string | undefined>(state => state.config.activeMapName);\n}\n\nexport function useActiveMapInitialExternalLayers() {\n    return useAppState<IInitialExternalLayer[]>(state => {\n        if (state.config.activeMapName) {\n            return state.mapState[state.config.activeMapName].initialExternalLayers;\n        }\n        return [];\n    });\n}\n\nfunction sameHeatmapSettings(left: IHeatmapSettings | undefined, right: IHeatmapSettings | undefined): boolean {\n    if (left && right) {\n        return left.blur == right.blur\n            && left.radius == right.radius;\n    }\n    return false;\n}\n\n\nexport function useActiveMapLayers() {\n    return useAppState<ILayerInfo[] | undefined>(state => {\n        if (state.config.activeMapName) {\n            return state.mapState[state.config.activeMapName].layers;\n        }\n        return undefined;\n    }, (left, right) => !areArraysDifferent(left, right, (l, r) => {\n        return l.name == r.name\n            && l.opacity == r.opacity\n            && l.visible == r.visible\n            && l.vectorStyle == r.vectorStyle\n            && l.cluster == r.cluster\n            && sameHeatmapSettings(l.heatmap, r.heatmap);\n    }));\n}\n\nexport function useViewerLocale() {\n    return useAppState<string>(state => state.config.locale);\n}\n\nexport function useActiveMapView() {\n    return useAppState<IMapView | undefined>(state => {\n        return getCurrentView(state);\n    });\n}\n\nexport function useActiveMapWidth() {\n    return useAppState<number | undefined>(state => state.viewer?.size?.[0]);\n}\n\nexport function useActiveMapHeight() {\n    return useAppState<number | undefined>(state => state.viewer?.size?.[1]);\n}\n\nexport function useViewerSizeUnits() {\n    return useAppState<UnitOfMeasure>(state => state.config.viewSizeUnits);\n}\n\n/**\n * Gets the current set of available external base layers\n * \n * @param includeNonVisual Include \"non-visual\" base layers like UTFGrid tile sets\n * @returns The current set of available external base layers\n * @since 0.14 New required includeNonVisual parameter\n */\nexport function useActiveMapExternalBaseLayers(includeNonVisual: boolean) {\n    return useAppState<IExternalBaseLayer[] | undefined>(state => getExternalBaseLayers(state, includeNonVisual));\n}\n\nexport function useCurrentMouseCoordinates() {\n    return useAppState<Coordinate2D | undefined>(state => state.mouse.coords);\n}\n\nexport function useViewerFlyouts() {\n    return useAppState<any>(state => state.toolbar.flyouts);\n}\n\nexport function useInitWarnings() {\n    return useAppState<string[]>(state => state.initError.warnings);\n}\n\nexport function useInitError() {\n    return useAppState<InitError | undefined>(state => state.initError.error);\n}\n\nexport function useInitErrorStack() {\n    return useAppState<boolean>(state => state.initError.includeStack)\n}\n\nexport function useInitErrorOptions() {\n    return useAppState<any>(state => state.initError.options);\n}\n\nexport function getActiveMapBranch(state: IApplicationState) {\n    if (state.config.activeMapName) {\n        return state.mapState[state.config.activeMapName];\n    }\n    return undefined;\n}\n\nexport function useActiveMapBranch() {\n    return useAppState<IBranchedMapSubState | undefined>(state => getActiveMapBranch(state));\n}\n\nexport function useActiveMapSelectionSet() {\n    return useAppState<QueryMapFeaturesResponse | null>(state => getSelectionSet(state) ?? null);\n}\n\n/**\n * Gets custom app settings\n * \n * @returns \n * @since 0.14\n */\nexport function useCustomAppSettings() {\n    return useAppState(state => state.config.appSettings);\n}\n\n/**\n * Gets the client-side selection set\n * @since 0.14\n */\nexport function useActiveMapClientSelectionSet() {\n    return useAppState<ClientSelectionSet | undefined>(state => getActiveMapBranch(state)?.clientSelection);\n}\n\nexport function useActiveMapInitialView() {\n    return useAppState<IMapView | undefined>(state => getActiveMapBranch(state)?.initialView);\n}\n\nexport function useAvailableMaps() {\n    return useAppState<INameValuePair[] | undefined>(state => state.config.availableMaps);\n}\n\nexport function useViewerBusyCount() {\n    return useAppState<number>(state => state.viewer.busyCount);\n}\n\nexport function useViewerViewRotation() {\n    return useAppState<number>(state => state.config.viewRotation);\n}\n\nexport function useViewerActiveTool() {\n    return useAppState<ActiveMapTool>(state => state.viewer.tool);\n}\n\nexport function useViewerViewRotationEnabled() {\n    return useAppState<boolean>(state => state.config.viewRotationEnabled);\n}\n\nexport function useConfiguredCoordinateProjection() {\n    return useAppState<string>(state => state.config.coordinates.projection);\n}\n\nexport function useConfiguredCoordinateDecimals() {\n    return useAppState<number>(state => state.config.coordinates.decimals);\n}\n\nexport function useConfiguredCoordinateFormat() {\n    return useAppState<string | undefined>(state => state.config.coordinates.format);\n}\n\nexport function useConfiguredAgentUri() {\n    return useAppState<string | undefined>(state => state.config.agentUri);\n}\n\nexport function useConfiguredAgentKind() {\n    return useAppState<ClientKind>(state => state.config.agentKind);\n}\n\nexport function useIsContextMenuOpen() {\n    return useAppState<boolean>(state => {\n        let isContextMenuOpen = false;\n        if (state?.toolbar?.flyouts?.[WEBLAYOUT_CONTEXTMENU]?.open === true) {\n            isContextMenuOpen = true;\n        }\n        return isContextMenuOpen;\n    })\n}\n\n/**\n * Gets whether the viewer is in stateless mode\n * @returns true if the viewer is in stateless mode\n * @since 0.14\n */\nexport function useViewerIsStateless() {\n    return useAppState<boolean>(state => state.config.viewer.isStateless);\n}\n\nexport function useViewerImageFormat() {\n    return useAppState<ImageFormat>(state => state.config.viewer.imageFormat);\n}\n\nexport function useViewerSelectionImageFormat() {\n    return useAppState<ImageFormat>(state => state.config.viewer.selectionImageFormat);\n}\n\nexport function useViewerSelectionColor() {\n    return useAppState<string>(state => state.config.viewer.selectionColor);\n}\n\nexport function useViewerActiveFeatureSelectionColor() {\n    return useAppState<string>(state => state.config.viewer.activeSelectedFeatureColor);\n}\n\nexport function useViewerPointSelectionBuffer() {\n    return useAppState<number>(state => state.config.viewer.pointSelectionBuffer);\n}\n\nexport function useViewerFeatureTooltipsEnabled() {\n    return useAppState<boolean>(state => state.viewer.featureTooltipsEnabled);\n}\n\nexport function useConfiguredManualFeatureTooltips() {\n    return useAppState<boolean>(state => state.config.manualFeatureTooltips);\n}\n\nexport function useConfiguredLoadIndicatorPositioning() {\n    return useAppState<MapLoadIndicatorPositioning>(state => state.config.viewer.loadIndicatorPositioning);\n}\n\nexport function useConfiguredLoadIndicatorColor() {\n    return useAppState<string>(state => state.config.viewer.loadIndicatorColor);\n}\n\nexport function useConfiguredCancelDigitizationKey() {\n    return useAppState<number>(state => state.config.cancelDigitizationKey);\n}\n\nexport function useConfiguredUndoLastPointKey() {\n    return useAppState<number>(state => state.config.undoLastPointKey);\n}\n\nexport function useConfiguredCapabilities() {\n    return useAppState<IViewerCapabilities>(state => state.config.capabilities);\n}\n\nexport function useTemplateLegendVisible() {\n    return useAppState<boolean>(state => state.template.legendVisible);\n}\n\nexport function useTemplateTaskPaneVisible() {\n    return useAppState<boolean>(state => state.template.taskPaneVisible);\n}\n\nexport function useTemplateSelectionVisible() {\n    return useAppState<boolean>(state => state.template.selectionPanelVisible);\n}\n\nexport function useTemplateInitialInfoPaneWidth() {\n    return useAppState<number>(state => state.template.initialInfoPaneWidth);\n}\n\nexport function useTemplateInitialTaskPaneWidth() {\n    return useAppState<number>(state => state.template.initialTaskPaneWidth);\n}\n\nexport function useTaskPaneInitialUrl() {\n    return useAppState<string | undefined>(state => state.taskpane.initialUrl);\n}\n\nexport function useTaskPaneNavigationIndex() {\n    return useAppState<number>(state => state.taskpane.navIndex);\n}\n\nexport function useTaskPaneLastUrlPushed() {\n    return useAppState<boolean>(state => state.taskpane.lastUrlPushed);\n}\n\nexport function useTaskPaneNavigationStack() {\n    return useAppState<string[]>(state => state.taskpane.navigation);\n}\n\nexport function useLastDispatchedAction() {\n    return useAppState<any>(state => state.lastaction);\n}\n\nexport function useReducedToolbarAppState() {\n    const selection = useActiveMapSelectionSet();\n    const clientSelection = useActiveMapClientSelectionSet();\n    const tbState = useAppState(state => reduceAppToToolbarState(state), (left, right) => {\n        return left?.busyWorkerCount == right?.busyWorkerCount\n            && left?.hasNextView == right?.hasNextView\n            && left?.hasPreviousView == right?.hasPreviousView\n            && left?.featureTooltipsEnabled == right?.featureTooltipsEnabled\n            && left?.activeTool == right?.activeTool;\n    });\n    //Overwrite whatever selection flags from the reduceAppToToolbarState result\n    let hasClientSelection = false;\n    let hasSelection = false;\n    if (selection) {\n        if (selection.FeatureSet && selection.FeatureSet.Layer.length > 0) {\n            hasSelection = true;\n        }\n        if (selection.SelectedFeatures && selection.SelectedFeatures.SelectedLayer.length > 0) {\n            hasSelection = true;\n        }\n    }\n    if (clientSelection && clientSelection.layers.length > 0) {\n        hasClientSelection = true;\n    }\n    return {\n        ...tbState,\n        hasClientSelection,\n        hasSelection\n    };\n}","import * as React from \"react\";\nimport { Legend } from \"../components/legend\";\nimport { tr } from \"../api/i18n\";\nimport { useActiveMapView, useActiveMapExternalBaseLayers, useActiveMapName, useViewerLocale, useViewerIsStateless, useActiveMapLayers } from './hooks';\nimport { setBaseLayer } from '../actions/map';\nimport { setGroupVisibility, setLayerVisibility, setLayerSelectable, setGroupExpanded } from '../actions/legend';\nimport { useActiveMapState, useActiveMapShowGroups, useActiveMapShowLayers, useActiveMapHideGroups, useActiveMapHideLayers, useActiveMapExpandedGroups, useActiveMapSelectableLayers } from './hooks-mapguide';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\n\nexport interface ILegendContainerProps {\n    maxHeight?: number;\n    inlineBaseLayerSwitcher?: boolean;\n}\n\nexport const LegendContainer = (props: ILegendContainerProps) => {\n    const { maxHeight, inlineBaseLayerSwitcher } = props;\n    const dispatch = useReduxDispatch();\n    const activeMapName = useActiveMapName();\n    const locale = useViewerLocale();\n    const map = useActiveMapState();\n    const view = useActiveMapView();\n    const showGroups = useActiveMapShowGroups();\n    const showLayers = useActiveMapShowLayers();\n    const hideGroups = useActiveMapHideGroups();\n    const hideLayers=  useActiveMapHideLayers();\n    const expandedGroups = useActiveMapExpandedGroups();\n    const selectableLayers = useActiveMapSelectableLayers();\n    const externalBaseLayers = useActiveMapExternalBaseLayers(false);\n    const stateless = useViewerIsStateless();\n    const setBaseLayerAction = (mapName: string, layerName: string) => dispatch(setBaseLayer(mapName, layerName));\n    const setGroupVisibilityAction = (mapName: string, options: { id: string, value: boolean }) => dispatch(setGroupVisibility(mapName, options));\n    const setLayerVisibilityAction = (mapName: string, options: { id: string, value: boolean }) => dispatch(setLayerVisibility(mapName, options));\n    const setLayerSelectableAction = (mapName: string, options: { id: string, value: boolean }) => dispatch(setLayerSelectable(mapName, options));\n    const setGroupExpandedAction = (mapName: string, options: { id: string, value: boolean }) => dispatch(setGroupExpanded(mapName, options));\n    const layers = useActiveMapLayers();\n    const onLayerSelectabilityChanged = (id: string, selectable: boolean) => {\n        if (activeMapName) {\n            setLayerSelectableAction?.(activeMapName, { id: id, value: selectable });\n        }\n    };\n    const onGroupExpansionChanged = (id: string, expanded: boolean) => {\n        if (setGroupExpandedAction && activeMapName) {\n            setGroupExpandedAction(activeMapName, { id: id, value: expanded });\n        }\n    };\n    const onGroupVisibilityChanged = (groupId: string, visible: boolean) => {\n        if (setGroupVisibilityAction && activeMapName) {\n            setGroupVisibilityAction(activeMapName, { id: groupId, value: visible });\n        }\n    };\n    const onLayerVisibilityChanged = (layerId: string, visible: boolean) => {\n        if (setLayerVisibilityAction && activeMapName) {\n            setLayerVisibilityAction(activeMapName, { id: layerId, value: visible });\n        }\n    };\n    const onBaseLayerChanged = (layerName: string) => {\n        if (setBaseLayerAction && activeMapName) {\n            setBaseLayerAction(activeMapName, layerName);\n        }\n    };\n    if ((map || layers) && view) {\n        let scale = view.scale;\n        if (scale || layers) {\n            return <Legend map={map}\n                activeMapName={activeMapName}\n                stateless={stateless}\n                maxHeight={maxHeight}\n                currentScale={scale}\n                externalLayers={layers}\n                showLayers={showLayers}\n                showGroups={showGroups}\n                hideLayers={hideLayers}\n                hideGroups={hideGroups}\n                locale={locale}\n                inlineBaseLayerSwitcher={!!inlineBaseLayerSwitcher}\n                externalBaseLayers={externalBaseLayers}\n                onBaseLayerChanged={onBaseLayerChanged}\n                overrideSelectableLayers={selectableLayers}\n                overrideExpandedItems={expandedGroups}\n                onLayerSelectabilityChanged={onLayerSelectabilityChanged}\n                onGroupExpansionChanged={onGroupExpansionChanged}\n                onGroupVisibilityChanged={onGroupVisibilityChanged}\n                onLayerVisibilityChanged={onLayerVisibilityChanged} />;\n        } else {\n            return <div>{tr(\"LOADING_MSG\", locale)}</div>;\n        }\n    } else {\n        return <div>{tr(\"LOADING_MSG\", locale)}</div>;\n    }\n}","import * as React from \"react\";\nimport { MapMenu } from \"../components/map-menu\";\nimport { useViewerLocale, useActiveMapName, useAvailableMaps } from './hooks';\nimport { setActiveMap } from '../actions/map';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\n\nexport const MapMenuContainer = () => {\n    const dispatch = useReduxDispatch();\n    const locale = useViewerLocale();\n    const activeMapName = useActiveMapName();\n    const availableMaps = useAvailableMaps();\n    const setActiveMapAction = (mapName: string) => dispatch(setActiveMap(mapName));\n    const onActiveMapChanged = (mapName: string) => setActiveMapAction(mapName);\n    if (locale && activeMapName && availableMaps) {\n        //TODO: Should use MapGroup id has label. For now, use map name for both\n        const entries = availableMaps.map(m => {\n            return { label: m.name, mapName: m.value };\n        });\n        return <MapMenu onActiveMapChanged={onActiveMapChanged} selectedMap={activeMapName} maps={entries} locale={locale} />;\n    } else {\n        return <noscript />;\n    }\n}","import * as React from \"react\";\nimport {\n    Coordinate2D,\n    UnitOfMeasure\n} from \"../api/common\";\nimport { MouseCoordinates } from \"../components/mouse-coordinates\";\nimport * as olProj from \"ol/proj\";\nimport { getUnitOfMeasure } from \"../utils/units\";\nimport { useViewerLocale, useCurrentMouseCoordinates, useConfiguredCoordinateProjection, useConfiguredCoordinateDecimals, useConfiguredCoordinateFormat } from './hooks';\nimport { useActiveMapProjection } from './hooks-mapguide';\n\nexport interface IMouseCoordinatesContainerProps {\n    style?: React.CSSProperties;\n}\n\nexport const MouseCoordinatesContainer = (props: IMouseCoordinatesContainerProps) => {\n    const { style } = props;\n    const mapProjection = useActiveMapProjection();\n    const projection = useConfiguredCoordinateProjection();\n    const decimals = useConfiguredCoordinateDecimals();\n    const format = useConfiguredCoordinateFormat();\n    const mouse = useCurrentMouseCoordinates();\n    const locale = useViewerLocale();\n    if (mouse) {\n        const prj = olProj.get(projection ?? mapProjection);\n        let units;\n        if (prj) {\n            units = prj.getUnits();\n            switch (units) {\n                case \"degrees\":\n                    units = getUnitOfMeasure(UnitOfMeasure.Degrees).abbreviation(locale);\n                    break;\n                case \"pixels\":\n                case \"tile-pixels\":\n                    units = getUnitOfMeasure(UnitOfMeasure.Pixels).abbreviation(locale);\n                    break;\n                case \"m\":\n                    units = getUnitOfMeasure(UnitOfMeasure.Meters).abbreviation(locale);\n                    break;\n                case \"ft\":\n                case \"us-ft\":\n                    units = getUnitOfMeasure(UnitOfMeasure.Feet).abbreviation(locale);\n                    break;\n            }\n        }\n        let coords: Coordinate2D = [mouse[0], mouse[1]];\n        if (projection && mapProjection) {\n            try {\n                coords = olProj.transform(coords, mapProjection, projection) as Coordinate2D;\n            } catch (e) {\n\n            }\n        }\n        return <MouseCoordinates units={units} coords={coords} style={style} decimals={decimals} format={format} />;\n    } else {\n        return <div />;\n    }\n};","import * as React from \"react\";\nimport { ICommand } from \"../api/common\";\nimport { Navigator, ZoomDirection, PanDirection } from \"../components/navigator\";\nimport { getCommand, DefaultCommands } from \"../api/registry/command\";\nimport { useViewerLocale, useActiveMapView, useActiveMapName, useViewerBusyCount } from './hooks';\nimport { invokeCommand, setScale } from '../actions/map';\nimport { useActiveMapFiniteScales } from './hooks-mapguide';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\n\nexport interface INavigatorContainerProps {\n    style?: React.CSSProperties;\n}\n\nexport const NavigatorContainer = (props: INavigatorContainerProps) => {\n    const { style } = props;\n    const dispatch = useReduxDispatch();\n    const locale = useViewerLocale();\n    const finiteScales = useActiveMapFiniteScales();\n    const view = useActiveMapView();\n    const busyCount = useViewerBusyCount();\n    const activeMapName = useActiveMapName();\n    const setScaleAction = (mapName: string, scale: number) => dispatch(setScale(mapName, scale));\n    const invokeCommandAction = (cmd: ICommand, parameters?: any) => dispatch(invokeCommand(cmd, parameters));\n    const onZoom = (direction: ZoomDirection) => {\n        let cmd: ICommand | undefined;\n        switch (direction) {\n            case ZoomDirection.In:\n                cmd = getCommand(DefaultCommands.ZoomIn);\n                break;\n            case ZoomDirection.Out:\n                cmd = getCommand(DefaultCommands.ZoomOut);\n                break;\n        }\n        if (cmd) {\n            invokeCommandAction(cmd);\n        }\n    };\n    const onPan = (direction: PanDirection) => {\n        let cmd: ICommand | undefined;\n        switch (direction) {\n            case PanDirection.East:\n                cmd = getCommand(DefaultCommands.PanRight);\n                break;\n            case PanDirection.West:\n                cmd = getCommand(DefaultCommands.PanLeft);\n                break;\n            case PanDirection.North:\n                cmd = getCommand(DefaultCommands.PanUp);\n                break;\n            case PanDirection.South:\n                cmd = getCommand(DefaultCommands.PanDown);\n                break;\n        }\n        if (cmd) {\n            invokeCommandAction(cmd);\n        }\n    };\n    const onRequestZoomToScale = (scale: number) => {\n        if (activeMapName) {\n            setScaleAction(activeMapName, scale);\n        }\n    };\n    if (view) {\n        return <Navigator style={style}\n            scale={view.scale}\n            finiteScaleList={finiteScales}\n            locale={locale}\n            busy={busyCount > 0}\n            onRequestZoomToScale={onRequestZoomToScale}\n            onPan={onPan}\n            onZoom={onZoom} />;\n    } else {\n        return <div />;\n    }\n}","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { IMapProviderContext, IViewerComponent, useViewerSideEffects } from '../components/map-providers/base';\nimport { CURSOR_DIGITIZE_POINT, CURSOR_DIGITIZE_LINE, CURSOR_DIGITIZE_LINESTRING, CURSOR_DIGITIZE_RECT, CURSOR_DIGITIZE_POLYGON, CURSOR_DIGITIZE_CIRCLE, CURSOR_GRABBING, CURSOR_GRAB, CURSOR_ZOOM_IN } from '../constants/assets';\nimport { MapLoadIndicator } from '../components/map-load-indicator';\nimport { ActiveMapTool, MapLoadIndicatorPositioning, GenericEvent, ReduxDispatch, ClientKind } from '../api/common';\nimport { useMapProviderContext, useReduxDispatch } from '../components/map-providers/context';\nimport { Toaster, Position } from '@blueprintjs/core';\nimport { isMapGuideProviderState } from '../components/map-providers/mapguide';\nimport { tr } from '../api/i18n';\n\nimport \"ol/ol.css\";\nimport { QueryMapFeaturesResponse } from '../api/contracts/query';\nimport { ISubscriberProps, Subscriber } from './subscriber';\nimport { useActiveMapClientSelectionSet, useConfiguredLoadIndicatorColor, useConfiguredLoadIndicatorPositioning, useCustomAppSettings, useViewerFlyouts } from \"./hooks\";\nimport { closeContextMenu, openContextMenu } from \"../actions/flyout\";\nimport { WEBLAYOUT_CONTEXTMENU } from \"../constants\";\n\n\n\ninterface ICoreMapViewerProps {\n    context: IMapProviderContext;\n    loadIndicatorPosition: MapLoadIndicatorPositioning;\n    loadIndicatorColor: string;\n    onContextMenu: (pos: [number, number]) => void;\n    onHideContextMenu: () => void;\n    onDispatch: ReduxDispatch;\n    backgroundColor?: string;\n    children?: React.ReactNode;\n    isContextMenuOpen: boolean;\n}\n\ninterface ICoreMapViewerState {\n    shiftKey: boolean;\n    isMouseDown: boolean;\n    digitizingType: string | undefined;\n    loading: number;\n    loaded: number;\n    subscribers: ISubscriberProps[];\n}\n\nclass CoreMapViewer extends React.Component<ICoreMapViewerProps, ICoreMapViewerState> implements IViewerComponent {\n    private mounted: boolean;\n    constructor(props: ICoreMapViewerProps) {\n        super(props);\n        this.mounted = false;\n        this.state = {\n            shiftKey: false,\n            isMouseDown: false,\n            digitizingType: undefined,\n            loaded: 0,\n            loading: 0,\n            subscribers: []\n        }\n    }\n    //#region IViewerComponent\n    isContextMenuOpen = () => this.props.isContextMenuOpen;\n    setDigitizingType = (digitizingType: string | undefined) => this.setState({ digitizingType });\n    onBeginDigitization = (callback: (cancelled: boolean) => void) => { };\n    onHideContextMenu = () => this.props.onHideContextMenu?.();\n    onOpenTooltipLink = (url: string) => { };\n    onDispatch = (action: any) => this.props.onDispatch(action);\n    addImageLoading(): void {\n        const { loading } = this.state;\n        const newLoading = (loading || 0) + 1;\n        this.setState({ loading: newLoading });\n        this.props.context.incrementBusyWorker();\n    }\n    addSubscribers = (props: ISubscriberProps[]) => {\n        const subscribers = [...this.state.subscribers, ...props];\n        this.setState({ subscribers });\n        return props.map(p => p.name);\n    }\n    removeSubscribers = (names: string[]) => {\n        const { subscribers } = this.state;\n        const ol = subscribers.length;\n        const ns = subscribers.filter(s => names.indexOf(s.name) < 0);\n        this.setState({ subscribers });\n        return ns.length < ol;\n    }\n    getSubscribers(): string[] {\n        return this.state.subscribers.map(s => s.name);\n    }\n    addImageLoaded(): void {\n        const { loaded, loading } = this.state;\n        const newLoadedCount = (loaded || 0) + 1;\n        if (loading === newLoadedCount) {\n            this.setState({ loaded: 0, loading: 0 });\n        } else {\n            this.setState({ loaded: newLoadedCount });\n        }\n        this.props.context.decrementBusyWorker();\n    }\n    //#endregion\n    private onContextMenu = (e: React.MouseEvent<HTMLDivElement>) => {\n        if (!this.mounted)\n            return;\n        if (this.props.context.isMouseOverTooltip()) {\n            return;\n        }\n        e.preventDefault();\n        //console.log(`Open context menu at (${e.clientX}, ${e.clientY})`);\n        this.props.onContextMenu?.([e.clientX, e.clientY]);\n    }\n    private onKeyDown = (e: GenericEvent) => {\n        if (!this.mounted)\n            return;\n        this.props.context.onKeyDown(e);\n        this.setState({ shiftKey: e.shiftKey });\n    }\n    private onKeyUp = (e: GenericEvent) => {\n        if (!this.mounted)\n            return;\n        this.setState({ shiftKey: e.shiftKey });\n    }\n    private onMouseDown = (e: GenericEvent) => {\n        if (!this.mounted)\n            return;\n        if (!this.state.isMouseDown) {\n            this.setState({\n                isMouseDown: true\n            });\n        }\n    }\n    private onMouseUp = (e: GenericEvent) => {\n        if (!this.mounted)\n            return;\n        if (this.state.isMouseDown) {\n            this.setState({\n                isMouseDown: false\n            });\n        }\n    }\n    componentDidMount() {\n        document.addEventListener(\"keydown\", this.onKeyDown);\n        document.addEventListener(\"keyup\", this.onKeyUp);\n        const mapNode: any = ReactDOM.findDOMNode(this);\n        this.props.context.attachToComponent(mapNode, this);\n        this.mounted = true;\n    }\n    componentWillUnmount() {\n        this.props.context.detachFromComponent();\n        this.mounted = false;\n    }\n    render(): JSX.Element {\n        const { context, backgroundColor } = this.props;\n        const { isMouseDown } = this.state;\n        const tool = context.getActiveTool();\n        const style: React.CSSProperties = {\n            width: \"100%\",\n            height: \"100%\"\n        };\n        if (context.isDigitizing()) {\n            const dtype = this.state.digitizingType;\n            switch (dtype) {\n                case \"Point\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_POINT}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"Line\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_LINE}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"LineString\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_LINESTRING}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"Rectangle\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_RECT}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"Polygon\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_POLYGON}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n                case \"Circle\":\n                    style.cursor = `url(${CURSOR_DIGITIZE_CIRCLE}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n            }\n        } else {\n            switch (tool) {\n                case ActiveMapTool.Pan:\n                    if (isMouseDown) {\n                        style.cursor = `url(${CURSOR_GRABBING}), auto`;\n                        //console.log(`cursor: ${style.cursor}`);\n                    } else {\n                        style.cursor = `url(${CURSOR_GRAB}), auto`;\n                        //console.log(`cursor: ${style.cursor}`);\n                    }\n                    break;\n                case ActiveMapTool.Zoom:\n                    style.cursor = `url(${CURSOR_ZOOM_IN}), auto`;\n                    //console.log(`cursor: ${style.cursor}`);\n                    break;\n            }\n        }\n        if (backgroundColor) {\n            style.backgroundColor = backgroundColor;\n            //style.backgroundColor = `#${map.BackgroundColor.substring(2)}`;\n        }\n        const { loading, loaded, subscribers } = this.state;\n        return <div className=\"map-viewer-component\" style={style} onContextMenu={this.onContextMenu} onMouseDown={this.onMouseDown} onMouseUp={this.onMouseUp}>\n            <MapLoadIndicator loaded={loaded || 0} loading={loading || 0} position={this.props.loadIndicatorPosition} color={this.props.loadIndicatorColor} />\n            {subscribers.map((s, i) => <Subscriber key={`subscriber-${i}-${s.name}`} {...s} />)}\n            {this.props.children}\n        </div>;\n    }\n}\n\nexport const MapViewer = ({ children }: { children?: React.ReactNode }) => {\n    const context = useMapProviderContext();\n    const toasterRef = React.useRef<Toaster>(null);\n    const loadIndicatorPositioning = useConfiguredLoadIndicatorPositioning();\n    const loadIndicatorColor = useConfiguredLoadIndicatorColor();\n    const dispatch = useReduxDispatch();\n    const hookFunc = context.getHookFunction();\n    const clientSelection = useActiveMapClientSelectionSet();\n    const appSettings = useCustomAppSettings();\n    const nextState = hookFunc();\n    const {\n        mapName,\n        layers,\n        initialExternalLayers,\n        bgColor,\n        locale\n    } = nextState;\n    const flyouts = useViewerFlyouts();\n    React.useEffect(() => {\n        if (!clientSelection) {\n            context.getSelectedFeatures()?.clear();\n        }\n    }, [clientSelection]);\n    const bContextMenuOpen = (flyouts[WEBLAYOUT_CONTEXTMENU]?.open == true);\n    const showContextMenuAction = (pos: [number, number]) => dispatch(openContextMenu({ x: pos[0], y: pos[1] }));\n    const hideContextMenuAction = () => dispatch(closeContextMenu());\n    const onContextMenu = (pos: [number, number]) => showContextMenuAction?.(pos);\n    //HACK: Still have some MG-specific state we're needing to check for here. Minor abstraction leakage.\n    let agentUri: string | undefined;\n    let agentKind: ClientKind | undefined;\n    let selection: QueryMapFeaturesResponse | null = null;\n    if (isMapGuideProviderState(nextState)) {\n        agentUri = nextState.agentUri;\n        agentKind = nextState.agentKind;\n        selection = nextState.selection;\n    }\n    context.setToasterRef(toasterRef);\n    context.setProviderState(nextState);\n    useViewerSideEffects(context, appSettings ?? {}, nextState.isReady, mapName, layers, initialExternalLayers, agentUri, agentKind, selection);\n\n    if (nextState.isReady) {\n        return <>\n            {/* HACK: usePortal=false to workaround what I think is: https://github.com/palantir/blueprint/issues/3248 */}\n            <Toaster usePortal={false} position={Position.TOP} ref={toasterRef} />\n            <CoreMapViewer context={context}\n                onDispatch={dispatch}\n                backgroundColor={bgColor}\n                onContextMenu={onContextMenu}\n                onHideContextMenu={hideContextMenuAction}\n                isContextMenuOpen={bContextMenuOpen}\n                loadIndicatorPosition={loadIndicatorPositioning}\n                loadIndicatorColor={loadIndicatorColor}>\n                {children}\n            </CoreMapViewer>\n        </>;\n    } else {\n        return <div>{tr(\"LOADING_MSG\", locale)}</div>;\n    }\n}","import * as React from \"react\";\nimport { ScaleDisplay } from \"../components/scale-display\";\nimport { useActiveMapView, useActiveMapName, useViewerLocale } from './hooks';\nimport { setScale } from '../actions/map';\nimport { useActiveMapFiniteScales } from './hooks-mapguide';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\n\nexport interface IScaleDisplayContainerProps {\n    style?: React.CSSProperties;\n}\n\nexport const ScaleDisplayContainer = (props: IScaleDisplayContainerProps) => {\n    const { style } = props;\n    const dispatch = useReduxDispatch();\n    const locale = useViewerLocale();\n    const activeMapName = useActiveMapName();\n    const view = useActiveMapView();\n    const finiteScales = useActiveMapFiniteScales();\n    const setScaleAction = (mapName: string, scale: number) => dispatch(setScale(mapName, scale))\n    const onScaleChanged = (scale: number) => {\n        if (activeMapName) {\n            setScaleAction(activeMapName, scale);\n        }\n    };\n    if (view) {\n        return <ScaleDisplay onScaleChanged={onScaleChanged}\n            view={view}\n            style={style}\n            finiteScales={finiteScales}\n            locale={locale} />;\n    } else {\n        return <noscript />;\n    }\n};","import * as React from \"react\";\nimport { countSelection } from \"../api/selection-count\";\nimport { SelectedFeatureCount } from \"../components/selected-feature-count\";\nimport { useViewerLocale, useActiveMapSelectionSet, useActiveMapClientSelectionSet } from './hooks';\n\nexport interface ISelectedFeatureCountContainerProps {\n    style?: React.CSSProperties;\n}\n\nexport const SelectedFeatureCountContainer = (props: ISelectedFeatureCountContainerProps) => {\n    const { style } = props;\n    const selection = useActiveMapSelectionSet();\n    const clientSelection = useActiveMapClientSelectionSet();\n    const locale = useViewerLocale();\n    const summary = countSelection(selection?.FeatureSet, clientSelection);\n    if (summary) {\n        return <SelectedFeatureCount locale={locale} style={style} summary={summary} />;\n    } else {\n        return <div />;\n    }\n}","import * as React from \"react\";\nimport { SelectionPanel, ISelectedFeatureProps } from \"../components/selection-panel\";\nimport { FeatureProperty, LayerMetadata, SelectedFeature, SelectedFeatureSet, SelectedLayer } from \"../api/contracts/query\";\nimport { getViewer } from \"../api/runtime\";\nimport { tr } from \"../api/i18n\";\nimport { ICompositeSelection, ICompositeSelectionLayer, IMapView } from \"../api/common\";\nimport { Callout, Intent } from '@blueprintjs/core';\nimport { AppContext } from '../components/context';\nimport { useViewerLocale, useActiveMapSelectionSet, useActiveMapName, useActiveMapClientSelectionSet } from './hooks';\nimport { setCurrentView, showSelectedFeature } from '../actions/map';\nimport { useActiveMapState } from './hooks-mapguide';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\nimport { CompositeSelection } from \"../api/composite-selection\";\n\nexport interface ISelectionPanelContainerProps {\n    maxHeight?: number;\n    selectedFeatureRenderer?: (props: ISelectedFeatureProps) => JSX.Element;\n}\n\nexport const SelectionPanelContainer = (props: ISelectionPanelContainerProps) => {\n    const { maxHeight, selectedFeatureRenderer } = props;\n    const locale = useViewerLocale();\n    const map = useActiveMapState();\n    const selection = useActiveMapSelectionSet();\n    const clientSelection = useActiveMapClientSelectionSet();\n    const dispatch = useReduxDispatch();\n    const activeMapName = useActiveMapName();\n    const setCurrentViewAction = (view: IMapView) => dispatch(setCurrentView(view));\n    const showSelectedFeatureAction = (mapName: string, layerId: string, selectionKey: string) => dispatch(showSelectedFeature(mapName, layerId, selectionKey));\n    const appContext = React.useContext(AppContext);\n    const onZoomToSelectedFeature = (feature: SelectedFeature) => {\n        if (feature.Bounds) {\n            const bbox: any = feature.Bounds.split(\" \").map(s => parseFloat(s));\n            const viewer = getViewer();\n            if (viewer) {\n                const view = viewer.getViewForExtent(bbox);\n                setCurrentViewAction(view);\n            }\n        }\n    };\n    const resolveLayerLabel = (layerId: string, _: string) => {\n        const layer = map?.Layer?.filter?.(l => l.ObjectId == layerId)?.[0];\n        if (layer) {\n            return layer.LegendLabel;\n        }\n    };\n    const onShowSelectedFeature = (layerId: string, selectionKey: string) => {\n        if (activeMapName) {\n            showSelectedFeatureAction(activeMapName, layerId, selectionKey);\n        }\n    };\n    const compSel = new CompositeSelection(selection?.SelectedFeatures, clientSelection);\n    if (selection?.SelectedFeatures != null || clientSelection) {\n        return <SelectionPanel locale={locale}\n            onResolveLayerLabel={resolveLayerLabel}\n            allowHtmlValues={appContext.allowHtmlValuesInSelection()}\n            cleanHTML={appContext.getHTMLCleaner()}\n            selection={compSel}\n            onRequestZoomToFeature={onZoomToSelectedFeature}\n            onShowSelectedFeature={onShowSelectedFeature}\n            selectedFeatureRenderer={selectedFeatureRenderer}\n            maxHeight={maxHeight} />;\n    } else {\n        return <Callout intent={Intent.PRIMARY} icon=\"info-sign\">\n            <p className=\"selection-panel-no-selection\">{tr(\"NO_SELECTED_FEATURES\", locale)}</p>\n        </Callout>;\n    }\n}","import * as React from \"react\";\nimport { IApplicationState } from '../api/common';\nimport { useAppState } from \"../components/map-providers/context\";\n\n/**\n * @since 0.13\n */\nexport interface ISubscriberProps {\n    name: string;\n    appStateSelector: (state: IApplicationState) => any;\n    appStateEqualityFn?: (left: any, right: any) => boolean;\n    onNewState: (state: any) => void;\n}\n\n/**\n * \n * @param props \n * @since 0.13\n */\nexport const Subscriber = (props: ISubscriberProps) => {\n    const state = useAppState<any>(props.appStateSelector, props.appStateEqualityFn);\n    React.useEffect(() => {\n        props.onNewState(state);\n    }, [state]);\n    return <noscript data-subscriber-name={props.name} />;\n}","import * as React from \"react\";\nimport {\n    ICommand,\n    IDOMElementMetrics,\n    IBranchedMapSubState,\n    FlyoutVisibilitySet\n} from \"../api/common\";\nimport { IItem } from \"../components/toolbar\";\nimport { TaskPane, TASK_PANE_OVERLAY_BGCOLOR } from \"../components/task-pane\";\nimport { areUrlsSame, ensureParameters } from \"../utils/url\";\nimport { tr } from \"../api/i18n\";\nimport { NonIdealState } from '@blueprintjs/core';\nimport { useActiveMapBranch, useViewerFlyouts, useTaskPaneInitialUrl, useTaskPaneLastUrlPushed, useTaskPaneNavigationIndex, useTaskPaneNavigationStack, useConfiguredCapabilities, useViewerLocale } from './hooks';\nimport { invokeCommand } from '../actions/map';\nimport { goHome, goForward, goBack, pushUrl } from '../actions/taskpane';\nimport { openFlyout, closeFlyout } from '../actions/flyout';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\n\nexport interface ITaskPaneContainerProps {\n    maxHeight?: number;\n    isResizing?: boolean;\n}\n\ninterface ITaskPaneContainerState {\n    map: IBranchedMapSubState | undefined;\n    initialUrl: string | undefined;\n    navIndex: number;\n    navigationStack: string[];\n    locale: string;\n    flyouts: any;\n    lastUrlPushed: boolean;\n    hasTaskBar: boolean;\n}\n\ninterface ITaskPaneDispatch {\n    invokeCommand: (cmd: ICommand, parameters?: any) => void;\n    goHome: () => void;\n    goForward: () => void;\n    goBack: () => void;\n    pushUrl: (url: string, silent?: boolean) => void;\n    openFlyout: (id: string, metrics: IDOMElementMetrics) => void;\n    closeFlyout: (id: string) => void;\n}\n\ntype TaskPaneProps = ITaskPaneContainerProps & ITaskPaneContainerState & ITaskPaneDispatch;\n\nclass TaskPaneContainerInner extends React.Component<TaskPaneProps, any> {\n    private homeAction: IItem;\n    private backAction: IItem;\n    private forwardAction: IItem;\n    constructor(props: TaskPaneProps) {\n        super(props);\n        const locale = this.getLocale();\n        this.homeAction = {\n            bpIconName: \"home\",\n            tooltip: tr(\"TT_GO_HOME\", locale),\n            enabled: this.canGoHome,\n            invoke: () => this.props.goHome?.()\n        };\n        this.backAction = {\n            bpIconName: \"arrow-left\",\n            tooltip: tr(\"TT_GO_BACK\", locale),\n            enabled: this.canGoBack,\n            invoke: () => this.props.goBack?.()\n        };\n        this.forwardAction = {\n            bpIconName: \"arrow-right\",\n            tooltip: tr(\"TT_GO_FORWARD\", locale),\n            enabled: this.canGoForward,\n            invoke: () => this.props.goForward?.()\n        };\n    }\n    private getLocale(): string {\n        return this.props.locale;\n    }\n    private onCloseFlyout = (id: string) => this.props.closeFlyout?.(id);\n    private onOpenFlyout = (id: string, metrics: IDOMElementMetrics) => this.props.openFlyout?.(id, metrics);\n    private onUrlLoaded = (url: string) => {\n        const { navigationStack, navIndex, pushUrl } = this.props;\n        const currentUrl = navigationStack[navIndex];\n        if (!areUrlsSame(currentUrl, url)) {\n            pushUrl?.(url);\n        }\n    }\n    private canGoHome = (): boolean => {\n        const { initialUrl, navigationStack, navIndex, map } = this.props;\n        if (initialUrl) { //An initial URL was set\n            const initUrl = map?.mapguide?.runtimeMap && initialUrl\n                ? ensureParameters(initialUrl, map?.mapguide?.runtimeMap?.Name, map?.mapguide?.runtimeMap?.SessionId, this.getLocale())\n                : initialUrl;\n            return navigationStack.length > 0 //We have a navigation stack\n                && !areUrlsSame(navigationStack[navIndex], initUrl); //The current URL is not initial.\n        }\n        return false;\n    }\n    private canGoBack = (): boolean => {\n        const { navIndex } = this.props;\n        return navIndex > 0;\n    }\n    private canGoForward = (): boolean => {\n        const { navigationStack, navIndex } = this.props;\n        return navIndex < navigationStack.length - 1;\n    }\n    render(): JSX.Element {\n        const { navigationStack, navIndex, hasTaskBar, lastUrlPushed, map, maxHeight, flyouts, isResizing } = this.props;\n        if (navigationStack[navIndex]) {\n            const flyoutStates: FlyoutVisibilitySet = {};\n            if (flyouts) {\n                const ids = Object.keys(flyouts);\n                for (const fid of ids) {\n                    flyoutStates[fid] = !!flyouts[fid].open;\n                }\n            }\n            return <div>\n                <TaskPane currentUrl={navigationStack[navIndex]}\n                    showTaskBar={hasTaskBar}\n                    lastUrlPushed={lastUrlPushed}\n                    homeAction={this.homeAction}\n                    backAction={this.backAction}\n                    onOpenFlyout={this.onOpenFlyout}\n                    onCloseFlyout={this.onCloseFlyout}\n                    forwardAction={this.forwardAction}\n                    session={map?.mapguide?.runtimeMap?.SessionId}\n                    mapName={map?.mapguide?.runtimeMap?.Name}\n                    onUrlLoaded={this.onUrlLoaded}\n                    maxHeight={maxHeight}\n                    flyoutStates={flyoutStates}\n                    locale={this.getLocale()} />\n                {(() => {\n                    if (isResizing == true) {\n                        return <div style={{ position: \"absolute\", left: 0, right: 0, top: 0, bottom: 0, backgroundColor: TASK_PANE_OVERLAY_BGCOLOR }}>\n                            <NonIdealState\n                                icon=\"arrows-horizontal\"\n                                description={tr(\"TASK_PANE_RESIZING\", this.getLocale())} />\n                        </div>\n                    }\n                })()}\n            </div>;\n        }\n        return <noscript />;\n    }\n}\n\nexport const TaskPaneContainer = (props: ITaskPaneContainerProps) => {\n    const locale = useViewerLocale();\n    const map = useActiveMapBranch();\n    const flyouts = useViewerFlyouts();\n    const initialUrl = useTaskPaneInitialUrl();\n    const lastUrlPushed = useTaskPaneLastUrlPushed();\n    const navIndex = useTaskPaneNavigationIndex();\n    const navigationStack = useTaskPaneNavigationStack();\n    const hasTaskBar = useConfiguredCapabilities().hasTaskBar;\n\n    const dispatch = useReduxDispatch();\n    const invokeCommandAction = (cmd: ICommand, parameters: any) => dispatch(invokeCommand(cmd, parameters));\n    const goHomeAction = () => dispatch(goHome());\n    const goForwardAction = () => dispatch(goForward());\n    const goBackAction = () => dispatch(goBack());\n    const pushUrlAction = (url: string, silent?: boolean) => dispatch(pushUrl(url, silent));\n    const openFlyoutAction = (id: string, metrics: IDOMElementMetrics) => dispatch(openFlyout(id, metrics));\n    const closeFlyoutAction = (id: string) => dispatch(closeFlyout(id));\n\n    return <TaskPaneContainerInner map={map}\n        locale={locale}\n        flyouts={flyouts}\n        initialUrl={initialUrl}\n        lastUrlPushed={lastUrlPushed}\n        navIndex={navIndex}\n        navigationStack={navigationStack}\n        invokeCommand={invokeCommandAction}\n        hasTaskBar={hasTaskBar}\n        goHome={goHomeAction}\n        goForward={goForwardAction}\n        goBack={goBackAction}\n        pushUrl={pushUrlAction}\n        openFlyout={openFlyoutAction}\n        closeFlyout={closeFlyoutAction}\n        {...props} />;\n};","import { appendParameters, parseUrlParameters } from '../utils/url';\n\n/**\n * All relevant state that can be encoded into the main viewer URL\n * @since 0.13\n */\nexport interface IAppUrlState {\n    x?: number;\n    y?: number;\n    scale?: number;\n    resource?: string;\n    locale?: string;\n    session?: string;\n    map?: string;\n    ft?: boolean;\n    sl?: string[];\n    hl?: string[];\n    sg?: string[];\n    hg?: string[];\n}\n\nconst S_DELIM = \"_\"; //This is the current layer/group name delimiter\n\n/**\n * Updates the main URL with the given application state. If passing extra custom state,\n * this extra custom state is also included when getStateFromUrl() is called.\n * \n * Also if the custom state shares the same keys as the main application state, the application\n * state takes precedence (ie. The key/value in the custom state *will not* overwrite the application state for the same key). \n * \n * To avoid this, you should delete/omit said keys from the application state when calling this method if\n * you want to take the equivalent key/value from the custom state.\n *\n * @export\n * @param {IAppUrlState} state\n * @param {*} [extraState] Any extra state to include into the main URL\n * @rem\n * @since 0.13\n * @since 0.14 - New optional extraState argument\n */\nexport function updateUrl(state: IAppUrlState, extraState?: any): void {\n    const st: any = { ...extraState };\n    for (const k in state) {\n        const val: any = (state as any)[k];\n        switch (k) {\n            case \"ft\":\n                st.ft = (val == true) ? 1 : 0;\n                break;\n            case \"sl\":\n                st.sl = val?.join(S_DELIM);\n                break;\n            case \"hl\":\n                st.hl = val?.join(S_DELIM);\n                break;\n            case \"sg\":\n                st.sg = val?.join(S_DELIM);\n                break;\n            case \"hg\":\n                st.hg = val?.join(S_DELIM);\n                break;\n            default:\n                st[k] = val;\n                break;\n        }\n    }\n    const url = appendParameters(window.location.href, st, true, false);\n    window.history.replaceState(st, \"\", url);\n}\n\n/**\n * Gets the application state from the current main URL. If the URL was updated with custom state\n * via updateUrl(), they will also be included in the returned state.\n *\n * @export\n * @param {string[]} [ignoreKeys]\n * @returns {IAppUrlState}\n * @since 0.13\n * @since 0.14 - New optional ignoreKeys to avoid reading out certain properties from URL state\n */\nexport function getStateFromUrl(ignoreKeys?: string[]): IAppUrlState {\n    const st = parseUrlParameters(window.location.href);\n    const state: IAppUrlState = {};\n    const ignore = ignoreKeys ?? [];\n    for (const k in st) {\n        if (ignore.indexOf(k) >= 0) {\n            continue;\n        }\n        const val = st[k];\n        switch (k) {\n            case \"ft\":\n                {\n                    const n = parseInt(val, 10);\n                    if (!isNaN(n)) {\n                        state.ft = (n == 0) ? false : true;\n                    }\n                }\n                break;\n            case \"x\":\n                {\n                    const n = parseFloat(val);\n                    if (!isNaN(n)) {\n                        state.x = n;\n                    }\n                }\n                break;\n            case \"y\":\n                {\n                    const n = parseFloat(val);\n                    if (!isNaN(n)) {\n                        state.y = n;\n                    }\n                }\n                break;\n            case \"scale\":\n                {\n                    const n = parseFloat(val);\n                    if (!isNaN(n)) {\n                        state.scale = n;\n                    }\n                }\n                break;\n            case \"sl\":\n                state.sl = val?.split(S_DELIM);\n                break;\n            case \"hl\":\n                state.hl = val?.split(S_DELIM);\n                break;\n            case \"sg\":\n                state.sg = val?.split(S_DELIM);\n                break;\n            case \"hg\":\n                state.hg = val?.split(S_DELIM);\n                break;\n            default:\n                (state as any)[k] = val;\n                break;\n        }\n    }\n    return state;\n}","import * as React from \"react\";\nimport { UnitOfMeasure } from \"../api/common\";\nimport { ViewSize } from \"../components/view-size\";\nimport { useActiveMapWidth, useActiveMapHeight, useViewerSizeUnits, useActiveMapView, useViewerLocale } from './hooks';\nimport { useActiveMapMetersPerUnit } from './hooks-mapguide';\n\nexport interface IViewSizeContainerProps { }\n\nexport const ViewSizeContainer = () => {\n    const width = useActiveMapWidth();\n    const height = useActiveMapHeight();\n    const sizeUnits = useViewerSizeUnits();\n    const metersPerUnit = useActiveMapMetersPerUnit();\n    const view = useActiveMapView();\n    const locale = useViewerLocale();\n    if (width && height && metersPerUnit && view) {\n        return <ViewSize locale={locale} width={width} height={height} view={view} metersPerUnit={metersPerUnit} units={sizeUnits || UnitOfMeasure.Unknown} />;\n    } else {\n        return <noscript />;\n    }\n};","import * as React from \"react\";\nimport {\n    GenericEvent,\n    UnitOfMeasure\n} from \"../api/common\";\nimport { tr } from \"../api/i18n\";\nimport { getUnits, getUnitOfMeasure } from \"../utils/units\";\nimport { Slider, HTMLSelect } from '@blueprintjs/core';\nimport { useActiveMapName, useViewerFeatureTooltipsEnabled, useConfiguredManualFeatureTooltips, useViewerSizeUnits, useViewerLocale, useActiveMapExternalBaseLayers, useViewerIsStateless } from './hooks';\nimport { setManualFeatureTooltipsEnabled, setFeatureTooltipsEnabled, setLayerTransparency, setViewSizeUnits } from '../actions/map';\nimport { useActiveMapLayerTransparency, useActiveMapState } from './hooks-mapguide';\nimport { LAYER_ID_BASE, LAYER_ID_MG_BASE, LAYER_ID_MG_SEL_OVERLAY } from '../constants';\nimport { useReduxDispatch } from \"../components/map-providers/context\";\nimport { isRuntimeMap } from \"../utils/type-guards\";\n\nexport interface IViewerOptionsProps {\n\n}\n\nexport const ViewerOptions = () => {\n    const externalBaseLayers = useActiveMapExternalBaseLayers(false);\n    const mapName = useActiveMapName();\n    const layerTransparency = useActiveMapLayerTransparency();\n    const featureTooltipsEnabled = useViewerFeatureTooltipsEnabled();\n    const manualFeatureTooltips = useConfiguredManualFeatureTooltips();\n    const viewSizeUnits = useViewerSizeUnits();\n    const stateless = useViewerIsStateless();\n    const map = useActiveMapState();\n    const locale = useViewerLocale();\n    const dispatch = useReduxDispatch();\n    const toggleManualMapTipsAction = (enabled: boolean) => dispatch(setManualFeatureTooltipsEnabled(enabled));\n    const toggleMapTipsAction = (enabled: boolean) => dispatch(setFeatureTooltipsEnabled(enabled));\n    const setLayerTransparencyAction = (mapName: string, id: string, opacity: number) => dispatch(setLayerTransparency(mapName, id, opacity));\n    const setViewSizeDisplayUnitsAction = (units: UnitOfMeasure) => dispatch(setViewSizeUnits(units));\n    const onMgLayerOpacityChanged = (mapName: string | undefined, layerId: string, value: number) => {\n        if (mapName) {\n            setLayerTransparencyAction?.(mapName, layerId, value);\n        }\n    };\n    const onBaseOpacityChanged = (value: number) => {\n        onMgLayerOpacityChanged(mapName, LAYER_ID_BASE, value);\n    };\n    const onMgOpacityChanged = (value: number) => {\n        onMgLayerOpacityChanged(mapName, LAYER_ID_MG_BASE, value);\n    };\n    const onMgSelOpacityChanged = (value: number) => {\n        onMgLayerOpacityChanged(mapName, LAYER_ID_MG_SEL_OVERLAY, value);\n    };\n    const onViewSizeUnitsChanged = (e: GenericEvent) => {\n        setViewSizeDisplayUnitsAction(e.target.value);\n    };\n    const onFeatureTooltipsChanged = (e: GenericEvent) => {\n        toggleMapTipsAction(e.target.checked);\n    };\n    const onManualFeatureTooltipsChanged = (e: GenericEvent) => {\n        toggleManualMapTipsAction(e.target.checked);\n    };\n    const units = getUnits();\n    let opBase = 1.0;\n    let opMgBase = 1.0;\n    let opMgSelOverlay = 1.0;\n    if (layerTransparency) {\n        if (LAYER_ID_BASE in layerTransparency) {\n            opBase = layerTransparency[LAYER_ID_BASE];\n        }\n        if (LAYER_ID_MG_BASE in layerTransparency) {\n            opMgBase = layerTransparency[LAYER_ID_MG_BASE];\n        }\n        if (LAYER_ID_MG_SEL_OVERLAY in layerTransparency) {\n            opMgSelOverlay = layerTransparency[LAYER_ID_MG_SEL_OVERLAY];\n        }\n    }\n    let isStateless = stateless;\n    if (!map) {\n        isStateless = true;\n    }\n    return <div className=\"component-viewer-options\">\n        <h5>{tr(\"VIEWER_OPTIONS\", locale)}</h5>\n        <hr />\n        {!isStateless && <label className=\"bp3-control bp3-switch\">\n            <input type=\"checkbox\" checked={featureTooltipsEnabled} onChange={onFeatureTooltipsChanged} />\n            <span className=\"bp3-control-indicator\"></span>\n            {tr(\"FEATURE_TOOLTIPS\", locale)}\n        </label>}\n        {(() => {\n            if (!isStateless && featureTooltipsEnabled) {\n                return <label className=\"bp3-control bp3-switch\">\n                    <input type=\"checkbox\" checked={manualFeatureTooltips} onChange={onManualFeatureTooltipsChanged} />\n                    <span className=\"bp3-control-indicator\"></span>\n                    {tr(\"MANUAL_FEATURE_TOOLTIPS\", locale)}\n                </label>;\n            }\n        })()}\n        <fieldset>\n            <legend>{tr(\"LAYER_TRANSPARENCY\", locale)}</legend>\n            {(() => {\n                if (externalBaseLayers) {\n                    return <label className=\"bp3-label noselect\">\n                        {tr(\"LAYER_ID_BASE\", locale)}\n                        <div style={{ paddingLeft: 8, paddingRight: 8 }}>\n                            <Slider min={0} max={1.0} stepSize={0.01} value={opBase} onChange={onBaseOpacityChanged} />\n                        </div>\n                    </label>;\n                }\n            })()}\n            <label className=\"bp3-label noselect\">\n                {map ? tr(\"LAYER_ID_MG_BASE\", locale) : tr(\"LAYER_ID_SUBJECT\", locale)}\n                <div style={{ paddingLeft: 8, paddingRight: 8 }}>\n                    <Slider min={0} max={1.0} stepSize={0.01} value={opMgBase} onChange={onMgOpacityChanged} />\n                </div>\n            </label>\n            {!isStateless && <label className=\"bp3-label noselect\">\n                {tr(\"LAYER_ID_MG_SEL_OVERLAY\", locale)}\n                <div style={{ paddingLeft: 8, paddingRight: 8 }}>\n                    <Slider min={0} max={1.0} stepSize={0.01} value={opMgSelOverlay} onChange={onMgSelOpacityChanged} />\n                </div>\n            </label>}\n        </fieldset>\n        <label className=\"bp3-label\">\n            {tr(\"MAP_SIZE_DISPLAY_UNITS\", locale)}\n            <div className=\"bp3-select\">\n                <HTMLSelect value={viewSizeUnits} onChange={onViewSizeUnitsChanged}>\n                    {units.map(u => {\n                        const [uom] = u;\n                        const ui = getUnitOfMeasure(uom);\n                        return <option key={uom} value={uom}>{ui.localizedName(locale)}</option>;\n                    })}\n                </HTMLSelect>\n            </div>\n        </label>\n    </div>;\n};","import {\n    IConfigurationReducerState,\n    ICoordinateConfiguration,\n    IViewerCapabilities,\n    UnitOfMeasure,\n    KC_ESCAPE, \n    KC_U\n} from \"../api/common\";\nimport { DEFAULT_LOCALE } from \"../api/i18n\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\nimport { warn } from '../utils/logger';\n\nexport const CONFIG_INITIAL_STATE: IConfigurationReducerState = {\n    agentUri: undefined,\n    agentKind: \"mapagent\",\n    locale: DEFAULT_LOCALE,\n    activeMapName: undefined,\n    availableMaps: undefined,\n    viewRotation: 0,\n    viewRotationEnabled: true,\n    viewSizeUnits: UnitOfMeasure.Meters,\n    manualFeatureTooltips: false,\n    cancelDigitizationKey: KC_ESCAPE,\n    undoLastPointKey: KC_U,\n    coordinates: {\n        decimals: 6\n    } as ICoordinateConfiguration,\n    viewer: {\n        isStateless: false,\n        imageFormat: \"PNG\",\n        selectionImageFormat: \"PNG8\",\n        selectionColor: \"0x0000FFAA\", //Blue\n        activeSelectedFeatureColor: \"0xFF0000AA\", //Red\n        pointSelectionBuffer: 2,\n        loadIndicatorPositioning: \"top\",\n        loadIndicatorColor: \"rgba(34, 153, 221, 0.9)\",\n    },\n    capabilities: {\n        hasTaskPane: false,\n        hasTaskBar: false,\n        hasStatusBar: false,\n        hasNavigator: false,\n        hasSelectionPanel: false,\n        hasLegend: false,\n        hasToolbar: false,\n        hasViewSize: false\n    } as IViewerCapabilities\n};\n\nexport function configReducer(state = CONFIG_INITIAL_STATE, action: ViewerAction): IConfigurationReducerState {\n    switch (action.type) {\n        case ActionType.SET_LOCALE:\n            {\n                return {\n                    ...state,\n                    ...{ locale: action.payload }\n                }\n            }\n        case ActionType.INIT_APP:\n            {\n                const payload = action.payload ?? {};\n                const maps = payload.maps;\n                const availableMaps = [];\n                let am = payload.activeMapName;\n                const mapNames = Object.keys(maps);\n                for (const mapName of mapNames) {\n                    availableMaps.push({ name: maps[mapName].mapGroupId, value: mapName });\n                }\n                if (mapNames.indexOf(am) < 0) {\n                    warn(`Invalid initial active map name: ${am}. Probably because we haven't properly implemented recovery of runtime maps on reload yet`);\n                    am = mapNames[0];\n                }\n                const state1: Partial<IConfigurationReducerState> = {\n                    locale: payload.locale || DEFAULT_LOCALE,\n                    capabilities: payload.capabilities,\n                    activeMapName: am,\n                    availableMaps: availableMaps\n                };\n                const newState = { ...state, ...state1 };\n                if (payload.config != null && Object.keys(payload.config).length > 0) {\n                    const coordConfig = { ...state.coordinates };\n                    const viewerConfig = { ...state.viewer };\n                    if (payload.config.isStateless != null) {\n                        viewerConfig.isStateless = payload.config.isStateless;\n                    }\n                    if (payload.config.imageFormat != null) {\n                        viewerConfig.imageFormat = payload.config.imageFormat;\n                    }\n                    if (payload.config.selectionImageFormat != null) {\n                        viewerConfig.selectionImageFormat = payload.config.selectionImageFormat;\n                    }\n                    if (payload.config.selectionColor != null) {\n                        viewerConfig.selectionColor = payload.config.selectionColor;\n                    }\n                    if (payload.config.pointSelectionBuffer != null) {\n                        viewerConfig.pointSelectionBuffer = payload.config.pointSelectionBuffer;\n                    }\n                    if (payload.config.coordinateProjection != null) {\n                        coordConfig.projection = payload.config.coordinateProjection;\n                    }\n                    if (payload.config.coordinateDecimals != null) {\n                        coordConfig.decimals = payload.config.coordinateDecimals;\n                    }\n                    if (payload.config.coordinateDisplayFormat != null) {\n                        coordConfig.format = payload.config.coordinateDisplayFormat;\n                    }\n                    const state2: Partial<IConfigurationReducerState> = { viewer: viewerConfig, coordinates: coordConfig };\n                    if (payload.config.viewSizeUnits != null) {\n                        state2.viewSizeUnits = payload.config.viewSizeUnits;\n                    }\n                    return { ...newState, ...state2 };\n                } else {\n                    return newState;\n                }\n            }\n        case ActionType.MAP_SET_VIEW_ROTATION:\n            {\n                return { ...state, ...{ viewRotation: action.payload } };\n            }\n        case ActionType.MAP_SET_VIEW_ROTATION_ENABLED:\n            {\n                return { ...state, ...{ viewRotationEnabled: action.payload } };\n            }\n        case ActionType.MAP_SET_ACTIVE_MAP:\n            {\n                const data: any = action.payload;\n                if (data) {\n                    const state1: Partial<IConfigurationReducerState> = {\n                        activeMapName: data\n                    };\n                    return { ...state, ...state1 };\n                }\n            }\n        case ActionType.MAP_SET_VIEW_SIZE_UNITS:\n            {\n                //HACK: Huh? It's typed UnitOfMeasure on both ends, so where is the string coming from that causes\n                //the RHS type to be string | UnitOfMeasure?\n                const state1: Partial<IConfigurationReducerState> = { viewSizeUnits: action.payload as UnitOfMeasure };\n                return { ...state, ...state1 };\n            }\n        case ActionType.MAP_SET_MANUAL_MAPTIP:\n            {\n                return { ...state, ...{ manualFeatureTooltips: action.payload } };\n            }\n    }\n    return state;\n}","import { IInitErrorReducerState } from \"../api/common\";\nimport { makeUnique } from \"../utils/array\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const INIT_ERROR_INITIAL_STATE: IInitErrorReducerState = {\n    options: {},\n    error: undefined,\n    includeStack: true,\n    warnings: []\n};\n\nexport function initErrorReducer(state = INIT_ERROR_INITIAL_STATE, action: ViewerAction): IInitErrorReducerState {\n    switch (action.type) {\n        case ActionType.INIT_ACKNOWLEDGE_WARNINGS:\n            {\n                return { ...state, ...{ warnings: [] } };\n            }\n        case ActionType.INIT_APP:\n            {\n                return { ...state, ...{ warnings: makeUnique(action.payload.warnings) } }\n            }\n        case ActionType.INIT_ERROR:\n            {\n                const { payload } = action;\n                const error = payload.error;\n                const options = payload.options;\n                let includeStack: boolean | undefined = payload.includeStack;\n                if (typeof(includeStack) == 'undefined') {\n                    includeStack = true;\n                }\n                return { error: error, options: options, includeStack: includeStack, warnings: [] };\n            }\n    }\n    return state;\n}","// A reducer to remember the last dispatched action. This is primarily used by layout\n// templates to listen on certain actions and be able to update their panel states\n//\n// As suggested by the creator of redux:\n// https://github.com/reactjs/redux/issues/580\nimport { isAction } from \"../utils/type-guards\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const NULL_ACTION = {};\n\nexport function lastAction(state = null, action: ViewerAction) {\n    if (isAction(action)) {\n        switch (action.type) {\n            case ActionType.MAP_SET_BUSY_COUNT:\n            case ActionType.TASK_INVOKE_URL:\n            case ActionType.MAP_SET_SELECTION:\n            case ActionType.MAP_ADD_CLIENT_SELECTED_FEATURE:\n            case ActionType.MAP_SET_MAPTIP:\n            case ActionType.MAP_SET_ACTIVE_TOOL:\n                return action;\n        }\n    }\n    //As we're returning a const reference subsequent dispatched actions that\n    //are not the ones listed above should give us the same branch in the eyes\n    //of redux\n    return NULL_ACTION;\n}","import {\n    IBranchedMapState,\n    IBranchedMapSubState,\n    IExternalBaseLayer,\n    ILayerInfo,\n    IMapGuideSubState,\n    IGenericLayerSubState\n} from \"../api/common\";\nimport { isMapView } from \"../utils/type-guards\";\nimport { makeUnique } from \"../utils/array\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction, isGenericSubjectMapLayer } from '../actions/defs';\nimport { debug } from '../utils/logger';\nimport { IClusterSettings, VectorStyleSource } from \"../api/ol-style-contracts\";\nimport { ClientSelectionLayer } from \"../api/contracts/common\";\n\nexport const MAP_STATE_INITIAL_STATE: IBranchedMapState = {\n\n};\n\nexport const MG_INITIAL_SUB_STATE: IMapGuideSubState = {\n    selectionSet: undefined,\n    layerTransparency: {},\n    selectableLayers: {},\n    expandedGroups: {},\n    runtimeMap: undefined,\n    showLayers: [],\n    showGroups: [],\n    hideLayers: [],\n    hideGroups: [],\n    activeSelectedFeature: undefined,\n}\n\nexport const MAP_STATE_INITIAL_SUB_STATE: IBranchedMapSubState = {\n    currentView: undefined,\n    initialView: undefined,\n    history: [],\n    historyIndex: -1,\n    externalBaseLayers: [],\n    initialExternalLayers: [],\n    layers: undefined,\n    mapguide: undefined,\n    generic: undefined,\n    clientSelection: undefined\n};\n\nfunction applyMapGuideSubState(state: IBranchedMapState, mapName: string, applyFn: (current: IMapGuideSubState) => Partial<IMapGuideSubState>) {\n    const subState = state[mapName]\n    if (subState) {\n        const mgSubState = subState.mapguide;\n        if (mgSubState) {\n            const toApply = applyFn(mgSubState);\n            const mgSubState1 = {\n                ...mgSubState,\n                ...toApply\n            };\n            return mergeSubState(state, mapName, { ...subState, ...{ mapguide: mgSubState1 } });\n        }\n    }\n    return state;\n}\n\nfunction setLayerAction<K extends keyof ILayerInfo>(state: IBranchedMapState, mapName: string, layerName: string, selector: (current: ILayerInfo) => Pick<ILayerInfo, K>): IBranchedMapState {\n    const subState = state[mapName];\n    if (subState && subState.layers) {\n        const layers = subState.layers.map(l => {\n            if (l.name == layerName) {\n                return {\n                    ...l,\n                    ...(selector(l))\n                } as ILayerInfo;\n            } else {\n                return l;\n            }\n        });\n        const state1: Partial<IBranchedMapSubState> = {\n            layers\n        };\n        return mergeSubState(state, mapName, { ...subState, ...state1 });\n    }\n    return state;\n}\n\nfunction mergeSubState(state: IBranchedMapState, mapName: string, subState: Partial<IBranchedMapSubState>): IBranchedMapState {\n    const state1: Partial<IBranchedMapState> = {};\n    state1[mapName] = { ...state[mapName], ...subState };\n    return { ...state, ...state1 } as IBranchedMapState;\n}\n\nexport function mapStateReducer(state = MAP_STATE_INITIAL_STATE, action: ViewerAction): IBranchedMapState {\n    switch (action.type) {\n        case ActionType.MAP_REFRESH:\n            {\n                const { payload } = action;\n                return applyMapGuideSubState(state, payload.mapName, _ => ({\n                    runtimeMap: payload.map\n                }));\n            }\n        case ActionType.INIT_APP:\n            {\n                const { payload } = action;\n                const maps = payload.maps;\n                const mapKeys = Object.keys(maps);\n                const newState: IBranchedMapState = {};\n                let mapNameToApplyInitialState = payload.activeMapName;\n                if (!mapNameToApplyInitialState && mapKeys.length == 1) {\n                    mapNameToApplyInitialState = mapKeys[0];\n                }\n                for (const mapName of mapKeys) {\n                    let cv: Partial<IBranchedMapSubState> | undefined;\n                    if (payload.initialView && mapName == mapNameToApplyInitialState) {\n                        cv = {\n                            currentView: { ...payload.initialView }\n                        };\n                    }\n                    let isel: Partial<IMapGuideSubState> | undefined;\n                    if (payload.initialSelections && payload.initialSelections[mapName]) {\n                        isel = {\n                            selectionSet: payload.initialSelections[mapName]\n                        };\n                        debug(`Restoring client-side selection set for: ${mapName}`);\n                    }\n\n                    const sl = [];\n                    const sg = [];\n                    const hl = [];\n                    const hg = [];\n                    let mrtm;\n                    let mgeneric: IGenericLayerSubState | undefined;\n\n                    const rtm = maps[mapName].map;\n                    if (rtm) {\n                        if (!isGenericSubjectMapLayer(rtm)) {\n                            mrtm = { runtimeMap: rtm };\n                        } else {\n                            mgeneric = { subject: { ...rtm } };\n                        }\n                    }\n                    if (mapName == mapNameToApplyInitialState) {\n                        if (rtm && !isGenericSubjectMapLayer(rtm)) {\n                            const isl = payload.initialShowLayers ?? [];\n                            const isg = payload.initialShowGroups ?? [];\n                            const ihl = payload.initialHideLayers ?? [];\n                            const ihg = payload.initialHideGroups ?? [];\n\n                            //Only initally show what is initially hidden and vice versa\n                            //NOTE: A map could have duplicate group/layer names, we make no attempt\n                            //to pick out the \"correct\" one. It's first come first serve.\n                            if (rtm.Layer) {\n                                for (const l of rtm.Layer) {\n                                    if (isl.indexOf(l.Name) >= 0 && !l.Visible) {\n                                        sl.push(l.ObjectId);\n                                    } else if (ihl.indexOf(l.Name) >= 0 && l.Visible) {\n                                        hl.push(l.ObjectId);\n                                    }\n                                }\n                            }\n                            if (rtm.Group) {\n                                for (const g of rtm.Group) {\n                                    if (isg.indexOf(g.Name) >= 0 && !g.Visible) {\n                                        sg.push(g.ObjectId);\n                                    } else if (ihg.indexOf(g.Name) >= 0 && g.Visible) {\n                                        hg.push(g.ObjectId);\n                                    }\n                                }\n                            }\n                            debug(`Initially showing layers: ${isl.join(\"|\")}`);\n                            debug(`Initially showing groups: ${isg.join(\"|\")}`);\n                            debug(`Initially hiding layers: ${ihl.join(\"|\")}`);\n                            debug(`Initially hiding groups: ${ihg.join(\"|\")}`);\n\n                            debug(`Initially showing layer ids: ${sl.join(\"|\")}`);\n                            debug(`Initially showing group ids: ${sg.join(\"|\")}`);\n                            debug(`Initially hiding layer ids: ${hl.join(\"|\")}`);\n                            debug(`Initially hiding group ids: ${hg.join(\"|\")}`);\n                        }\n                    }\n                    const newMgSubState = {\n                        ...MG_INITIAL_SUB_STATE,\n                        ...mrtm,\n                        ...(isel || {}),\n                        ...(sl.length > 0 ? { showLayers: [...sl] } : {}),\n                        ...(sg.length > 0 ? { showGroups: [...sg] } : {}),\n                        ...(hl.length > 0 ? { hideLayers: [...hl] } : {}),\n                        ...(hg.length > 0 ? { hideGroups: [...hg] } : {})\n                    };\n                    const newMapState = {\n                        ...MAP_STATE_INITIAL_SUB_STATE,\n                        ...{ generic: mgeneric },\n                        ...{ externalBaseLayers: maps[mapName].externalBaseLayers },\n                        ...{ initialExternalLayers: maps[mapName].initialExternalLayers },\n                        ...{ initialView: maps[mapName].initialView },\n                        ...(cv || {}),\n                        ...{ mapguide: newMgSubState }\n                    };\n\n\n                    // As INIT_APP does not establish a currentView, if a currentView was\n                    // somehow established as part of the initial app state, we will keep\n                    // it instead of it being discarded\n                    if (state?.[mapName]?.currentView) {\n                        newMapState.currentView = state[mapName].currentView;\n                    }\n\n                    newState[mapName] = newMapState;\n                }\n\n                return { ...state, ...newState };\n            }\n        case ActionType.MAP_PREVIOUS_VIEW:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const index = subState.historyIndex - 1;\n                    if (index >= 0) {\n                        const state1: Partial<IBranchedMapSubState> = {\n                            historyIndex: index,\n                            currentView: subState.history[index]\n                        };\n                        return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                    }\n                }\n                return state;\n            }\n        case ActionType.MAP_NEXT_VIEW:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const index = subState.historyIndex + 1;\n                    if (index < subState.history.length) {\n                        const state1: Partial<IBranchedMapSubState> = {\n                            historyIndex: index,\n                            currentView: subState.history[index]\n                        };\n                        return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                    }\n                }\n                return state;\n            }\n        case ActionType.MAP_SET_SCALE:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    let view = subState.currentView;\n                    const scale = payload.scale;\n                    if (typeof view === 'object' && typeof scale === 'number') {\n                        const view1 = { scale: scale, resolution: payload.resolution };\n                        view = { ...view, ...view1 };\n                    }\n                    const state1: Partial<IBranchedMapSubState> = {\n                        currentView: view\n                    };\n                    const newSubState: Partial<IBranchedMapSubState> = { ...state1, ...{ historyIndex: subState.historyIndex } };\n                    newSubState.history = [...subState.history];\n                    if (view && newSubState.history && newSubState.historyIndex != null) {\n                        newSubState.historyIndex++;\n                        newSubState.history[newSubState.historyIndex] = view;\n                        //If we slotted at a position that is not the end of the array\n                        //remove everything after it\n                        if (newSubState.history.length > newSubState.historyIndex + 1) {\n                            newSubState.history.splice(newSubState.historyIndex + 1);\n                        }\n                    }\n                    return mergeSubState(state, payload.mapName, newSubState);\n                }\n                return state;\n            }\n        case ActionType.MAP_SET_VIEW:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const data = payload.view;\n                    if (isMapView(data)) {\n                        const state1: Partial<IBranchedMapSubState> = {\n                            currentView: data\n                        };\n                        const newSubState: Partial<IBranchedMapSubState> = { ...state1, ...{ historyIndex: subState.historyIndex } };\n                        newSubState.history = [...subState.history];\n                        if (newSubState.history && newSubState.historyIndex != null) {\n                            newSubState.historyIndex++;\n                            newSubState.history[newSubState.historyIndex] = data;\n                            //If we slotted at a position that is not the end of the array\n                            //remove everything after it\n                            if (newSubState.history.length > newSubState.historyIndex + 1) {\n                                newSubState.history.splice(newSubState.historyIndex + 1);\n                            }\n                        }\n                        return mergeSubState(state, payload.mapName, newSubState);\n                    }\n                }\n                return state;\n            }\n        case ActionType.MAP_SET_LAYER_TRANSPARENCY:\n            {\n                const { payload } = action;\n                return applyMapGuideSubState(state, payload.mapName, mgSubState => {\n                    const trans = { ...mgSubState.layerTransparency };\n                    trans[payload.layerName] = payload.opacity;\n                    return {\n                        layerTransparency: trans\n                    };\n                });\n            }\n        case ActionType.LEGEND_SET_LAYER_SELECTABLE:\n            {\n                const { payload } = action;\n                return applyMapGuideSubState(state, payload.mapName, mgSubState => {\n                    const layers = { ...mgSubState.selectableLayers };\n                    layers[payload.id] = payload.value;\n                    return {\n                        selectableLayers: layers\n                    };\n                });\n            }\n        case ActionType.LEGEND_SET_GROUP_EXPANDABLE:\n            {\n                const { payload } = action;\n                return applyMapGuideSubState(state, payload.mapName, mgSubState => {\n                    const groups = { ...mgSubState.expandedGroups };\n                    groups[payload.id] = payload.value;\n                    return {\n                        expandedGroups: groups\n                    };\n                });\n            }\n        case ActionType.LEGEND_SET_GROUP_VISIBILITY:\n            {\n                const { payload } = action;\n                return applyMapGuideSubState(state, payload.mapName, mgSubState => {\n                    let showGroups: string[] = [...mgSubState.showGroups];\n                    let hideGroups: string[] = [...mgSubState.hideGroups];\n                    if (payload.value === true) { //Show it\n                        showGroups.push(payload.id);\n                        showGroups = makeUnique(showGroups);\n                        hideGroups = hideGroups.filter(g => g != payload.id);\n                    } else { //Hide it\n                        hideGroups.push(payload.id);\n                        hideGroups = makeUnique(hideGroups);\n                        showGroups = showGroups.filter(g => g != payload.id);\n                    }\n                    return {\n                        showLayers: mgSubState.showLayers,\n                        showGroups: showGroups,\n                        hideLayers: mgSubState.hideLayers,\n                        hideGroups: hideGroups\n                    };\n                });\n            }\n        case ActionType.LEGEND_SET_LAYER_VISIBILITY:\n            {\n                const { payload } = action;\n                return applyMapGuideSubState(state, payload.mapName, mgSubState => {\n                    let showLayers: string[] = [...mgSubState.showLayers];\n                    let hideLayers: string[] = [...mgSubState.hideLayers];\n                    if (payload.value === true) { //Show it\n                        showLayers.push(payload.id);\n                        showLayers = makeUnique(showLayers);\n                        hideLayers = hideLayers.filter(g => g != payload.id);\n                    } else { //Hide it\n                        hideLayers.push(payload.id);\n                        hideLayers = makeUnique(hideLayers);\n                        showLayers = showLayers.filter(g => g != payload.id);\n                    }\n                    return {\n                        showLayers: showLayers,\n                        showGroups: mgSubState.showGroups,\n                        hideLayers: hideLayers,\n                        hideGroups: mgSubState.hideGroups\n                    };\n                });\n            }\n        case ActionType.MAP_SET_SELECTION:\n            {\n                const { payload } = action;\n                return applyMapGuideSubState(state, payload.mapName, _ => ({\n                    selectionSet: payload.selection,\n                    layerIndex: -1,\n                    featureIndex: -1,\n                    activeSelectedFeature: undefined\n                }));\n            }\n        case ActionType.MAP_ADD_CLIENT_SELECTED_FEATURE:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const cs = subState.clientSelection ?? {\n                        layers: []\n                    };\n                    let lyr = cs.layers.find(l => l.name == payload.layerName);\n                    if (!lyr) {\n                        lyr = {\n                            name: payload.layerName,\n                            features: []\n                        } as ClientSelectionLayer;\n                        cs.layers.push(lyr);\n                    }\n                    lyr.features.push(payload.feature);\n                    return mergeSubState(state, payload.mapName, {\n                        ...subState,\n                        clientSelection: cs\n                    });\n                }\n                return state;\n            }\n        case ActionType.MAP_CLEAR_CLIENT_SELECTION:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    return mergeSubState(state, payload.mapName, {\n                        ...subState,\n                        clientSelection: undefined\n                    });\n                }\n                return state;\n            }\n        case ActionType.MAP_SHOW_SELECTED_FEATURE:\n            {\n                const { payload } = action;\n                return applyMapGuideSubState(state, payload.mapName, _ => ({\n                    activeSelectedFeature: {\n                        layerId: payload.layerId,\n                        selectionKey: payload.selectionKey\n                    }\n                }));\n            }\n        case ActionType.MAP_SET_BASE_LAYER:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const layers: IExternalBaseLayer[] = (subState.externalBaseLayers || []);\n                    const baseLayers = layers.map(layer => {\n                        // Non-visual base layers like UTFGrid will always stay visible\n                        if (layer.kind != \"UTFGrid\") {\n                            layer.visible = false;\n                        }\n                        if (layer.name == payload.layerName) {\n                            layer.visible = true;\n                        }\n                        return layer;\n                    });\n                    const state1: Partial<IBranchedMapSubState> = {\n                        externalBaseLayers: baseLayers\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.EXTERNAL_LAYERS_READY:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const layers = subState.layers ?? [];\n                    const state1: Partial<IBranchedMapSubState> = {\n                        layers\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.LAYER_ADDED:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState) {\n                    const layers = [payload.layer, ...(subState.layers ?? [])];\n                    const state1: Partial<IBranchedMapSubState> = {\n                        layers\n                    };\n                    const ss = mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                    if (payload.defaultStyle) {\n                        const ss1 = setLayerAction(ss, payload.mapName, payload.layer.name, () => ({ vectorStyle: payload.defaultStyle }));\n                        return ss1;\n                    }\n                    return ss;\n                }\n                return state;\n            }\n        case ActionType.REMOVE_LAYER:\n            {\n                const { payload } = action;\n                const subState = state[payload.mapName];\n                if (subState && subState.layers) {\n                    const layers = subState.layers.filter(l => l.name != action.payload.layerName);\n                    const state1: Partial<IBranchedMapSubState> = {\n                        layers\n                    };\n                    return mergeSubState(state, payload.mapName, { ...subState, ...state1 });\n                }\n                return state;\n            }\n        case ActionType.SET_LAYER_VISIBILITY:\n            {\n                const { mapName, layerName, visible } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, () => ({ visible: visible }));\n                return state1;\n            }\n        case ActionType.SET_LAYER_OPACITY:\n            {\n                const { mapName, layerName, opacity } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, () => ({ opacity: opacity }));\n                return state1;\n            }\n        case ActionType.SET_HEATMAP_LAYER_BLUR:\n            {\n                const { mapName, layerName, blur } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, (layer) => ({\n                    heatmap: {\n                        ...(layer.heatmap ?? { blur: 15, radius: 5 }),\n                        blur\n                    }\n                }));\n                return state1;\n            }\n        case ActionType.SET_HEATMAP_LAYER_RADIUS:\n            {\n                const { mapName, layerName, radius } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, (layer) => ({\n                    heatmap: {\n                        ...(layer.heatmap ?? { blur: 15, radius: 5 }),\n                        radius\n                    }\n                }));\n                return state1;\n            }\n        case ActionType.SET_LAYER_INDEX:\n            {\n                const { mapName, index, layerName } = action.payload;\n                const subState = state[mapName];\n                if (subState && subState.layers) {\n                    const layers = [...subState.layers];\n                    let currentIdx = -1;\n                    for (let i = 0; i < layers.length; i++) {\n                        if (layers[i].name == layerName) {\n                            currentIdx = i;\n                            break;\n                        }\n                    }\n                    if (currentIdx >= 0 && currentIdx != index && index < layers.length && index >= 0) {\n                        const theLayer = layers[currentIdx];\n                        layers.splice(currentIdx, 1);\n                        layers.splice(index, 0, theLayer);\n                        const state1: Partial<IBranchedMapSubState> = {\n                            layers\n                        };\n                        return mergeSubState(state, mapName, { ...subState, ...state1 });\n                    }\n                }\n                return state;\n            }\n        case ActionType.SET_LAYER_VECTOR_STYLE:\n            {\n                const { mapName, layerName, style, which } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, (current) => {\n                    if (which == VectorStyleSource.Base) {\n                        return { vectorStyle: style }\n                    } else if (which == VectorStyleSource.Cluster) {\n                        return {\n                            cluster: {\n                                ...current.cluster,\n                                style: { ...style }\n                            } as IClusterSettings\n                        };\n                    } else {\n                        return {};\n                    }\n                });\n                return state1;\n            }\n        case ActionType.ADD_LAYER_BUSY_WORKER:\n            {\n                const { mapName, layerName } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, l => ({ busyWorkerCount: l.busyWorkerCount + 1 }));\n                return state1;\n            }\n        case ActionType.REMOVE_LAYER_BUSY_WORKER:\n            {\n                const { mapName, layerName } = action.payload;\n                const state1 = setLayerAction(state, mapName, layerName, l => ({ busyWorkerCount: l.busyWorkerCount - 1 }));\n                return state1;\n            }\n    }\n    return state;\n}","import { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\nimport { IModalReducerState } from '../api/common';\n\nexport const MODAL_INITIAL_STATE: IModalReducerState = { };\n\nexport function modalReducer(state = MODAL_INITIAL_STATE, action: ViewerAction): IModalReducerState {\n    switch (action.type) {\n        case ActionType.MODAL_SHOW_COMPONENT:\n            {\n                const newData: any = {};\n                newData[action.payload.name] = {\n                    modal: action.payload.modal,\n                    component: action.payload.component,\n                    componentProps: action.payload.componentProps\n                };\n                return { ...state, ...newData };\n            }\n        case ActionType.MODAL_SHOW_URL:\n            {\n                const newData: any = {};\n                newData[action.payload.name] = { ...action.payload };\n                return { ...state, ...newData };\n            }\n        case ActionType.MODAL_CLOSE:\n            {\n                let newState: any = { ...state };\n                delete newState[action.payload];\n                return newState;\n            }\n    }\n    return state;\n}","import {\n    IMouseReducerState\n} from \"../api/common\";\nimport { isCoordinate } from \"../utils/type-guards\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const MOUSE_INITIAL_STATE: IMouseReducerState = {\n    coords: undefined\n};\n\nexport function mouseReducer(state = MOUSE_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.UPDATE_MOUSE_COORDINATES:\n            {\n                const data = action.payload.coord;\n                if (isCoordinate(data)) {\n                    const state1: Partial<IMouseReducerState> = { coords: data };\n                    return { ...state, ...state1 };\n                }\n            }\n    }\n    return state;\n}","import { configReducer} from \"./config\";\nimport { toolbarReducer } from \"./toolbar\";\nimport { taskPaneReducer } from \"./taskpane\";\nimport { lastAction } from \"./last-action\";\nimport { modalReducer } from \"./modal\";\nimport { initErrorReducer } from \"./init-error\";\nimport { mapStateReducer } from \"./map-state\";\nimport { viewerReducer } from \"./viewer\";\nimport { mouseReducer } from \"./mouse\";\nimport { templateReducer } from \"./template\";\n\nexport const rootReducer: any = {\n    initError: initErrorReducer,\n    config: configReducer,\n    template: templateReducer,\n    mapState: mapStateReducer,\n    viewer: viewerReducer,\n    toolbar: toolbarReducer,\n    taskpane: taskPaneReducer,\n    modal: modalReducer,\n    mouse: mouseReducer,\n    lastaction: lastAction\n};","import { ITaskPaneReducerState } from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const TASK_PANE_INITIAL_STATE: ITaskPaneReducerState = {\n    navIndex: -1,\n    navigation: [],\n    initialUrl: undefined,\n    //Having this state sounds extremely hacky, but we need a way to signal to the \"dumb\" task pane that\n    //the url its about to receive was pushed and should not be reloaded into the internal iframe\n    lastUrlPushed: false\n};\n\nfunction mergeNavigatedUrl(state: any, url: string): any {\n    let index = state.navIndex;\n    const nav: string[] = state.navigation;\n    index++;\n    nav[index] = url;\n    //If we slotted at a position that is not the end of the array\n    //remove everything after it\n    if (nav.length > index + 1) {\n        nav.splice(index + 1);\n    }\n    const newState = {\n        navIndex: index,\n        navigation: nav,\n        lastUrlPushed: false\n    };\n    return { ...state, ...newState };\n}\n\nexport function taskPaneReducer(state = TASK_PANE_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.INIT_APP:\n            {\n                const { payload } = action;\n                const newState = {\n                    initialUrl: payload.initialUrl,\n                    navIndex: 0,\n                    navigation: [ payload.initialUrl ]\n                };\n                return { ...state, ...newState };\n            }\n        case ActionType.TASK_PANE_HOME:\n            {\n                if (state.initialUrl != null) {\n                    return mergeNavigatedUrl(state, state.initialUrl);\n                }\n                return state;\n            }\n        case ActionType.TASK_PANE_BACK:\n            {\n                let index = state.navIndex;\n                const nav = state.navigation;\n                index--;\n                const newState = {\n                    navIndex: index,\n                    navigation: nav,\n                    lastUrlPushed: false\n                };\n                return { ...state, ...newState };\n            }\n        case ActionType.TASK_PANE_FORWARD:\n            {\n                let index = state.navIndex;\n                const nav = state.navigation;\n                index++;\n                const newState = {\n                    navIndex: index,\n                    navigation: nav,\n                    lastUrlPushed: false\n                };\n                return { ...state, ...newState };\n            }\n        case ActionType.TASK_PANE_PUSH_URL:\n            {\n                const { payload } = action;\n                const index = state.navIndex;\n                const nav: string[] = state.navigation;\n                //if (areUrlsSame(nav[index], action.payload.url)) {\n                //    return state;\n                //}\n                nav[index + 1] = payload.url\n                //If we slotted at a position that is not the end of the array\n                //remove everything after it\n                if (nav.length > index + 2) {\n                    nav.splice(index + 2);\n                }\n                if (payload.silent === true) {\n                    const newState = {\n                        navigation: nav\n                    };\n                    return { ...state, ...newState };\n                } else {\n                    const newState = {\n                        navIndex: index + 1,\n                        navigation: nav,\n                        lastUrlPushed: true\n                    };\n                    return { ...state, ...newState };\n                }\n            }\n        case ActionType.TASK_INVOKE_URL:\n            {\n                return mergeNavigatedUrl(state, action.payload.url);\n            }\n    }\n    return state;\n}","import {\n    ReducerFunction,\n    ITemplateReducerState,\n    TemplateReducerFunction\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { IElementState, ViewerAction } from '../actions/defs';\n\nexport const TEMPLATE_INITIAL_STATE: ITemplateReducerState = {\n    initialInfoPaneWidth: 250,\n    initialTaskPaneWidth: 300,\n    taskPaneVisible: true,\n    selectionPanelVisible: true,\n    legendVisible: true,\n    autoDisplaySelectionPanelOnSelection: true\n};\n\n/**\n * Checks if the given payload is an element state\n *\n * @export\n * @param {*} args\n * @returns {args is IElementState}\n */\nexport function isElementState(args: any): args is IElementState {\n    return args != null\n        && typeof (args.legendVisible) != 'undefined'\n        && typeof (args.selectionPanelVisible) != 'undefined'\n        && typeof (args.taskPaneVisible) != 'undefined';\n}\n\nlet _ovReducer: TemplateReducerFunction;\n\n/**\n * Installs a custom template reducer function. This is generally used by viewer templates\n * which need to respond to template-related actions in a way that is unique to the template\n *\n * @export\n * @param {ReducerFunction<ITemplateReducerState>} func\n */\nexport function setCustomTemplateReducer(func: TemplateReducerFunction): void {\n    _ovReducer = func;\n}\n\nexport function templateReducer(origState = TEMPLATE_INITIAL_STATE, action: ViewerAction) {\n    let state = origState;\n    //Whether this reducer has been overridden or not, service the MAP_SET_SELECTION action and\n    //if we get modified state, pass that down to the rest of the reducer\n    if (action.type == ActionType.MAP_SET_SELECTION) {\n        const { selection } = action.payload;\n        if (selection && selection.SelectedFeatures) {\n            if (selection.SelectedFeatures.SelectedLayer.length && origState.autoDisplaySelectionPanelOnSelection) {\n                state = {\n                    ...origState,\n                    // The majority of the templates provided have the SelectionPanel/Legend/TaskPane as\n                    // a mutually exclusive visible set, so this new state would be applicable for them.\n                    // For templates that do not, they can fix this state up \"in post\" against the same action\n                    // in their overridden reducer\n                    ...{ selectionPanelVisible: true, legendVisible: false, taskPaneVisible: false }\n                }\n            }\n        }\n    }\n    if (action.type == ActionType.MAP_ADD_CLIENT_SELECTED_FEATURE) {\n        const { feature } = action.payload;\n        if (feature?.properties) {\n            state = {\n                ...origState,\n                // The majority of the templates provided have the SelectionPanel/Legend/TaskPane as\n                // a mutually exclusive visible set, so this new state would be applicable for them.\n                // For templates that do not, they can fix this state up \"in post\" against the same action\n                // in their overridden reducer\n                ...{ selectionPanelVisible: true, legendVisible: false, taskPaneVisible: false }\n            }\n        }\n    }\n    if (typeof (_ovReducer) == 'function') {\n        return _ovReducer(origState, state, action);\n    } else {\n        //If no template present (they would've overridden this reducer), at least service the actions we know affect this\n        //particular state branch\n        switch (action.type) {\n            case ActionType.FUSION_SET_ELEMENT_STATE:\n                {\n                    if (isElementState(action.payload)) {\n                        return { ...state, ...action.payload };\n                    }\n                    return state;\n                }\n            case ActionType.INIT_APP:\n                {\n                    let state1: Partial<ITemplateReducerState> = {};\n                    if (action.payload.initialTaskPaneWidth) {\n                        state1.initialTaskPaneWidth = action.payload.initialTaskPaneWidth;\n                    }\n                    if (action.payload.initialInfoPaneWidth) {\n                        state1.initialInfoPaneWidth = action.payload.initialInfoPaneWidth;\n                    }\n                    return { ...state, ...state1 };\n                }\n        }\n    }\n    return state;\n}","import { IToolbarReducerState, IDOMElementMetrics } from \"../api/common\";\nimport update from 'immutability-helper';\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\nimport { isElementState } from './template';\nimport { WEBLAYOUT_TASKMENU, WEBLAYOUT_CONTEXTMENU } from '../constants';\n\nfunction mergeFlyoutState(flyoutId: string, state: any, flyoutPayload: any, flyoutUpdateAction: \"$set\" | \"$merge\", closeOtherFlyouts: boolean = false, bSettingStates: boolean = false) {\n    const updateSpec: any = {\n        flyouts: {}\n    };\n    if (!state.flyouts[flyoutId] && bSettingStates) {\n        return state;\n    }\n    const flyoutUpdateSpec: any = {};\n    flyoutUpdateSpec[flyoutUpdateAction] = flyoutPayload;\n    updateSpec.flyouts[flyoutId] = flyoutUpdateSpec;\n    if (closeOtherFlyouts) {\n        //Close others\n        for (const key in state.flyouts) {\n            if (key != flyoutId) {\n                updateSpec.flyouts[key] = {\n                    \"$merge\": {\n                        open: false\n                    }\n                };\n            }\n        }\n    }\n    const newState = update(state, updateSpec);\n    return newState;\n}\n\nfunction mergeFlyoutCloseState(flyoutId: string, state: any, bSettingStates: boolean = false) {\n    return mergeFlyoutState(flyoutId, state, {\n        open: false,\n        metrics: null\n    }, \"$merge\", false, bSettingStates);\n}\n\nexport const TOOLBAR_INITIAL_STATE: IToolbarReducerState = {\n    toolbars: {},\n    flyouts: {}\n};\n\nexport function toolbarReducer(state = TOOLBAR_INITIAL_STATE, action: ViewerAction): IToolbarReducerState {\n    switch (action.type) {\n        case ActionType.INIT_APP:\n            {\n                return { ...state, ...action.payload.toolbars };\n            }\n        case ActionType.COMPONENT_OPEN:\n            {\n                const payload = action.payload;\n                let flyoutId = payload.flyoutId;\n                if (flyoutId) {\n                    return mergeFlyoutState(flyoutId, state,\n                        {\n                            open: true,\n                            metrics: payload.metrics,\n                            componentName: payload.name,\n                            componentProps: payload.props\n                        },\n                        \"$set\", //Need to use $set instead of $merge as the tree won't have component flyout info initially\n                        true);\n                }\n                return state;\n            }\n        case ActionType.COMPONENT_CLOSE:\n            {\n                if (!state.flyouts[WEBLAYOUT_CONTEXTMENU]) {\n                    return state;\n                }\n                let flyoutId = action.payload.flyoutId;\n                if (flyoutId) {\n                    return mergeFlyoutState(flyoutId, state, {\n                        open: false,\n                        metrics: null,\n                        componentName: null,\n                        componentProps: null\n                    }, \"$set\"); //Need to use $set instead of $merge as the tree won't have component flyout info initially\n                }\n                return state;\n            }\n        case ActionType.CONTEXT_MENU_OPEN:\n            {\n                if (!state.flyouts[WEBLAYOUT_CONTEXTMENU]) {\n                    return state;\n                }\n                return mergeFlyoutState(WEBLAYOUT_CONTEXTMENU, state, {\n                    open: true,\n                    metrics: {\n                        posX: action.payload.x,\n                        posY: action.payload.y\n                    } as IDOMElementMetrics\n                }, \"$merge\", true);\n            }\n        case ActionType.FLYOUT_OPEN:\n            {\n                let flyoutId = action.payload.flyoutId;\n                if (flyoutId) {\n                    return mergeFlyoutState(flyoutId, state, {\n                        open: true,\n                        metrics: action.payload.metrics\n                    }, \"$merge\", true);\n                }\n                return state;\n            }\n        case ActionType.FUSION_SET_ELEMENT_STATE:\n            {\n                if (isElementState(action.payload) && !action.payload.taskPaneVisible) {\n                    return mergeFlyoutCloseState(WEBLAYOUT_TASKMENU, state, true);\n                }\n                return state;\n            }\n        case ActionType.FUSION_SET_TASK_PANE_VISIBILITY:\n            {\n                if (!action.payload) {\n                    return mergeFlyoutCloseState(WEBLAYOUT_TASKMENU, state);\n                }\n                return state;\n            }\n        case ActionType.FLYOUT_CLOSE:\n            {\n                let flyoutId = action.payload.flyoutId;\n                if (flyoutId) {\n                    return mergeFlyoutCloseState(flyoutId, state);\n                }\n            }\n        case ActionType.CONTEXT_MENU_CLOSE:\n            {\n                return mergeFlyoutCloseState(WEBLAYOUT_CONTEXTMENU, state);\n            }\n    }\n    return state;\n}","import {\n    ActiveMapTool,\n    IViewerReducerState,\n    ILayerInfo\n} from \"../api/common\";\nimport { ActionType } from '../constants/actions';\nimport { ViewerAction } from '../actions/defs';\n\nexport const VIEWER_INITIAL_STATE: IViewerReducerState = {\n    busyCount: 0,\n    size: undefined,\n    tool: ActiveMapTool.None,\n    featureTooltipsEnabled: true\n}\n\nexport function viewerReducer(state = VIEWER_INITIAL_STATE, action: ViewerAction) {\n    switch (action.type) {\n        case ActionType.INIT_APP:\n            {\n                let tool = action.payload.initialActiveTool;\n                let ft = action.payload.featureTooltipsEnabled;\n                let state1: Partial<IViewerReducerState> | undefined;\n                if (tool != null) {\n                    state1 = {\n                        tool: tool\n                    };\n                }\n                let state2 : Partial<IViewerReducerState> | undefined;\n                if (typeof(ft) != 'undefined') {\n                    state2 = {\n                        featureTooltipsEnabled: ft\n                    };\n                }\n                return { ...state, ...state1, ...state2 };\n            }\n        case ActionType.MAP_SET_ACTIVE_TOOL:\n            {\n                const state1 = {\n                    tool: action.payload\n                };\n                return { ...state, ...state1 };\n            }\n        case ActionType.MAP_SET_MAPTIP:\n            {\n                const state1 = {\n                    featureTooltipsEnabled: action.payload\n                };\n                return { ...state, ...state1 };\n            }\n        case ActionType.MAP_SET_BUSY_COUNT:\n            {\n                const state1 = {\n                    busyCount: action.payload\n                };\n                return { ...state, ...state1 };\n            }\n        case ActionType.MAP_RESIZED:\n            {\n                const state1 = {\n                    size: [action.payload.width, action.payload.height]\n                };\n                return { ...state, ...state1 };\n            }\n    }\n    return state;\n}","import { createStore, applyMiddleware, compose, combineReducers } from 'redux';\nimport thunk from 'redux-thunk';\nimport { promiseMiddleware } from './promise-middleware';\nimport { logger } from './logger';\nimport { rootReducer } from '../reducers/root';\nimport type { ReduxStoreImpl } from '../components/map-providers/context';\n\nexport function configureStore(initialState: any, extraReducers?: any): ReduxStoreImpl {\n    const root = extraReducers ? combineReducers({ ...rootReducer, ...extraReducers }) : combineReducers(rootReducer);\n    const store = (<any>compose)( //HACK: Something bogus about the compose() declaration\n        _getMiddleware(),\n        ..._getEnhancers()\n    )(createStore)(root, initialState);\n    return store;\n}\n\nfunction _getMiddleware() {\n    let middleware = [\n        promiseMiddleware,\n        thunk,\n    ];\n\n    if (__DEV__) {\n        middleware = [...middleware, logger];\n    }\n\n    return applyMiddleware(...middleware);\n}\n\nfunction _getEnhancers() {\n    let enhancers = [] as any[];\n    if (__DEV__ && window.__REDUX_DEVTOOLS_EXTENSION__) {\n        enhancers = [...enhancers, window.__REDUX_DEVTOOLS_EXTENSION__()];\n    }\n    return enhancers;\n}","import { ActionType } from '../constants/actions';\nconst createLogger = require(\"redux-logger\").createLogger;\n\nexport const logger = createLogger({\n    collapsed: true,\n    stateTransformer: (state: any) => {\n        return state;\n    },\n    //Note the { type } syntax: https://github.com/Microsoft/TypeScript/issues/9657\n    predicate: (getState: any, { type }: { type: string }) => {\n        return type !== 'redux-form/BLUR' &&\n            type !== 'redux-form/CHANGE' &&\n            type !== 'redux-form/FOCUS' &&\n            type !== 'redux-form/TOUCH' &&\n            type !== ActionType.MAP_RESIZED &&\n            type !== ActionType.UPDATE_MOUSE_COORDINATES &&\n            type !== ActionType.MAP_SET_BUSY_COUNT &&\n            type !== ActionType.ADD_LAYER_BUSY_WORKER &&\n            type !== ActionType.REMOVE_LAYER_BUSY_WORKER;\n    },\n});","/**\n * Returns whether the provided value is a promise\n *\n * @hidden\n * @param {object} value Potential promise\n * @return {Boolean}\n */\nfunction isPromise(value: any) {\n    if (value !== null && typeof value === 'object') {\n        return value.promise && typeof value.promise.then === 'function';\n    }\n}\n\n/**\n * @hidden\n */\nexport function promiseMiddleware({ dispatch }: { dispatch: any }) {\n    return (next: any) => (action: any) => {\n        if (!isPromise(action.payload)) {\n            return next(action);\n        }\n\n        const { types, payload, meta } = action;\n        const { promise, data } = payload;\n        const [PENDING, FULFILLED, REJECTED] = types;\n\n        const p1 = { type: PENDING };\n        const p2 = data ? { payload: data } : {};\n        const p3 = meta ? { meta } : {};\n\n        /**\n         * Dispatch the pending action\n         */\n        dispatch({ ...p1, ...p2, ...p3 });\n\n        /**\n         * If successful, dispatch the fulfilled action, otherwise dispatch\n         * rejected action.\n         */\n        return promise.then(\n            (result: any) => {\n                dispatch({\n                    type: FULFILLED,\n                    payload: result,\n                    meta,\n                });\n            },\n            (error: any) => {\n                dispatch({\n                    type: REJECTED,\n                    payload: error,\n                    meta,\n                });\n            }\n        );\n    };\n}\n","import * as React from \"react\";\nimport { storiesOf } from \"@storybook/react\";\nimport { withKnobs } from '@storybook/addon-knobs';\nimport { FakeApp } from './fake-app';\nimport { LegendContainer } from '../containers/legend';\nimport { TaskPaneContainer } from '../containers/task-pane';\nimport { ScaleDisplayContainer } from '../containers/scale-display';\nimport { SelectedFeatureCountContainer } from '../containers/selected-feature-count';\nimport { SelectionPanelContainer } from '../containers/selection-panel';\nimport { NavigatorContainer } from '../containers/navigator';\nimport { MapMenuContainer } from '../containers/map-menu';\nimport { BaseLayerSwitcherContainer } from '../containers/base-layer-switcher';\nimport { CoordinateTrackerContainer } from '../containers/coordinate-tracker';\nimport { AddManageLayersContainer } from '../containers/add-manage-layers';\nimport { Button, ButtonGroup, Card, Intent } from '@blueprintjs/core';\nimport { useReducedToolbarAppState, useActiveMapName } from '../containers/hooks';\nimport { CommandConditions } from '../api/registry/command';\nimport { QueryMapFeaturesResponse } from '../api/contracts/query';\nimport { deArrayify, isQueryMapFeaturesResponse } from '../api/builders/deArrayify';\nimport { MouseCoordinatesContainer } from '../containers/mouse-coordinates';\nimport { ViewSizeContainer } from '../containers/view-size';\nimport { ViewerOptions } from '../containers/viewer-options';\nimport { setSelection } from '../actions/map';\nimport { MapGuideMockMode, MapDebugContext } from '../components/mapguide-debug-context';\nimport { MapViewer } from '../containers/neo-map-viewer';\nimport { useMapProviderContext, useReduxDispatch } from '../components/map-providers/context';\nimport { MapGuideMapProviderContext } from '../components/map-providers/mapguide';\n\n//import MeasureContainer from '../containers/measure';\n\nconst testSelSheboygan = deArrayify(require(\"./data/test-selection-response-sheboygan.json\"));\n\ninterface MapDependentContainer {\n    \n    includeSelect?: boolean;\n    children: React.ReactNode;\n}\n\nfunction getQueryMapFeaturesResponse(activeMapName: string) {\n    switch (activeMapName) {\n        case \"Sheboygan\":\n            if (isQueryMapFeaturesResponse(testSelSheboygan))\n                return testSelSheboygan;\n    }\n    return {};\n}\n\nconst MapStoryFrame = (props: MapDependentContainer) => {\n    const SB_WIDTH = 350;\n    const includeTools = !!props.includeSelect;\n    const dispatch = useReduxDispatch();\n    const state = useReducedToolbarAppState();\n    const activeMapName = useActiveMapName();\n    const context = useMapProviderContext() as MapGuideMapProviderContext;\n    const doTestSelect = () => {\n        if (activeMapName) {\n            const q = setSelection(activeMapName, getQueryMapFeaturesResponse(activeMapName));\n            dispatch(q);\n        }\n    }\n    const doClearSelection = () => {\n        if (activeMapName) {\n            const q = setSelection(activeMapName, {});\n            dispatch(q);\n        }\n    }\n    return <div style={{ position: \"absolute\", left: 0, right: 0, top: 0, bottom: 0 }}>\n        <div style={{ position: \"absolute\", left: 0, top: 0, bottom: 0, width: SB_WIDTH, overflowY: \"auto\" }}>\n            {props.children}\n        </div>\n        <div style={{ position: \"absolute\", left: SB_WIDTH, top: 0, bottom: 0, right: 0 }}>\n            <MapDebugContext.Provider value={{ mock: context.mockMode }}>\n                <MapViewer />\n                {props.includeSelect && <ButtonGroup style={{ position: \"absolute\", right: 15, top: 15 }}>\n                    <Button intent={Intent.PRIMARY} onClick={() => doTestSelect()}>Test Select</Button>\n                    <Button intent={Intent.DANGER} onClick={() => doClearSelection()} disabled={!CommandConditions.hasSelection(state)}>Clear Selection</Button>\n                </ButtonGroup>}\n            </MapDebugContext.Provider>\n        </div>\n    </div>;\n}\n\nstoriesOf(\"Map and Map Interaction Components\", module)\n    .addDecorator(withKnobs)\n    .addDecorator(storyFn => <FakeApp mgMockMode={MapGuideMockMode.DoNotRender}>\n        <MapStoryFrame>\n            {storyFn()}\n        </MapStoryFrame>\n    </FakeApp>)\n    .add(\"Map Viewer\", () => <Card>\n        <h5 className=\"bp3-heading\"><a href=\"#\">Map Viewer</a></h5>\n        <p>This story (and all sibling stories) showcases the map viewer component and other components that depend or interact with map viewer state</p>\n        <p>For MapGuide-specific stories, the MapGuide layer has been mocked out with a placeholder that shows the mapagent request that would be made</p>\n        <p>Some components require selections to be made. Some fake select tools are included to trigger such selection actions</p>\n    </Card>)\n    .add(\"Task Pane\", () => <TaskPaneContainer />)\n    .add(\"Mouse Coordinates\", () => <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">Mouse Coordinates</a></h5>\n            <p>Move the mouse around the map and its geographic coordinates should be shown below</p>\n        </Card>\n        <MouseCoordinatesContainer />\n    </>)\n    .add(\"View Size\", () => <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">View Size</a></h5>\n            <p>Zoom in or out of the map. The physical map size should be shown below</p>\n        </Card>\n        <ViewSizeContainer />\n    </>)\n    .add(\"Scale Display\", () => <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">Scale Display</a></h5>\n            <p>Zoom in or out of the map. The map scale should be shown below</p>\n        </Card>\n        <ScaleDisplayContainer />\n    </>)\n    .add(\"Navigator\", () => <NavigatorContainer />)\n    .add(\"Map Menu\", () => <MapMenuContainer />)\n    .add(\"Base Layer Switcher\", () => <BaseLayerSwitcherContainer />)\n    .add(\"Viewer Options\", () => <ViewerOptions />)\n    //.add(\"Measure\", () => <MeasureContainer />)\n    .add(\"Coordinate Tracker\", () => <CoordinateTrackerContainer projections={[\"EPSG:4326\", \"EPSG:3857\"]} />)\n    .add(\"External Layer Manager\", () => <AddManageLayersContainer />);\n\nstoriesOf(\"Map and Map Interaction Components / MapGuide-specific\", module)\n    .addDecorator(withKnobs)\n    .addDecorator(storyFn => <FakeApp mgMockMode={MapGuideMockMode.RenderPlaceholder}>\n        <MapStoryFrame includeSelect={true}>\n            {storyFn()}\n        </MapStoryFrame>\n    </FakeApp>)\n    .add(\"Legend\", () => <LegendContainer />)\n    .add(\"Legend - with base layer switcher\", () => <LegendContainer inlineBaseLayerSwitcher={true} />)\n    .add(\"Selected Feature Count\", () => <>\n        <Card>\n            <h5 className=\"bp3-heading\"><a href=\"#\">Selected Feature Count</a></h5>\n            <p>Click the test select button to simulate a map selection request. The selection count should display below</p>\n        </Card>\n        <SelectedFeatureCountContainer />\n    </>)\n    .add(\"Selection Panel\", () => <SelectionPanelContainer />)","import * as React from \"react\";\nimport { storiesOf } from \"@storybook/react\";\nimport { action } from \"@storybook/addon-actions\";\nimport { ColorPicker } from '../components/color-picker';\nimport { withKnobs, boolean, number, select } from '@storybook/addon-knobs';\nimport { VectorLayerStyleEditor, VectorStyleEditor } from '../components/vector-style-editor';\nimport \"../styles/index.css\";\nimport { BooleanExprEditor, ColorExprEditor, NumberExprEditor, SliderExprEditor, StringExprEditor } from \"../components/layer-manager/common\";\nimport { DEFAULT_VECTOR_LAYER_STYLE, ExprOr, IVectorLayerStyle } from \"../api/ol-style-contracts\";\nimport { DEFAULT_LOCALE } from \"../api/i18n\";\nimport { ColorBrewerSwatch, getColorBrewerRamps } from \"../components/layer-manager/color-brewer\";\n\nstoriesOf(\"Common Components\", module)\n    .addDecorator(withKnobs)\n    .add(\"String Expr Editor\", () => {\n        const locale = DEFAULT_LOCALE;\n        const act = action(\"Value changed\");\n        const [expr, setExpr] = React.useState<ExprOr<string> | undefined>(undefined);\n        return <StringExprEditor locale={locale} value={expr} onChange={e => setExpr(e)} />;\n    })\n    .add(\"Number Expr Editor\", () => {\n        const locale = DEFAULT_LOCALE;\n        const act = action(\"Value changed\");\n        const [expr, setExpr] = React.useState<ExprOr<number> | undefined>(undefined);\n        return <NumberExprEditor locale={locale} value={expr} onChange={e => setExpr(e)} />;\n    })\n    .add(\"Slider Expr Editor\", () => {\n        const locale = DEFAULT_LOCALE;\n        const act = action(\"Value changed\");\n        const min = number(\"Min Value\", 0);\n        const max = number(\"Max Value\", 100);\n        const [expr, setExpr] = React.useState<ExprOr<number> | undefined>(undefined);\n        return <SliderExprEditor min={min} max={max} labelStepSize={max} locale={locale} value={expr} onChange={e => setExpr(e)} />;\n    })\n    .add(\"Color Expr Editor\", () => {\n        const locale = DEFAULT_LOCALE;\n        const act = action(\"Value changed\");\n        const [expr, setExpr] = React.useState<ExprOr<string> | undefined>(undefined);\n        return <ColorExprEditor locale={locale} value={expr} onChange={e => setExpr(e)} />;\n    })\n    .add(\"Boolean Expr Editor\", () => {\n        const locale = DEFAULT_LOCALE;\n        const act = action(\"Value changed\");\n        const [expr, setExpr] = React.useState<ExprOr<boolean> | undefined>(undefined);\n        return <BooleanExprEditor locale={locale} value={expr} onChange={e => setExpr(e)} />;\n    })\n    .add(\"Color Picker\", () => {\n        const act = action(\"color changed\");\n        const [color, setColor] = React.useState<string | undefined>(undefined);\n        const onSetColor = (val: string) => {\n            act(val);\n            setColor(val);\n        };\n        return <ColorPicker locale=\"en\" value={color} onChange={onSetColor} />;\n    })\n    .add(\"Vector Style Editor\", () => {\n        return <VectorStyleEditor onChange={action(\"style changed\")}\n            locale=\"en\"\n            enablePoint={boolean(\"Enable Point\", true)}\n            enableLine={boolean(\"Enable Line\", true)}\n            enablePolygon={boolean(\"Enable Polygon\", true)} />;\n    })\n    .add(\"Vector Layer Style Editor\", () => {\n        const [layerStyle, setLayerStyle] = React.useState<IVectorLayerStyle>(DEFAULT_VECTOR_LAYER_STYLE);\n        const act = action(\"Style changed\");\n        const onChange = (st: IVectorLayerStyle) => {\n            setLayerStyle(st);\n            act(st);\n        }\n        return <VectorLayerStyleEditor\n            style={layerStyle}\n            onChange={st => setLayerStyle(st)}\n            enablePoint={boolean(\"Enable Point\", true)}\n            enableLine={boolean(\"Enable Line\", true)}\n            enablePolygon={boolean(\"Enable Polygon\", true)}\n            locale={DEFAULT_LOCALE} />;\n    })\n    .add(\"ColorBrewer Swatch\", () => {\n        const ramps = getColorBrewerRamps();\n        let defaultValue;\n        const options: any = {};\n        for (const r of ramps) {\n            if (!defaultValue) {\n                defaultValue = r.scheme;\n            }\n            options[r.displayName] = r.scheme;\n        }\n        const scheme = select(\"ColorBrewer Theme\", options, defaultValue);\n        return <ColorBrewerSwatch theme={scheme!} />\n    });","import * as React from \"react\";\nimport { storiesOf } from \"@storybook/react\";\nimport { action } from \"@storybook/addon-actions\";\nimport { Accordion, IAccordionPanelSpec, IAccordionPanelContentDimensions } from \"../components/accordion\";\nimport { withKnobs, text, boolean } from '@storybook/addon-knobs';\n\nimport \"../styles/index.css\";\nimport \"ol/ol.css\";\nimport \"@blueprintjs/core/lib/css/blueprint.css\";\nimport \"react-splitter-layout/lib/index.css\";\nimport \"./styles/accordion-slate.css\";\n\nconst PANELS: IAccordionPanelSpec[] = [\n    {\n        id: \"PanelA\",\n        title: \"Panel One\",\n        contentRenderer: (dim: IAccordionPanelContentDimensions) => {\n            return <div style={{ width: dim.width, height: dim.height }}>Panel One Content ({dim.width}x{dim.height})</div>\n        }\n    },\n    {\n        id: \"PanelB\",\n        title: \"Panel Two\",\n        contentRenderer: (dim: IAccordionPanelContentDimensions) => {\n            return <div style={{ width: dim.width, height: dim.height }}>Panel Two Content ({dim.width}x{dim.height})</div>\n        }\n    },\n    {\n        id: \"PanelC\",\n        title: \"Panel Three\",\n        contentRenderer: (dim: IAccordionPanelContentDimensions) => {\n            return <div style={{ width: dim.width, height: dim.height }}>Panel Three Content ({dim.width}x{dim.height})</div>\n        }\n    }\n];\n\nstoriesOf(\"Accordion (Slate)\", module)\n    .addDecorator(withKnobs)\n    .add(\"Default\", () => <Accordion style={{ width: 250, height: 500 }} onActivePanelChanged={action(\"activePanelChanged\")} panels={PANELS} />)\n    .add(\"Middle Panel Initially Visible\", () => <Accordion style={{ width: 250, height: 500 }} onActivePanelChanged={action(\"activePanelChanged\")} panels={PANELS} activePanelId=\"PanelB\" />);","import * as React from \"react\";\nimport { configureStore } from '../store/configure-store';\nimport { AdHocLayoutTemplate, App } from \"../containers/app\";\nimport { CONFIG_INITIAL_STATE } from '../reducers/config';\nimport { registerRequestBuilder } from '../api/builders/factory';\nimport { RequestBuilder, ICreateRuntimeMapOptions, IQueryMapFeaturesOptions, IDescribeRuntimeMapOptions } from '../api/request-builder';\nimport { ResourceBase, SiteVersionResponse } from '../api/contracts/common';\nimport { RuntimeMap } from '../api/contracts/runtime-map';\nimport { QueryMapFeaturesResponse } from '../api/contracts/query';\nimport { deArrayify } from '../api/builders/deArrayify';\nimport { registerLayout } from '../api/registry/layout';\nimport { IConfigurationReducerState, IViewerReducerState, ClientKind } from '../api/common';\nimport { DefaultViewerInitCommand } from '../actions/init-mapguide';\nimport { IViewerInitCommand } from '../actions/init-command';\nimport { MapContextProvider } from '../components/map-providers/context';\nimport { MapGuideMapProviderContext } from '../components/map-providers/mapguide';\nimport { MapGuideMockMode } from '../components/mapguide-debug-context';\nimport { isRuntimeMap } from \"../utils/type-guards\";\nconst testMapSheboygan = deArrayify(require(\"./data/test-runtime-map-sheboygan.json\"));\nconst testMapRedding = deArrayify(require(\"./data/test-runtime-map-redding.json\"));\nconst testMapMelbourne = deArrayify(require(\"./data/test-runtime-map-melbourne.json\"));\nconst testAppDef = deArrayify(require(\"./data/test-app-def.json\"));\n\nconst PROVIDER_IMPL = new MapGuideMapProviderContext();\n\nclass FakeMapAgent extends RequestBuilder {\n    public getSiteVersion(): Promise<SiteVersionResponse> {\n        return Promise.resolve({ Version: \"4.0.0.0\" });\n    }\n    constructor(private uri: string, private locale?: string) {\n        super(uri);\n    }\n    public createSession(username: string, password: string): Promise<string> {\n        if (isRuntimeMap(testMapSheboygan)) {\n            return Promise.resolve(testMapSheboygan.SessionId);\n        }\n        return Promise.reject(\"Not a runtime map\");\n    }\n    public getServerSessionTimeout(session: string): Promise<number> {\n        return Promise.resolve(10000);\n    }\n    public getResource<T extends ResourceBase>(resourceId: string, args?: any): Promise<T> {\n        if (resourceId.endsWith(\".ApplicationDefinition\")) {\n            return Promise.resolve<any>(testAppDef);\n        }\n        throw new Error(`Method not implemented - getResource(${resourceId}).`);\n    }\n    public createRuntimeMap(options: ICreateRuntimeMapOptions): Promise<RuntimeMap> {\n        switch (options.mapDefinition) {\n            case \"Library://Samples/Sheboygan/Maps/Sheboygan.MapDefinition\":\n                return isRuntimeMap(testMapSheboygan) ? Promise.resolve(testMapSheboygan) : Promise.reject(\"Not a runtime map\");\n            case \"Library://Redding/Maps/Redding.MapDefinition\":\n                return isRuntimeMap(testMapRedding) ? Promise.resolve(testMapRedding) : Promise.reject(\"Not a runtime map\");\n            case \"Library://Samples/Melbourne/Maps/Melbourne.MapDefinition\":\n                return isRuntimeMap(testMapMelbourne) ? Promise.resolve(testMapMelbourne) : Promise.reject(\"Not a runtime map\");\n        }\n        return Promise.reject(`Unknown test map: ${options.mapDefinition}`);\n    }\n    public queryMapFeatures(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse> {\n        return Promise.resolve({});\n    }\n    public queryMapFeatures_v4(options: IQueryMapFeaturesOptions): Promise<QueryMapFeaturesResponse> {\n        return Promise.resolve({});\n    }\n    public describeRuntimeMap(options: IDescribeRuntimeMapOptions): Promise<RuntimeMap> {\n        switch (options.mapname) {\n            case \"Sheboygan\":\n                return isRuntimeMap(testMapSheboygan) ? Promise.resolve(testMapSheboygan) : Promise.reject(\"Not a runtime map\");\n            case \"Redding\":\n                return isRuntimeMap(testMapRedding) ? Promise.resolve(testMapRedding) : Promise.reject(\"Not a runtime map\");\n            case \"Melbourne\":\n                return isRuntimeMap(testMapMelbourne) ? Promise.resolve(testMapMelbourne) : Promise.reject(\"Not a runtime map\");\n        }\n        return Promise.reject(`Unknown test map state: ${options.mapname}`);\n    }\n    public getTileTemplateUrl(resourceId: string, groupName: string, xPlaceholder: string, yPlaceholder: string, zPlaceholder: string): string {\n        throw new Error(\"Method not implemented - getTileTemplateUrl.\");\n    }\n}\n\nexport interface IFakeAppProps {\n    templateLayout?: AdHocLayoutTemplate;\n    mgMockMode: MapGuideMockMode;\n    children?: React.ReactNode;\n}\n\n/**\n * This component sets up a mocked application environment from which any redux container component\n * can be housed within\n */\nexport class FakeApp extends React.Component<IFakeAppProps> {\n    private _store: any;\n    private _agentUri: string;\n    private _agentKind: ClientKind;\n    private _initCommand: IViewerInitCommand;\n    constructor(props: IFakeAppProps) {\n        super(props);\n        registerRequestBuilder(\"mapagent\", (uri, locale) => new FakeMapAgent(uri, locale));\n        registerLayout(\"fake-app\", () => <>{props.children}</>, {\n            hasTaskPane: true\n        });\n        this._agentUri = \"https://my-mapguide-server/mapguide/mapagent/mapagent.fcgi\";\n        this._agentKind = \"mapagent\";\n        const initState = {\n            ...{\n                config: {\n                    ...CONFIG_INITIAL_STATE,\n                    ...{\n                        agentKind: this._agentKind,\n                        agentUri: this._agentUri\n                    },\n                } as IConfigurationReducerState,\n                mapState: {\n                    Sheboygan: {\n                        currentView: {\n                            scale: 51439.16420267266,\n                            x: -87.73025425093128,\n                            y: 43.744459064634064\n                        }\n                    }\n                },\n                viewer: {\n                    featureTooltipsEnabled: false\n                } as IViewerReducerState\n            }\n        };\n        this._store = configureStore(initState);\n        this._initCommand = new DefaultViewerInitCommand(this._store.dispatch);\n        PROVIDER_IMPL.setMockMode(props.mgMockMode);\n    }\n    render() {\n        return <MapContextProvider value={PROVIDER_IMPL} store={this._store}>\n            <App initCommand={this._initCommand}\n                mapguide={{\n                    fusionRoot: \".\",\n                    agentUri: this._agentUri,\n                    agentKind: this._agentKind,\n                    initialElementVisibility: {\n                        //Doesn't matter for the fake app, but this has to be true for the purpose of not breaking the reducer when no physical components are present\n                        taskpane: true,\n                        legend: true,\n                        selection: true\n                    }\n                }}\n                layout={this.props.templateLayout ?? \"fake-app\"}\n                resourceId=\"Library://Test/Viewer.ApplicationDefinition\"\n                {...this.props} />\n        </MapContextProvider>;\n    }\n}","import { bootstrap } from '../api/bootstrap';\nimport { addFormatDriver } from \"../api/layer-manager/driver-registry\";\nimport { CsvFormatDriver, CSV_COLUMN_ALIASES } from \"../api/layer-manager/csv-driver\";\nimport { FormatDriver } from \"../api/layer-manager/format-driver\";\nimport KML from \"ol/format/KML\";\nimport GPX from \"ol/format/GPX\";\nimport IGC from \"ol/format/IGC\";\nimport GeoJSON from \"ol/format/GeoJSON\";\nimport TopoJSON from \"ol/format/TopoJSON\";\n\n// Bootstrap the viewer\nbootstrap();\naddFormatDriver(new CsvFormatDriver(CSV_COLUMN_ALIASES));\naddFormatDriver(new FormatDriver(\"GeoJSON\", new GeoJSON()));\naddFormatDriver(new FormatDriver(\"TopoJSON\", new TopoJSON()));\naddFormatDriver(new FormatDriver(\"KML\", new KML(), \"EPSG:4326\"));\naddFormatDriver(new FormatDriver(\"GPX\", new GPX(), \"EPSG:4326\"));\naddFormatDriver(new FormatDriver(\"IGC\", new IGC()));","import { ILocalizedMessages } from \"./msgdef\";\nimport { DEG } from '../constants';\n\nexport const STRINGS_EN: ILocalizedMessages = {\n    \"OK\": \"OK\",\n    \"NONE\": \"NONE\",\n    \"ERROR\": \"Error\",\n    \"WARNING\": \"Warning\",\n    \"PBMG\": \"Powered by <a href='https://mapguide.osgeo.org' target='_blank'>MapGuide</a>\",\n    \"INIT_WARNINGS_FOUND\": \"The following warnings were encountered loading the viewer\",\n    \"INIT_WARNING_BING_API_KEY_REQD\": \"A Bing Maps API key is required. Sign up for an API key at http://www.bingmapsportal.com/\",\n    \"INIT_WARNING_BING_UNKNOWN_LAYER\": \"Unknown bing maps layer type {type}. This layer was skipped\",\n    \"INIT_WARNING_UNSUPPORTED_GOOGLE_MAPS\": \"This viewer does not support Google Maps base layers\",\n    \"INIT_WARNING_NO_CONTEXT_MENU\": \"Could not find the context menu configuration. Right-clicking the map will show an empty context menu. If you are loading from a Flexible Layout, it must have a container named '{containerName}'\",\n    \"LAYER_TRANSPARENCY\": \"Layer Transparency\",\n    \"LAYER_ID_BASE\": \"Base Layers\",\n    \"LAYER_ID_MG_BASE\": \"MapGuide Map\",\n    \"LAYER_ID_SUBJECT\": \"Subject Layer\",\n    \"LAYER_ID_MG_SEL_OVERLAY\": \"MapGuide Selection Overlay\",\n    \"UNKNOWN_WIDGET\": \"This button references an unknown or unsupported widget: {widget}\",\n    \"UNKNOWN_COMMAND_REFERENCE\": \"This button references an unknown command or unsupported: {command}\",\n    \"INIT\": \"Initializing\",\n    \"INIT_DESC\": \"Please wait while the viewer is loading required assets ...\",\n    \"INIT_ERROR_TITLE\": \"An error occurred during startup\",\n    \"INIT_ERROR_UNKNOWN_RESOURCE_TYPE\": \"<p>Unknown or unsupported resource type for resource: <strong>{resourceId}</strong></p>\",\n    \"INIT_ERROR_MISSING_RESOURCE_PARAM\": \"<p>No <strong>resource</strong> parameter found. This viewer assumes this parameter to be set in the query string and must refer to a valid Web Layout or Application Definition. If not specified, it will try to init from a Application Definition document at <strong>appdef.json</strong></p>\",\n    \"INIT_ERROR_UNSUPPORTED_COORD_SYS\": \"<p>The Map Definition <strong>{mapDefinition}</strong>, uses a coordinate system that does not resolve to a valid EPSG code and cannot be loaded in this viewer</p><p>Solution:</p><ul><li>Change the coordinate system of this Map Definition to one that resolves to an EPSG code</li><li>Please note: There will be a small performance overhead for server-side re-projection as a result of doing this</li></ul>\",\n    \"INIT_ERROR_UNREGISTERED_EPSG_CODE\": \"<p>The Map Definition <strong>{mapDefinition}</strong>, uses a coordinate system that resolves to a valid EPSG code (<strong>EPSG:{epsg}</strong>), but no projection for this EPSG code has been registered</p><p>Solution:</p><ol><li>Search for the matching proj4js definition at <a href='http://epsg.io/'>http://epsg.io/</a></li><li>Register this projection to the viewer before mounting it</li></ol>\",\n    \"INIT_ERROR_EXPIRED_SESSION\": \"<p>The session id given has expired: <strong>{sessionId}</strong></p><p>Reload the viewer without the <strong>session</strong> parameter, or supply a valid session id for the <strong>session</strong> parameter</p>\",\n    \"INIT_ERROR_RESOURCE_NOT_FOUND\": \"Attempted to load the following resource, but it was not found: <strong>{resourceId}</strong>\",\n    \"INIT_ERROR_NO_CONNECTION\": \"<p>There is no connection between the MapGuide Web Tier and the MapGuide Server.</p><p>Possible causes:</p><ul><li>MapGuide Server is not running or is no longer responding</li><li>Internet connection problems</li></ul><p>Possible solutions:</p><ul><li>Restart the MapGuide Server Service</li><li>Contact your server administrator</li></ul>\",\n    \"TPL_SIDEBAR_OPEN_TASKPANE\": \"Open Task Pane\",\n    \"TPL_SIDEBAR_OPEN_LEGEND\": \"Open Legend\",\n    \"TPL_SIDEBAR_OPEN_SELECTION_PANEL\": \"Open Selection Panel\",\n    \"TPL_TITLE_TASKPANE\": \"Task Pane\",\n    \"TPL_TITLE_LEGEND\": \"Legend\",\n    \"TPL_TITLE_SELECTION_PANEL\": \"Selection\",\n    \"TT_GO_HOME\": \"Go home\",\n    \"TT_GO_BACK\": \"Go back\",\n    \"TT_GO_FORWARD\": \"Go forward\",\n    \"SESSION_EXPIRED\": \"Session Expired\",\n    \"SESSION_EXPIRED_DETAILED\": \"Your current MapGuide session has expired\",\n    \"SESSION_EXPIRED_AVAILABLE_ACTIONS\": \"Available Actions:\",\n    \"SESSION_EXPIRED_RELOAD_VIEWER\": \"Reload the viewer\",\n    \"ERR_UNREGISTERED_LAYOUT\": \"ERROR: No layout named ({layout}) registered\",\n    \"ERR_UNREGISTERED_COMPONENT\": \"ERROR: No such registered component ({componentId}). Ensure the component has been registered in the component registry with an id of: {componentId}\",\n    \"ERR_NO_COMPONENT_ID\": \"No component id specified\",\n    \"LOADING_MSG\": \"Loading ...\",\n    \"MENU_TASKS\": \"Tasks\",\n    \"NO_SELECTED_FEATURES\": \"No selected features\",\n    \"FMT_SCALE_DISPLAY\": \"Scale - 1:{scale}\",\n    \"FMT_SELECTION_COUNT\": \"Selected {total} feature(s) in {layerCount} layer(s)\",\n    \"DIGITIZE_POINT_PROMPT\": \"Click to finish and draw a point at this location<br/><br/>Press ESC to cancel\",\n    \"DIGITIZE_LINE_PROMPT\": \"Click to set this position as the start.<br/>Click again to finish the line at this position<br/><br/>Press ESC to cancel\",\n    \"DIGITIZE_LINESTRING_PROMPT\": \"Click to set this position as the start.<br/>Click again to add a vertex at this position.<br/>If you drew a vertex at the wrong spot, you can press {key} to undo.<br/>Hold SHIFT and drag while digitizing to draw in freehand mode<br/></br>Double click to finish<br/>Press ESC to cancel\",\n    \"DIGITIZE_CIRCLE_PROMPT\": \"Click to set this position as the center.<br/>Move out to the desired radius and click again to finish<br/><br/>Press ESC to cancel\",\n    \"DIGITIZE_RECT_PROMPT\": \"Click to set this position as one corner.<br/>Click again to finish and set this position as the other corner<br/><br/>Press ESC to cancel\",\n    \"DIGITIZE_POLYGON_PROMPT\": \"Click to set this positon as the start.<br/>Click again to add a vertex at this position.<br/>If you drew a vertex at the wrong spot, you can press {key} to undo<br/>Hold SHIFT and drag while digitizing to draw in freehand mode<br/><br/>Double click to finish and close the polygon<br/>Press ESC to cancel\",\n    \"MEASURE\": \"Measure\",\n    \"MEASURE_SEGMENT\": \"Segment\",\n    \"MEASURE_LENGTH\": \"Length\",\n    \"MEASURE_SEGMENT_PART\": \"Segment {segment}\",\n    \"MEASURE_TOTAL_AREA\": \"Total Area\",\n    \"MEASURE_TOTAL_LENGTH\": \"Total Length\",\n    \"MEASURING\": \"Measuring\",\n    \"MEASURING_MESSAGE\": \"You are currently measuring\",\n    \"MEASUREMENT\": \"Measurement\",\n    \"MEASUREMENT_TYPE\": \"Measurement Type\",\n    \"MEASUREMENT_TYPE_LENGTH\": \"Length (LineString)\",\n    \"MEASUREMENT_TYPE_AREA\": \"Area (Polygon)\",\n    \"MEASUREMENT_CLEAR\": \"Clear\",\n    \"MEASUREMENT_CONTINUE_POLYGON\": \"Click to continue drawing the polygon. Double-click to finish.\",\n    \"MEASUREMENT_CONTINUE_LINE\": \"Click to continue drawing the line. Double-click to finish.\",\n    \"MEASUREMENT_START_DRAWING\": \"Click to start drawing\",\n    \"MEASUREMENT_START\": \"Start\",\n    \"MEASUREMENT_END\": \"End\",\n    \"NAVIGATOR_PAN_EAST\": \"Pan East\",\n    \"NAVIGATOR_PAN_WEST\": \"Pan West\",\n    \"NAVIGATOR_PAN_SOUTH\": \"Pan South\",\n    \"NAVIGATOR_PAN_NORTH\": \"Pan North\",\n    \"NAVIGATOR_ZOOM_OUT\": \"Zoom Out\",\n    \"NAVIGATOR_ZOOM_IN\": \"Zoom In\",\n    \"FMT_NAVIGATOR_ZOOM_TO_SCALE\": \"Zoom to 1:{scale}\",\n    \"EXTERNAL_BASE_LAYERS\": \"External Base Layers\",\n    \"SELECTION_PROPERTY\": \"Property\",\n    \"SELECTION_VALUE\": \"Value\",\n    \"SELECTION_PREV_FEATURE\": \"Previous Feature\",\n    \"SELECTION_NEXT_FEATURE\": \"Next Feature\",\n    \"SELECTION_ZOOMTO_FEATURE\": \"Zoom to selected feature\",\n    \"VIEWER_OPTIONS\": \"Viewer Options\",\n    \"ABOUT\": \"About\",\n    \"HELP\": \"Help\",\n    \"QUICKPLOT_HEADER\": \"Quick Plot\",\n    \"QUICKPLOT_TITLE\": \"Title\",\n    \"QUICKPLOT_SUBTITLE\": \"Sub-Title\",\n    \"QUICKPLOT_PAPER_SIZE\": \"Paper Size\",\n    \"QUICKPLOT_ORIENTATION\": \"Orientation\",\n    \"QUICKPLOT_ORIENTATION_P\": \"Portrait\",\n    \"QUICKPLOT_ORIENTATION_L\": \"Landscape\",\n    \"QUICKPLOT_SHOWELEMENTS\": \"Show Elements\",\n    \"QUICKPLOT_SHOWLEGEND\": \"Show Legend\",\n    \"QUICKPLOT_SHOWNORTHARROW\": \"Show North Arrow\",\n    \"QUICKPLOT_SHOWCOORDINTES\": \"Show Coordinates\",\n    \"QUICKPLOT_SHOWSCALEBAR\": \"Show Scalebar\",\n    \"QUICKPLOT_SHOWDISCLAIMER\": \"Show Disclaimer\",\n    \"QUICKPLOT_ADVANCED_OPTIONS\": \"Advanced Options\",\n    \"QUICKPLOT_SCALING\": \"Scale\",\n    \"QUICKPLOT_DPI\": \"DPI\",\n    \"QUICKPLOT_BOX_INFO\": \"Quick Plot Map Capture box is active. Map rotation is disabled while box is active\",\n    \"QUICKPLOT_BOX_ROTATION\": \"Capture Box Rotation\",\n    \"QUICKPLOT_GENERATE\": \"Generate Plot\",\n    \"QUICKPLOT_COMMERCIAL_LAYER_WARNING\": \"Quick Plot will NOT include any visible commercial map layers\",\n    \"FEATURE_TOOLTIPS\": \"Feature Tooltips\",\n    \"MANUAL_FEATURE_TOOLTIPS\": \"Manual Feature Tooltips (click to show)\",\n    \"GEOLOCATION_SUCCESS\": \"Zoomed to your position\",\n    \"GEOLOCATION_WARN_OUTSIDE_MAP\": \"Zoomed to your position. It is outside the extents of your map\",\n    \"GEOLOCATION_ERROR\": \"Geolocation error: {message} ({code})\",\n    \"TASK_PANE_RESIZING\": \"Task Pane is resizing ...\",\n    \"TASK_PANE_LOADING\": \"Loading\",\n    \"TASK_PANE_LOADING_DESC\": \"Task Pane content is loading ...\",\n    \"COORDTRACKER\": \"Coordinate Tracker\",\n    \"COORDTRACKER_NO_PROJECTIONS\": \"You have no projections configured for this component\",\n    \"MAP_SIZE_DISPLAY_UNITS\": \"Map view size display units\",\n    \"ADD_MANAGE_LAYERS\": \"Add/Manage Layers\",\n    \"ADD_LAYER\": \"Add Layer\",\n    \"ADD_LAYER_TILED\": \"Add Tiled Layer\",\n    \"MANAGE_LAYERS\": \"Manage Layers\",\n    \"LAYER_TYPE\": \"Layer Type\",\n    \"SELECT_LAYER_TYPE\": \"Select Layer Type ...\",\n    \"ADD_WMS_LAYER_URL\": \"WMS Service URL\",\n    \"ADD_WMS_LAYER_LOADING\": \"Loading\",\n    \"ADD_WMS_LAYER_LOADING_DESC\": \"Loading WMS Capabilities\",\n    \"ADD_WMS_LAYER_NO_LAYERS\": \"No WMS Layers\",\n    \"WMS_VERSION\": \"WMS Version: {version}\",\n    \"ADD_WFS_LAYER_URL\": \"WFS Service URL\",\n    \"ADD_WFS_LAYER_LOADING\": \"Loading\",\n    \"ADD_WFS_LAYER_LOADING_DESC\": \"Loading WFS Capabilities\",\n    \"ADD_WFS_LAYER_NO_LAYERS\": \"No WFS Layers\",\n    \"WFS_NO_LAYER_DESCRIPTION\": \"Enter a WFS Service URL above and click the button beside it to load available layers\",\n    \"WFS_VERSION\": \"WFS Version: {version}\",\n    \"OWS_SERVICE_NAME\": \"Name: {name}\",\n    \"OWS_SERVICE_TITLE\": \"Title: {title}\",\n    \"OWS_SERVICE_ABSTRACT\": \"Abstract: {abstract}\",\n    \"WMS_LAYERS\": \"WMS Layers\",\n    \"WFS_LAYERS\": \"WFS Layers\",\n    \"OWS_LAYER_NAME\": \"Name: {name}\",\n    \"OWS_LAYER_TITLE\": \"Title: {title}\",\n    \"OWS_LAYER_ABSTRACT\": \"Abstract: {abstract}\",\n    \"OWS_LAYER_CRS\": \"CRS: {crs}\",\n    \"OWS_ADD_LAYER_PROMPT\": \"Click this layer to add it to the map\",\n    \"ADDED_LAYER\": \"Added layer: {name}\",\n    \"REMOVED_LAYER\": \"Removed layer: {name}\",\n    \"ADD_WFS_LAYER\": \"Add WFS Layer\",\n    \"SHARE_LINK_COPY_CLIPBOARD\": \"Copy Link\",\n    \"SHARE_LINK_COPIED\": \"Link copied\",\n    \"WMS_NO_LAYER_DESCRIPTION\": \"Enter a WMS Service URL above and click the button beside it to load available layers\",\n    \"UNIT_UNKNOWN\": \"Unknown\",\n    \"UNIT_INCHES\": \"Inches\",\n    \"UNIT_FEET\": \"Feet\",\n    \"UNIT_YARDS\": \"Yards\",\n    \"UNIT_MILES\": \"Miles\",\n    \"UNIT_NAUT_MILES\": \"Nautical Miles\",\n    \"UNIT_MILLIMETERS\": \"Millimeters\",\n    \"UNIT_CENTIMETERS\": \"Centimeters\",\n    \"UNIT_METERS\": \"Meters\",\n    \"UNIT_KILOMETERS\": \"Kilometers\",\n    \"UNIT_DEGREES\": \"Degrees\",\n    \"UNIT_DEC_DEGREES\": \"Decimal Degrees\",\n    \"UNIT_DMS\": \"Degrees Minutes Seconds\",\n    \"UNIT_PIXELS\": \"Pixels\",\n    \"UNIT_ABBR_UNKNOWN\": \"unk\",\n    \"UNIT_ABBR_INCHES\": \"in\",\n    \"UNIT_ABBR_FEET\": \"ft\",\n    \"UNIT_ABBR_YARDS\": \"yd\",\n    \"UNIT_ABBR_MILES\": \"mi\",\n    \"UNIT_ABBR_NAUT_MILES\": \"nm\",\n    \"UNIT_ABBR_MILLIMETERS\": \"mm\",\n    \"UNIT_ABBR_CENTIMETERS\": \"cm\",\n    \"UNIT_ABBR_METERS\": \"m\",\n    \"UNIT_ABBR_KILOMETERS\": \"km\",\n    \"UNIT_ABBR_DEGREES\": DEG,\n    \"UNIT_ABBR_DEC_DEGREES\": DEG,\n    \"UNIT_ABBR_DMS\": DEG,\n    \"UNIT_ABBR_PIXELS\": \"px\",\n    \"UNIT_FMT_M\": \"{value} m\",\n    \"UNIT_FMT_KM\": \"{value} km\",\n    \"UNIT_FMT_SQM\": \"{value} m<sup>2</sup>\",\n    \"UNIT_FMT_SQKM\": \"{value} km<sup>2</sup>\",\n    \"OL_ATTRIBUTION_TIP\": \"Attributions\",\n    \"OL_OVERVIEWMAP_TIP\": \"Overview Map\",\n    \"OL_RESET_ROTATION_TIP\": \"Reset Rotation\",\n    \"FEATURE_TOOLTIP_URL_HELP_TEXT\": \"Click for more information\",\n    \"SHARE_LINK_INCLUDE_SESSION\": \"Include Session ID\",\n    \"WINDOW_RESIZING\": \"Resizing Window\",\n    \"WINDOW_MOVING\": \"Moving Window\",\n    \"OTHER_THEME_RULE_COUNT\": \"... ({count} other theme rules)\",\n    \"LEGEND_FILTER_LAYERS\": \"Filter/search for layers or groups\",\n    \"ADD_LAYER_KIND_PROMPT\": \"What kind of layer do you want to add?\",\n    \"LAYER_KIND_FILE\": \"A local file-based layer\",\n    \"LAYER_KIND_URL\": \"A remote url-based layer\",\n    \"ADD_FILE\": \"Add Local File\",\n    \"ADD_FILE_INSTRUCTIONS\": \"Browse and select a file to view it locally on the map (it won't be saved or uploaded to the internet)\",\n    \"FMT_UPLOADED_FILE\": \"(size: {size} bytes, type: {type})\",\n    \"ADD_LOCAL_FILE_LAYER_FAILURE_NOT_TEXT\": \"Could not read text content from this file\",\n    \"ADD_LOCAL_FILE_LAYER_FAILURE\": \"Failed to load file as layer. It is probably an unsupported file format\",\n    \"WMS_UNSUPPORTED_VERSION\": \"Unsupported WMS version: {version}\",\n    \"NO_EXTERNAL_LAYERS\": \"No Layers\",\n    \"NO_EXTERNAL_LAYERS_DESC\": \"Add layers via the {tabName} tab above\",\n    \"LAYER_OPACITY\": \"Opacity\",\n    \"LAYER_HEATMAP_BLUR\": \"Heatmap Blur Size\",\n    \"LAYER_HEATMAP_RADIUS\": \"Heatmap Radius Size\",\n    \"LAYER_NAME_EXISTS\": \"A layer named {name} already exists\",\n    \"LAYER_MANAGER_TT_MOVE_UP\": \"Move this layer up the draw order\",\n    \"LAYER_MANAGER_TT_MOVE_DOWN\": \"Move this layer down the draw order\",\n    \"LAYER_MANAGER_TT_ZOOM_EXTENTS\": \"Zoom to the extents of this layer\",\n    \"LAYER_MANAGER_TT_REMOVE\": \"Remove this layer\",\n    \"LAYER_MANAGER_TT_EDIT_STYLE\": \"Edit style\",\n    \"LAYER_MANAGER_TT_MORE_OPTIONS\": \"Show more layer options\",\n    \"CANCEL\": \"Cancel\",\n    \"UNKNOWN_FILE_TYPE\": \"Unknown\",\n    \"WMS_SERVICE_INFO\": \"WMS Service Info\",\n    \"WFS_SERVICE_INFO\": \"WFS Service Info\",\n    \"WMS_AVAILABLE_LAYERS\": \"Available WMS Layers\",\n    \"WFS_AVAILABLE_LAYERS\": \"Available WFS Layers\",\n    \"ADD_LAYER_WITH_WMS_STYLE\": \"Add layer ({style})\",\n    \"ADD_LAYER_WITH_WMS_STYLE_TILED\": \"Add tiled layer ({style})\",\n    \"WMS_LEGEND\": \"WMS Legend\",\n    \"VSED_NO_STYLES_TITLE\": \"No Styles\",\n    \"VSED_NO_STYLES_DESC\": \"This editor is not configured to edit any styles\",\n    \"VECTOR_LAYER_STYLE\": \"Vector Layer Style\",\n    \"VSED_PT_FILL_COLOR\": \"Point Fill Color\",\n    \"VSED_PT_FILL_COLOR_ALPHA\": \"Point Fill Color Alpha\",\n    \"VSED_PT_RADIUS\": \"Point Radius\",\n    \"VSED_PT_OUTLINE_COLOR\": \"Point Outline Color\",\n    \"VSED_PT_OUTLINE_COLOR_ALPHA\": \"Point Outline Color Alpha\",\n    \"VSED_PT_OUTLINE_WIDTH\": \"Point Outline Thickness\",\n    \"VSED_LN_OUTLINE_COLOR\": \"Line Color\",\n    \"VSED_LN_OUTLINE_COLOR_ALPHA\": \"Line Color Alpha\",\n    \"VSED_LN_OUTLINE_THICKNESS\": \"Line Thickness\",\n    \"VSED_PL_FILL_COLOR\": \"Fill Color\",\n    \"VSED_PL_FILL_COLOR_ALPHA\": \"Fill Color Alpha\",\n    \"VSED_PL_OUTLINE_COLOR\": \"Outline Color\",\n    \"VSED_PL_OUTLINE_COLOR_ALPHA\": \"Outline Color Alpha\",\n    \"VSED_PL_OUTLINE_THICKNESS\": \"Outline Thickness\",\n    \"VSED_TAB_POINT\": \"Point\",\n    \"VSED_TAB_LINE\": \"Line\",\n    \"VSED_TAB_POLY\": \"Polygon\",\n    \"VSED_PT_TYPE\": \"Point Style Type\",\n    \"VSED_PT_TYPE_CIRCLE\": \"Circle\",\n    \"VSED_PT_TYPE_ICON\": \"Icon\",\n    \"VSED_PT_ICON_ANCHOR\": \"Anchor\",\n    \"VSED_PT_ICON_ANCHOR_H\": \"Horizontal\",\n    \"VSED_PT_ICON_ANCHOR_V\": \"Vertical\",\n    \"VSED_PT_ICON_SRC\": \"Image URL\",\n    \"VSED_PT_ICON_ROTATE_WITH_VIEW\": \"Rotate with view\",\n    \"VSED_PT_ICON_ROTATION\": \"Rotation\",\n    \"VSED_PT_ICON_SCALE\": \"Scale\",\n    \"ADD_LAYER_PROJECTION\": \"Projection of this layer\",\n    \"ADDING_LAYER_ERROR\": \"Error adding layer\",\n    \"LOADING_LAYER\": \"Loading layer: {name}\",\n    \"ACTION_CLOSE\": \"Close\",\n    \"MORE_LAYER_OPTIONS\": \"More Layer Options\",\n    \"CHOOSE_FILE\": \"Choose file ...\",\n    \"BROWSE\": \"Browse\",\n    \"SEL_FEATURE_PROPERTIES\": \"Feature Properties\",\n    \"SEL_FEATURE_PROPERTIES_NONE\": \"No properties\",\n    \"SEL_CLUSTER_PROPERTIES\": \"Cluster Properties (size: {size})\",\n    \"ADD_LOCAL_FILE_LAYER_FAILURE_NO_FORMATS\": \"Failed to add layer. No format drivers registered\",\n    \"ENABLE_CLUSTERING\": \"Enable Clustering\",\n    \"POINT_CLUSTER_DISTANCE\": \"Point Cluster Distance\",\n    \"EXPR_NOT_SET\": \"(Not set)\",\n    \"ENABLE_LABELS\": \"Enable Labels\",\n    \"LABEL_TEXT\": \"Label Text\",\n    \"LABEL_SIZE\": \"Label Size\",\n    \"LABEL_COLOR\": \"Label Color\",\n    \"LABEL_OUTLINE_COLOR\": \"Label Outline Color\",\n    \"LABEL_OUTLINE_THICKNESS\": \"Label Outline Thickness\",\n    \"LABEL_BOLD\": \"Bold\",\n    \"LABEL_ITALIC\": \"Italic\",\n    \"LABEL_LINE_PLACEMENT\": \"Line Placement\",\n    \"ADD_FILE_PROCESSING\": \"Processing file ...\",\n    \"GENERATE_THEMABLE_LAYER\": \"Generate Themable Layer\",\n    \"THEME_ON_PROPERTY\": \"Theme On Property\",\n    \"COLORBREWER_THEME\": \"<a href='https://colorbrewer2.org/' target='_blank'>ColorBrewer</a> theme\",\n    \"LABEL_USING_PROPERTY\": \"Label Using Property\",\n    \"CLUSTER_CLICK_ACTION\": \"Action to perform when cluster is clicked\",\n    \"CLUSTER_CLICK_ACTION_SHOW_POPUP\": \"Display attributes of points in a popup\",\n    \"CLUSTER_CLICK_ACTION_ZOOM_EXTENTS\": \"Zoom into selected cluster\",\n    \"EXTERNAL_LAYERS\": \"External Layers\",\n    \"CREATE_VECTOR_LAYER\": \"Vector Layer\",\n    \"CREATE_VECTOR_THEMED\": \"Themed Vector Layer\",\n    \"CREATE_VECTOR_CLUSTERED\": \"Clustered Point Layer\",\n    \"CREATE_VECTOR_HEATMAP\": \"Heatmap Layer\"\n};","\n/**\n * Returns a unique array of strings from the given array\n * @param items The array of strings to make unique\n * @since 0.13\n */\nexport function makeUnique(arr: string[]): string[] {\n    const a = [];\n    for (let i = 0, l = arr.length; i < l; i++) {\n        if (a.indexOf(arr[i]) === -1 && arr[i] !== '')\n            a.push(arr[i]);\n    }\n    return a;\n}\n\n/**\n * Indicates if the given arrays are different (content-wise)\n * @param arr \n * @param other \n * @since 0.13\n */\nexport function areArraysDifferent<T>(arr: T[] | undefined, other: T[] | undefined, equalityFn?: (left: T, right: T) => boolean): boolean {\n    if (arr && other) {\n        if (arr.length != other.length) {\n            return true;\n        } else {\n            for (let i = 0; i < arr.length; i++) {\n                if (equalityFn) {\n                    if (!equalityFn(arr[i], other[i])) {\n                        return true;\n                    }\n                } else if (arr[i] !== other[i]) {\n                    return true;\n                }\n            }\n            return false;\n        }\n    } else {\n        return true;\n    }\n}","export function assertIsDefined<T>(val: T): asserts val is NonNullable<T> {\n    if (val === undefined || val === null) {\n        throw new Error(\n            `Expected 'val' to be defined, but received ${val}`\n        );\n    }\n}","export function getAssetPath(url: string | undefined): string | undefined {\n    return url;\n}\n\nimport { ICON_ZOOM_OUT_FIXED } from \"../constants/assets\";\n\n//HACK: url-loader has done some breaking things to how our icon asset imports are handled\n//while this has been addressed for the main bundle build, this import is still undefined in\n//the context of our jest tests. Since nothing in our jest test suite cares that this value\n//be set at the moment, just use ?. as a workaround ($DEITY bless TS 3.7 for this wonderful\n//syntactic addition!)\nlet mRoot = ICON_ZOOM_OUT_FIXED?.replace(\"/zoom-out-fixed.png\", \"/../../\");\n\nexport function getAssetRoot(): string {\n    return mRoot;\n}\n\nexport function setAssetRoot(root: string): void {\n    mRoot = root;\n}\n\nexport function getRelativeIconPath(iconName: string): string {\n    return `images/icons/${iconName}.png`;\n}","// Console wrappers that are only active in development mode\n\n/**\n * Log an informational message. Does nothing in a production build\n *\n * @export\n * @param {*} [message]\n * @param {...any[]} optionalParams\n */\nexport function info(message?: any, ...optionalParams: any[]) {\n    if (__DEV__) {\n        console.info(message, optionalParams);\n    }\n}\n\n/**\n * Log a warning message. Does nothing in a production build\n *\n * @export\n * @param {*} [message]\n * @param {...any[]} optionalParams\n */\nexport function warn(message?: any, ...optionalParams: any[]) {\n    if (__DEV__) {\n        console.warn(message, optionalParams);\n    }\n}\n\n/**\n * Log an error message. Does nothing in a production build\n *\n * @export\n * @param {*} [message]\n * @param {...any[]} optionalParams\n */\nexport function error(message?: any, ...optionalParams: any[]) {\n    if (__DEV__) {\n        console.error(message, optionalParams);\n    }\n}\n\n/**\n * Log a debug message. Does nothing in a production build\n *\n * @export\n * @param {*} [message]\n * @param {...any[]} optionalParams\n */\nexport function debug(message?: any, ...optionalParams: any[]) {\n    if (__DEV__) {\n        console.debug(message, optionalParams);\n    }\n}","/**\n * Asserts that this function should never be called. The common usage is to call this as the\n * \"else\" case in a series of if/else blocks or the default case in a switch statement when\n * testing cases of an enum or union type. This is a compile-time way to ensure that your code properly\n * tests for all possible cases of a given enum or union type\n *\n * @export\n * @param {never} value\n */\nexport function assertNever(value: never) {\n    throw new Error(\"Should never get here\");\n}","const SHIM_EPSILON = Math.pow(2, -52);\n\nfunction epsilon(): number {\n    const num: any = Number;\n    return num.EPSILON || SHIM_EPSILON;\n}\n\n/**\n * Restricts the given number to the given range\n * \n * @export\n * @param {number} val \n * @param {number} lower \n * @param {number} upper \n */\nexport function restrictToRange(val: number, lower: number, upper: number) {\n    return Math.min(Math.max(val, lower), upper);\n}\n\n/**\n * Indicates if the given numbers are equal\n *\n * @export\n * @param {number} a\n * @param {number} b\n * @returns {boolean}\n */\nexport function areNumbersEqual(a: number, b: number): boolean {\n    return Math.abs(a - b) < epsilon();\n}\n\n/**\n * Indicates if the given scale is within the specified range\n *\n * @export\n * @param {number} scale\n * @param {number} minScale\n * @param {number} maxScale\n * @returns {boolean}\n */\nexport function scaleRangeBetween(scale: number, minScale: number, maxScale: number): boolean {\n    //Note the '<'. This is the same range check used in MapGuide Server\n    return scale >= minScale && scale < maxScale;\n}\n\n/**\n * Gets the closest scale index for the given scale and scale array pair\n *\n * @export\n * @param {[number, number]} scales\n * @param {number} scale\n * @returns {number}\n */\nexport function getClosestScaleIndex(scales: [number, number], scale: number): number {\n    const d1 = Math.abs(scales[0] - scale);\n    const d2 = Math.abs(scales[1] - scale);\n    if (d1 < d2)\n        return 0;\n    else\n        return 1;\n}\n\n/**\n * Gets the applicable finite scale index for the given scale and finite scale array\n *\n * @export\n * @param {number[]} finiteScaleList\n * @param {number} scale\n * @returns {number}\n */\nexport function getFiniteScaleIndexForScale(finiteScaleList: number[], scale: number): number {\n    for (let i = 0; i < finiteScaleList.length; i++) {\n        if (scale >= finiteScaleList[i]) { //Found the lower bound\n            if ((i + 1) < finiteScaleList.length) { //There is a possible upper bound\n                if (scale <= finiteScaleList[i+1]) { //It is the upper bound\n                    const test: [number, number] = [finiteScaleList[i], finiteScaleList[i+1]];\n                    //Snap to the scale with lowest difference\n                    const testIndex = getClosestScaleIndex(test, scale);\n                    if (testIndex == 0) {\n                        return i;\n                    } else {\n                        return i+1;\n                    }\n                }\n            } else { //There is no upper bound (we're at the end), snap to it\n                return i;\n            }\n        } else if (scale <= finiteScaleList[i]) {\n            if (i > 0) {\n                const test: [number, number] = [finiteScaleList[i-1], finiteScaleList[i]];\n                const testIndex = getClosestScaleIndex(test, scale);\n                if (testIndex == 0) {\n                    return i-1;\n                } else {\n                    return i;\n                }\n            } else {\n                return i;\n            }\n        }\n    }\n    return 0;\n}\n\n/**\n * Converts the given angle in degrees to radians\n * @param deg The angle in degrees\n */\nexport function deg2rad(deg: number): number {\n    return deg * (Math.PI / 180);\n}\n\n/**\n * Converts the given angle in radians to degrees\n * @param radians \n * @since 0.13\n */\nexport function rad2deg(radians: number) {\n    return radians * (180 / Math.PI);\n}\n\n/**\n * Computes the sum of the given array\n * \n * @since 0.11\n * @export\n * @template T \n * @param {T[]} array \n * @param {(item: T) => number} numSelector \n * @returns {number} \n */\nexport function sum<T>(array: T[], numSelector: (item: T) => number): number {\n    let total = 0;\n    for (const item of array) {\n        total += numSelector(item);\n    }\n    return total;\n}\n\n/**\n * Rounds the given number to the specified number of decimals\n * \n * @since 0.11\n * @export\n * @param {number} num \n * @param {number} [decimals=2] \n * @returns {number} \n */\nexport function roundTo(num: number, decimals: number = 2): number {\n    const a = Math.pow(10, decimals);\n    return Math.round(num * a) / a;\n}","import { RuntimeMap } from '../api/contracts/runtime-map';\n\n/**\n * Type alias for a MapGuide site version\n * @since 0.12.1\n */\nexport type SiteVersion = [number, number, number, number];\n\n/**\n * Gets the MapGuide site version from the runtime map response\n * @param map \n * @since 0.12\n */\nexport function getSiteVersion(map: RuntimeMap): SiteVersion {\n    const [sMaj, sMin, sPatch, sRev] = map.SiteVersion.split(\".\");\n    const vMaj = parseInt(sMaj, 10);\n    const vMin = parseInt(sMin, 10);\n    const vPatch = parseInt(sPatch, 10);\n    const vRev = parseInt(sRev, 10);\n    return [vMaj, vMin, vPatch, vRev];\n}\n\n/**\n * Tests if QUERYMAPFEATURES 4.0.0 API can be used with this version of MapGuide\n * @param version The site version\n * @since 0.12.1\n */\nexport function canUseQueryMapFeaturesV4(version: SiteVersion): boolean {\n    const [vMaj, vMin, vPatch, vRev] = version;\n    if (vMaj >= 4) {\n        //Allow a 4.0 trunk/branch build\n        if (vMaj == 4 && vMin == 0 && vPatch == 0 && vRev == 0) {\n            return true;\n        }\n        //Test for > 4.0 preview 1\n        if (vMaj == 4 && vMin == 0 && vPatch == 0) {\n            return vRev > 9592; //This is the rev of preview 1\n        }\n        return true;\n    }\n    return false;\n}","/**\n * Indicates if the given string ends with the given suffix\n *\n * @export\n * @param {string} str\n * @param {string} suffix\n * @returns {boolean}\n */\nexport function strEndsWith(str: string, suffix: string): boolean {\n    return str.indexOf(suffix, str.length - suffix.length) !== -1;\n}\n\n/**\n * Indicates if the given string starts with the given string\n * \n * @param {string} str \n * @param {string} word \n * @returns {boolean}\n * @since 0.14\n */\nexport function strStartsWith(str: string, word: string) {\n    return str.lastIndexOf(word, 0) === 0;\n}\n\n/**\n * Replaces all occurrences of the given string with the specified replacement in the target\n * string\n * \n * @param str \n * @param find \n * @param replace \n * @since 0.12\n */\nexport function strReplaceAll(str: string, find: string, replace: string): string {\n    return str.split(find).join(replace);\n}\n\n/**\n * Empty string constant\n */\nexport const STR_EMPTY = \"\";\n\n/**\n * Indicates if the given string is null or empty\n *\n * @export\n * @param {(string | null | undefined)} str\n * @returns {boolean}\n */\nexport function strIsNullOrEmpty(str: string | null | undefined): str is null | undefined {\n    return null == str || \"\" === str;\n}\n\n/**\n * Returns a trimmed version of the given string\n * \n * @param str The string to trim\n * @since 0.12.5\n */\nexport function strTrim(str: string): string {\n    if (!String.prototype.trim) {\n        return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n    }\n    return str.trim();\n}\n\n/**\n *\n *\n * @export\n * @param {string} expr\n * @param {string} delimBegin\n * @param {string} delimEnd\n * @returns\n * @since 0.14\n */\nexport function extractPlaceholderTokens(expr: string, delimBegin: string, delimEnd: string) {\n    const regex = new RegExp(`${delimBegin}(.*?)${delimEnd}`, \"g\");\n    const matches = expr.match(regex);\n    return matches?.map(m => m.replace(delimBegin, \"\").replace(delimEnd, \"\")) ?? [];\n}\n\n/**\n * Gets whether the given string is a resource identifier\n * \n * @param str The string to test\n * @since 0.14\n */\nexport function isResourceId(str: string): boolean {\n    return strStartsWith(str, \"Library://\")\n}","import {\n    InitError,\n    IMapView,\n    IModalDisplayOptions,\n    IModalComponentDisplayOptions\n} from \"../api/common\";\nimport { MapLayer, RuntimeMap } from \"../api/contracts/runtime-map\";\nimport { IInlineMenu, IFlyoutMenu, IComponentFlyoutItem } from \"../components/toolbar\";\nimport { IGenericSubjectMapLayer, ViewerAction } from '../actions/defs';\nimport { DeArrayifiedResult } from \"../api/builders/deArrayify\";\n\n/**\n * Indicates if the given argument is an IModalDisplayOptions\n *\n * @export\n * @param {*} arg\n * @returns {arg is IModalDisplayOptions}\n */\nexport function isModalDisplayOptions(arg: any): arg is IModalDisplayOptions {\n    return typeof(arg.url) != 'undefined';\n}\n\n/**\n * Indicates if the given argument is an IModalComponentDisplayOptions\n *\n * @export\n * @param {*} arg\n * @returns {arg is IModalComponentDisplayOptions}\n */\nexport function isModalComponentDisplayOptions(arg: any): arg is IModalComponentDisplayOptions {\n    return typeof(arg.component) != 'undefined';\n}\n\n/**\n * Indicates if the given argument is an Error object\n *\n * @export\n * @param {*} err\n * @returns {err is Error}\n */\nexport function isError(err: any): err is Error {\n    return err instanceof Error;\n}\n\n/**\n * Indicates if the given argument is an InitError object\n *\n * @export\n * @param {*} item\n * @returns {item is InitError}\n */\nexport function isInitError(item: any): item is InitError {\n    return typeof (item.message) != 'undefined' && typeof (item.stack) != undefined;\n}\n\n/**\n * Indicates if the given arguemnt has the shape of an IFlyoutMenu\n *\n * @export\n * @param {*} item\n * @returns {item is IFlyoutMenu}\n */\nexport function isMenuRef(item: any): item is IFlyoutMenu {\n    return typeof (item.flyoutId) != 'undefined';\n}\n\n/**\n * Indicates if the given argument has the shape of an IComponentFlyoutItem\n *\n * @export\n * @param {*} item\n * @returns {item is IComponentFlyoutItem}\n */\nexport function isComponentFlyout(item: any): item is IComponentFlyoutItem {\n    return typeof (item.componentName) != 'undefined';\n}\n\n/**\n * Indicates if the given argument has the shape of an IInlineMenu\n *\n * @export\n * @param {*} item\n * @returns {item is IInlineMenu}\n */\nexport function isMenu(item: any): item is IInlineMenu {\n    return typeof (item.childItems) != 'undefined';\n}\n\n/**\n * Indicates if the given argument is a MapLayer object\n *\n * @export\n * @param {*} layer\n * @returns {layer is MapLayer}\n */\nexport function isLayer(layer: any): layer is MapLayer {\n    return layer.LayerDefinition !== undefined;\n}\n\n/**\n * Indicates if the given argument has the shape of an IMapView\n *\n * @export\n * @param {*} view\n * @returns {view is IMapView}\n */\nexport function isMapView(view: any): view is IMapView {\n    return typeof (view.x) == 'number'\n        && typeof (view.y) == 'number'\n        && typeof (view.scale) == 'number';\n}\n\n/**\n * Indicates if the given argument is a coordinate pair\n *\n * @export\n * @param {*} coord\n * @returns {coord is [number, number]}\n */\nexport function isCoordinate(coord: any): coord is [number, number] {\n    return coord instanceof Array\n        && coord.length == 2\n        && typeof (coord[0]) == 'number'\n        && typeof (coord[1]) == 'number';\n}\n\n/**\n * Indicates if the given argument has the shape of a ViewerAction\n *\n * @export\n * @param {*} action\n * @returns {action is ViewerAction}\n */\nexport function isAction(action: any): action is ViewerAction {\n    return typeof (action.type) != 'undefined'\n        && typeof (action.payload) != 'undefined';\n}\n\n/**\n * Indicates if the given argument is a RuntimeMap\n * \n * @param arg \n * @returns \n * @since 0.14\n */\nexport function isRuntimeMap(arg: DeArrayifiedResult | RuntimeMap | IGenericSubjectMapLayer): arg is RuntimeMap {\n    return (arg as any).Extents != null\n        && (arg as any).BackgroundColor != null\n        && (arg as any).CoordinateSystem != null\n        && (arg as any).MapDefinition != null\n        && (arg as any).DisplayDpi != null;\n}","import * as React from \"react\";\nimport { tr } from \"../api/i18n\";\nimport { DEG } from \"../constants\";\nimport { UnitInfo, UnitOfMeasure, UnitName, IMapView } from \"../api/common\";\n\nconst mUnits: UnitInfo[] = [\n    { name: \"Unknown\", localizedName: (locale) => tr(\"UNIT_UNKNOWN\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_UNKNOWN\", locale), unitsPerMeter: 1.0, metersPerUnit: 1.0 },\n    { name: \"Inches\", localizedName: (locale) => tr(\"UNIT_INCHES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_INCHES\", locale), unitsPerMeter: 39.370079, metersPerUnit: 0.0254 },\n    { name: \"Feet\", localizedName: (locale) => tr(\"UNIT_FEET\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_FEET\", locale), unitsPerMeter: 3.2808, metersPerUnit: 0.3048 },\n    { name: \"Yards\", localizedName: (locale) => tr(\"UNIT_YARDS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_YARDS\", locale), unitsPerMeter: 1.0936133, metersPerUnit: 0.9144 },\n    { name: \"Miles\", localizedName: (locale) => tr(\"UNIT_MILES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_MILES\", locale), unitsPerMeter: 0.00062137, metersPerUnit: 1609.344 },\n    { name: \"Nautical Miles\", localizedName: (locale) => tr(\"UNIT_NAUT_MILES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_NAUT_MILES\", locale), unitsPerMeter: 0.000539956803, metersPerUnit: 1852 },\n    { name: \"Millimeters\", localizedName: (locale) => tr(\"UNIT_MILLIMETERS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_MILLIMETERS\", locale), unitsPerMeter: 1000.0, metersPerUnit: 0.001 },\n    { name: \"Centimeters\", localizedName: (locale) => tr(\"UNIT_CENTIMETERS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_CENTIMETERS\", locale), unitsPerMeter: 100.0, metersPerUnit: 0.01 },\n    { name: \"Meters\", localizedName: (locale) => tr(\"UNIT_METERS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_METERS\", locale), unitsPerMeter: 1.0, metersPerUnit: 1.0 },\n    { name: \"Kilometers\", localizedName: (locale) => tr(\"UNIT_KILOMETERS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_KILOMETERS\", locale), unitsPerMeter: 0.001, metersPerUnit: 1000.0 },\n    { name: \"Degrees\", localizedName: (locale) => tr(\"UNIT_DEGREES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_DEGREES\", locale), unitsPerMeter: 0.000009044, metersPerUnit: 111061.75033 },\n    { name: \"Decimal Degrees\", localizedName: (locale) => tr(\"UNIT_DEC_DEGREES\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_DEC_DEGREES\", locale), unitsPerMeter: 0.000009044, metersPerUnit: 111061.75033 },\n    { name: \"Degrees Minutes Seconds\", localizedName: (locale) => tr(\"UNIT_DMS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_DMS\", locale), unitsPerMeter: 0.000009044, metersPerUnit: 111061.75033 },\n    { name: \"Pixels\", localizedName: (locale) => tr(\"UNIT_PIXELS\", locale), abbreviation: (locale) => tr(\"UNIT_ABBR_PIXELS\", locale), unitsPerMeter: 1.0, metersPerUnit: 1.0 }\n];\n\n/**\n * Gets all available units of measure\n * @since 0.12.2\n */\nexport function getUnitsOfMeasure(): UnitOfMeasure[] {\n    return [\n        UnitOfMeasure.Centimeters,\n        UnitOfMeasure.DecimalDegrees,\n        UnitOfMeasure.Degrees,\n        UnitOfMeasure.DMS,\n        UnitOfMeasure.Feet,\n        UnitOfMeasure.Inches,\n        UnitOfMeasure.Kilometers,\n        UnitOfMeasure.Meters,\n        UnitOfMeasure.Miles,\n        UnitOfMeasure.Millimeters,\n        UnitOfMeasure.NauticalMiles,\n        UnitOfMeasure.Pixels,\n        UnitOfMeasure.Unknown,\n        UnitOfMeasure.Yards\n    ]\n}\n\n/**\n * @deprecated Use getUnitsOfMeasure() instead\n */\nexport function getUnits(): [UnitOfMeasure, UnitName][] {\n    return [\n        [UnitOfMeasure.Centimeters, \"Centimeters\"],\n        [UnitOfMeasure.DecimalDegrees, \"Decimal Degrees\"],\n        [UnitOfMeasure.Degrees, \"Degrees\"],\n        [UnitOfMeasure.DMS, \"Degrees Minutes Seconds\"],\n        [UnitOfMeasure.Feet, \"Feet\"],\n        [UnitOfMeasure.Inches, \"Inches\"],\n        [UnitOfMeasure.Kilometers, \"Kilometers\"],\n        [UnitOfMeasure.Meters, \"Meters\"],\n        [UnitOfMeasure.Miles, \"Miles\"],\n        [UnitOfMeasure.Millimeters, \"Millimeters\"],\n        [UnitOfMeasure.NauticalMiles, \"Nautical Miles\"],\n        [UnitOfMeasure.Pixels, \"Pixels\"],\n        [UnitOfMeasure.Unknown, \"Unknown\"],\n        [UnitOfMeasure.Yards, \"Yards\"]\n    ];\n}\n\nexport function getUnitOfMeasure(unit: UnitOfMeasure): UnitInfo {\n    const u = mUnits[unit];\n    return u || mUnits[0]; //The unknown unit\n}\n\n/**\n * Utility function to compute the physical map size based on the given display size and various display settings\n * \n * @since 0.11\n * @export\n * @param {[number, number]} displaySize \n * @param {number} metersPerUnit \n * @param {UnitOfMeasure} units \n * @param {number} [resolution] \n * @param {number} [precision] \n * @returns {[number, number]} \n */\nexport function getMapSize(displaySize: [number, number], metersPerUnit: number, units: UnitOfMeasure, resolution?: number, precision?: number): [number, number] {\n    const [width, height] = displaySize;\n    let gw = width;\n    let gh = height;\n    const uom = getUnitOfMeasure(units);\n    if (resolution && units != UnitOfMeasure.Pixels) {\n        gw = resolution * width;\n        gh = resolution * height;\n        if (units != UnitOfMeasure.Unknown) {\n            gw = uom.unitsPerMeter * gw * metersPerUnit;\n            gh = uom.unitsPerMeter * gh * metersPerUnit;\n        }\n        let prec = precision || 2;\n        if (prec >= 0) {\n            const factor = Math.pow(10, prec);\n            gw = Math.round(gw * factor) / factor;\n            gh = Math.round(gh * factor) / factor;\n        }\n    }\n    return [gw, gh];\n}","import queryString from \"qs\";\nimport { IInvokeUrlCommandParameter } from \"../api/common\";\nimport { strIsNullOrEmpty } from './string';\nconst parse = require(\"url-parse\");\n\nconst DEFAULT_PARSE_OPTIONS = { ignoreQueryPrefix: true };\n\n/**\n * Indicates if the given arrays are equal\n *\n * @param {(string[]|null)} a\n * @param {(string[]|null)} b\n * @returns {boolean}\n */\nfunction arraysEqual(a: string[] | null, b: string[] | null): boolean {\n    if (a === b) return true;\n    if (a == null || b == null) return false;\n    if (a.length != b.length) return false;\n\n    // If you don't care about the order of the elements inside\n    // the array, you should sort both arrays here.\n\n    for (let i = 0; i < a.length; ++i) {\n        if (a[i] !== b[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n\n/**\n * Indicates if the given sets of parameterse are the same\n *\n * @param {*} params1\n * @param {*} params2\n * @returns {boolean}\n */\nfunction areParamsEqual(params1: any, params2: any): boolean {\n    //HACK: locale is an optional part of the mapname/session/locale triplet\n    //For the purpose of the same url test, the presence (or lack thereof) of\n    //this parameter should not break the url equality test\n    const keys1 = Object.keys(params1).filter(k => k.toLowerCase() != \"locale\").sort();\n    const keys2 = Object.keys(params2).filter(k => k.toLowerCase() != \"locale\").sort();\n    if (arraysEqual(keys1, keys2)) {\n        for (const key of keys1) {\n            if (params1[key] != params2[key]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    return false;\n}\n\n/**\n * Indicates if the given URLs are the same\n *\n * @export\n * @param {string} url1\n * @param {string} url2\n * @returns {boolean}\n */\nexport function areUrlsSame(url1: string, url2: string): boolean {\n    const parsed1 = parse(url1);\n    const parsed2 = parse(url2);\n    const params1 = queryString.parse(parsed1.query, DEFAULT_PARSE_OPTIONS);\n    const params2 = queryString.parse(parsed2.query, DEFAULT_PARSE_OPTIONS);\n\n    const same = parsed1.protocol == parsed2.protocol\n        && parsed1.slashes == parsed2.slashes\n        && parsed1.auth == parsed2.auth\n        && parsed1.username == parsed2.username\n        && parsed1.password == parsed2.password\n        && parsed1.host == parsed2.host\n        && parsed1.hostname == parsed2.hostname\n        && parsed1.port == parsed2.port\n        && parsed1.pathname == parsed2.pathname\n        && parsed1.hash == parsed2.hash\n        && parsed1.host == parsed2.host\n        && areParamsEqual(params1, params2);\n\n    return same;\n}\n\n/**\n * A parsed component URI\n * \n * @export\n * @interface ParsedComponentUri\n */\nexport interface ParsedComponentUri {\n    name: string;\n    props: any;\n}\n\n/**\n * Indicates if the given URI is a component URI\n * \n * @export\n * @param {string} uri \n * @returns {boolean} \n */\nexport function isComponentUri(uri: string): boolean {\n    return uri.indexOf(\"component://\") >= 0;\n}\n\n/**\n * Parses the given component URI. If it not a valid component URI returns undefined\n * \n * @export\n * @param {string} uri \n * @returns {(ParsedComponentUri | undefined)} \n */\nexport function parseComponentUri(uri: string): ParsedComponentUri | undefined {\n    if (isComponentUri(uri)) {\n        const qi = uri.lastIndexOf(\"?\");\n        const name = qi < 0 ? uri.substring(12) : uri.substring(12, qi);\n        const props = qi < 0 ? {} : queryString.parse(uri.substring(qi), DEFAULT_PARSE_OPTIONS);\n        return {\n            name,\n            props\n        };\n    }\n}\n\n/**\n * Normalizes the given URL to ensure it has the baseline set of required parameters for invoking any server-side script that uses the MapGuide Web API\n * \n * @export\n * @param {string} url The url to normalize\n * @param {(string | undefined)} mapName The name of the current runtime map\n * @param {(string | undefined)} session The current session id\n * @param {string} [locale] An optional locale\n * @param {boolean} [uppercase=true] If true, will uppercase all parameter names\n * @param {IInvokeUrlCommandParameter[]} [extraParameters=[]] Any extra parameters to append to the URL\n * @returns {string} \n */\nexport function ensureParameters(url: string, mapName: string | undefined, session: string | undefined, locale?: string, uppercase = true, extraParameters: IInvokeUrlCommandParameter[] = []): string {\n    //If this is a component URL, let it be\n    if (isComponentUri(url)) {\n        return url;\n    }\n    const parsed = parseUrl(url);\n    const params: any = parsed.query != null ? queryString.parse(parsed.query, DEFAULT_PARSE_OPTIONS) : {};\n    let bNeedMapName = true;\n    let bNeedSession = true;\n    let bNeedLocale = true;\n    for (const key in params) {\n        const name = key.toLowerCase();\n        switch (name) {\n            case \"session\":\n                bNeedSession = false;\n                break;\n            case \"mapname\":\n                bNeedMapName = false;\n                break;\n            case \"locale\":\n                bNeedLocale = false;\n                break;\n        }\n    }\n    if (bNeedMapName && !strIsNullOrEmpty(mapName)) {\n        if (uppercase) {\n            params.MAPNAME = mapName;\n        } else {\n            params.mapname = mapName;\n        }\n    }\n    if (bNeedSession && !strIsNullOrEmpty(session)) {\n        if (uppercase) {\n            params.SESSION = session;\n        } else {\n            params.session = session;\n        }\n    }\n    if (bNeedLocale) {\n        if (uppercase) {\n            params.LOCALE = locale;\n        } else {\n            params.locale = locale;\n        }\n    }\n\n    for (const p of extraParameters) {\n        params[p.name] = p.value;\n    }\n\n    /*\n    parsed.query = queryString.stringify(params);\n    const result = parsed.toString();\n\n    if (url.indexOf(parsed.protocol) >= 0 || url.indexOf(\"/\") == 0) {\n        return result;\n    }\n\n    return result;\n    */\n    //Don't uppercase the parameters here if true, uppercasing is only for filling in\n    //missing parameters\n    return appendParameters(url, params, true, false /*uppercase*/);\n}\n\n/**\n * Represents a parsed URL with query string separated\n *\n * @export\n * @interface IParsedUrl\n * @since 0.12\n */\nexport interface IParsedUrl {\n    url: string;\n    query: any;\n}\n\n/**\n * Parses the given URL and separates out the query string parameters\n *\n * @export\n * @param {string} url The URL to parse\n * @returns {IParsedUrl}\n * @since 0.12\n */\nexport function parseUrl(url: string): IParsedUrl {\n    //return queryString.parseUrl(url);\n    const qi = url.lastIndexOf(\"?\");\n    const parsedUrl = qi < 0 ? url : url.substring(0, qi);\n    const query = qi < 0 ? {} : queryString.parse(url.substring(qi), DEFAULT_PARSE_OPTIONS);\n    return {\n        url: parsedUrl,\n        query\n    };\n}\n\n/**\n * Converts the given object to a query string fragment\n *\n * @export\n * @param {*} parameters The object to stringify\n * @returns {string} The query string fragment\n */\nexport function stringifyQuery(parameters: any): string {\n    return queryString.stringify(parameters);\n}\n\n/**\n * Appends the specified parameters to the given URL\n *\n * @export\n * @param {string} url The URL to append parameters to\n * @param {*} parameters The parameters to append\n * @param {boolean} [bOverwriteExisting=true] If true, will overwrite any existing parameters if the URL already has them\n * @param {boolean} [bConvertToUppercase=false] If true, will ensure all parameter names are uppercase\n * @param {boolean} [bDiscardExistingParams=false] If true, will discard existing query string params before appending\n * @since 0.12\n */\nexport function appendParameters(url: string, parameters: any, bOverwriteExisting: boolean = true, bConvertToUppercase: boolean = false, bDiscardExistingParams: boolean = false) {\n    const parsed = parse(url);\n    let currentParams: any;\n    if (!bDiscardExistingParams) {\n        currentParams = parsed.query != null ? queryString.parse(parsed.query, DEFAULT_PARSE_OPTIONS) : {};\n    } else {\n        currentParams = {};\n    }\n\n    const paramNames: any = {};\n    for (const key in currentParams) {\n        paramNames[key.toUpperCase()] = key;\n    }\n\n    for (const name in parameters) {\n        //See if this parameter name was normalized\n        const key = paramNames[name.toUpperCase()] || name;\n        //If it was and we've got an existing value there, skip if not overwriting\n        if (key && currentParams[key] && !bOverwriteExisting) {\n            continue;\n        }\n        //Put the parameter value\n        currentParams[key] = parameters[name];\n    }\n\n    if (bConvertToUppercase) {\n        let params2: any = {};\n        for (const name in currentParams) {\n            params2[name.toUpperCase()] = currentParams[name];\n        }\n        currentParams = params2;\n    }\n\n    parsed.query = queryString.stringify(currentParams);\n    const result = parsed.toString();\n\n    if (url.indexOf(parsed.protocol) >= 0 || url.indexOf(\"/\") == 0) {\n        return result;\n    }\n\n    return result;\n}\n\n/**\n * Parses the query string section of the given URL and returns the parsed\n * parameters as an object\n * @param url The URL to parse\n * @since 0.13\n */\nexport function parseUrlParameters(url: string): any {\n    const parsed = parse(url);\n    const currentParams: any = parsed.query != null ? queryString.parse(parsed.query, DEFAULT_PARSE_OPTIONS) : {};\n    return currentParams;\n}","\nimport { areNumbersEqual } from './number';\nimport { areArraysDifferent } from './array';\nimport { IMapView, LayerTransparencySet } from '../api/common';\nimport { RuntimeMap } from '../api/contracts/runtime-map';\n\n/**\n * Determines if the given IMapView instances are equal or close to it\n *\n * @export\n * @param {(IMapView | undefined)} view\n * @param {(IMapView | undefined)} otherView\n * @returns {boolean}\n */\nexport function areViewsCloseToEqual(view: IMapView | undefined, otherView: IMapView | undefined): boolean {\n    if (view && otherView) {\n        return areNumbersEqual(view.x, otherView.x) &&\n            areNumbersEqual(view.y, otherView.y) &&\n            areNumbersEqual(view.scale, otherView.scale);\n    } else {\n        return false;\n    }\n}\n\n/**\n * Indicates if the given runtime map instances are the same or have the same name\n *\n * @export\n * @param {RuntimeMap} map\n * @param {RuntimeMap} other\n * @returns {boolean}\n */\nexport function areMapsSame(map: RuntimeMap, other: RuntimeMap): boolean {\n    if (map != other) {\n        return map.Name == other.Name;\n    }\n    return true;\n}\n\n/**\n * Indicates if the given layer transparency sets are different\n * @param set \n * @param other \n */\nexport function layerTransparencyChanged(set: LayerTransparencySet | undefined, other: LayerTransparencySet | undefined): boolean {\n    if ((!set && other) || (set && !other)) {\n        return true;\n    }\n    const s = set ?? {};\n    const o = other ?? {};\n    const setLayers = Object.keys(s);\n    const otherLayers = Object.keys(o);\n    if (areArraysDifferent(setLayers, otherLayers))\n        return true;\n\n    for (const name of setLayers) {\n        if (s[name] != o[name]) {\n            return true;\n        }\n    }\n    return false;\n}","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".component-accordion {\\n    font: 10pt Verdana, sans-serif;\\n    background-color: #E4E3E3;\\n}\\n.component-accordion-panel-header {\\n    border: 1px solid black;\\n    font-weight: bold;\\n    color: white;\\n    /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#878787+0,747474+50,6e7774+50,555555+51,5e6666+100 */\\n    background: #878787; /* Old browsers */\\n    background: -moz-linear-gradient(top,  #878787 0%, #747474 50%, #6e7774 50%, #555555 51%, #5e6666 100%); /* FF3.6-15 */\\n    background: -webkit-linear-gradient(top,  #878787 0%,#747474 50%,#6e7774 50%,#555555 51%,#5e6666 100%); /* Chrome10-25,Safari5.1-6 */\\n    background: linear-gradient(to bottom,  #878787 0%,#747474 50%,#6e7774 50%,#555555 51%,#5e6666 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#878787', endColorstr='#5e6666',GradientType=0 ); /* IE6-9 */\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/stories/styles/accordion-slate.css\"],\"names\":[],\"mappings\":\"AAAA;IACI,8BAA8B;IAC9B,yBAAyB;AAC7B;AACA;IACI,uBAAuB;IACvB,iBAAiB;IACjB,YAAY;IACZ,8IAA8I;IAC9I,mBAAmB,EAAE,iBAAiB;IACtC,uGAAuG,EAAE,aAAa;IACtH,sGAAsG,EAAE,4BAA4B;IACpI,oGAAoG,EAAE,qDAAqD;IAC3J,mHAAmH,EAAE,UAAU;AACnI\",\"sourcesContent\":[\".component-accordion {\\n    font: 10pt Verdana, sans-serif;\\n    background-color: #E4E3E3;\\n}\\n.component-accordion-panel-header {\\n    border: 1px solid black;\\n    font-weight: bold;\\n    color: white;\\n    /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#878787+0,747474+50,6e7774+50,555555+51,5e6666+100 */\\n    background: #878787; /* Old browsers */\\n    background: -moz-linear-gradient(top,  #878787 0%, #747474 50%, #6e7774 50%, #555555 51%, #5e6666 100%); /* FF3.6-15 */\\n    background: -webkit-linear-gradient(top,  #878787 0%,#747474 50%,#6e7774 50%,#555555 51%,#5e6666 100%); /* Chrome10-25,Safari5.1-6 */\\n    background: linear-gradient(to bottom,  #878787 0%,#747474 50%,#6e7774 50%,#555555 51%,#5e6666 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#878787', endColorstr='#5e6666',GradientType=0 ); /* IE6-9 */\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[3].use[1]!../../stdassets/sprites/icons.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"@charset \\\"UTF-8\\\";\\n/*\\n@import \\\"~ol/ol.css\\\";\\n@import \\\"~@blueprintjs/core/lib/css/blueprint.css\\\";\\n@import \\\"~react-splitter-layout/lib/index.css\\\";\\n*/\\n\\n/* HACK: Clear out any trace of the font icon as HTMLSelect should be using the SVG counterpart */\\n.bp3-select:after {\\n    content: \\\"\\\";\\n}\\n\\n.legend-label-highlight-text {\\n    background-color: yellow;\\n}\\n\\n.mg-toast {\\n    z-index: 120;\\n}\\n\\n.map-viewer-component {\\n    background-color: white;\\n}\\n\\n.iframe-iehack-zindex {\\n    position: absolute;\\n    border: none;\\n    top: 0;\\n    left: 0;\\n    height: 100%;\\n    width: 100%;\\n    z-index: -1;\\n}\\n\\n/* OpenLayers overrides */\\n\\n.ol-attribution {\\n    right: 10px;\\n    bottom: 52px;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.ol-rotate {\\n    top: auto;\\n    right: 10px;\\n    bottom: 25px;\\n}\\n\\n.ol-rotate button {\\n    bottom: 1px;\\n    left: auto;\\n    right: 1px;\\n    top: auto;\\n}\\n\\n.ol-custom-overviewmap,\\n.ol-custom-overviewmap.ol-uncollapsible {\\n    bottom: 79px;\\n    left: auto;\\n    right: 10px;\\n    top: auto;\\n}\\n\\n.ol-custom-overviewmap:not(.ol-collapsed) {\\n    border: 1px solid black;\\n}\\n\\n.ol-custom-overviewmap .ol-overviewmap-map {\\n    border: none;\\n}\\n\\n.ol-custom-overviewmap .ol-overviewmap-box {\\n    border: 2px solid red;\\n}\\n\\n.ol-custom-overviewmap:not(.ol-collapsed) button {\\n    bottom: 1px;\\n    left: auto;\\n    right: 1px;\\n    top: auto;\\n}\\n\\n/* Accordion */\\n.component-accordion-panel-header {\\n    padding: 3px;\\n    cursor: pointer;\\n}\\n\\n/* Selection Panel */\\n\\n.selection-panel-property-grid {\\n    width: 100%;\\n}\\n\\n.selection-panel-layer-selector {\\n    max-width: 180px;\\n}\\n\\n.selection-panel-layer-selector select {\\n    max-width: 143px;\\n}\\n\\n/* Modal Dialogs */\\n\\n.modal-dialog {\\n    background: #fff;\\n    border: 1px solid black;\\n    border-radius: 3px;\\n    position: absolute;\\n    transform: translate(-50%, -50%);\\n    z-index: 4999;\\n}\\n\\n.modal-dialog-header {\\n    border-top-left-radius: 3px;\\n    border-top-right-radius: 3px;\\n}\\n\\n.modal-dialog-body {\\n    border-bottom-left-radius: 3px;\\n    border-bottom-right-radius: 3px;\\n    padding-bottom: 3px;\\n}\\n\\n.modal-dialog-backdrop {\\n    position: absolute;\\n    width: 100%;\\n    height: 100%;\\n    top: 0px;\\n    left: 0px;\\n    z-index: 4998;\\n    background: rgba(0, 0, 0, 0.3);\\n}\\n\\n.mg-flyout-menu-container {\\n    position: absolute;\\n}\\n\\n.mg-flyout-component-container {\\n    position: absolute;\\n    background-color: white;\\n    padding: 15px;\\n    border-radius: 3px;\\n    border: 1px solid black;\\n}\\n\\n/* Toolbar */\\n.toolbar-separator-vertical {\\n    border-bottom: 1px solid black;\\n}\\n\\n.toolbar-separator-horizontal {\\n    border-left: 1px solid black;\\n}\\n\\n.selected-item {\\n    border-style: solid;\\n}\\n\\n.mouse-over {\\n    cursor: pointer;\\n    background: rgb(220, 220, 220);\\n    border-style: solid;\\n    border-color: rgb(160, 160, 160);\\n}\\n\\n/* Begin QuickPlot */\\ndiv.Label {\\n    padding: 5px 0px;\\n}\\n\\ndiv.Ctrl {\\n    padding: 5px 0px;\\n}\\n\\ndiv.Title {\\n    font-size: 14px;\\n    font-weight: bold;\\n    padding: 10px 0px;\\n}\\n\\ndiv.HPlaceholder5px {\\n    font-size: 0px;\\n    height: 5px;\\n}\\n\\ndiv.ButtonContainer {\\n    padding: 5px 0px;\\n    text-align: right;\\n}\\n\\n.FixWidth {\\n    width: 100%;\\n}\\n\\ndiv.InfoText {\\n    padding: 3px;\\n    background-color: #FFFFCC;\\n    color: #666666;\\n    font-family: Arial, Helvetica, sans-serif;\\n    font-size: 8pt;\\n}\\n\\n/* End QuickPlot */\\n\\n.field,\\n.field-label {\\n    display: block;\\n}\\n\\n/*\\n.error-display {\\n    color: #ffffff;\\n    background-color: #ff0000;\\n    font-size: 0.8em;\\n}\\n\\n.error-header {\\n    font-weight: bold;\\n}\\n*/\\n.error-stack {\\n    text-decoration: none;\\n}\\n\\n.modal-dialog-header {\\n    font-weight: bold;\\n    padding: 5px;\\n    font-size: 1.1em;\\n    background-color: #cdcdcd;\\n    border-bottom: 1px solid black;\\n}\\n\\n.modal-dialog-body {\\n    padding: 0px;\\n}\\n\\n.context-menu-item-disabled {\\n    opacity: 0.4;\\n    cursor: none;\\n}\\n\\n/* https://gist.github.com/aiboy/7406727 */\\n.rotated-text {\\n    display: inline-block;\\n    overflow: hidden;\\n    width: 1.5em;\\n}\\n\\n.rotated-text-ccw {\\n    -webkit-transform: rotate(-90deg);\\n    -moz-transform: rotate(-90deg);\\n    -ms-transform: rotate(-90deg);\\n    -o-transform: rotate(-90deg);\\n    transform: rotate(-90deg);\\n\\n    /* also accepts left, right, top, bottom coordinates; not required, but a good idea for styling */\\n    -webkit-transform-origin: 50% 50%;\\n    -moz-transform-origin: 50% 50%;\\n    -ms-transform-origin: 50% 50%;\\n    -o-transform-origin: 50% 50%;\\n    transform-origin: 50% 50%;\\n\\n    /* Should be unset in IE9+ I think. */\\n    filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);\\n}\\n\\n.rotated-text__inner {\\n    display: inline-block;\\n    white-space: nowrap;\\n}\\n\\n.rotated-text__inner:before {\\n    content: \\\"\\\";\\n    float: left;\\n    margin-top: 100%;\\n}\\n\\n.noselect {\\n    -webkit-touch-callout: none;\\n    /* iOS Safari */\\n    -webkit-user-select: none;\\n    /* Chrome/Safari/Opera */\\n    -khtml-user-select: none;\\n    /* Konqueror */\\n    -moz-user-select: none;\\n    /* Firefox */\\n    -ms-user-select: none;\\n    /* Internet Explorer/Edge */\\n    user-select: none;\\n    /* Non-prefixed version, currently\\n                                    not supported by any browser */\\n}\\n\\n.component-about-dialog-content {\\n    padding: 5px;\\n}\\n\\n.component-session-expired {\\n    padding: 5px;\\n}\\n\\n.component-measure {\\n    padding: 5px;\\n}\\n\\n.component-quick-plot {\\n    padding: 5px;\\n}\\n\\n.component-viewer-options {\\n    padding: 5px;\\n}\\n\\n.component-mouse-coordinates,\\n.component-selected-feature-count,\\n.component-view-size {\\n    padding: 3px;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n    font-size: 8pt;\\n}\\n\\n.component-scale-display {\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n    font-size: 8pt;\\n}\\n\\n.component-scale-display .scale-input {\\n    margin: 0;\\n    padding: 0;\\n}\\n\\n.feature-tooltip {\\n    position: relative;\\n    background: rgb(255, 255, 153);\\n    border-radius: 4px;\\n    color: black;\\n    padding: 4px 8px;\\n    white-space: nowrap;\\n    font-size: 8pt;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.selected-tooltip {\\n    position: relative;\\n    background: rgb(255, 255, 255);\\n    border-radius: 4px;\\n    border: 1px solid black;\\n    color: black;\\n    padding: 4px 8px;\\n    white-space: nowrap;\\n    font-size: 8pt;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.selected-popup-header {\\n    min-width: 190px;\\n}\\n.selected-popup-header div {\\n    float: left;\\n    font-weight: bold;\\n    font-size: 1.3em;\\n    margin-right: 5px;\\n}\\n.selected-popup-header .closer {\\n    float: right;\\n}\\n.selected-popup-header .clearit {\\n    clear: both;\\n}\\n\\n.selected-popup-content-wrapper {\\n    clear: both;\\n    margin-top: 25px;\\n    max-height: 300px;\\n    overflow: auto;\\n}\\n\\n.selected-popup-cluster-table {\\n    border-collapse: collapse;\\n}\\n\\n.selected-popup-content-none {\\n    clear: both;\\n    margin-top: 20px;\\n}\\n\\n.select-popup-single-link-wrapper {\\n    margin-top: 20px;\\n}\\n\\n.selected-popup-single-properties-table {\\n    max-width: 400px;\\n}\\n\\n.selected-popup-single-properties-table th,\\n.selected-popup-single-properties-table td {\\n    text-align: left;\\n}\\n\\n.selected-popup-single-properties-table .property-name-cell {\\n    font-weight: bold;\\n}\\n\\n.selected-popup-single-properties-table .property-value-cell {\\n    font-weight: none;\\n}\\n\\n.tooltip-hidden {\\n    display: none;\\n}\\n\\n.tooltip {\\n    position: relative;\\n    background: rgba(0, 0, 0, 0.9);\\n    border-radius: 4px;\\n    color: white;\\n    padding: 4px 8px;\\n    opacity: 0.7;\\n    white-space: nowrap;\\n    font-size: 8pt;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.tooltip-measure {\\n    opacity: 1;\\n    font-weight: bold;\\n}\\n\\n.tooltip-static {\\n    background-color: #ffcc33;\\n    color: black;\\n    border: 1px solid white;\\n}\\n\\n.tooltip-measure:before,\\n.tooltip-static:before {\\n    border-top: 6px solid rgba(0, 0, 0, 0.5);\\n    border-right: 6px solid transparent;\\n    border-left: 6px solid transparent;\\n    content: \\\"\\\";\\n    position: absolute;\\n    bottom: -6px;\\n    margin-left: -7px;\\n    left: 50%;\\n}\\n\\n.tooltip-static:before {\\n    border-top-color: #ffcc33;\\n}\\n\\n.component-navigator {\\n    position: absolute;\\n    width: 51px;\\n    height: 204px;\\n    z-index: 1000;\\n    cursor: pointer;\\n    right: 10px;\\n    top: 10px;\\n}\\n\\n.wms-layer-info-tooltip p {\\n    max-width: 250px;\\n    word-wrap: break-word;\\n}\\n\\n.bp3-dark {\\n    background-color: #30404d;\\n}\\n\\n.colorpicker {\\n    position: relative;\\n    width: 100%;\\n    height: 13em;\\n    background-color: #fff;\\n    border: 1px solid rgba(0, 0, 0, 0.2);\\n    border-radius: 0.25em;\\n    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);\\n}\\n\\n.map {\\n    position: absolute;\\n    top: 1em;\\n    bottom: 1em;\\n    right: 2em;\\n    left: 1em;\\n    overflow: hidden;\\n    user-select: none;\\n    border-radius: 0.25em;\\n}\\n\\n.map.active {\\n    cursor: none;\\n}\\n\\n.map.dark .pointer {\\n    border-color: #fff;\\n}\\n\\n.map.light .pointer {\\n    border-color: #000;\\n}\\n\\n.map .pointer {\\n    position: absolute;\\n    width: 10px;\\n    height: 10px;\\n    margin-left: -5px;\\n    margin-bottom: -5px;\\n    border-radius: 100%;\\n    border: 1px solid #000;\\n    will-change: left, bottom;\\n}\\n\\n.map .background {\\n    top: 0;\\n    left: 0;\\n    position: absolute;\\n    height: 100%;\\n    width: 100%;\\n}\\n\\n.map .background:before,\\n.map .background:after {\\n    display: block;\\n    content: '';\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    bottom: 0;\\n    right: 0;\\n}\\n\\n.map .background:after {\\n    background: linear-gradient(to bottom, transparent 0%, black 100%);\\n}\\n\\n.map .background:before {\\n    background: linear-gradient(to right, white 0%, rgba(255, 255, 255, 0) 100%);\\n}\\n\\n.slider {\\n    position: absolute;\\n    user-select: none;\\n}\\n\\n.slider.vertical {\\n    top: 0;\\n    bottom: 0;\\n    left: 50%;\\n    width: 10px;\\n    cursor: ns-resize;\\n}\\n\\n.slider.vertical .track {\\n    position: absolute;\\n    top: 0;\\n    bottom: 0;\\n    left: 50%;\\n    width: 8px;\\n    margin-left: -4px;\\n}\\n\\n.slider.horizontal {\\n    left: 0;\\n    right: 0;\\n    top: 50%;\\n    height: 10px;\\n    cursor: ew-resize;\\n}\\n\\n.slider.horizontal .track {\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    top: 50%;\\n    height: 8px;\\n    margin-top: -4px;\\n}\\n\\n.slider .track {\\n    border-radius: 3px;\\n    background: #888;\\n}\\n\\n.slider .pointer {\\n    position: absolute;\\n    bottom: 50%;\\n    left: 50%;\\n    width: 16px;\\n    height: 16px;\\n    margin-left: -8px;\\n    margin-bottom: -8px;\\n    border-radius: 16px;\\n    background: #fff;\\n    box-shadow: inset 0 0 0 1px #ccc, 0 1px 2px #ccc;\\n    will-change: left, bottom;\\n}\\n\\n.hue-slider {\\n    position: absolute;\\n    top: 1em;\\n    bottom: 1em;\\n    right: 1.3em;\\n}\\n\\n.hue-slider .track {\\n    background: linear-gradient(to bottom, #FF0000 0%, #FF0099 10%, #CD00FF 20%, #3200FF 30%, #0066FF 40%, #00FFFD 50%, #00FF66 60%, #35FF00 70%, #CDFF00 80%, #FF9900 90%, #FF0000 100%);\\n}\\n\\n.opacity-slider {\\n    position: absolute;\\n    bottom: 1.3em;\\n    left: 1em;\\n    right: 2em;\\n}\\n\\n.opacity-slider .slider {\\n    background: #fff url(\\\"data:image/gif;base64,R0lGODdhEAAQAPEAAMvLy8zMzP///wAAACwAAAAAEAAQAEACHYxvosstCAEMrq6Jj812Y59NIDQipdY5XLWqH4sVADs=\\\") repeat;\\n    background-size: 8px 8px;\\n    height: 8px;\\n}\\n\\n.opacity-slider .slider .track {\\n    height: 8px;\\n    margin-top: -4px;\\n    background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, #FFF 100%);\\n}\\n\\n.with-opacity-slider {\\n    height: 14em;\\n}\\n\\n.with-opacity-slider .map {\\n    bottom: 2em;\\n}\\n\\n.with-opacity-slider .hue-slider {\\n    bottom: 2em;\\n}\\n\\n.react-colorful {\\n    width: 100%;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/styles/index.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"@charset \\\"UTF-8\\\";\\n@import \\\"../../stdassets/sprites/icons.css\\\";\\n/*\\n@import \\\"~ol/ol.css\\\";\\n@import \\\"~@blueprintjs/core/lib/css/blueprint.css\\\";\\n@import \\\"~react-splitter-layout/lib/index.css\\\";\\n*/\\n\\n/* HACK: Clear out any trace of the font icon as HTMLSelect should be using the SVG counterpart */\\n.bp3-select:after {\\n    content: \\\"\\\";\\n}\\n\\n.legend-label-highlight-text {\\n    background-color: yellow;\\n}\\n\\n.mg-toast {\\n    z-index: 120;\\n}\\n\\n.map-viewer-component {\\n    background-color: white;\\n}\\n\\n.iframe-iehack-zindex {\\n    position: absolute;\\n    border: none;\\n    top: 0;\\n    left: 0;\\n    height: 100%;\\n    width: 100%;\\n    z-index: -1;\\n}\\n\\n/* OpenLayers overrides */\\n\\n.ol-attribution {\\n    right: 10px;\\n    bottom: 52px;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.ol-rotate {\\n    top: auto;\\n    right: 10px;\\n    bottom: 25px;\\n}\\n\\n.ol-rotate button {\\n    bottom: 1px;\\n    left: auto;\\n    right: 1px;\\n    top: auto;\\n}\\n\\n.ol-custom-overviewmap,\\n.ol-custom-overviewmap.ol-uncollapsible {\\n    bottom: 79px;\\n    left: auto;\\n    right: 10px;\\n    top: auto;\\n}\\n\\n.ol-custom-overviewmap:not(.ol-collapsed) {\\n    border: 1px solid black;\\n}\\n\\n.ol-custom-overviewmap .ol-overviewmap-map {\\n    border: none;\\n}\\n\\n.ol-custom-overviewmap .ol-overviewmap-box {\\n    border: 2px solid red;\\n}\\n\\n.ol-custom-overviewmap:not(.ol-collapsed) button {\\n    bottom: 1px;\\n    left: auto;\\n    right: 1px;\\n    top: auto;\\n}\\n\\n/* Accordion */\\n.component-accordion-panel-header {\\n    padding: 3px;\\n    cursor: pointer;\\n}\\n\\n/* Selection Panel */\\n\\n.selection-panel-property-grid {\\n    width: 100%;\\n}\\n\\n.selection-panel-layer-selector {\\n    max-width: 180px;\\n}\\n\\n.selection-panel-layer-selector select {\\n    max-width: 143px;\\n}\\n\\n/* Modal Dialogs */\\n\\n.modal-dialog {\\n    background: #fff;\\n    border: 1px solid black;\\n    border-radius: 3px;\\n    position: absolute;\\n    transform: translate(-50%, -50%);\\n    z-index: 4999;\\n}\\n\\n.modal-dialog-header {\\n    border-top-left-radius: 3px;\\n    border-top-right-radius: 3px;\\n}\\n\\n.modal-dialog-body {\\n    border-bottom-left-radius: 3px;\\n    border-bottom-right-radius: 3px;\\n    padding-bottom: 3px;\\n}\\n\\n.modal-dialog-backdrop {\\n    position: absolute;\\n    width: 100%;\\n    height: 100%;\\n    top: 0px;\\n    left: 0px;\\n    z-index: 4998;\\n    background: rgba(0, 0, 0, 0.3);\\n}\\n\\n.mg-flyout-menu-container {\\n    position: absolute;\\n}\\n\\n.mg-flyout-component-container {\\n    position: absolute;\\n    background-color: white;\\n    padding: 15px;\\n    border-radius: 3px;\\n    border: 1px solid black;\\n}\\n\\n/* Toolbar */\\n.toolbar-separator-vertical {\\n    border-bottom: 1px solid black;\\n}\\n\\n.toolbar-separator-horizontal {\\n    border-left: 1px solid black;\\n}\\n\\n.selected-item {\\n    border-style: solid;\\n}\\n\\n.mouse-over {\\n    cursor: pointer;\\n    background: rgb(220, 220, 220);\\n    border-style: solid;\\n    border-color: rgb(160, 160, 160);\\n}\\n\\n/* Begin QuickPlot */\\ndiv.Label {\\n    padding: 5px 0px;\\n}\\n\\ndiv.Ctrl {\\n    padding: 5px 0px;\\n}\\n\\ndiv.Title {\\n    font-size: 14px;\\n    font-weight: bold;\\n    padding: 10px 0px;\\n}\\n\\ndiv.HPlaceholder5px {\\n    font-size: 0px;\\n    height: 5px;\\n}\\n\\ndiv.ButtonContainer {\\n    padding: 5px 0px;\\n    text-align: right;\\n}\\n\\n.FixWidth {\\n    width: 100%;\\n}\\n\\ndiv.InfoText {\\n    padding: 3px;\\n    background-color: #FFFFCC;\\n    color: #666666;\\n    font-family: Arial, Helvetica, sans-serif;\\n    font-size: 8pt;\\n}\\n\\n/* End QuickPlot */\\n\\n.field,\\n.field-label {\\n    display: block;\\n}\\n\\n/*\\n.error-display {\\n    color: #ffffff;\\n    background-color: #ff0000;\\n    font-size: 0.8em;\\n}\\n\\n.error-header {\\n    font-weight: bold;\\n}\\n*/\\n.error-stack {\\n    text-decoration: none;\\n}\\n\\n.modal-dialog-header {\\n    font-weight: bold;\\n    padding: 5px;\\n    font-size: 1.1em;\\n    background-color: #cdcdcd;\\n    border-bottom: 1px solid black;\\n}\\n\\n.modal-dialog-body {\\n    padding: 0px;\\n}\\n\\n.context-menu-item-disabled {\\n    opacity: 0.4;\\n    cursor: none;\\n}\\n\\n/* https://gist.github.com/aiboy/7406727 */\\n.rotated-text {\\n    display: inline-block;\\n    overflow: hidden;\\n    width: 1.5em;\\n}\\n\\n.rotated-text-ccw {\\n    -webkit-transform: rotate(-90deg);\\n    -moz-transform: rotate(-90deg);\\n    -ms-transform: rotate(-90deg);\\n    -o-transform: rotate(-90deg);\\n    transform: rotate(-90deg);\\n\\n    /* also accepts left, right, top, bottom coordinates; not required, but a good idea for styling */\\n    -webkit-transform-origin: 50% 50%;\\n    -moz-transform-origin: 50% 50%;\\n    -ms-transform-origin: 50% 50%;\\n    -o-transform-origin: 50% 50%;\\n    transform-origin: 50% 50%;\\n\\n    /* Should be unset in IE9+ I think. */\\n    filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);\\n}\\n\\n.rotated-text__inner {\\n    display: inline-block;\\n    white-space: nowrap;\\n}\\n\\n.rotated-text__inner:before {\\n    content: \\\"\\\";\\n    float: left;\\n    margin-top: 100%;\\n}\\n\\n.noselect {\\n    -webkit-touch-callout: none;\\n    /* iOS Safari */\\n    -webkit-user-select: none;\\n    /* Chrome/Safari/Opera */\\n    -khtml-user-select: none;\\n    /* Konqueror */\\n    -moz-user-select: none;\\n    /* Firefox */\\n    -ms-user-select: none;\\n    /* Internet Explorer/Edge */\\n    user-select: none;\\n    /* Non-prefixed version, currently\\n                                    not supported by any browser */\\n}\\n\\n.component-about-dialog-content {\\n    padding: 5px;\\n}\\n\\n.component-session-expired {\\n    padding: 5px;\\n}\\n\\n.component-measure {\\n    padding: 5px;\\n}\\n\\n.component-quick-plot {\\n    padding: 5px;\\n}\\n\\n.component-viewer-options {\\n    padding: 5px;\\n}\\n\\n.component-mouse-coordinates,\\n.component-selected-feature-count,\\n.component-view-size {\\n    padding: 3px;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n    font-size: 8pt;\\n}\\n\\n.component-scale-display {\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n    font-size: 8pt;\\n}\\n\\n.component-scale-display .scale-input {\\n    margin: 0;\\n    padding: 0;\\n}\\n\\n.feature-tooltip {\\n    position: relative;\\n    background: rgb(255, 255, 153);\\n    border-radius: 4px;\\n    color: black;\\n    padding: 4px 8px;\\n    white-space: nowrap;\\n    font-size: 8pt;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.selected-tooltip {\\n    position: relative;\\n    background: rgb(255, 255, 255);\\n    border-radius: 4px;\\n    border: 1px solid black;\\n    color: black;\\n    padding: 4px 8px;\\n    white-space: nowrap;\\n    font-size: 8pt;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.selected-popup-header {\\n    min-width: 190px;\\n}\\n.selected-popup-header div {\\n    float: left;\\n    font-weight: bold;\\n    font-size: 1.3em;\\n    margin-right: 5px;\\n}\\n.selected-popup-header .closer {\\n    float: right;\\n}\\n.selected-popup-header .clearit {\\n    clear: both;\\n}\\n\\n.selected-popup-content-wrapper {\\n    clear: both;\\n    margin-top: 25px;\\n    max-height: 300px;\\n    overflow: auto;\\n}\\n\\n.selected-popup-cluster-table {\\n    border-collapse: collapse;\\n}\\n\\n.selected-popup-content-none {\\n    clear: both;\\n    margin-top: 20px;\\n}\\n\\n.select-popup-single-link-wrapper {\\n    margin-top: 20px;\\n}\\n\\n.selected-popup-single-properties-table {\\n    max-width: 400px;\\n}\\n\\n.selected-popup-single-properties-table th,\\n.selected-popup-single-properties-table td {\\n    text-align: left;\\n}\\n\\n.selected-popup-single-properties-table .property-name-cell {\\n    font-weight: bold;\\n}\\n\\n.selected-popup-single-properties-table .property-value-cell {\\n    font-weight: none;\\n}\\n\\n.tooltip-hidden {\\n    display: none;\\n}\\n\\n.tooltip {\\n    position: relative;\\n    background: rgba(0, 0, 0, 0.9);\\n    border-radius: 4px;\\n    color: white;\\n    padding: 4px 8px;\\n    opacity: 0.7;\\n    white-space: nowrap;\\n    font-size: 8pt;\\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\\n}\\n\\n.tooltip-measure {\\n    opacity: 1;\\n    font-weight: bold;\\n}\\n\\n.tooltip-static {\\n    background-color: #ffcc33;\\n    color: black;\\n    border: 1px solid white;\\n}\\n\\n.tooltip-measure:before,\\n.tooltip-static:before {\\n    border-top: 6px solid rgba(0, 0, 0, 0.5);\\n    border-right: 6px solid transparent;\\n    border-left: 6px solid transparent;\\n    content: \\\"\\\";\\n    position: absolute;\\n    bottom: -6px;\\n    margin-left: -7px;\\n    left: 50%;\\n}\\n\\n.tooltip-static:before {\\n    border-top-color: #ffcc33;\\n}\\n\\n.component-navigator {\\n    position: absolute;\\n    width: 51px;\\n    height: 204px;\\n    z-index: 1000;\\n    cursor: pointer;\\n    right: 10px;\\n    top: 10px;\\n}\\n\\n.wms-layer-info-tooltip p {\\n    max-width: 250px;\\n    word-wrap: break-word;\\n}\\n\\n.bp3-dark {\\n    background-color: #30404d;\\n}\\n\\n.colorpicker {\\n    position: relative;\\n    width: 100%;\\n    height: 13em;\\n    background-color: #fff;\\n    border: 1px solid rgba(0, 0, 0, 0.2);\\n    border-radius: 0.25em;\\n    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);\\n}\\n\\n.map {\\n    position: absolute;\\n    top: 1em;\\n    bottom: 1em;\\n    right: 2em;\\n    left: 1em;\\n    overflow: hidden;\\n    user-select: none;\\n    border-radius: 0.25em;\\n}\\n\\n.map.active {\\n    cursor: none;\\n}\\n\\n.map.dark .pointer {\\n    border-color: #fff;\\n}\\n\\n.map.light .pointer {\\n    border-color: #000;\\n}\\n\\n.map .pointer {\\n    position: absolute;\\n    width: 10px;\\n    height: 10px;\\n    margin-left: -5px;\\n    margin-bottom: -5px;\\n    border-radius: 100%;\\n    border: 1px solid #000;\\n    will-change: left, bottom;\\n}\\n\\n.map .background {\\n    top: 0;\\n    left: 0;\\n    position: absolute;\\n    height: 100%;\\n    width: 100%;\\n}\\n\\n.map .background:before,\\n.map .background:after {\\n    display: block;\\n    content: '';\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    bottom: 0;\\n    right: 0;\\n}\\n\\n.map .background:after {\\n    background: linear-gradient(to bottom, transparent 0%, black 100%);\\n}\\n\\n.map .background:before {\\n    background: linear-gradient(to right, white 0%, rgba(255, 255, 255, 0) 100%);\\n}\\n\\n.slider {\\n    position: absolute;\\n    user-select: none;\\n}\\n\\n.slider.vertical {\\n    top: 0;\\n    bottom: 0;\\n    left: 50%;\\n    width: 10px;\\n    cursor: ns-resize;\\n}\\n\\n.slider.vertical .track {\\n    position: absolute;\\n    top: 0;\\n    bottom: 0;\\n    left: 50%;\\n    width: 8px;\\n    margin-left: -4px;\\n}\\n\\n.slider.horizontal {\\n    left: 0;\\n    right: 0;\\n    top: 50%;\\n    height: 10px;\\n    cursor: ew-resize;\\n}\\n\\n.slider.horizontal .track {\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    top: 50%;\\n    height: 8px;\\n    margin-top: -4px;\\n}\\n\\n.slider .track {\\n    border-radius: 3px;\\n    background: #888;\\n}\\n\\n.slider .pointer {\\n    position: absolute;\\n    bottom: 50%;\\n    left: 50%;\\n    width: 16px;\\n    height: 16px;\\n    margin-left: -8px;\\n    margin-bottom: -8px;\\n    border-radius: 16px;\\n    background: #fff;\\n    box-shadow: inset 0 0 0 1px #ccc, 0 1px 2px #ccc;\\n    will-change: left, bottom;\\n}\\n\\n.hue-slider {\\n    position: absolute;\\n    top: 1em;\\n    bottom: 1em;\\n    right: 1.3em;\\n}\\n\\n.hue-slider .track {\\n    background: linear-gradient(to bottom, #FF0000 0%, #FF0099 10%, #CD00FF 20%, #3200FF 30%, #0066FF 40%, #00FFFD 50%, #00FF66 60%, #35FF00 70%, #CDFF00 80%, #FF9900 90%, #FF0000 100%);\\n}\\n\\n.opacity-slider {\\n    position: absolute;\\n    bottom: 1.3em;\\n    left: 1em;\\n    right: 2em;\\n}\\n\\n.opacity-slider .slider {\\n    background: #fff url(\\\"data:image/gif;base64,R0lGODdhEAAQAPEAAMvLy8zMzP///wAAACwAAAAAEAAQAEACHYxvosstCAEMrq6Jj812Y59NIDQipdY5XLWqH4sVADs=\\\") repeat;\\n    background-size: 8px 8px;\\n    height: 8px;\\n}\\n\\n.opacity-slider .slider .track {\\n    height: 8px;\\n    margin-top: -4px;\\n    background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, #FFF 100%);\\n}\\n\\n.with-opacity-slider {\\n    height: 14em;\\n}\\n\\n.with-opacity-slider .map {\\n    bottom: 2em;\\n}\\n\\n.with-opacity-slider .hue-slider {\\n    bottom: 2em;\\n}\\n\\n.react-colorful {\\n    width: 100%;\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_GET_URL_IMPORT___ from \"../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/getUrl.js\";\nimport ___CSS_LOADER_URL_IMPORT_0___ from \"./icons.png\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\nvar ___CSS_LOADER_URL_REPLACEMENT_0___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* glue: 0.13 hash: 28fada1b84 */\\n        .PoweredBy_en,\\n.zoom-out-fixed,\\n.zoom-in,\\n.zoom-in-fixed,\\n.zoom-full,\\n.zoom-dynamic,\\n.view-refresh,\\n.view-forward,\\n.view-back,\\n.ui-menu,\\n.toggle,\\n.toggle-expand,\\n.theme,\\n.select,\\n.select-zoom,\\n.select-radius,\\n.select-polygon,\\n.select-features,\\n.select-clear,\\n.select-centre,\\n.search,\\n.redline,\\n.query,\\n.property,\\n.print,\\n.preview,\\n.pan,\\n.pan-west,\\n.pan-south,\\n.pan-north,\\n.pan-east,\\n.overview-map,\\n.out-of-range,\\n.options,\\n.measure,\\n.maptip,\\n.legend-theme,\\n.legend-raster,\\n.legend-map,\\n.legend-layer,\\n.legend-DWF,\\n.lc_unselect,\\n.layer_add,\\n.invoke-url,\\n.invoke-script,\\n.initial-center,\\n.info,\\n.icon_zoomselect,\\n.icon_warning,\\n.icon_select,\\n.icon_refreshmap,\\n.icon_menuarrowup_disabled,\\n.icon_menuarrowup,\\n.icon_menuarrow_disabled,\\n.icon_menuarrow,\\n.icon_home,\\n.icon_error,\\n.iconNavigator,\\n.help,\\n.globe_add,\\n.globe-share,\\n.geolocation,\\n.forward,\\n.folder-horizontal,\\n.folder-horizontal-open,\\n.file-save,\\n.file-print,\\n.feature-info,\\n.edit-xml,\\n.edit-paste,\\n.edit-duplicate,\\n.edit-cut,\\n.edit-copy,\\n.coordinate-tracker,\\n.control,\\n.control-stop,\\n.control-stop-180,\\n.control-180,\\n.buffer,\\n.back,\\n.application-browser,\\n.about {\\n            background-image: url(\" + ___CSS_LOADER_URL_REPLACEMENT_0___ + \");\\n            background-repeat: no-repeat;\\n        }\\n        \\n        .PoweredBy_en {\\n            background-position: 0 0;\\n            width: 136px;\\n            height: 19px;\\n        }\\n        \\n        .zoom-out-fixed {\\n            background-position: 0 -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-in {\\n            background-position: -16px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-in-fixed {\\n            background-position: -32px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-full {\\n            background-position: -48px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-dynamic {\\n            background-position: -64px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .view-refresh {\\n            background-position: -80px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .view-forward {\\n            background-position: -96px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .view-back {\\n            background-position: -112px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .ui-menu {\\n            background-position: 0 -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .toggle {\\n            background-position: -16px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .toggle-expand {\\n            background-position: -32px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .theme {\\n            background-position: -48px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select {\\n            background-position: -64px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-zoom {\\n            background-position: -80px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-radius {\\n            background-position: -96px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-polygon {\\n            background-position: -112px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-features {\\n            background-position: 0 -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-clear {\\n            background-position: -16px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-centre {\\n            background-position: -32px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .search {\\n            background-position: -48px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .redline {\\n            background-position: -64px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .query {\\n            background-position: -80px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .property {\\n            background-position: -96px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .print {\\n            background-position: -112px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .preview {\\n            background-position: 0 -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan {\\n            background-position: -16px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-west {\\n            background-position: -32px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-south {\\n            background-position: -48px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-north {\\n            background-position: -64px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-east {\\n            background-position: -80px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .overview-map {\\n            background-position: -96px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .out-of-range {\\n            background-position: -112px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .options {\\n            background-position: 0 -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .measure {\\n            background-position: -16px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .maptip {\\n            background-position: -32px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-theme {\\n            background-position: -48px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-raster {\\n            background-position: -64px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-map {\\n            background-position: -80px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-layer {\\n            background-position: -96px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-DWF {\\n            background-position: -112px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .lc_unselect {\\n            background-position: 0 -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .layer_add {\\n            background-position: -16px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .invoke-url {\\n            background-position: -32px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .invoke-script {\\n            background-position: -48px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .initial-center {\\n            background-position: -64px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .info {\\n            background-position: -80px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_zoomselect {\\n            background-position: -96px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_warning {\\n            background-position: -112px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_select {\\n            background-position: 0 -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_refreshmap {\\n            background-position: -16px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrowup_disabled {\\n            background-position: -32px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrowup {\\n            background-position: -48px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrow_disabled {\\n            background-position: -64px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrow {\\n            background-position: -80px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_home {\\n            background-position: -96px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_error {\\n            background-position: -112px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .iconNavigator {\\n            background-position: -136px 0;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .help {\\n            background-position: -136px -16px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .globe_add {\\n            background-position: -136px -32px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .globe-share {\\n            background-position: -136px -48px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .geolocation {\\n            background-position: -136px -64px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .forward {\\n            background-position: -136px -80px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .folder-horizontal {\\n            background-position: -136px -96px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .folder-horizontal-open {\\n            background-position: -136px -112px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .file-save {\\n            background-position: 0 -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .file-print {\\n            background-position: -16px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .feature-info {\\n            background-position: -32px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-xml {\\n            background-position: -48px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-paste {\\n            background-position: -64px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-duplicate {\\n            background-position: -80px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-cut {\\n            background-position: -96px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-copy {\\n            background-position: -112px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .coordinate-tracker {\\n            background-position: -128px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control {\\n            background-position: -152px 0;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control-stop {\\n            background-position: -152px -16px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control-stop-180 {\\n            background-position: -152px -32px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control-180 {\\n            background-position: -152px -48px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .buffer {\\n            background-position: -152px -64px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .back {\\n            background-position: -152px -80px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .application-browser {\\n            background-position: -152px -96px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .about {\\n            background-position: -152px -112px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        @media screen and (-webkit-min-device-pixel-ratio: 1.0), screen and (min--moz-device-pixel-ratio: 1.0), screen and (-o-min-device-pixel-ratio: 100/100), screen and (min-device-pixel-ratio: 1.0), screen and (min-resolution: 1.0dppx) {\\n            .PoweredBy_en,\\n    .zoom-out-fixed,\\n    .zoom-in,\\n    .zoom-in-fixed,\\n    .zoom-full,\\n    .zoom-dynamic,\\n    .view-refresh,\\n    .view-forward,\\n    .view-back,\\n    .ui-menu,\\n    .toggle,\\n    .toggle-expand,\\n    .theme,\\n    .select,\\n    .select-zoom,\\n    .select-radius,\\n    .select-polygon,\\n    .select-features,\\n    .select-clear,\\n    .select-centre,\\n    .search,\\n    .redline,\\n    .query,\\n    .property,\\n    .print,\\n    .preview,\\n    .pan,\\n    .pan-west,\\n    .pan-south,\\n    .pan-north,\\n    .pan-east,\\n    .overview-map,\\n    .out-of-range,\\n    .options,\\n    .measure,\\n    .maptip,\\n    .legend-theme,\\n    .legend-raster,\\n    .legend-map,\\n    .legend-layer,\\n    .legend-DWF,\\n    .lc_unselect,\\n    .layer_add,\\n    .invoke-url,\\n    .invoke-script,\\n    .initial-center,\\n    .info,\\n    .icon_zoomselect,\\n    .icon_warning,\\n    .icon_select,\\n    .icon_refreshmap,\\n    .icon_menuarrowup_disabled,\\n    .icon_menuarrowup,\\n    .icon_menuarrow_disabled,\\n    .icon_menuarrow,\\n    .icon_home,\\n    .icon_error,\\n    .iconNavigator,\\n    .help,\\n    .globe_add,\\n    .globe-share,\\n    .geolocation,\\n    .forward,\\n    .folder-horizontal,\\n    .folder-horizontal-open,\\n    .file-save,\\n    .file-print,\\n    .feature-info,\\n    .edit-xml,\\n    .edit-paste,\\n    .edit-duplicate,\\n    .edit-cut,\\n    .edit-copy,\\n    .coordinate-tracker,\\n    .control,\\n    .control-stop,\\n    .control-stop-180,\\n    .control-180,\\n    .buffer,\\n    .back,\\n    .application-browser,\\n    .about {\\n                background-image: url(\" + ___CSS_LOADER_URL_REPLACEMENT_0___ + \");\\n                -webkit-background-size: 168px 147px;\\n                -moz-background-size: 168px 147px;\\n                background-size: 168px 147px;\\n            }\\n        }\\n        \", \"\",{\"version\":3,\"sources\":[\"webpack://./stdassets/sprites/icons.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"/* glue: 0.13 hash: 28fada1b84 */\\n        .PoweredBy_en,\\n.zoom-out-fixed,\\n.zoom-in,\\n.zoom-in-fixed,\\n.zoom-full,\\n.zoom-dynamic,\\n.view-refresh,\\n.view-forward,\\n.view-back,\\n.ui-menu,\\n.toggle,\\n.toggle-expand,\\n.theme,\\n.select,\\n.select-zoom,\\n.select-radius,\\n.select-polygon,\\n.select-features,\\n.select-clear,\\n.select-centre,\\n.search,\\n.redline,\\n.query,\\n.property,\\n.print,\\n.preview,\\n.pan,\\n.pan-west,\\n.pan-south,\\n.pan-north,\\n.pan-east,\\n.overview-map,\\n.out-of-range,\\n.options,\\n.measure,\\n.maptip,\\n.legend-theme,\\n.legend-raster,\\n.legend-map,\\n.legend-layer,\\n.legend-DWF,\\n.lc_unselect,\\n.layer_add,\\n.invoke-url,\\n.invoke-script,\\n.initial-center,\\n.info,\\n.icon_zoomselect,\\n.icon_warning,\\n.icon_select,\\n.icon_refreshmap,\\n.icon_menuarrowup_disabled,\\n.icon_menuarrowup,\\n.icon_menuarrow_disabled,\\n.icon_menuarrow,\\n.icon_home,\\n.icon_error,\\n.iconNavigator,\\n.help,\\n.globe_add,\\n.globe-share,\\n.geolocation,\\n.forward,\\n.folder-horizontal,\\n.folder-horizontal-open,\\n.file-save,\\n.file-print,\\n.feature-info,\\n.edit-xml,\\n.edit-paste,\\n.edit-duplicate,\\n.edit-cut,\\n.edit-copy,\\n.coordinate-tracker,\\n.control,\\n.control-stop,\\n.control-stop-180,\\n.control-180,\\n.buffer,\\n.back,\\n.application-browser,\\n.about {\\n            background-image: url('icons.png');\\n            background-repeat: no-repeat;\\n        }\\n        \\n        .PoweredBy_en {\\n            background-position: 0 0;\\n            width: 136px;\\n            height: 19px;\\n        }\\n        \\n        .zoom-out-fixed {\\n            background-position: 0 -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-in {\\n            background-position: -16px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-in-fixed {\\n            background-position: -32px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-full {\\n            background-position: -48px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .zoom-dynamic {\\n            background-position: -64px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .view-refresh {\\n            background-position: -80px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .view-forward {\\n            background-position: -96px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .view-back {\\n            background-position: -112px -19px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .ui-menu {\\n            background-position: 0 -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .toggle {\\n            background-position: -16px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .toggle-expand {\\n            background-position: -32px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .theme {\\n            background-position: -48px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select {\\n            background-position: -64px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-zoom {\\n            background-position: -80px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-radius {\\n            background-position: -96px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-polygon {\\n            background-position: -112px -35px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-features {\\n            background-position: 0 -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-clear {\\n            background-position: -16px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .select-centre {\\n            background-position: -32px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .search {\\n            background-position: -48px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .redline {\\n            background-position: -64px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .query {\\n            background-position: -80px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .property {\\n            background-position: -96px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .print {\\n            background-position: -112px -51px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .preview {\\n            background-position: 0 -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan {\\n            background-position: -16px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-west {\\n            background-position: -32px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-south {\\n            background-position: -48px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-north {\\n            background-position: -64px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .pan-east {\\n            background-position: -80px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .overview-map {\\n            background-position: -96px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .out-of-range {\\n            background-position: -112px -67px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .options {\\n            background-position: 0 -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .measure {\\n            background-position: -16px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .maptip {\\n            background-position: -32px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-theme {\\n            background-position: -48px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-raster {\\n            background-position: -64px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-map {\\n            background-position: -80px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-layer {\\n            background-position: -96px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .legend-DWF {\\n            background-position: -112px -83px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .lc_unselect {\\n            background-position: 0 -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .layer_add {\\n            background-position: -16px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .invoke-url {\\n            background-position: -32px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .invoke-script {\\n            background-position: -48px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .initial-center {\\n            background-position: -64px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .info {\\n            background-position: -80px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_zoomselect {\\n            background-position: -96px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_warning {\\n            background-position: -112px -99px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_select {\\n            background-position: 0 -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_refreshmap {\\n            background-position: -16px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrowup_disabled {\\n            background-position: -32px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrowup {\\n            background-position: -48px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrow_disabled {\\n            background-position: -64px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_menuarrow {\\n            background-position: -80px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_home {\\n            background-position: -96px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .icon_error {\\n            background-position: -112px -115px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .iconNavigator {\\n            background-position: -136px 0;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .help {\\n            background-position: -136px -16px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .globe_add {\\n            background-position: -136px -32px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .globe-share {\\n            background-position: -136px -48px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .geolocation {\\n            background-position: -136px -64px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .forward {\\n            background-position: -136px -80px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .folder-horizontal {\\n            background-position: -136px -96px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .folder-horizontal-open {\\n            background-position: -136px -112px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .file-save {\\n            background-position: 0 -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .file-print {\\n            background-position: -16px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .feature-info {\\n            background-position: -32px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-xml {\\n            background-position: -48px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-paste {\\n            background-position: -64px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-duplicate {\\n            background-position: -80px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-cut {\\n            background-position: -96px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .edit-copy {\\n            background-position: -112px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .coordinate-tracker {\\n            background-position: -128px -131px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control {\\n            background-position: -152px 0;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control-stop {\\n            background-position: -152px -16px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control-stop-180 {\\n            background-position: -152px -32px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .control-180 {\\n            background-position: -152px -48px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .buffer {\\n            background-position: -152px -64px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .back {\\n            background-position: -152px -80px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .application-browser {\\n            background-position: -152px -96px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        .about {\\n            background-position: -152px -112px;\\n            width: 16px;\\n            height: 16px;\\n        }\\n        \\n        @media screen and (-webkit-min-device-pixel-ratio: 1.0), screen and (min--moz-device-pixel-ratio: 1.0), screen and (-o-min-device-pixel-ratio: 100/100), screen and (min-device-pixel-ratio: 1.0), screen and (min-resolution: 1.0dppx) {\\n            .PoweredBy_en,\\n    .zoom-out-fixed,\\n    .zoom-in,\\n    .zoom-in-fixed,\\n    .zoom-full,\\n    .zoom-dynamic,\\n    .view-refresh,\\n    .view-forward,\\n    .view-back,\\n    .ui-menu,\\n    .toggle,\\n    .toggle-expand,\\n    .theme,\\n    .select,\\n    .select-zoom,\\n    .select-radius,\\n    .select-polygon,\\n    .select-features,\\n    .select-clear,\\n    .select-centre,\\n    .search,\\n    .redline,\\n    .query,\\n    .property,\\n    .print,\\n    .preview,\\n    .pan,\\n    .pan-west,\\n    .pan-south,\\n    .pan-north,\\n    .pan-east,\\n    .overview-map,\\n    .out-of-range,\\n    .options,\\n    .measure,\\n    .maptip,\\n    .legend-theme,\\n    .legend-raster,\\n    .legend-map,\\n    .legend-layer,\\n    .legend-DWF,\\n    .lc_unselect,\\n    .layer_add,\\n    .invoke-url,\\n    .invoke-script,\\n    .initial-center,\\n    .info,\\n    .icon_zoomselect,\\n    .icon_warning,\\n    .icon_select,\\n    .icon_refreshmap,\\n    .icon_menuarrowup_disabled,\\n    .icon_menuarrowup,\\n    .icon_menuarrow_disabled,\\n    .icon_menuarrow,\\n    .icon_home,\\n    .icon_error,\\n    .iconNavigator,\\n    .help,\\n    .globe_add,\\n    .globe-share,\\n    .geolocation,\\n    .forward,\\n    .folder-horizontal,\\n    .folder-horizontal-open,\\n    .file-save,\\n    .file-print,\\n    .feature-info,\\n    .edit-xml,\\n    .edit-paste,\\n    .edit-duplicate,\\n    .edit-cut,\\n    .edit-copy,\\n    .coordinate-tracker,\\n    .control,\\n    .control-stop,\\n    .control-stop-180,\\n    .control-180,\\n    .buffer,\\n    .back,\\n    .application-browser,\\n    .about {\\n                background-image: url('icons.png');\\n                -webkit-background-size: 168px 147px;\\n                -moz-background-size: 168px 147px;\\n                background-size: 168px 147px;\\n            }\\n        }\\n        \"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import api from \"!../../../node_modules/@storybook/builder-webpack5/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[3].use[1]!./accordion-slate.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import api from \"!../../node_modules/@storybook/builder-webpack5/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[3].use[1]!./index.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","var map = {\n\t\"./1.map.stories.tsx\": 75876,\n\t\"./2.common.stories.tsx\": 63914,\n\t\"./3.accordion.stories.tsx\": 42516\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 61568;"],"names":["require","configure","module","parameters","actions","argTypesRegex","controls","matchers","color","date","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_defineProperty","obj","key","value","defineProperty","configurable","writable","config","forEach","logger","JSON","stringify","decorator","addDecorator","loader","addLoader","addParameters","_objectSpread","target","i","arguments","length","source","getOwnPropertyDescriptors","defineProperties","enhancer","addArgTypesEnhancer","addArgsEnhancer","setGlobalRender","v","console","log","GenericSubjectLayerType","isGenericSubjectMapLayer","map","type","openContextMenu","position","ActionType","CONTEXT_MENU_OPEN","payload","closeContextMenu","CONTEXT_MENU_CLOSE","openFlyout","id","metrics","FLYOUT_OPEN","flyoutId","closeFlyout","FLYOUT_CLOSE","openComponent","name","props","COMPONENT_OPEN","closeComponent","COMPONENT_CLOSE","tryExtractMapMetadata","extension","ext","k","strStartsWith","substring","buildSubjectLayerDefn","st","Extension","source_type","initiallyVisible","initially_visible","sp","lo","meta","popupTemplate","popup_template","selectable","is_selectable","spidx","indexOf","loidx","midx","sl","description","layer_description","displayName","display_name","driverName","driver_name","layerOptions","sourceParams","undefined","vectorStyle","vector_layer_style","cluster","getMapDefinitionsFromFlexLayout","appDef","maps","configs","getMapGuideConfiguration","MapSet","MapGroup","mg","Map","Type","c","mapDef","ResourceId","metadata","mGroup","MgError","isStateless","Stateless","e","dispatch","initLocaleAsync","options","locale","DEFAULT_LOCALE","fetch","r","ok","json","res","registerStringBundle","this","SET_LOCALE","info","warn","getExtraProjectionsFromFlexLayout","epsgs","WidgetSet","Widget","w","Projection","p","split","dp","DisplayProjection","makeUnique","initFromAppDefCoreAsync","mapsByName","warnings","parseWidgetsInAppDef","registerCommand","taskPane","hasTaskBar","hasStatus","hasNavigator","hasSelectionPanel","hasLegend","viewSize","widgetsByKey","initialTask","featureTooltipsEnabled","tbConf","widgetSet","Container","cont","tbName","Name","items","convertFlexLayoutUIItems","Item","coordinateProjection","coordinateDecimals","Precision","coordinateDisplayFormat","Template","mapsDict","setupMaps","Title","document","title","establishInitialMapNameAndSession","firstMapName","firstSessionId","prepareSubMenus","tb","tr","containerName","WEBLAYOUT_CONTEXTMENU","normalizeInitPayload","activeMapName","initialUrl","ensureParameters","capabilities","hasTaskPane","hasStatusBar","hasToolbar","hasViewSize","toolbars","initialActiveTool","ActiveMapTool","Pan","layout","ViewerInitCommand","attachClient","client","mapName","isRuntimeMap","SessionId","getDesiredTargetMapName","lastSlash","lastIndexOf","lastDot","shortid","generate","initFromWebLayoutAsync","webLayout","session","sessionWasReused","createRuntimeMapsAsync","wl","cmdsByKey","parseCommandsInWebLayout","mainToolbar","ToolBar","Visible","convertWebLayoutUIItems","Button","taskBar","TaskPane","TaskBar","MenuButton","contextMenu","ContextMenu","MenuItem","SelectionColor","selectionColor","MapImageFormat","imageFormat","SelectionImageFormat","selectionImageFormat","PointSelectionBuffer","pointSelectionBuffer","InitialView","x","CenterX","y","CenterY","scale","Scale","menus","WEBLAYOUT_TOOLBAR","WEBLAYOUT_TASKMENU","InitialTask","initialTaskPaneWidth","Width","initialInfoPaneWidth","InformationPane","StatusBar","ZoomControl","PropertiesVisible","LegendVisible","tryDescribeRuntimeMapAsync","assertIsDefined","describeRuntimeMap","mapname","requestedFeatures","RuntimeMapFeatureFlags","LayerFeatureSources","LayerIcons","LayersAndGroups","getValueAsync","message","createRuntimeMap","mapDefinition","targetMapName","isMapDefinition","arg","mapDefSelector","projectionSelector","mapDefs","mapPromises","siteVersion","AsyncLazy","getSiteVersion","m","siteVer","describeRuntimeMapStateless","Version","Promise","all","fetchEpsgs","epsg","CoordinateSystem","EpsgCode","MapDefinition","defs","extraEpsgs","f","resolveProjectionFromEpsgIoAsync","debug","register","gs","getResource","username","mdf","Error","rt","Extents","LowerLeftCoordinate","X","MinX","Y","MinY","UpperRightCoordinate","MaxX","MaxY","SiteVersion","DisplayDpi","BackgroundColor","MentorCode","MetersPerUnit","Wkt","IconMimeType","groups","layers","TileSetSource","TileSetDefinition","tsd","TileStoreParameters","TileProvider","sTileWidth","Parameter","find","Value","sTileHeight","strIsNullOrEmpty","TileWidth","parseInt","TileHeight","BaseMapLayerGroup","bg","DisplayInLegend","ShowInLegend","LegendLabel","ObjectId","ExpandInLegend","ActuallyVisible","BaseMapLayer","lyr","Selectable","ParentId","LayerDefinition","MapLayerGroup","grp","MapLayer","Group","Layer","dict","initExternalLayers","externalBaseLayers","ImageFormat","SelectionFormat","layer_name","processLayerInMapGroup","applyInitialBaseLayerVisibility","initialView","mapGroupId","initialExternalLayers","initFromAppDefAsync","fl","sessionAcquiredAsync","resourceId","cl","Client","get","strEndsWith","SESSION","isResourceId","runAsync","resolve","createSession","initSelections","retrieveSelectionSetFromLocalStorage","sset","initialSelections","clearSessionStore","DefaultViewerInitCommand","firstBase","bl","kind","visible","caps","getLayoutCapabilities","_counter","Options","sName","Array","isArray","bAdd","sType","imagerySet","BingMapKey","url","layer","tileJSON","scheme","grids","UrlTemplate","attributions","tilePixelRatio","urls","s","strReplaceAll","initLayout","cmd","opts","getState","args","agentUri","agentKind","then","initPayload","initialActiveMap","initialHideGroups","initialHideLayers","initialShowGroups","initialShowLayers","INIT_APP","onInit","viewer","getViewer","catch","err","processAndDispatchInitError","error","includeStack","stack","INIT_ERROR","acknowledgeInitWarnings","INIT_ACKNOWLEDGE_WARNINGS","setGroupVisibility","LEGEND_SET_GROUP_VISIBILITY","setLayerVisibility","LEGEND_SET_LAYER_VISIBILITY","setGroupExpanded","LEGEND_SET_GROUP_EXPANDABLE","setLayerSelectable","LEGEND_SET_LAYER_SELECTABLE","refresh","state","getRuntimeMap","MAP_REFRESH","combineSelectedFeatureSets","oldRes","newRes","merged","SelectedLayer","layerId","layerName","existing","l","Feature","combineSelectedFeatures","feat","Property","np","combineFeatureSets","Class","ID","concat","setSelection","selectionSet","MAP_SET_SELECTION","selection","queryMapFeatures","getSelectionSet","callback","sv","canUseQueryMapFeaturesV4","queryMapFeatures_v4","persist","append","combineSelections","SelectedFeatures","FeatureSet","Hyperlink","InlineSelectionImage","mergedXml","buildSelectionXml","featurefilter","persistSelectionSetToLocalStorage","failure","errBack","setCurrentView","view","currentView","getCurrentView","newView","dispatchThis","mapState","fs","mapguide","runtimeMap","FiniteDisplayScale","fi","getFiniteScaleIndexForScale","areViewsCloseToEqual","MAP_SET_VIEW","mapResized","width","height","MAP_RESIZED","invokeCommand","invoke","setBusyCount","busyCount","MAP_SET_BUSY_COUNT","setBaseLayer","MAP_SET_BASE_LAYER","setScale","resolution","scaleToResolution","MAP_SET_SCALE","setMouseCoordinates","coord","UPDATE_MOUSE_COORDINATES","setLayerTransparency","opacity","MAP_SET_LAYER_TRANSPARENCY","setViewSizeUnits","unit","MAP_SET_VIEW_SIZE_UNITS","previousView","MAP_PREVIOUS_VIEW","nextView","MAP_NEXT_VIEW","setActiveTool","tool","MAP_SET_ACTIVE_TOOL","setActiveMap","MAP_SET_ACTIVE_MAP","setFeatureTooltipsEnabled","enabled","MAP_SET_MAPTIP","setManualFeatureTooltipsEnabled","MAP_SET_MANUAL_MAPTIP","setViewRotation","rotation","MAP_SET_VIEW_ROTATION","setViewRotationEnabled","MAP_SET_VIEW_ROTATION_ENABLED","showSelectedFeature","selectionKey","MAP_SHOW_SELECTED_FEATURE","mapLayerAdded","defaultStyle","LAYER_ADDED","externalLayersReady","EXTERNAL_LAYERS_READY","removeMapLayer","REMOVE_LAYER","setMapLayerIndex","index","SET_LAYER_INDEX","setMapLayerOpacity","SET_LAYER_OPACITY","setHeatmapLayerBlur","blur","SET_HEATMAP_LAYER_BLUR","setHeatmapLayerRadius","radius","SET_HEATMAP_LAYER_RADIUS","setMapLayerVisibility","SET_LAYER_VISIBILITY","setMapLayerVectorStyle","style","which","SET_LAYER_VECTOR_STYLE","addMapLayerBusyWorker","ADD_LAYER_BUSY_WORKER","removeMapLayerBusyWorker","REMOVE_LAYER_BUSY_WORKER","addClientSelectedFeature","feature","MAP_ADD_CLIENT_SELECTED_FEATURE","clearClientSelection","MAP_CLEAR_CLIENT_SELECTION","showModalComponent","MODAL_SHOW_COMPONENT","showModalUrl","MODAL_SHOW_URL","hideModal","MODAL_CLOSE","goHome","taskpane","TASK_PANE_HOME","goBack","TASK_PANE_BACK","goForward","TASK_PANE_FORWARD","pushUrl","silent","TASK_PANE_PUSH_URL","setElementStates","states","FUSION_SET_ELEMENT_STATE","setTaskPaneVisibility","FUSION_SET_TASK_PANE_VISIBILITY","setSelectionPanelVisibility","FUSION_SET_SELECTION_PANEL_VISIBILITY","setLegendVisibility","FUSION_SET_LEGEND_VISIBILITY","externalBaseLayersGroup","projection","dpi","extent","inPerUnit","getMetersPerUnit","olHas","DEVICE_PIXEL_RATIO","resolutionToScale","updateExternalBaseLayers","getLayers","match","el","setVisible","refreshMap","mode","BaseLayerSetOL","bootstrap","buildPropertyGetter","tryGetAsProperty","val","parseFloat","toLowerCase","deArrayifyRules","rules","getter","Filter","Icon","deArrayifyFeatureStyles","fts","ft","Rule","deArrayifyScaleRanges","scales","MinScale","MaxScale","MDF_INFINITY","FeatureStyle","sc","deArrayifyFeatureSourceInfo","ClassName","Geometry","deArrayifyLayers","FeatureSource","ScaleRange","deArrayifyGroups","deArrayifyCoordinateSystem","cs","deArrayifyCoordinate","deArrayifyExtents","extents","deArrayifyFiniteDisplayScales","fds","deArrayifyFeatureSetClass","root","deArrayifyFeatureSetLayers","deArrayifyFeatureSet","deArrayifyInlineSelectionImage","MimeType","Content","deArrayifyFeatureProperties","deArrayifyFeatures","Bounds","SelectionKey","deArrayifyLayerMetadataProperties","DisplayName","deArrayifyLayerMetadata","deArrayifySelectedLayer","LayerMetadata","deArrayifySelectedFeatures","deArrayifyWebLayoutControl","deArrayifyWebLayoutInfoPane","deArrayifyWebLayoutInitialView","deArrayifyWebLayoutMap","HyperlinkTarget","HyperlinkTargetFrame","deArrayifyTaskButton","Tooltip","Description","ImageURL","DisabledImageURL","deArrayifyWebLayoutTaskBar","taskbar","Home","Forward","Back","Tasks","mb","deArrayifyUIItem","deArrayifyWebLayoutTaskPane","func","item","Function","Command","Label","SubItem","si","deArrayifyItemContainer","container","deArrayifyCommand","TargetViewer","Action","Target","TargetFrame","Prompt","ResultColumns","deArrayifyWebLayoutSearchResultColumnSet","Column","col","MatchLimit","URL","DisableIfSelectionEmpty","LayerSet","deArrayifyWebLayoutInvokeURLLayerSet","AdditionalParameter","deArrayifyWebLayoutParameterPairs","pairs","kvp","Key","Script","deArrayifyWebLayoutCommandSet","set","deArrayifyMapGroup","mapGroup","iview","deArrayifyExtension","deArrayifyMapSet","deArrayifyContainerItems","ImageUrl","ImageClass","deArrayifyContainer","containers","deArrayifyWidgets","widgets","uiw","deArrayifyUiWidget","deArrayifyWidget","WidgetType","arrayCheck","params","StatusText","Disabled","deArrayifyMapWidget","MapId","deArrayifyWidgetSet","ws","MapWidget","deArrayifyMapDefinitionGroups","g","deArrayifyMapDefinitionLayers","deArrayifyTileSetDefinitionLayers","deArrayifyTileSetDefinitionGroups","deArrayifyTileSetDefinitionParamList","deArrayifyTileSetDefinitionParams","isWebLayout","CommandSet","isAppDef","isMapDef","isTileSet","isSiteVersion","isQueryMapFeaturesResponse","deArrayify","deArrayifyRuntimeMap","RuntimeMap","deArrayifyFeatureInformation","FeatureInformation","deArrayifyWebLayout","EnablePingServer","StartupScript","WebLayout","deArrayifyFlexibleLayout","TemplateUrl","ApplicationDefinition","deArrayifyMapDefinition","eGetter","resp","tGetter","deArrayifyTileSetDefinition","join","layerIds","xml","cls","getActiveSelectedFeatureXml","_builders","registerRequestBuilder","factory","createRequestBuilder","isErrorResponse","response","status","serialize","data","uppercase","keyName","encodeURIComponent","toUpperCase","headers","method","statusText","post","format","body","stringifyGetUrl","version","bFirst","password","operation","USERNAME","PASSWORD","text","getServerSessionTimeout","p1","getTileTemplateUrl","groupName","xPlaceholder","yPlaceholder","zPlaceholder","RequestBuilder","MapAgentRequestBuilder","builder","getText","reject","getMapGuideSubState","BLANK_SIZE","h","UnitOfMeasure","RefreshMode","DEFAULT_MODAL_SIZE","KC_ESCAPE","KC_U","NOOP","ALWAYS_FALSE","ALWAYS_TRUE","getInitialView","getExternalBaseLayers","includeNonVisual","ebl","LayerProperty","SourceProperty","MgLayerType","MG_LAYER_TYPE_NAME","MG_BASE_LAYER_GROUP_NAME","MgBuiltInLayers","extend","extent1","extent2","features","isSelectedLayer","fp","properties","fb","bounds","getBounds","b","getLayerId","getName","getFeatureAt","featureIndex","getFeatureCount","getLayerMetadata","CompositeSelectionLayer","mgSelection","clientSelection","layerBounds","getLayerCount","getLayerAt","layerIndex","CompositeSelection","isCommandItem","isFlyoutItem","isSeparatorItem","isBasicCommand","isTargetedCommand","isInvokeURLCommand","isSearchCommand","isSessionExpiredError","exprCache","filterCache","clusterExprCache","clusterFilterCache","parser","Parser","functions","agg_sum","collectionProperty","property","reduce","running","currentItem","arr_size","feat_property","addFilter","expr","parse","addExpr","addClusterFilter","addClusterExpr","cleanValues","vals","getProperties","cvals","evaluateFilter","cache","isClusteredFeature","evaluate","ExprEvalContext","DEFAULT_METERS_PER_UNIT","subjectLayer","metersPerUnit","getSourcesForProgressTracking","sources","getLayersArray","getSource","updateTransparency","trans","showActiveSelectedFeature","mapExtent","size","uri","update","showGroups","showLayers","hideGroups","hideLayers","updateSelectionColor","GenericLayerSetOL","STRINGS","STRINGS_EN","fmt","str","bundle","cloneObject","clonePointWithFill","baseTemplate","fillColor","clone","fill","cloneLineWithFill","clonePolyWithFill","ensureLabelText","isLine","label","textAlign","offsetX","alpha","stroke","placement","ensureLabelTextForStyle","fstyle","line","point","polygon","getLayerInfo","isExternal","hs","HAS_WMS_LEGEND","getLegendUrl","vs","VECTOR_STYLE","toVectorLayerStyle","toClusterSettings","getBlur","getRadius","getVisible","IS_SELECTABLE","LAYER_NAME","LAYER_DISPLAY_NAME","LAYER_DESCRIPTION","LAYER_TYPE","getOpacity","extensions","heatmap","busyWorkerCount","BUSY_WORKER_COUNT","LAYER_METADATA","layerSet","_olFormats","getFormatDrivers","tryGetSubjectLayer","addExternalLayer","extLayer","onlyAddIfNotExists","appSettings","hasLayer","getCustomLayers","addLayer","allowReplace","removeLayer","getLayer","parseFeaturesFromFile","file","that","reader","FileReader","addEventListener","handler","result","formats","loadedType","bLoaded","ii","tryParse","hasFeatures","readAsText","addLayerFromParsedFeatures","extraOptions","labelOnProperty","selectedPopupTemplate","proj","getView","getProjection","SUPPRESS_LOAD_EVENTS","csArgs","distance","clusterDistance","weight","weightProperty","clusterSourceIfRequired","className","declutter","addTo","IS_HEATMAP","IS_EXTERNAL","IS_GROUP","SELECTED_POPUP_CONFIGURATION","clusterSettings","onClick","onClusterClickAction","ClusterClickAction","ShowPopup","clusterStyle","DEFAULT_CLUSTERED_LAYER_STYLE","bStyle","DEFAULT_VECTOR_LAYER_STYLE","geometryTypes","includes","default","getDistinctValues","themeOnProperty","values","baseTemplatePoint","baseTemplateLine","baseTemplatePoly","th","colorBrewerTheme","ramp","Blues","chosenRamp","getMaxRamp","ruleCount","Math","min","palette","setOLVectorLayerStyle","LayerManager","Papa","aliases","header","complete","results","fields","parsed","alias","xc","xColumn","yc","yColumn","first","firstX","firstY","isNaN","d","geometry","coordinates","readFeatures","propNames","getKeys","getGeometryName","ParsedFeatures","pfs","CsvFormatDriver","CSV_COLUMN_ALIASES","_drivers","addFormatDriver","driver","defaultProjection","bHasPoint","bHasLine","bHasPoly","getGeometry","getType","geomTypes","FormatDriver","hasFeaturesFlag","propertyNames","mapProjection","dataProjection","tg","transform","setGeometry","addFeatures","propertyName","HIGHLIGHT_STYLE","font","mainSet","fitViewToExtent","fit","getDpi","getExtent","getLayersForOverviewMap","overviewSet","_customLayers","scratchLayer","IS_SCRATCH","wmsSelOverlayLayer","IS_WMS_SELECTION_OVERLAY","hoverHighlightLayer","IS_HOVER_HIGHLIGHT","addHighlightedFeature","addFeature","removeHighlightedFeature","hasFeature","removeFeature","clearHighlightedFeatures","clear","addWmsSelectionOverlay","clearWmsSelectionOverlay","addScratchFeature","clearScratchLayer","registerSourceEvents","on","addImageLoading","isMapGuideImageSource","onImageError","addImageLoaded","attach","ovMapControl","bSetLayers","insertAt","customLayers","sort","a","order","remove","allLayers","setView","ovMap","getOverviewMap","center","getCenter","getResolution","getSize","detach","ovLayers","getArray","isSelectable","reverse","createOLLayerFromSubjectDefn","bAllow","getLocale","tileLoaders","getTileLoaders","setTileLoadFunction","imageLoaders","getImageLoaders","setImageLoadFunction","theMeasureLayer","layersByName","current","oll","setOpacity","setBlur","setRadius","removed","IS_MEASURE","cCurrentLayers","currentLayers","isGroup","toRemove","rn","bReorder","toAdd","getLength","LayerSetGroupBase","MgLayerSetMode","DEFAULT_BOUNDS_3857","DEFAULT_BOUNDS_4326","blankImageLoadFunction","image","getImage","src","BLANK_GIF_DATA_URI","mockMapGuideImageLoadFunction","getElementById","createElement","visibility","tCtx","getContext","clearRect","canvas","strings","parseUrl","maxSize","measureText","ch","yoff","max","fontSize","query","fillStyle","fillRect","fillText","toDataURL","mgTiledLayers","overlay","selectionOverlay","activeSelectedFeatureOverlay","updateParams","showlayers","showgroups","hidelayers","hidegroups","groupId","SELECTIONCOLOR","LAYER_ID_BASE","restrictToRange","LAYER_ID_MG_BASE","LAYER_ID_MG_SEL_OVERLAY","LayersOnly","SelectionOnly","seq","Date","getTime","makeActiveSelectedFeatureSource","imageExtent","imageSize","setSource","MgLayerSetOL","dynamicOverlayParams","MAPNAME","FORMAT","BEHAVIOR","staticOverlayParams","MAPDEFINITION","CLIENTAGENT","VERSION","selectionOverlayParams","getTileUrlFunctionForGroup","zOrigin","urlTemplate","getClient","tileCoord","z","replace","toString","create","tileWidth","tileHeight","finiteScales","resolutions","tileGrid","origin","olExtent","getTopLeft","tileSize","group","tileSource","tileUrlFunction","wrapX","tileLayer","Tiled","createMgOverlayLayer","Overlay","Stateful","SelectionOverlay","ActiveFeatureSelectionOverlay","OverviewMap","groupOpts","createExternalBaseLayer","extSource","createExternalSource","loaders","getBaseTileLoaders","tl","useImageOverlayOp","overlaySource","createMapGuideSource","useOverlay","ratio","displayDpi","floor","setAttributions","MgInnerLayerSetFactory","getValue","_value","Lazy","isRtMap","hasAgentUri","stateless","tryGetWmsSource","setMapGuideMocking","mock","MapGuideMockMode","RenderPlaceholder","DoNotRender","assertNever","defaultImageLoadFunction","MgLayerSetGroup","createStyle","createStyleFill","createStyleStroke","createStyleCircle","createFeatureCollection","extentContainsXY","containsXY","extendExtent","other","createProjection","transformCoordinateFromLonLat","lonlat","olProj","fromLonLat","transformCoordinate","coordinate","transformExtent","createGeomPoint","createGeomLineString","createGeomCircle","createGeomLinearRing","createGeomPolygon","createGeomPolygonFromCircle","circle","fromCircle","createGeomMultiLineString","createGeomMultiPoint","createGeomMultiPolygon","createGeomCollection","geometries","createVectorSource","createVectorLayer","createOverlay","createInteractionDraw","createInteractionExtent","createInteractionTranslate","createInteractionSnap","createInteractionModify","createInteractionSelect","createFeature","geomOrProps","createFormatGeoJSON","createFormatWKT","createStyleIcon","createStyleRegularShape","createStyleText","OLFactory","toOLColor","asArray","evalFeature","context","isEvaluatable","setIfNotUndefined","prop","buildStroke","buildFill","tryBuildTextStyle","textOpts","maxAngle","offsetY","overflow","rotateWithView","txt","textBaseline","padding","setPadding","setFill","backgroundFill","setBackgroundFill","setStroke","backgroundStroke","setBackgroundStroke","VectorStyleSource","DEFAULT_POINT_CIRCLE_STYLE","DEFAULT_CLUSTERED_POINT_CIRCLE_STYLE","DEFAULT_POINT_ICON_STYLE","anchor","MAP_MARKER_ICON","DEFAULT_COLOR","DEFAULT_LINE_STYLE","DEFAULT_POLY_STYLE","getClusterSubFeatures","DEFAULT_STYLE_KEY","olstyles","OLStyleMapSet","layerStyleFunc","evaluateStyle","bind","setStyle","getOLStyleFunction","isDynamicStroke","isDynamicFill","isDynamicLabel","labelSettings","vectorStyleToStyleMap","ptStyle","lnStyle","plStyle","pts","setImage","deg2rad","lns","pls","ptText","lnText","plsText","setText","buildStyleMap","cpts","cpls","gcs","getStroke","getFill","Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Circle","GeometryCollection","isDynamicPointStyle","apts","isDynamicLineStyle","isDynamicPolygonStyle","origStyleDef","clusterStyleDef","exprContext","clusterRules","defaultStyleMap","getClusterClickAction","gt","matchingStyle","isUIWidget","widget","isFlyoutSpec","children","makeCommand","noToolbarLabels","cmdType","icon","spriteClass","command","tooltip","convertToCommandTarget","fusionCmdTarget","convertWidget","DefaultCommands","Select","Zoom","Factor","ZoomIn","ZoomOut","ZoomExtents","ZoomToSelection","Direction","PreviousView","NextView","CenterSelection","About","Buffer","ClearSelection","CoordinateTracker","FeatureInfo","Geolocation","Help","MapTip","componentName","DefaultComponentNames","MapMenu","Query","QuickPlot","Redline","RefreshMap","SelectPolygon","SelectRadius","SelectWithin","Theme","ViewerOptions","Measure","Print","BaseMapSwitcher","isCommandSpec","isSupportedCommandInStatelessMode","isSeparator","cmdDef","tryTranslateImageUrlToSpriteClass","imageUrl","SPRITE_INVOKE_URL","SPRITE_INVOKE_SCRIPT","commonParams","action","cmdRegister","isStatelessAppDef","prompt","resultColumns","matchLimit","targetFrame","Url","disableIfSelectionEmpty","prepared","flyouts","bFoundContextMenu","FUSION_ICON_REGEX","fixIconPath","path","test","getAssetRoot","fusionFixSpriteClass","iconClass","mergeInvokeUrlParameters","currentParameters","extraParameters","currentP","prev","arr","fixChildItems","childItems","commandInvoker","mapToolbarReference","SPRITE_ICON_ERROR","selected","componentProps","getCommand","reduceAppToToolbarState","hasSelection","hasClientSelection","hasPreviousView","hasNextView","visibleWmsLayerCount","historyIndex","history","visibleAndSelectableWmsLayerCount","activeTool","isNotBusy","disabledIfEmptySelection","CommandConditions","commands","openModalUrl","modalTitle","modal","backdrop","overflowYScroll","openUrlInTarget","TASK_INVOKE_URL","window","frames","bInvoked","location","isInvokeUrlCommand","getFusionRoot","PointZoomLevel","components","registerComponentFactory","getComponentFactory","render","componentId","React","Component","PlaceholderComponent","_vectorCreators","ExternalLayerFactoryRegistry","_instance","getInstance","registerExternalVectorLayerCreator","creator","getExternalVectorLayerCreator","layouts","layoutCaps","registerLayout","getLayout","proj4","ensureProjection","epsgCode","factoryIfNotFound","bAdded","resolvedName","QueryFeaturesSet","_fusionRoot","_viewer","setFusionRoot","setViewer","isReady","countSelection","summary","total","layerCount","isSelectedFeatureSet","ss","encodeKey","sessionId","localStorage","removeItem","setItem","content","getItem","Accordion","panels","isResizing","onActivePanelChanged","activeId","validatePanelId","activePanelId","useState","dim","setDim","openPanel","setOpenPanel","useEffect","onTogglePanel","currentTarget","attributes","ResizeSensor","onResize","entries","contentRect","isOpen","Collapse","contentRenderer","BaseLayerSwitcher","visLayers","STR_EMPTY","setSelected","onBaseLayerChanged","checked","onChange","ColorPicker","isPickerOpen","setIsPickerOpen","disabled","borderRadius","backgroundColor","onPickerToggle","NBSP","Card","HexColorPicker","intent","Intent","PRIMARY","VOID_NOOP","AppContext","createContext","allowHtmlValuesInSelection","getHTMLCleaner","LegendContext","getMapName","isFiltering","getFilterText","getBaseIconSize","getIconMimeType","getChildren","getCurrentScale","getTree","getLayerVisibility","getGroupVisibility","getLayerSelectability","setLayerSelectability","getGroupExpanded","getLayerExpanded","setLayerExpanded","ToolbarContext","normalizeStack","isError","isInitError","errorRenderer","Callout","DANGER","ln","geoJsonVt2GeoJSON","rawType","tags","applyVectorLayerProperties","defn","EMPTY_GEOJSON","def","geometryFunction","POINT","GeoJSON_Inline","GeoJSON","isWebM","sameProjectionAs","proj1","proj2","nproj1","nproj2","equivalent","asVT","geojson_as_vt","gj","featureProjection","writeFeaturesObject","code","units","tileLoadFunction","tile","tileIndex","getTile","geojson","getTileGrid","getTileCoordExtent","setFeatures","vectorLayer","MVT","mo","idProperty","mvtIdProperty","mvtFeatureClass","featureClass","setLoader","arrayBuffer","getFormat","CSV","_extent","_resolution","xhr","XMLHttpRequest","open","onError","onerror","onload","responseText","pf","send","KML","TileWMS","sourceArgs","crossOrigin","CustomVector","sourceCtor","spStyle","display","otherProps","baseSize","ImageIcon","STD_CSS_SPRITE_RELPATH","getAssetPath","AddLayerKind","CreateVectorLayerAs","ADD_URL_LAYER_TYPES","AddWmsLayer","AddWfsLayer","getCreateVectorLayerOptions","Vector","isValid","Themed","Clustered","Heatmap","o","AddFileLayer","isProcessingFile","setIsProcessingFile","isAddingLayer","setIsAddingLayer","addLayerError","setAddLayerError","loadedFile","setLoadedFile","addLayerName","setAddLayerName","addProjection","setAddProjection","createOptions","setCreateOptions","enableLabels","setEnableLabels","setLabelOnProperty","setThemeOnProperty","themableProperties","setThemableProperties","themeToUse","setThemeToUse","createLayerAs","setCreateLayerAs","setClusterDistance","getColorBrewerRamps","themableRamps","clusterClickAction","setClusterClickAction","parsedFeaturesRef","useRef","setParsedFile","parseEpsgCodeFromCRS","onAddFileLayer","useCallback","layerProjection","layerProj","layerMgr","getLayerManager","extraOpts","labelProp","zoomToLayerExtents","toastSuccess","onLayerAdded","toastError","canAdd","Switch","FormGroup","HTMLSelect","colorBrewerLabel","dangerouslySetInnerHTML","__html","ColorBrewerSwatch","theme","NumericInput","onValueChange","ZoomToClusterExtents","NonIdealState","EditableText","href","inline","ButtonGroup","loading","onCancelAddFile","Spinner","NONE","SpinnerSize","LARGE","FileInput","buttonText","onInputChange","files","onFileDropped","AddUrlLayer","selectedUrlType","setSelectedUrlType","lt","onUrlLayerTypeChanged","it","cprops","onAddLayerBusyWorker","onRemoveLayerBusyWorker","AddLayer","File","addLayerKind","setAddLayerKind","RadioGroup","onAddLayerKindChanged","selectedValue","Radio","wfsUrl","setWfsUrl","loadingCapabilities","setLoadingCapabilities","setCaps","setError","onAddLayer","origCrs","wfsWgs84Bounds","resolvedProj","sourceProj","typeNameKey","sourceUrl","vectorFmt","strategy","WGS84_BBOX","li","ControlGroup","InputGroup","leftIcon","placeholder","onWmsUrlChange","readOnly","rightElement","onLoadCaps","WfsCapabilitiesParser","SIZE_LARGE","WfsCapabilitiesPanel","wmsUrl","setWmsUrl","isTiled","LAYERS","STYLE","TILED","Capability","Request","GetMap","DCPType","HTTP","Get","OnlineResource","legendUrl","LegendURL","started","finished","read","WmsCapabilitiesPanel","theScheme","len","ramps","cat","schemeGroups","category","span","border","contrast","colorHex","threshold","rgb","hexToRgb","hex","exec","rgbToYIQ","stringifyExpr","isStrTrue","stringifyExprIf","ExprEditorInner","renderValueEditor","roStyle","useExprEditor","editMode","setEditMode","localValue","setLocalValue","isEditing","setIsEditing","isEditValid","setIsEditValid","onCancelEditing","onApplyValue","onUpdateLocalValue","editButton","minimal","onEditClick","keepChildrenMounted","SUCCESS","NumberExprEditor","oc","loc","SliderExprEditor","labelStepSize","Slider","StringExprEditor","BooleanExprEditor","ColorExprEditor","DEFAULT_SIZE","getLegendImage","row","margin","setTimeout","lineHeight","ctx","save","vectorContext","pixelRatio","typeGeom","setProperties","getStyle","styles","cx","cy","sx","sy","img","imgElt","devicePixelRatio","naturalWidth","load","getAnchor","dx","dy","drawGeometry","rect","clip","restore","OpenPanel","HEATMAP_SLIDER_RAMP","LAYER_SWITCH_STYLE","whiteSpace","textOverflow","ManageLayerItem","canMoveUp","canMoveDown","currentResolution","onSetOpacity","onSetHeatmapBlur","onSetHeatmapRadius","onRemoveLayer","onMoveLayerUp","onMoveLayerDown","onZoomToBounds","onSetVisibility","onVectorStyleChanged","wmsLegendUrl","setWmsLegendUrl","None","toggleOpenPanel","panel","EditVectorStyle","MoreLayerOptions","WmsLegend","marginTop","canZoom","isBoundsZoomable","iconName","extraActions","isWms","onToggleWmsLegend","isWmsLegendOpen","layerLabel","theVectorStyle","Base","Cluster","enableLine","enablePoint","enablePolygon","labelElement","stepSize","labelValues","VectorLayerStyleEditor","ManageLayers","setLayers","cannotMoveUp","cannotMoveDown","tabName","crs","isGeoJsonMimeType","mimeType","lmt","abstract","marginBottom","geoJsonFmt","getGeoJsonFormat","serviceInfo","lformats","sformats","allowedOutputFormats","getLayerCrs","pdc","defaultCrs","otherCrs","matches","poc","otherActions","paddingTop","tryGetElementContent","textContent","getElements","tagName","ns","els","getElementsByTagName","elements","trySetProperty","setter","DOMParser","xmlDoc","parseFromString","getServiceInfo","t","op","getAttribute","parm","allowedValues","av","n","fel","os","fmts","ll","ur","llParts","urParts","wgs84Bounds","extractWmsLayers","rootLayer","Style","Service","Abstract","vertical","alignText","queryable","UL_LIST_STYLE","listStyle","paddingLeft","LI_LIST_STYLE","ROW_ITEM_ELEMENT_STYLE","verticalAlign","CHK_STYLE","EMPTY_STYLE","inner","legendCtx","useContext","toLocaleLowerCase","idx","getIconUri","iconMimeType","iconBase64","EmptyNode","RuleNode","rule","LayerNode","chkbox","layerVisible","setLayerVisible","getExpanded","expanded","onToggleExpansion","bs","iconSize","onToggleSelectability","onVisibilityChanged","nodeStyle","scaleRange","ruleElements","totalRuleCount","ftsRuleCount","bCompressed","count","ExternalLayerNode","useReduxDispatch","iconToUse","ExternalLayersGroupNode","GroupNode","groupVisible","setGroupVisible","currentScale","tree","isExpanded","isLayer","isLayerVisibleAtScale","isGroupVisibleAtScale","groupChildren","sr","scaleRangeBetween","child","itemTextFilter","setupTree","Layers","Groups","LayerMap","GroupMap","remainingGroups","itemCount","objId","removeIds","Legend","setState","_tree","maxHeight","setIsFiltering","filterText","setFilterText","filteredTree","setFilteredTree","onExitFilterMode","onFilterUpdate","buildFilteredTree","filtered","oid","rootStyle","providerImpl","baseIconSize","objectId","onGroupVisibilityChanged","onLayerVisibilityChanged","overrideSelectableLayers","onLayerSelectabilityChanged","overrideExpandedItems","onGroupExpansionChanged","daTree","rootItems","Provider","inlineBaseLayerSwitcher","round","autoFocus","onEnterFilterMode","right","top","bGroupVisAtScale","bGroupVisFilter","externalLayers","MapLoadIndicator","loaded","pc","toFixed","zIndex","left","background","transition","bottom","onActiveMapChanged","selectedMap","inflateBoundsByMeters","thisProj","meters","webmBounds","webmBounds2","buffer","isMiddleMouseDownEvent","button","recursiveFindLayer","predicate","useViewerSideEffects","layerManager","added","browserWindow","olFactory","onBeginDigitization","_comp","onDispatch","_map","_busyWorkers","_layerSetGroups","_tileSourceLoaders","_imageSourceLoaders","_wmsQueryAugmentations","_triggerZoomRequestOnMoveEnd","ism","navigator","userAgent","_supportsTouch","phone","tablet","baseInitialState","viewRotation","viewRotationEnabled","cancelDigitizationKey","undoLastPointKey","_state","getInitialProviderState","exportImage","once","mapCanvas","mapContext","prototype","call","querySelectorAll","parentNode","globalAlpha","Number","matrix","CanvasRenderingContext2D","setTransform","drawImage","exportMimeType","renderSync","addBaseTileLoadFunction","_baseTileSourceLoaders","addTileLoadFunction","addImageLoadFunction","addWmsQueryAugmentation","addCustomSelectionPopupRenderer","renderer","_customSelectionPopupRenderers","_globalCustomSelectionPopupRenderer","getSelectionPopupRenderer","hideAllPopups","_mouseTooltip","_selectTooltip","hide","mapguideSupport","getOLFactory","getViewRotation","isViewRotationEnabled","_toasterRef","show","toastWarning","WARNING","toastPrimary","dismissToast","dismiss","addSubscribers","removeSubscribers","names","getSubscribers","getDefaultPointCircleStyle","getDefaultPointIconStyle","getDefaultLineStyle","getDefaultPolygonStyle","getBaseTileSourceLoaders","getTileSourceLoaders","getImageSourceLoaders","getMockMode","addFeatureToHighlight","bAppend","getLayerSetGroup","sf","_select","getFeatures","getScaleForExtent","activeLayerSet","mcsW","getWidth","mcsH","getHeight","devW","devH","metersPerPixel","getViewForExtent","inflatedBounds","onZoomSelectBox","_zoomSelectBox","selectFeaturesByExtent","onMouseMove","handleMouseTooltipMouseMove","handleHighlightHover","isContextMenuOpen","incrementBusyWorker","decrementBusyWorker","applyView","vw","setCenter","setResolution","removeActiveDrawInteraction","_activeDrawInteraction","removeInteraction","setDigitizingType","getActiveTool","cancelDigitization","isDigitizing","clearMouseTooltip","pushDrawInteraction","digitizingType","draw","cancel","setMouseTooltip","geom","addInteraction","zoomByDelta","delta","currentZoom","getZoom","newZoom","getConstrainedZoom","getAnimating","cancelAnimations","animate","zoom","duration","easing","olEasing","easeOut","ensureAndGetLayerSetGroup","nextState","initLayerSet","isMouseOverTooltip","isMouseOver","isLayerHoverable","dragging","pixel","getEventPixel","originalEvent","forEachFeatureAtPixel","_highlightedFeature","hideSelectedVectorFeaturesTooltip","showSelectedVectorFeatures","featureToLayerMap","queryWmsFeatures","bAppendMode","getWmsRequestAugmentations","theFeature","clearClientSelectedFeatures","onMapClick","onHideContextMenu","zoomBounds","currentFeatures","createEmpty","zoomToExtent","px","madeSelection","onProviderMapClick","initContext","overviewMapElementSelector","overviewMapOpts","tipLabel","collapseLabel","String","fromCharCode","ReactDOM","findDOMNode","collapsed","collapsible","_ovMap","addControl","onBeforeAttachingLayerSetGroup","layerSetGroup","setToasterRef","ref","onKeyDown","cancelKey","undoKey","keyCode","removeLastPoint","getInteractions","inter","detachFromComponent","dispose","_boundZoomSelectBox","un","_boundClick","_boundMouseMove","_boundResize","_boundMoveEnd","setTarget","setMap","onMoveEnd","frameState","viewState","attachToComponent","comp","condition","startingMiddleMouseDrag","mapOptions","interactions","MouseTrackingTooltip","SelectedFeaturesTooltip","zoomToView","ov","getOLView","getCurrentExtent","calculateExtent","zoomDelta","digitizePoint","digitizeLine","LINE_STRING","minPoints","maxPoints","digitizeLineString","digitizeCircle","CIRCLE","digitizeRectangle","geomFunc","start","end","setCoordinates","digitizePolygon","POLYGON","interaction","addOverlay","removeOverlay","addHandler","eventName","removeHandler","updateSize","getLayerManagerForLayerSet","screenToMapUnits","mapDevW","mapDevH","extX1","extY1","getSelectedFeatures","getPointSelectionBox","ptBuffer","getCoordinateFromPixel","updateOverviewMapElement","setCollapsed","setCollapsible","BaseMapProviderContext","MapProviderContext","ReduxProvider","store","useDispatch","useAppState","selector","equalityFn","useSelector","MapProviderContextProvider","useMapProviderContext","MapContextProvider","useMapGuideViewerState","bgColor","activeSelectedFeatureXml","useViewerActiveTool","useActiveMapView","useViewerViewRotation","useViewerViewRotationEnabled","useActiveMapName","useViewerLocale","useActiveMapExternalBaseLayers","useConfiguredCancelDigitizationKey","useConfiguredUndoLastPointKey","useActiveMapLayers","useActiveMapInitialExternalLayers","useCustomAppSettings","subject","useActiveMapSubjectLayer","useViewerIsStateless","useViewerImageFormat","useConfiguredAgentUri","useConfiguredAgentKind","useActiveMapState","useViewerPointSelectionBuffer","useViewerFeatureTooltipsEnabled","manualFeatureTooltips","useConfiguredManualFeatureTooltips","useActiveMapSessionId","useViewerSelectionColor","useViewerSelectionImageFormat","selectableLayerNames","useActiveMapSelectableLayerNames","layerTransparency","useActiveMapLayerTransparency","useActiveMapShowGroups","useActiveMapHideGroups","useActiveMapShowLayers","useActiveMapHideLayers","activeSelectedFeature","useActiveMapActiveSelectedFeature","activeSelectedFeatureColor","useViewerActiveFeatureSelectionColor","useActiveMapSelectionSet","theMap","isMapGuideProviderState","mockMode","onOpenTooltipLink","fixedUrl","_wktFormat","refreshOnStateChange","_refreshOnStateChange","getHookFunction","setMockMode","_featureTooltip","setEnabled","getProviderName","getSelection","getSelectionXml","getSessionId","setFeatureTooltipEnabled","onSessionExpired","queryFeatureTooltip","box","fromExtent","buildDefaultQueryOptions","maxfeatures","sendSelectionQuery","handleFeatureTooltipMouseMove","_utfGridTooltip","isEnabled","raiseQueryFromPoint","enableFeatureTooltips","refreshMapInternal","featureXml","_client","selectionformat","selectioncolor","requestdata","layerattributefilter","dataUri","_keepAlive","lastTry","getSelectableLayers","reqQueryFeatures","wkt","writeGeometry","layernames","getAgentUri","getAgentKind","isFeatureTooltipEnabled","pt","openTooltipLink","bCheckSession","SessionKeepAlive","utfGridLayer","UTFGridTrackingTooltip","FeatureQueryTooltip","setProviderState","bChangedView","oldLayerSet","newLayerSet","layerTransparencyChanged","areArraysDifferent","bViewChanged","setRotation","enableRotation","getResolutions","minResolution","getMinResolution","maxResolution","getMaxResolution","maxZoom","getMaxZoom","minZoom","getMinZoom","bDiffSelectionXml","bRefreshActiveFeatureSelection","me","setSelectionXml","queryOpts","success","qOrig","queryOptions","clearSelection","selectByGeometry","selectionMethod","selectionvariant","MapGuideMapProviderContext","MapDebugContext","MouseCoordinates","formatCoordinates","coords","decimals","sfmt","strTrim","ZoomDirection","PanDirection","LN9","calculatePosForScale","finiteScaleList","pos","calculateScaleForPos","pow","Navigator","busy","previewPos","setPreviewPos","setPos","isDragging","setIsDragging","onPanEast","onPan","East","shape","alt","onPanWest","West","onPanSouth","South","onPanNorth","North","onZoomOut","onZoom","Out","onZoomIn","In","IMG_SLIDER_SCALE","useMap","GIF_SPINNER","axis","handle","VERT_START","onStart","preventDefault","onDrag","deltaY","onStop","newScale","onRequestZoomToScale","IMG_SLIDER","dragLabel","ScaleDisplay","onScaleChanged","localScale","setLocalScale","fiScale","onFiniteScaleChanged","onScaleInputChanged","onKeyPress","onScaleKeyPressed","SelectedFeatureCount","DefaultSelectedFeature","selectedFeature","selectedLayer","allowHtmlValues","cleanHTML","featureProps","lp","SELECTION_TOOLBAR_STYLE","float","DEFAULT_TOOLBAR_SIZE","SELECTION_PANEL_TOOLBAR_STYLE","TOOLBAR_BACKGROUND_COLOR","LAYER_COMBO_STYLE","FloatClear","SelectionPanel","selectedFeatureRenderer","onShowSelectedFeature","onRequestZoomToFeature","selectedLayerIndex","setSelectedLayerIndex","setFeatureIndex","selBodyStyle","getCurrentLayer","getCurrentFeature","canGoPrev","canGoNext","canZoomSelectedFeature","prevFeature","newIndex","sKey","nextFeature","zoomSelectedFeature","onSelectedLayerChanged","selLayer","overflowY","selectionToolbarItems","buildToolbarItems","selPanel","bpIconName","lid","lname","lkey","onResolveLayerLabel","Toolbar","containerStyle","getSession","check","tm","interval","timeoutID","tick","clearTimeout","currentUrlDoesNotMatchMapName","currentUrl","normUrl","TASK_PANE_OVERLAY_BGCOLOR","onCloseFlyout","onOpenFlyout","onFrameMounted","iframe","_iframe","taskPaneId","FUSION_TASKPANE_NAME","onFrameLoaded","frame","contentWindow","frameContentLoaded","onUrlLoaded","taskButtons","homeAction","backAction","forwardAction","activeComponent","invalidated","componentDidUpdate","prevProps","nextProps","lastUrlPushed","loadUrl","componentDidMount","compUri","parseComponentUri","activeComponentProps","showTaskBar","taskMenu","flyoutAlign","taskBarStyle","taskBodyStyle","taskFrameStyle","taskComponentContainerStyle","flyoutStates","cpp","onLoad","SVG_SIZE_RATIO","getSelected","sel","getEnabled","en","getIconElement","iconStyle","getIconStyle","getFlyoutIconElement","isFlownOut","getTooltip","tt","getItemStyle","pad","paddingRight","paddingBottom","borderWidth","vertPad","FlyoutMenuChildItem","setIsMouseOver","getMenuItemStyle","cursor","iconEl","onMouseEnter","onMouseLeave","onInvoked","ComponentFlyoutItem","toolbarCtx","ttip","getBoundingClientRect","posX","posY","FlyoutMenuReferenceItem","menu","align","ToolbarSeparator","getToolbarSeparatorItemStyle","marginLeft","marginRight","ToolbarButton","hideVerticalLabels","containerClass","onOpenComponent","onCloseComponent","isNumeric","isComponentFlyout","isMenuRef","setLinkClickHandler","linkElement","onclick","handleLinkClick","wktFormat","featureTooltipElement","featureTooltip","element","offset","positioning","CENTER_LEFT","throttledMouseMove","sendTooltipQuery","innerHTML","classList","add","setPosition","html","contextMenuTest","getViewport","onMouseOut","tooltipElement","destroy","removeChild","defaultPopupContentRenderer","popupConfig","bClustered","clusteredTitle","singlePopupContentRender","appendHtml","renderForSingle","linkFragment","table","propertyMappings","pm","linkProperty","linkTarget","linkHref","encodeURI","expression","pBegin","placeholderBegin","pEnd","placeholderEnd","extractPlaceholderTokens","al","subFeatures","renderForMultiple","fheadings","pn","fprops","parent","setPopupCloseHandler","closerEl","closePopup","currentLayerSet","wmsSources","currentWmsSource","wmsLayer","pair","getFeatureInfoUrl","augs","srcProj","popupConf","generateFeatureHtml","customRenderer","gridSource","viewResolution","forDataAtCoordinateAndResolution","MG_TOOLTIP","MG_URL","ExprEditor","assertValue","onExprChanged","converter","DynamicSwitch","rest","innerProps","buildFont","bold","italic","LabelStyleEditor","setBold","setItalic","localBgColor","setLocalBgColor","localBgColorAlpha","localStrokeColor","setLocalStrokeColor","localStrokeWidth","setLocalStrokeWidth","localFontSize","setLocalFontSize","localLabel","setLocalLabel","hasLabel","setHasLabel","onToggleLinePlacement","coalesceExpr","defaultVal","active","PointIconStyleEditor","localSrc","setLocalSrc","PointCircleStyleEditor","PointStyleEditor","setIconStyle","circleStyle","setCircleStyle","currentStyle","setCurrentStyle","onStyleTypeChange","applyCurrentStyle","LineStyleEditor","PolygonStyleEditor","VectorStyleEditor","selectedTab","setSelectedTab","pointStyle","setPointStyle","lineStyle","setLineStyle","polyStyle","setPolyStyle","onStyleChanged","poly","newStyle","Tabs","selectedTabId","Tab","onPointStyleChanged","onLineStyleChanged","onPolygonStyleChanged","FilterItem","isDefault","isStyleEditorOpen","featureStyle","localFilter","setLocalFilter","isLocalFilterValid","setIsLocalFilterValid","pointStyleUrl","setPointStyleUrl","lineStyleUrl","setLineStyleUrl","polyStyleUrl","setPolyStyleUrl","bHaveVar","bHaveOperator","tokens","ls","olstyle","cPoint","cLineString","cPolygon","colSpan","filterExprEd","onToggle","onToggleStyleEditor","onInnerStyleChanged","filters","openStyleEditors","setOpenStyleEditors","onFeatureStyleChanged","updatedStyle","opEds","isVisible","ViewSizeContent","gw","gh","ViewSize","precision","uom","getUnitOfMeasure","getMapSize","abbreviation","DEG","EMPTY_OBJECT","FUSION_MAP_NAME","FUSION_REDLINE_NAME","ICON_ERROR","SPRITE_GLOBE_ADD","SPRITE_LAYER_ADD","SPRITE_COORDINATE_TRACKER","SPRITE_CONTROL_180","SPRITE_CONTROL","SPRITE_ICON_ZOOMSELECT","SPRITE_LEGEND_LAYER","SPRITE_ICON_SELECT","SPRITE_LC_UNSELECT","SPRITE_LEGEND_THEME","SPRITE_LEGEND_RASTER","SPRITE_LEGEND_TOGGLE","SPRITE_LEGEND_TOGGLE_EXPAND","SPRITE_FOLDER_HORIZONTAL","SPRITE_ICON_HOME","SPRITE_BACK","SPRITE_FORWARD","SPRITE_ICON_MENUARROWUP","SPRITE_ICON_MENUARROW","SPRITE_SELECT","SPRITE_PAN","SPRITE_ZOOM_IN","SPRITE_ZOOM_IN_FIXED","SPRITE_ZOOM_OUT_FIXED","SPRITE_ZOOM_FULL","SPRITE_MAPTIP","SPRITE_PAN_WEST","SPRITE_PAN_EAST","SPRITE_PAN_NORTH","SPRITE_PAN_SOUTH","SPRITE_ABOUT","SPRITE_HELP","SPRITE_MEASURE","SPRITE_PRINT","SPRITE_OPTIONS","SPRITE_SELECT_RADIUS","SPRITE_SELECT_POLYGON","SPRITE_INITIAL_CENTER","SPRITE_SELECT_CLEAR","SPRITE_ICON_REFRESHMAP","SPRITE_VIEW_BACK","SPRITE_VIEW_FORWARD","SPRITE_GEOLOCATION","SPRITE_BUFFER","SPRITE_SELECT_FEATURES","SPRITE_REDLINE","SPRITE_FEATURE_INFO","SPRITE_QUERY","SPRITE_THEME","SPRITE_SELECT_CENTRE","SPRITE_GLOBE_SHARE","ll_bbox","isFinite","AddManageLayersContainer","getLayerIndex","renderActiveTabPanelOnly","SIZE_STANDARD","setHeatmapBlur","setHeatmapRadius","setVisibility","zoomToBounds","downHandler","upHandler","updateVectorStyle","initErrorRenderer","configuredLocale","initOptions","renderErrorMessage","isLoading","selectionSettings","getHtmlCleaner","cleanHtml","setElementVisibility","initCommand","getStateFromUrl","urlPropsIgnore","urlLocale","urlResource","urlSession","urlX","urlY","urlFeatureTooltip","urlScale","urlMap","urlShowLayers","urlHideLayers","urlShowGroups","urlHideGroups","initialElementVisibility","legend","taskPaneVisible","legendVisible","selectionPanelVisible","fusionRoot","ftArgs","amArgs","ivArgs","slArgs","hlArgs","sgArgs","hgArgs","curUrlState","nextUrlState","resource","am","mgs","rtm","sg","hg","hl","updateUrl","msg","layoutEl","App","useInitError","useInitErrorStack","useInitErrorOptions","useActiveMapBranch","ftEnabled","AppInner","initLayoutAction","BaseLayerSwitcherContainer","setBaseLayerAction","CoordinateTrackerContainer","projections","mouse","useCurrentMouseCoordinates","useActiveMapProjection","NaN","generic","useActiveMapSelectableLayers","getActiveMapBranch","selectableLayers","useActiveMapMetersPerUnit","mpu","ms","useActiveMapExpandedGroups","expandedGroups","useActiveMapFiniteScales","useActiveMapClientSelectionSet","usePrevious","sameHeatmapSettings","useActiveMapWidth","useActiveMapHeight","useViewerSizeUnits","useViewerFlyouts","toolbar","useInitWarnings","initError","useActiveMapInitialView","useAvailableMaps","useViewerBusyCount","useConfiguredCoordinateProjection","useConfiguredCoordinateDecimals","useConfiguredCoordinateFormat","useIsContextMenuOpen","useConfiguredLoadIndicatorPositioning","useConfiguredLoadIndicatorColor","useConfiguredCapabilities","useTemplateLegendVisible","template","useTemplateTaskPaneVisible","useTemplateSelectionVisible","useTemplateInitialInfoPaneWidth","useTemplateInitialTaskPaneWidth","useTaskPaneInitialUrl","useTaskPaneNavigationIndex","useTaskPaneLastUrlPushed","useTaskPaneNavigationStack","useLastDispatchedAction","useReducedToolbarAppState","tbState","LegendContainer","setGroupVisibilityAction","setLayerVisibilityAction","setLayerSelectableAction","setGroupExpandedAction","MapMenuContainer","availableMaps","setActiveMapAction","MouseCoordinatesContainer","prj","getUnits","Degrees","Pixels","Meters","Feet","NavigatorContainer","invokeCommandAction","setScaleAction","direction","PanRight","PanLeft","PanUp","PanDown","subscribers","ol","onContextMenu","mounted","clientX","clientY","shiftKey","onKeyUp","onMouseDown","isMouseDown","onMouseUp","newLoading","newLoadedCount","mapNode","componentWillUnmount","CURSOR_DIGITIZE_POINT","CURSOR_DIGITIZE_LINE","CURSOR_DIGITIZE_LINESTRING","CURSOR_DIGITIZE_RECT","CURSOR_DIGITIZE_POLYGON","CURSOR_DIGITIZE_CIRCLE","CURSOR_GRABBING","CURSOR_GRAB","CURSOR_ZOOM_IN","loadIndicatorPosition","loadIndicatorColor","Subscriber","MapViewer","toasterRef","loadIndicatorPositioning","hookFunc","bContextMenuOpen","showContextMenuAction","Toaster","usePortal","Position","TOP","CoreMapViewer","hideContextMenuAction","ScaleDisplayContainer","SelectedFeatureCountContainer","SelectionPanelContainer","appContext","compSel","resolveLayerLabel","_","onZoomToSelectedFeature","bbox","setCurrentViewAction","showSelectedFeatureAction","appStateSelector","appStateEqualityFn","onNewState","navigationStack","navIndex","areUrlsSame","canGoHome","initUrl","canGoBack","canGoForward","fid","TaskPaneContainer","TaskPaneContainerInner","goHomeAction","goForwardAction","goBackAction","pushUrlAction","openFlyoutAction","closeFlyoutAction","extraState","appendParameters","replaceState","ignoreKeys","parseUrlParameters","ignore","ViewSizeContainer","sizeUnits","Unknown","viewSizeUnits","setLayerTransparencyAction","onMgLayerOpacityChanged","onBaseOpacityChanged","onManualFeatureTooltipsChanged","toggleManualMapTipsAction","opBase","opMgBase","opMgSelOverlay","onFeatureTooltipsChanged","toggleMapTipsAction","onMgOpacityChanged","onMgSelOpacityChanged","onViewSizeUnitsChanged","setViewSizeDisplayUnitsAction","u","ui","localizedName","CONFIG_INITIAL_STATE","configReducer","mapNames","state1","newState","coordConfig","viewerConfig","state2","INIT_ERROR_INITIAL_STATE","initErrorReducer","NULL_ACTION","lastAction","isAction","applyMapGuideSubState","applyFn","subState","mgSubState","toApply","mgSubState1","mergeSubState","setLayerAction","MAP_STATE_INITIAL_STATE","MG_INITIAL_SUB_STATE","MAP_STATE_INITIAL_SUB_STATE","mapStateReducer","mapKeys","mapNameToApplyInitialState","cv","isel","mrtm","mgeneric","isl","isg","ihl","ihg","newMgSubState","newMapState","view1","newSubState","splice","isMapView","currentIdx","theLayer","MODAL_INITIAL_STATE","modalReducer","newData","component","MOUSE_INITIAL_STATE","mouseReducer","isCoordinate","rootReducer","templateReducer","viewerReducer","toolbarReducer","taskPaneReducer","lastaction","mergeNavigatedUrl","nav","navigation","TASK_PANE_INITIAL_STATE","_ovReducer","isElementState","TEMPLATE_INITIAL_STATE","autoDisplaySelectionPanelOnSelection","setCustomTemplateReducer","origState","mergeFlyoutState","flyoutPayload","flyoutUpdateAction","closeOtherFlyouts","bSettingStates","updateSpec","flyoutUpdateSpec","mergeFlyoutCloseState","TOOLBAR_INITIAL_STATE","VIEWER_INITIAL_STATE","_getMiddleware","middleware","promiseMiddleware","applyMiddleware","configureStore","initialState","extraReducers","combineReducers","compose","_getEnhancers","enhancers","__REDUX_DEVTOOLS_EXTENSION__","createStore","createLogger","stateTransformer","next","isPromise","promise","types","PENDING","FULFILLED","REJECTED","p2","p3","testSelSheboygan","MapStoryFrame","includeSelect","doTestSelect","q","getQueryMapFeaturesResponse","doClearSelection","storiesOf","withKnobs","storyFn","FakeApp","mgMockMode","setExpr","number","act","setColor","onSetColor","boolean","layerStyle","setLayerStyle","defaultValue","select","PANELS","testMapSheboygan","testMapRedding","testMapMelbourne","testAppDef","PROVIDER_IMPL","endsWith","FakeMapAgent","_agentUri","_agentKind","initState","Sheboygan","_store","_initCommand","templateLayout","mRoot","ICON_ZOOM_OUT_FIXED","setAssetRoot","getRelativeIconPath","optionalParams","SHIM_EPSILON","getClosestScaleIndex","abs","lower","upper","areNumbersEqual","epsilon","EPSILON","minScale","maxScale","deg","PI","rad2deg","radians","sum","array","numSelector","roundTo","num","sMaj","sMin","sPatch","sRev","vMaj","vMin","vPatch","vRev","word","suffix","trim","delimBegin","delimEnd","regex","RegExp","isModalDisplayOptions","isModalComponentDisplayOptions","isMenu","mUnits","unitsPerMeter","getUnitsOfMeasure","Centimeters","DecimalDegrees","DMS","Inches","Kilometers","Miles","Millimeters","NauticalMiles","Yards","displaySize","prec","factor","DEFAULT_PARSE_OPTIONS","ignoreQueryPrefix","isComponentUri","qi","bOverwriteExisting","bConvertToUppercase","bDiscardExistingParams","currentParams","paramNames","params2","protocol","url1","url2","parsed1","parsed2","params1","slashes","auth","host","hostname","port","pathname","hash","areParamsEqual","keys1","arraysEqual","bNeedMapName","bNeedSession","bNeedLocale","LOCALE","stringifyQuery","otherView","areMapsSame","otherLayers","___CSS_LOADER_EXPORT___","___CSS_LOADER_URL_REPLACEMENT_0___","webpackContext","req","webpackContextResolve","__webpack_require__","webpackContextKeys","exports"],"sourceRoot":""}